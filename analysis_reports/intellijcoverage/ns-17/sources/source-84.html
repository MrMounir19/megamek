


<!DOCTYPE html>
<html id="htmlId">
<head>
  <title>Coverage Report > QuirksHandler</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">megamek.common</a>
</div>

<h1>Coverage Summary for Class: QuirksHandler (megamek.common)</h1>

<table class="coverageStats">
<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Class, %
</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">QuirksHandler</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    9.5%
  </span>
  <span class="absValue">
    (2/21)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    2.1%
  </span>
  <span class="absValue">
    (6/283)
  </span>
</td>
</tr>

</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;/*
&nbsp; * MegaMek - Copyright (C) 2003, 2004 Ben Mazur (bmazur@sev.org)
&nbsp; *
&nbsp; *  This program is free software; you can redistribute it and/or modify it
&nbsp; *  under the terms of the GNU General Public License as published by the Free
&nbsp; *  Software Foundation; either version 2 of the License, or (at your option)
&nbsp; *  any later version.
&nbsp; *
&nbsp; *  This program is distributed in the hope that it will be useful, but
&nbsp; *  WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
&nbsp; *  or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License
&nbsp; *  for more details.
&nbsp; */
&nbsp;
&nbsp;package megamek.common;
&nbsp;
&nbsp;import java.io.BufferedWriter;
&nbsp;import java.io.File;
&nbsp;import java.io.FileOutputStream;
&nbsp;import java.io.IOException;
&nbsp;import java.io.OutputStreamWriter;
&nbsp;import java.io.Writer;
&nbsp;import java.util.ArrayList;
&nbsp;import java.util.Enumeration;
&nbsp;import java.util.HashMap;
&nbsp;import java.util.List;
&nbsp;import java.util.Map;
&nbsp;import java.util.Set;
&nbsp;import java.util.concurrent.atomic.AtomicBoolean;
&nbsp;
&nbsp;import javax.xml.parsers.DocumentBuilder;
&nbsp;
&nbsp;import megamek.common.annotations.Nullable;
&nbsp;import megamek.common.logging.DefaultMmLogger;
&nbsp;import megamek.common.logging.MMLogger;
&nbsp;import megamek.common.options.IOption;
&nbsp;import megamek.common.options.IOptionGroup;
&nbsp;import megamek.common.options.Quirks;
&nbsp;import megamek.common.options.WeaponQuirks;
&nbsp;import megamek.utils.MegaMekXmlUtil;
&nbsp;
&nbsp;import org.w3c.dom.Document;
&nbsp;import org.w3c.dom.Element;
&nbsp;import org.w3c.dom.NodeList;
&nbsp;
&nbsp;/**
&nbsp; * This class loads the quirks lists from the data/canonUnitQuirks.xml and /mmconf/unitQuirksOverride.xml files.
&nbsp; *
&nbsp; * @author Deric &quot;Netzilla&quot; Page (deric dot page at usa dot net)
&nbsp; * @version %I% %G%
&nbsp; * @since 2012-03-05
&nbsp; */
&nbsp;public class QuirksHandler {
&nbsp;    
&nbsp;    private static final String CUSTOM_QUIRKS_FOOTER = &quot;&lt;/unitQuirks&gt;&quot;;
&nbsp;    private static final String CUSTOM_QUIRKS_HEADER;
&nbsp;    
&nbsp;    static {
<b class="fc">&nbsp;        CUSTOM_QUIRKS_HEADER = &quot;&lt;?xml version=\&quot;1.0\&quot; encoding=\&quot;UTF-8\&quot;?&gt;\n\n&quot; +</b>
&nbsp;                               &quot;&lt;!--\n&quot; +
&nbsp;                               &quot;NOTE: saving quirks for units within MM will cause this file to get re-written and all changes will be lost!\n\n&quot; +
&nbsp;                               &quot;This file allows users to customize the default cannon quirks list.  Any quirk assignments in this file will override\n&quot; +
&nbsp;                               &quot;  the cannon quirk entries entirely.  Changes to this file will not take effect until the next time megamek is launched.\n\n&quot; +
&nbsp;                               &quot;To assign a unit a quirk, the entry should be in the following format:\n&quot; +
&nbsp;                               &quot;    &lt;unit&gt;\n&quot; +
&nbsp;                               &quot;        &lt;chassis&gt;[chassis name]&lt;/chassis&gt;\n&quot; +
&nbsp;                               &quot;        &lt;model&gt;{model}&lt;/model&gt;\n&quot; +
&nbsp;                               &quot;        &lt;quirk&gt;[quirk1 name]&lt;/quirk&gt;\n&quot; +
&nbsp;                               &quot;        &lt;quirk&gt;[quirk2 name]&lt;/quirk&gt;\n&quot; +
&nbsp;                               &quot;        &lt;weaponQuirk&gt;\n&quot; +
&nbsp;                               &quot;            &lt;weaponQuirkName&gt;[weapon quirk 1 name]&lt;/weaponQuirkName&gt;\n&quot; +
&nbsp;                               &quot;            &lt;location&gt;[location of weapon]&lt;/location&gt;\n&quot; +
&nbsp;                               &quot;            &lt;slot&gt;[critical slot of weapon]&lt;/slot&gt;\n&quot; +
&nbsp;                               &quot;            &lt;weaponName&gt;[name of weapon]&lt;/weaponName&gt;\n&quot; +
&nbsp;                               &quot;        &lt;/weaponQuirk&gt;\n&quot; +
&nbsp;                               &quot;        &lt;weaponQuirk&gt;\n&quot; +
&nbsp;                               &quot;            &lt;weaponQuirkName&gt;[weapon quirk 2 name]&lt;/weaponQuirkName&gt;\n&quot; +
&nbsp;                               &quot;            &lt;location&gt;[location of weapon]&lt;/location&gt;\n&quot; +
&nbsp;                               &quot;            &lt;slot&gt;[critical slot of weapon]&lt;/slot&gt;\n&quot; +
&nbsp;                               &quot;            &lt;weaponName&gt;[name of weapon]&lt;/weaponName&gt;\n&quot; +
&nbsp;                               &quot;        &lt;/weaponQuirk&gt;\n&quot; +
&nbsp;                               &quot;    &lt;/unit&gt;\n\n&quot; +
&nbsp;                               &quot;The \&quot;model\&quot; field can be left blank if there is no model number for the unit (common for some tank chassis), but the\n&quot; +
&nbsp;                               &quot;  tags should still be included.  A &lt;model&gt; of \&quot;all\&quot; will cause all units with the same &lt;chassis&gt; to have the defined\n&quot; +
&nbsp;                               &quot;  quirks.  This can later be overridden with entries for specific models.\n\n&quot; +
&nbsp;                               &quot;Multiple quirks should be contained within separate \&quot;quirk\&quot; tags.\n\n&quot; +
&nbsp;                               &quot;Multiple weapon quirks should be contained within separate \&quot;weaponQuirk\&quot; structures, even if multiple quirks apply to\n&quot; +
&nbsp;                               &quot;  the same weapon.\n\n&quot; +
&nbsp;                               &quot;The proper names for quirks can be found in the\n&quot; +
&nbsp;                               &quot;  l10n/megamek/common/options/messages.properties file.  Search for the \&quot;QuirksInfo\&quot; section.\n&quot; +
&nbsp;                               &quot;  The name you want will fall between \&quot;option\&quot; and \&quot;displayableName\&quot;.  For example, if you wish to apply the\n&quot; +
&nbsp;                               &quot;  \&quot;Anti-Aircraft Targeting\&quot; quirk to a unit, you will find the following entry in the messages.properties file:\n&quot; +
&nbsp;                               &quot;    QuirksInfo.option.anti_air.displayableName\n&quot; +
&nbsp;                               &quot;  The name you want to include in this file for the &lt;quirk&gt; entry is \&quot;anti_air\&quot;.\n&quot; +
&nbsp;                               &quot;If you wish to remove all quirks for a unit, you can create an entry in this file with a &lt;quirk&gt; of \&quot;none\&quot;.\n\n&quot; +
&nbsp;                               &quot;Example:  If you wish to declare that all Atlas variants do not have the Command Mech quirk:\n&quot; +
&nbsp;                               &quot;    &lt;unit&gt;\n&quot; +
&nbsp;                               &quot;        &lt;chassis&gt;Atlas&lt;/chassis&gt;\n&quot; +
&nbsp;                               &quot;        &lt;model&gt;all&lt;/model&gt;\n&quot; +
&nbsp;                               &quot;        &lt;quirk&gt;none&lt;/quirk&gt;\n&quot; +
&nbsp;                               &quot;    &lt;/unit&gt;\n\n&quot; +
&nbsp;                               &quot;Example: If you decide only the AS7-D Atlas, but no other variant, should have the Command Mech quirk:\n&quot; +
&nbsp;                               &quot;        &lt;unit&gt;\n&quot; +
&nbsp;                               &quot;        &lt;chassis&gt;Atlas&lt;/chassis&gt;\n&quot; +
&nbsp;                               &quot;        &lt;model&gt;all&lt;/model&gt;\n&quot; +
&nbsp;                               &quot;        &lt;quirk&gt;none&lt;/quirk&gt;\n&quot; +
&nbsp;                               &quot;    &lt;/unit&gt;\n&quot; +
&nbsp;                               &quot;    &lt;unit&gt;\n&quot; +
&nbsp;                               &quot;        &lt;chassis&gt;Atlas&lt;/chassis&gt;\n&quot; +
&nbsp;                               &quot;        &lt;model&gt;AS7-D&lt;/model&gt;\n&quot; +
&nbsp;                               &quot;        &lt;quirk&gt;command_mech&lt;/quirk&gt;\n&quot; +
&nbsp;                               &quot;    &lt;/unit&gt;\n\n&quot; +
&nbsp;                               &quot;Example: You can also do this in the opposite direction, so that all Atlases have the Command Mech quirk except the AS7-D:\n&quot; +
&nbsp;                               &quot;    &lt;unit&gt;\n&quot; +
&nbsp;                               &quot;        &lt;chassis&gt;Atlas&lt;/chassis&gt;\n&quot; +
&nbsp;                               &quot;        &lt;model&gt;all&lt;/model&gt;\n&quot; +
&nbsp;                               &quot;        &lt;quirk&gt;command_mech&lt;/quirk&gt;\n&quot; +
&nbsp;                               &quot;    &lt;/unit&gt;\n&quot; +
&nbsp;                               &quot;    &lt;unit&gt;\n&quot; +
&nbsp;                               &quot;        &lt;chassis&gt;Atlas&lt;/chassis&gt;\n&quot; +
&nbsp;                               &quot;        &lt;model&gt;AS7-D&lt;/model&gt;\n&quot; +
&nbsp;                               &quot;        &lt;quirk&gt;none&lt;/quirk&gt;\n&quot; +
&nbsp;                               &quot;    &lt;/unit&gt;\n\n&quot; +
&nbsp;                               &quot;Example: You can define quirks that affect all units of a given chassis and then add specific quirks to specific models:\n&quot; +
&nbsp;                               &quot;    &lt;unit&gt;\n&quot; +
&nbsp;                               &quot;        &lt;chassis&gt;Atlas&lt;/chassis&gt;\n&quot; +
&nbsp;                               &quot;        &lt;model&gt;all&lt;/model&gt;\n&quot; +
&nbsp;                               &quot;        &lt;quirk&gt;command_mech&lt;/quirk&gt;\n&quot; +
&nbsp;                               &quot;    &lt;/unit&gt;\n&quot; +
&nbsp;                               &quot;    &lt;unit&gt;\n&quot; +
&nbsp;                               &quot;        &lt;chassis&gt;Atlas&lt;/chassis&gt;\n&quot; +
&nbsp;                               &quot;        &lt;model&gt;AS7-D&lt;/model&gt;\n&quot; +
&nbsp;                               &quot;        &lt;quirk&gt;anti_air&lt;/quirk&gt;\n&quot; +
&nbsp;                               &quot;    &lt;/unit&gt;\n&quot; +
&nbsp;                               &quot;--&gt;\n\n&quot; +
&nbsp;                               &quot;&lt;unitQuirks xmlns:xsi=\&quot;http://www.w3.org/2001/XMLSchema-instance\&quot; xsi:noNamespaceSchemaLocation=\&quot;../data/unitQuirksSchema.xsl\&quot;&gt;\n&quot;;
&nbsp;    }
&nbsp;    
&nbsp;    private static final String UNIT = &quot;unit&quot;;
&nbsp;    private static final String CHASSIS = &quot;chassis&quot;;
&nbsp;    private static final String MODEL = &quot;model&quot;;
&nbsp;    private static final String UNIT_TYPE = &quot;unitType&quot;;
&nbsp;    private static final String QUIRK = &quot;quirk&quot;;
&nbsp;    private static final String WEAPON_QUIRK = &quot;weaponQuirk&quot;;
&nbsp;    private static final String LOCATION = &quot;location&quot;;
&nbsp;    private static final String SLOT = &quot;slot&quot;;
&nbsp;    private static final String WEAPON_NAME = &quot;weaponName&quot;;
&nbsp;    private static final String WEAPON_QUIRK_NAME = &quot;weaponQuirkName&quot;;
&nbsp;
&nbsp;    private static final String MODEL_ALL = &quot;all&quot;;
&nbsp;    
&nbsp;    private static final String NO_QUIRKS = &quot;none&quot;;
&nbsp;    
&nbsp;    private static Map&lt;String, List&lt;QuirkEntry&gt;&gt; canonQuirkMap;
&nbsp;    private static Map&lt;String, List&lt;QuirkEntry&gt;&gt; customQuirkMap;
<b class="fc">&nbsp;    private static AtomicBoolean customQuirksDirty = new AtomicBoolean(false);</b>
<b class="fc">&nbsp;    private static AtomicBoolean initialized = new AtomicBoolean(false);</b>
&nbsp;
<b class="fc">&nbsp;    private static MMLogger logger = null;</b>
&nbsp;
<b class="nc">&nbsp;    private QuirksHandler() {</b>
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    // Use to pass in a fake logger for unit tests.
&nbsp;    static void setLogger(final MMLogger newLogger) {
<b class="nc">&nbsp;        logger = newLogger;</b>
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    private static MMLogger getLogger() {
<b class="nc">&nbsp;        if (null == logger) {</b>
<b class="nc">&nbsp;            logger = DefaultMmLogger.getInstance();</b>
&nbsp;        }
<b class="nc">&nbsp;        return logger;</b>
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * Generate a Quirk&#39;s Unit ID given an Entity.
&nbsp;     *
&nbsp;     * @param ent Entity to generate UnitId from
&nbsp;     * @param useModel determines if the model should be used, or be &#39;all&#39;
&nbsp;     * @return The ID for the unit.
&nbsp;     */
&nbsp;    private static String getUnitId(Entity ent, boolean useModel) {
<b class="nc">&nbsp;        String typeText = Entity.getEntityMajorTypeName(ent.getEntityType());</b>
<b class="nc">&nbsp;        if (useModel) {</b>
<b class="nc">&nbsp;            return ent.getChassis() + &quot;~&quot; + ent.getModel() + &quot;~&quot; + typeText;</b>
&nbsp;        } else {
<b class="nc">&nbsp;            return ent.getChassis() + &quot;~~&quot; + typeText;</b>
&nbsp;        }
&nbsp;    }
&nbsp;    
&nbsp;    public static String getUnitId(String chassis, String model, String type) {
<b class="nc">&nbsp;        return chassis + &quot;~&quot; + (model.equals(MODEL_ALL) ? &quot;&quot; : model) + &quot;~&quot; + type;</b>
&nbsp;    }
&nbsp;
&nbsp;    public static String getChassis(String unitId) {
<b class="nc">&nbsp;        int splitIdx = unitId.indexOf(&quot;~&quot;);</b>
<b class="nc">&nbsp;        if (splitIdx == -1) {</b>
<b class="nc">&nbsp;            return unitId;</b>
&nbsp;        } else {
<b class="nc">&nbsp;            return unitId.substring(0, splitIdx);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    public static String getModel(String unitId) {
<b class="nc">&nbsp;        int splitIdx = unitId.indexOf(&quot;~&quot;);</b>
<b class="nc">&nbsp;        int endIdx = unitId.lastIndexOf(&quot;~&quot;);</b>
<b class="nc">&nbsp;        if (splitIdx == -1) {</b>
<b class="nc">&nbsp;            return null;</b>
&nbsp;        } else {
<b class="nc">&nbsp;            return unitId.substring(splitIdx + 1, endIdx);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    public static String getUnitType(String unitId) {
<b class="nc">&nbsp;        int splitIdx = unitId.lastIndexOf(&quot;~&quot;);</b>
<b class="nc">&nbsp;        if (splitIdx == -1) {</b>
<b class="nc">&nbsp;            return null;</b>
&nbsp;        } else {
<b class="nc">&nbsp;            return unitId.substring(splitIdx + 1, unitId.length());</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    public static String replaceUnitType(String unitId, String newUnitType) {
<b class="nc">&nbsp;        int splitIdx = unitId.lastIndexOf(&quot;~&quot;);</b>
<b class="nc">&nbsp;        return unitId.substring(0, splitIdx) + &quot;~&quot; + newUnitType;</b>
&nbsp;    }
&nbsp;
&nbsp;    private static Map&lt;String, List&lt;QuirkEntry&gt;&gt; loadQuirksFile(String path) throws IOException {
<b class="nc">&nbsp;        Map&lt;String, List&lt;QuirkEntry&gt;&gt; quirkMap = new HashMap&lt;&gt;();</b>
&nbsp;
<b class="nc">&nbsp;        File file = new File(path);</b>
<b class="nc">&nbsp;        if (!file.exists() || !file.isFile()) {</b>
<b class="nc">&nbsp;            getLogger().warning(&quot;Could not load quirks from &quot; + path);</b>
<b class="nc">&nbsp;            return quirkMap;</b>
&nbsp;        }
&nbsp;
&nbsp;        // Build the XML document.
<b class="nc">&nbsp;        StringBuilder log = new StringBuilder();</b>
&nbsp;        try {
<b class="nc">&nbsp;            DocumentBuilder builder = MegaMekXmlUtil.newSafeDocumentBuilder();</b>
<b class="nc">&nbsp;            log.append(&quot;Parsing &quot;).append(path);</b>
<b class="nc">&nbsp;            Document doc = builder.parse(file);</b>
<b class="nc">&nbsp;            log.append(&quot;\n...Parsing finished.&quot;);</b>
&nbsp;
&nbsp;            // Get the list of units.
<b class="nc">&nbsp;            NodeList listOfEntries = doc.getElementsByTagName(UNIT);</b>
<b class="nc">&nbsp;            int totalEntries = listOfEntries.getLength();</b>
<b class="nc">&nbsp;            log.append(&quot;\n\tTotal number of unit tags: &quot;).append(totalEntries);</b>
<b class="nc">&nbsp;            for (int unitCount = 0; unitCount &lt; totalEntries; unitCount++) {</b>
&nbsp;
&nbsp;                // Get the first element of this node.
<b class="nc">&nbsp;                Element unitList = (Element) listOfEntries.item(unitCount);</b>
&nbsp;
&nbsp;                // Get the chassis
<b class="nc">&nbsp;                Element chassisElement = (Element) unitList.getElementsByTagName(CHASSIS).item(0);</b>
<b class="nc">&nbsp;                if (chassisElement == null) {</b>
<b class="nc">&nbsp;                    log.append(&quot;\n\tMissing &lt;chassis&gt; element #&quot;).append(unitCount);</b>
<b class="nc">&nbsp;                    continue;</b>
&nbsp;                }
<b class="nc">&nbsp;                String chassis = chassisElement.getTextContent().trim();</b>
&nbsp;
&nbsp;                // Get the model.
<b class="nc">&nbsp;                Element modelElement = (Element) unitList.getElementsByTagName(MODEL).item(0);</b>
&nbsp;                // default to &quot;all&quot; model for entries that don&#39;t list a model.. backwards compatibility with older quirks files
<b class="nc">&nbsp;                String model = MODEL_ALL;</b>
<b class="nc">&nbsp;                if (modelElement != null) {</b>
<b class="nc">&nbsp;                    model = modelElement.getTextContent().trim();</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                Element typeElement = (Element) unitList.getElementsByTagName(UNIT_TYPE).item(0);</b>
&nbsp;                // default to &quot;Mech&quot; type for entries that don&#39;t list a type.. backwards compatibility with older quirks files
<b class="nc">&nbsp;                String unitType = &quot;Mech&quot;;</b>
<b class="nc">&nbsp;                if (typeElement != null) {</b>
<b class="nc">&nbsp;                    unitType = typeElement.getTextContent().trim();</b>
&nbsp;                }
&nbsp;
&nbsp;                // Generate the unit ID
<b class="nc">&nbsp;                String unitId = getUnitId(chassis, model, unitType);</b>
&nbsp;
&nbsp;                // Get the quirks.
<b class="nc">&nbsp;                NodeList quirkNodes = unitList.getElementsByTagName(QUIRK);</b>
<b class="nc">&nbsp;                NodeList weapQuirkNodes = unitList.getElementsByTagName(WEAPON_QUIRK);</b>
<b class="nc">&nbsp;                List&lt;QuirkEntry&gt; quirkList = new ArrayList&lt;&gt;(quirkNodes.getLength() + weapQuirkNodes.getLength());</b>
&nbsp;
&nbsp;                // Add the quirks.
<b class="nc">&nbsp;                for (int quirkCount = 0; quirkCount &lt; quirkNodes.getLength(); quirkCount++) {</b>
&nbsp;                    // Create the quirk entry and add it to the list.
<b class="nc">&nbsp;                    Element quirkElement = (Element) quirkNodes.item(quirkCount);</b>
<b class="nc">&nbsp;                    String qeText = quirkElement.getTextContent().trim();</b>
<b class="nc">&nbsp;                    if ((quirkElement.getTextContent() == null) || qeText.isEmpty()) {</b>
<b class="nc">&nbsp;                        log.append(&quot;\n\t\t&quot;).append(unitId).append(&quot;: no text content!&quot;);</b>
<b class="nc">&nbsp;                        continue;</b>
&nbsp;                    }
<b class="nc">&nbsp;                    QuirkEntry quirkEntry = new QuirkEntry(qeText, unitId);</b>
<b class="nc">&nbsp;                    quirkList.add(quirkEntry);</b>
&nbsp;                }
&nbsp;
&nbsp;                // Add the weapon quirks.
<b class="nc">&nbsp;                for (int quirkCount = 0; quirkCount &lt; weapQuirkNodes.getLength(); quirkCount++) {</b>
<b class="nc">&nbsp;                    Element quirkElement = (Element) weapQuirkNodes.item(quirkCount);</b>
&nbsp;
&nbsp;                    // Get the name of the quirk.
<b class="nc">&nbsp;                    Element nameElement = (Element) quirkElement.getElementsByTagName(WEAPON_QUIRK_NAME).item(0);</b>
<b class="nc">&nbsp;                    if (nameElement == null) {</b>
<b class="nc">&nbsp;                        log.append(&quot;\n\t\t&quot;).append(unitId).append(&quot;: no weapon quirk name!&quot;);</b>
<b class="nc">&nbsp;                        continue;</b>
&nbsp;                    }
<b class="nc">&nbsp;                    String weaponQuirkName = nameElement.getTextContent().trim();</b>
&nbsp;
&nbsp;                    // Get the weapon&#39;s location.
<b class="nc">&nbsp;                    Element locElement = (Element) quirkElement.getElementsByTagName(LOCATION).item(0);</b>
<b class="nc">&nbsp;                    if (locElement == null) {</b>
<b class="nc">&nbsp;                        log.append(&quot;\n\t\t&quot;).append(unitId).append(&quot;: no weapon quirk loc!&quot;);</b>
<b class="nc">&nbsp;                        continue;</b>
&nbsp;                    }
<b class="nc">&nbsp;                    String location = locElement.getTextContent().trim();</b>
&nbsp;
&nbsp;                    // Get the weapon&#39;s critical slot.
<b class="nc">&nbsp;                    Element slotElement = (Element) quirkElement.getElementsByTagName(SLOT).item(0);</b>
<b class="nc">&nbsp;                    if (slotElement == null) {</b>
<b class="nc">&nbsp;                        log.append(&quot;\n\t\t&quot;).append(unitId).append(&quot;: no weapon quirk slot!&quot;);</b>
<b class="nc">&nbsp;                        continue;</b>
&nbsp;                    }
<b class="nc">&nbsp;                    String slot = slotElement.getTextContent().trim();</b>
<b class="nc">&nbsp;                    if (slot.length() &lt; 1) {</b>
<b class="nc">&nbsp;                        throw new IllegalArgumentException(unitId</b>
&nbsp;                                + &quot; weapon quirk &quot; + weaponQuirkName
&nbsp;                                + &quot; has an illegal slot entry!&quot;);
&nbsp;                    } 
&nbsp;
&nbsp;                    // Get the weapon&#39;s name.
<b class="nc">&nbsp;                    Element weapElement = (Element) quirkElement.getElementsByTagName(WEAPON_NAME).item(0);</b>
<b class="nc">&nbsp;                    if (weapElement == null) {</b>
<b class="nc">&nbsp;                        log.append(&quot;\n\t\t&quot;).append(unitId).append(&quot;: no weapon quirk weapon name!&quot;);</b>
<b class="nc">&nbsp;                        continue;</b>
&nbsp;                    }
<b class="nc">&nbsp;                    String weaponName = weapElement.getTextContent().trim();</b>
&nbsp;
&nbsp;                    // Add the weapon quirk to the list.
<b class="nc">&nbsp;                    QuirkEntry weaponQuirk = new QuirkEntry(weaponQuirkName,</b>
<b class="nc">&nbsp;                            location, Integer.parseInt(slot), weaponName,</b>
&nbsp;                            unitId);
<b class="nc">&nbsp;                    quirkList.add(weaponQuirk);</b>
&nbsp;                }
&nbsp;
&nbsp;                // Add the unit to the default quirks list.
<b class="nc">&nbsp;                if (quirkList.isEmpty()) {</b>
<b class="nc">&nbsp;                    log.append(&quot;\n\t\tNo quirks found for &quot;);</b>
<b class="nc">&nbsp;                    if (unitId.length() &gt; 0) {</b>
<b class="nc">&nbsp;                        log.append(unitId);</b>
&nbsp;                    } else {
<b class="nc">&nbsp;                        log.append(&quot;&lt;BlankUnitId&gt;&quot;);</b>
&nbsp;                    }
&nbsp;                }
<b class="nc">&nbsp;                if (quirkMap.containsKey(unitId)) {</b>
<b class="nc">&nbsp;                    log.append(&quot;\n\t\t&quot;).append(unitId).append(&quot;: duplicate entry added!&quot;);</b>
&nbsp;                }
<b class="nc">&nbsp;                quirkMap.put(unitId, quirkList);</b>
&nbsp;            }
<b class="nc">&nbsp;            log.append(&quot;\n\tTotal number of quirk entries: &quot;).append(quirkMap.size());</b>
<b class="nc">&nbsp;            return quirkMap;</b>
<b class="nc">&nbsp;        } catch (Exception e) {</b>
<b class="nc">&nbsp;            getLogger().error(e);</b>
<b class="nc">&nbsp;            throw new IOException(e);</b>
&nbsp;        } finally {
<b class="nc">&nbsp;            getLogger().info(log.toString());</b>
<b class="nc">&nbsp;        }</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Reads in the values from the canonUnitQuirks.xml file and stores them in memory.
&nbsp;     *
&nbsp;     * @throws IOException If the file cannot be read.
&nbsp;     */
&nbsp;    public static void initQuirksList() throws IOException {
&nbsp;
&nbsp;        // Get the path to the canonUnitQuirks.xml file.
<b class="nc">&nbsp;        String userDir = System.getProperty(&quot;user.dir&quot;);</b>
<b class="nc">&nbsp;        if (!userDir.endsWith(File.separator)) {</b>
<b class="nc">&nbsp;            userDir += File.separator;</b>
&nbsp;        }
&nbsp;
&nbsp;        // Load the canon quirks list.
<b class="nc">&nbsp;        String filePath = Configuration.dataDir().getAbsolutePath() + File.separator + &quot;canonUnitQuirks.xml&quot;;</b>
<b class="nc">&nbsp;        canonQuirkMap = loadQuirksFile(filePath);</b>
&nbsp;
&nbsp;        // Load the custom quirks list.
<b class="nc">&nbsp;        filePath = userDir + &quot;mmconf&quot; + File.separator + &quot;unitQuirksOverride.xml&quot;;</b>
<b class="nc">&nbsp;        customQuirkMap = loadQuirksFile(filePath);</b>
&nbsp;
<b class="nc">&nbsp;        initialized.set(true);</b>
<b class="nc">&nbsp;    }</b>
&nbsp;    
&nbsp;    public static void saveCustomQuirksList() throws IOException {
&nbsp;        // If customQuirkMap wasn&#39;t initialized, no reason to save it
<b class="nc">&nbsp;        if (customQuirkMap == null) {</b>
<b class="nc">&nbsp;            return;</b>
&nbsp;        }
&nbsp;        
&nbsp;        // If the custom quirks map wasn&#39;t ever changed, no reason to save
<b class="nc">&nbsp;        if (!customQuirksDirty.get()) {</b>
<b class="nc">&nbsp;            return;</b>
&nbsp;        }
&nbsp;        
&nbsp;        // Get the path to the unitQuirksOverride.xml file.
<b class="nc">&nbsp;        String userDir = System.getProperty(&quot;user.dir&quot;);</b>
<b class="nc">&nbsp;        if (!userDir.endsWith(File.separator)) {</b>
<b class="nc">&nbsp;            userDir += File.separator;</b>
&nbsp;        }
<b class="nc">&nbsp;        String filePath = userDir + &quot;mmconf&quot; + File.separator</b>
&nbsp;                + &quot;unitQuirksOverride.xml&quot;;
&nbsp;        
<b class="nc">&nbsp;        Writer output = null;</b>
&nbsp;        try {
<b class="nc">&nbsp;            output = new BufferedWriter(new OutputStreamWriter(</b>
&nbsp;                    new FileOutputStream(filePath)));
<b class="nc">&nbsp;            output.write(CUSTOM_QUIRKS_HEADER);</b>
<b class="nc">&nbsp;            for (String unitId : customQuirkMap.keySet()) {</b>
<b class="nc">&nbsp;                String chassis = getChassis(unitId);</b>
<b class="nc">&nbsp;                String model = getModel(unitId);</b>
<b class="nc">&nbsp;                String unitType = getUnitType(unitId);</b>
&nbsp;                
<b class="nc">&nbsp;                output.write(&quot;\t&quot; + getOpenTag(UNIT) + &quot;\n&quot;);</b>
&nbsp;                
&nbsp;                // Write Chassis
<b class="nc">&nbsp;                output.write(&quot;\t\t&quot; + getOpenTag(CHASSIS));</b>
<b class="nc">&nbsp;                output.write(chassis);</b>
<b class="nc">&nbsp;                output.write(getCloseTag(CHASSIS) + &quot;\n&quot;);</b>
&nbsp;                
&nbsp;                // Write Model
<b class="nc">&nbsp;                if ((null != model) &amp;&amp; model.length() &gt; 0) {</b>
<b class="nc">&nbsp;                    output.write(&quot;\t\t&quot; + getOpenTag(MODEL));</b>
<b class="nc">&nbsp;                    output.write(model);</b>
<b class="nc">&nbsp;                    output.write(getCloseTag(MODEL) + &quot;\n&quot;);</b>
&nbsp;                }
&nbsp;
&nbsp;                // Write unit type
<b class="nc">&nbsp;                output.write(&quot;\t\t&quot; + getOpenTag(UNIT_TYPE));</b>
<b class="nc">&nbsp;                output.write(null == unitType ? &quot;&quot; : unitType);</b>
<b class="nc">&nbsp;                output.write(getCloseTag(UNIT_TYPE) + &quot;\n&quot;);</b>
&nbsp;
&nbsp;                // Write out quirks
<b class="nc">&nbsp;                List&lt;QuirkEntry&gt; quirks = customQuirkMap.get(unitId);</b>
<b class="nc">&nbsp;                if (quirks.isEmpty()) {</b>
<b class="nc">&nbsp;                    output.write(&quot;\t\t&quot; + getOpenTag(QUIRK));</b>
<b class="nc">&nbsp;                    output.write(NO_QUIRKS);</b>
<b class="nc">&nbsp;                    output.write(getCloseTag(QUIRK) + &quot;\n&quot;);</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    for (QuirkEntry quirk : quirks) {</b>
&nbsp;                        // Write Weapon Quirk
<b class="nc">&nbsp;                        if (quirk.isWeaponQuirk()) {</b>
<b class="nc">&nbsp;                            output.write(&quot;\t\t&quot; + getOpenTag(WEAPON_QUIRK) + &quot;\n&quot;);</b>
&nbsp;                            // Quirk Name
<b class="nc">&nbsp;                            output.write(&quot;\t\t\t&quot; + getOpenTag(WEAPON_QUIRK_NAME));</b>
<b class="nc">&nbsp;                            output.write(quirk.getQuirk());</b>
<b class="nc">&nbsp;                            output.write(getCloseTag(WEAPON_QUIRK_NAME) + &quot;\n&quot;);</b>
&nbsp;                            // Location
<b class="nc">&nbsp;                            output.write(&quot;\t\t\t&quot; + getOpenTag(LOCATION));</b>
<b class="nc">&nbsp;                            output.write(quirk.getLocation());</b>
<b class="nc">&nbsp;                            output.write(getCloseTag(LOCATION) + &quot;\n&quot;);</b>
&nbsp;                            // Slot
<b class="nc">&nbsp;                            output.write(&quot;\t\t\t&quot; + getOpenTag(SLOT));</b>
<b class="nc">&nbsp;                            output.write(quirk.getSlot() + &quot;&quot;);</b>
<b class="nc">&nbsp;                            output.write(getCloseTag(SLOT) + &quot;\n&quot;);</b>
&nbsp;                            // Weapon Name
<b class="nc">&nbsp;                            output.write(&quot;\t\t\t&quot; + getOpenTag(WEAPON_NAME));</b>
<b class="nc">&nbsp;                            output.write(quirk.getWeaponName());</b>
<b class="nc">&nbsp;                            output.write(getCloseTag(WEAPON_NAME) + &quot;\n&quot;);</b>
&nbsp;                            // Close Tag
<b class="nc">&nbsp;                            output.write(&quot;\t\t&quot; + getCloseTag(WEAPON_QUIRK) + &quot;\n&quot;);</b>
&nbsp;                        } else { // Write normal quirk
<b class="nc">&nbsp;                            output.write(&quot;\t\t&quot; + getOpenTag(QUIRK));</b>
<b class="nc">&nbsp;                            output.write(quirk.getQuirk());</b>
<b class="nc">&nbsp;                            output.write(getCloseTag(QUIRK) + &quot;\n&quot;);</b>
&nbsp;                        }
<b class="nc">&nbsp;                    }   </b>
&nbsp;                }            
<b class="nc">&nbsp;                output.write(&quot;\t&quot; + getCloseTag(UNIT) + &quot;\n\n&quot;);</b>
<b class="nc">&nbsp;            }</b>
&nbsp;            
<b class="nc">&nbsp;            output.write(CUSTOM_QUIRKS_FOOTER);</b>
<b class="nc">&nbsp;        } catch (IOException e) {</b>
<b class="nc">&nbsp;            getLogger().error(&quot;Error writing CustomQuirks file!&quot;, e);</b>
&nbsp;        } finally {
<b class="nc">&nbsp;            if (output != null) {</b>
<b class="nc">&nbsp;                output.close();</b>
&nbsp;            }
<b class="nc">&nbsp;        }        </b>
<b class="nc">&nbsp;    }</b>
&nbsp;    
&nbsp;    private static String getOpenTag(String s) {
<b class="nc">&nbsp;        return &quot;&lt;&quot; + s + &quot;&gt;&quot;;</b>
&nbsp;    }
&nbsp;    
&nbsp;    private static String getCloseTag(String s) {
<b class="nc">&nbsp;        return &quot;&lt;/&quot; + s + &quot;&gt;&quot;;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Retrieves the list of quirks for the identified unit.
&nbsp;     *
&nbsp;     * @param entity The entity whose quirks are to be returned.
&nbsp;     * @return A {@code List} of the quirks ({@code QuirkEntry}) for the given
&nbsp;     *         unit. If the unit is not in the list, a NULL value is returned.
&nbsp;     */
&nbsp;    @Nullable
&nbsp;    static List&lt;QuirkEntry&gt; getQuirks(Entity entity) {
<b class="fc">&nbsp;        if (!initialized.get() || (null == canonQuirkMap)) {</b>
<b class="fc">&nbsp;            return null;</b>
&nbsp;        }
<b class="nc">&nbsp;        List&lt;QuirkEntry&gt; quirks = new ArrayList&lt;&gt;();</b>
&nbsp;
&nbsp;        // General entry for the chassis.
<b class="nc">&nbsp;        String generalId = getUnitId(entity, false);</b>
&nbsp;
&nbsp;        // Build the unit ID from the chassis and model.
<b class="nc">&nbsp;        String unitId = getUnitId(entity, true);</b>
&nbsp;
&nbsp;        try {
&nbsp;            // Check for a general entry for this chassis in the custom list.
<b class="nc">&nbsp;            if (customQuirkMap.containsKey(generalId)) {</b>
<b class="nc">&nbsp;                quirks.addAll(customQuirkMap.get(generalId));</b>
&nbsp;            }
&nbsp;
&nbsp;            // Check for a model-specific entry.
<b class="nc">&nbsp;            if (customQuirkMap.containsKey(unitId)) {</b>
&nbsp;
&nbsp;                // If this specific model has no quirks, return null.
<b class="nc">&nbsp;                if (NO_QUIRKS.equalsIgnoreCase(customQuirkMap.get(unitId).get(0).getQuirk())) {</b>
<b class="nc">&nbsp;                    return null;</b>
&nbsp;                }
&nbsp;
&nbsp;                // Add the model-specific quirks.
<b class="nc">&nbsp;                quirks.addAll(customQuirkMap.get(unitId));</b>
&nbsp;            }
&nbsp;
&nbsp;            // If there is only one quirk on the list and it indicates that the custom list has removed all quirks from
&nbsp;            // this unit, return null.
<b class="nc">&nbsp;            if ((quirks.size() == 1) &amp;&amp; NO_QUIRKS.equalsIgnoreCase(quirks.get(0).getQuirk())) {</b>
<b class="nc">&nbsp;                return null;</b>
&nbsp;            }
&nbsp;
&nbsp;            // If quirk entries were found on the customized list, return those quirks.
<b class="nc">&nbsp;            if (!quirks.isEmpty()) {</b>
<b class="nc">&nbsp;                return quirks;</b>
&nbsp;            }
&nbsp;
&nbsp;            // Check the canonical list for a general entry for this chassis.
<b class="nc">&nbsp;            if (canonQuirkMap.containsKey(generalId)) {</b>
<b class="nc">&nbsp;                quirks.addAll(canonQuirkMap.get(generalId));</b>
&nbsp;            }
&nbsp;
&nbsp;            // Check for a model-specific entry.
<b class="nc">&nbsp;            if (canonQuirkMap.containsKey(unitId)) {</b>
&nbsp;
&nbsp;                // If this specific model, has no quirks, return null.
<b class="nc">&nbsp;                if (NO_QUIRKS.equalsIgnoreCase(canonQuirkMap.get(unitId).get(0).getQuirk())) {</b>
<b class="nc">&nbsp;                    return null;</b>
&nbsp;                }
&nbsp;
&nbsp;                // Add the model-specific quirks.
<b class="nc">&nbsp;                quirks.addAll(canonQuirkMap.get(unitId));</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            return quirks.isEmpty() ? null : quirks;</b>
<b class="nc">&nbsp;        } catch (Exception e) {</b>
<b class="nc">&nbsp;            String msg = &quot;generalId: &#39;&quot; + generalId + &quot;&#39;\nunitId: &#39;&quot; + unitId + &quot;&#39;\n&quot;;</b>
<b class="nc">&nbsp;            getLogger().error(msg, e);</b>
<b class="nc">&nbsp;            throw new RuntimeException(msg, e);</b>
&nbsp;        }
&nbsp;    }
&nbsp;    
&nbsp;    public static void addCustomQuirk(Entity entity, boolean useModel) {
&nbsp;        // Shouldn&#39;t happen, but lets be careful
<b class="nc">&nbsp;        if (customQuirkMap == null) {</b>
&nbsp;            try {
<b class="nc">&nbsp;                QuirksHandler.initQuirksList();</b>
<b class="nc">&nbsp;            } catch (IOException e) {</b>
<b class="nc">&nbsp;                getLogger().error(e);</b>
<b class="nc">&nbsp;            }</b>
&nbsp;        }
&nbsp;        
<b class="nc">&nbsp;        customQuirksDirty.set(true);</b>
&nbsp;        
&nbsp;        // Generate Unit ID
&nbsp;        String unitId;
<b class="nc">&nbsp;        unitId = getUnitId(entity, useModel);</b>
&nbsp;
&nbsp;        // Get a quirks list
<b class="nc">&nbsp;        List&lt;QuirkEntry&gt; quirkEntries = customQuirkMap.get(unitId);</b>
<b class="nc">&nbsp;        if (quirkEntries == null) {</b>
<b class="nc">&nbsp;            quirkEntries = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;            customQuirkMap.put(unitId, quirkEntries);</b>
&nbsp;        }
<b class="nc">&nbsp;        quirkEntries.clear();</b>
&nbsp;        
&nbsp;        // Add Entity Quirks
<b class="nc">&nbsp;        if (entity.countQuirks() &gt; 0) {</b>
<b class="nc">&nbsp;            Quirks entQuirks = entity.getQuirks();</b>
<b class="nc">&nbsp;            Enumeration&lt;IOptionGroup&gt; quirksGroup = entQuirks.getGroups();</b>
&nbsp;            Enumeration&lt;IOption&gt; quirkOptions;
<b class="nc">&nbsp;            while (quirksGroup.hasMoreElements()) {</b>
<b class="nc">&nbsp;                IOptionGroup group = quirksGroup.nextElement();</b>
<b class="nc">&nbsp;                quirkOptions = group.getSortedOptions();</b>
<b class="nc">&nbsp;                while (quirkOptions.hasMoreElements()) {</b>
<b class="nc">&nbsp;                    IOption option = quirkOptions.nextElement();</b>
&nbsp;                    // Ignore illegal quirks, and ones that aren&#39;t set
<b class="nc">&nbsp;                    if (!Quirks.isQuirkLegalFor(option, entity)</b>
<b class="nc">&nbsp;                            || !option.booleanValue()) {</b>
<b class="nc">&nbsp;                        continue;</b>
&nbsp;                    }
&nbsp;                    // Add new QuirkEntry
<b class="nc">&nbsp;                    QuirkEntry qe = new QuirkEntry(option.getName(), unitId);</b>
<b class="nc">&nbsp;                    quirkEntries.add(qe);</b>
<b class="nc">&nbsp;                }</b>
<b class="nc">&nbsp;            }</b>
&nbsp;        }
&nbsp;        
&nbsp;        // Handle Weapon/Equipment Quirks
&nbsp;        // Need to keep track of processed mounts, for multi-crit equipment
<b class="nc">&nbsp;        List&lt;Mounted&gt; addedEquipment = new ArrayList&lt;&gt;();</b>
&nbsp;        // Need to know loc and slot, so can&#39;t iterate over Entity.getEquipment
<b class="nc">&nbsp;        for  (int loc = 0; loc &lt; entity.locations(); loc++) {</b>
<b class="nc">&nbsp;            int numCrits = entity.getNumberOfCriticals(loc);</b>
<b class="nc">&nbsp;            for (int slot = 0; slot &lt; numCrits; slot++) {</b>
<b class="nc">&nbsp;                CriticalSlot crit = entity.getCritical(loc, slot);</b>
&nbsp;                // Ignore systems and null entries
<b class="nc">&nbsp;                if ((crit == null)</b>
<b class="nc">&nbsp;                        || (crit.getType() == CriticalSlot.TYPE_SYSTEM)) {</b>
<b class="nc">&nbsp;                    continue;</b>
&nbsp;                }
&nbsp;                // Add quirk for mount if we haven&#39;t already
<b class="nc">&nbsp;                if ((crit.getMount() != null)</b>
<b class="nc">&nbsp;                        &amp;&amp; !addedEquipment.contains(crit.getMount())) {</b>
<b class="nc">&nbsp;                    addWeaponQuirk(quirkEntries, crit.getMount(), loc, slot,</b>
&nbsp;                            unitId, entity);
<b class="nc">&nbsp;                    addedEquipment.add(crit.getMount());</b>
&nbsp;                }
&nbsp;                // Add quirk for mount2 if we haven&#39;t already
<b class="nc">&nbsp;                if ((crit.getMount2() != null)</b>
<b class="nc">&nbsp;                        &amp;&amp; !addedEquipment.contains(crit.getMount2())) {</b>
<b class="nc">&nbsp;                    addWeaponQuirk(quirkEntries, crit.getMount2(), loc, slot,</b>
&nbsp;                            unitId, entity);
<b class="nc">&nbsp;                    addedEquipment.add(crit.getMount2());</b>
&nbsp;                }
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;    }</b>
&nbsp;    
&nbsp;    /**
&nbsp;     * Convenience method for adding a weapon quirk to the quirk entries list.
&nbsp;     *
&nbsp;     * @param quirkEntries The quirks to be added.
&nbsp;     * @param m The weapon to which the quirks will be applied.
&nbsp;     * @param loc The servo location of the weapon.
&nbsp;     * @param slot The slot number of the weapon.
&nbsp;     * @param unitId The identity of the unit.
&nbsp;     * @param entity The entity itself.
&nbsp;     */
&nbsp;    private static void addWeaponQuirk(List&lt;QuirkEntry&gt; quirkEntries,
&nbsp;            @Nullable Mounted m, int loc, int slot, String unitId, Entity entity) {
&nbsp;        // If mount is null, nothing to do
<b class="nc">&nbsp;        if (m == null) {</b>
<b class="nc">&nbsp;            return;</b>
&nbsp;        }
&nbsp;        // Ignore if the mount has no quirks
<b class="nc">&nbsp;        if (m.countQuirks() &gt; 0) {</b>
<b class="nc">&nbsp;            WeaponQuirks weapQuirks = m.getQuirks();</b>
<b class="nc">&nbsp;            Enumeration&lt;IOptionGroup&gt; quirksGroup = weapQuirks.getGroups();</b>
&nbsp;            Enumeration&lt;IOption&gt; quirkOptions;
<b class="nc">&nbsp;           while (quirksGroup.hasMoreElements()) {</b>
<b class="nc">&nbsp;                IOptionGroup group = quirksGroup.nextElement();</b>
<b class="nc">&nbsp;                quirkOptions = group.getSortedOptions();</b>
<b class="nc">&nbsp;                while (quirkOptions.hasMoreElements()) {</b>
<b class="nc">&nbsp;                    IOption option = quirkOptions.nextElement();</b>
&nbsp;                    // Don&#39;t add quirk if it&#39;s not on 
<b class="nc">&nbsp;                    if (!option.booleanValue()) {</b>
<b class="nc">&nbsp;                        continue;</b>
&nbsp;                    }
&nbsp;                    // Create new entry and add it
<b class="nc">&nbsp;                    QuirkEntry qe = new QuirkEntry(option.getName(),</b>
<b class="nc">&nbsp;                            entity.getLocationAbbr(loc), slot, m.getType()</b>
<b class="nc">&nbsp;                                    .getInternalName(), unitId);</b>
<b class="nc">&nbsp;                    quirkEntries.add(qe);</b>
<b class="nc">&nbsp;                }</b>
<b class="nc">&nbsp;            }</b>
&nbsp;        }
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    public static Set&lt;String&gt; getCanonQuirkIds() {
<b class="nc">&nbsp;        return canonQuirkMap.keySet();</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Used by QuirkRewriteTool to take a quirk entry from canon quirks, and
&nbsp;     * munge its eType and write it to customQuirks.
&nbsp;     */
&nbsp;    public static void mungeQuirks(String quirkId, String newId) {
&nbsp;        // Shouldn&#39;t happen, but lets be careful
<b class="nc">&nbsp;        if (customQuirkMap == null) {</b>
&nbsp;            try {
<b class="nc">&nbsp;                QuirksHandler.initQuirksList();</b>
<b class="nc">&nbsp;            } catch (IOException e) {</b>
<b class="nc">&nbsp;                getLogger().error(e);</b>
<b class="nc">&nbsp;            }</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        customQuirksDirty.set(true);</b>
&nbsp;
<b class="nc">&nbsp;        customQuirkMap.put(newId, canonQuirkMap.get(quirkId));</b>
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    public static boolean customQuirksContain(String unitId) {
<b class="nc">&nbsp;        return customQuirkMap.containsKey(unitId);</b>
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2023-05-16 16:28</div>
</div>
</body>
</html>
