


<!DOCTYPE html>
<html id="htmlId">
<head>
  <title>Coverage Report > Mounted</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">megamek.common</a>
</div>

<h1>Coverage Summary for Class: Mounted (megamek.common)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">Mounted</td>
<td class="coverageStat">
  <span class="percent">
    30.7%
  </span>
  <span class="absValue">
    (50/163)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    23.2%
  </span>
  <span class="absValue">
    (192/828)
  </span>
</td>
</tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$07QPArio</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$0KkxXq3L</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$0szMP6BD</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$1o3W7UhP</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$1YwjQs1t</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$20gYx2tx</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$28JcyJAT</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$292kEtjC</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$2PMm799X</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$35HXUjBr</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$3gdSLF1y</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$4co1xyJL</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$4PSOUK6s</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$6HTb1SWb</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$6ONMu9K8</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$6R77Bipc</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$6RO5UPWu</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$78c7gxaL</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$7FmJnsrI</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$7KxYGHqa</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$7nj1P7oe</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$8PtOEGYu</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$8qKSeGXk</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$8WFoeCqV</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$9glZU8QP</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$9h4fu17E</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$9HvKYgoD</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$9t3nRvH5</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$9zQVrDXS</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$a7P8WmYn</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$A9lLE8M4</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$AJNmkB31</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$aLdbKzRy</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$APn2iZSl</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$auYW8GrS</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$awcJkb8M</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$bUhkK0MZ</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$BWpQHW71</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$Bx8H7Zbv</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$cbO5a6yb</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$CDXCx86R</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$cEMhZPoR</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$Cf3aXews</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$cmDU0wKZ</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$CQQXEmNm</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$CQtYDknP</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$cWhQqKIf</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$cXfFATRi</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$DOVZjUH8</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$dp7BXupf</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$DPtjkVAR</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$DUapY2L3</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$DvyrvPFj</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$dwSBc2ca</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$dWUVsRME</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$e1JS15aF</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$E1kL6egZ</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$E9UcmOc2</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$ejKzjTBy</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$fg2JEy4D</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$fHDjeoKO</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$fMnYi3AG</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$fwknjMgb</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$FY7RYAf9</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$g4qpzZTd</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$gcjQlUKS</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$GfqAqEV5</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$gqSU8CLE</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$gqXC1XJD</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$gxgdk4JQ</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$h7b5jMTH</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$HOcO16iR</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$hTPldpzR</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$hUfMbj08</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$HX5Bn3RQ</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$i2wu8SGs</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$i8Ne9kwE</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$icEuMuxN</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$iGMv5w0C</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$IHgtedub</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$IKYwqjQL</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$INjWvFNv</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$IpJNbALq</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$IT8ap3DB</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$Iw3UFzvi</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$jaDSCbp6</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$JbR4FvFv</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$JdPB0kiy</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$jpRBA3N2</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$jPT4EY1c</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$JqN9HHmh</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$JXaFoirp</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$JxLxAwQs</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$JXvcDDNc</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$kanu3Jbn</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$kHKCRYZv</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$KhsdJ7Gp</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$kxor5IuD</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$kYcd5CxG</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$lJSC2Mpw</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$lUikGRkx</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$lxQuErvp</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$mChJKXyR</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$me7WulSP</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$mOK7qHcE</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$nlNe1Kpc</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$nPjMIl39</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$o4K6MmNs</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$O6UsQSjC</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$ODmha47V</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$OGAwOuxq</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$OHpnXruy</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$OiDZl3JW</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$OS8X6rmI</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$oXD19TV8</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$pfmC1nxg</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$pk7QJbiC</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$ppK9hzg5</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$pzeorvGR</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$Qj31ysJq</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$QjFcd6im</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$QLKNW5Qc</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$R1ntXzUQ</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$rLpHPMGo</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$rLx41gKx</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$rNWnmTEN</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$RQ6aOvLV</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$RR8afZlt</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$rW4uvxD6</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$RWarLaZu</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$rxPU64Hv</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$s5YRHdIw</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$SMQDEAfk</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$SZMQtDay</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$tOJdgVpI</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$Tq3Mx5XD</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$UdkOhTsl</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$uv4ScHqC</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$vbYsnnYf</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$vhrepdhW</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$vJ53RoEO</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$vnYCjKq0</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$w5U2fb05</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$WeZdYdXU</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$wklJJTu3</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$wMHAgxGs</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$wYbaSRky</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$X7ReyCxm</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$XeGjzO2N</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$XnP0ZxvB</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$XqmahR2r</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$XspRcmDt</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$XUljAMMI</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$YJw1PuVu</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$YObStJFj</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$yrVA2RkM</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$YwpYWh81</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$yz3pNr8B</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$ziQONbii</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$zJJJob6o</td>
  </tr>
  <tr>
    <td class="name">Mounted$MockitoMock$1733719052$auxiliary$znunyYpx</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    30.7%
  </span>
  <span class="absValue">
    (50/163)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    23.2%
  </span>
  <span class="absValue">
    (192/828)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;/*
&nbsp; * MegaMek -
&nbsp; * Copyright (C) 2000,2001,2002,2003,2004,2005 Ben Mazur (bmazur@sev.org)
&nbsp; *
&nbsp; *  This program is free software; you can redistribute it and/or modify it
&nbsp; *  under the terms of the GNU General Public License as published by the Free
&nbsp; *  Software Foundation; either version 2 of the License, or (at your option)
&nbsp; *  any later version.
&nbsp; *
&nbsp; *  This program is distributed in the hope that it will be useful, but
&nbsp; *  WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
&nbsp; *  or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License
&nbsp; *  for more details.
&nbsp; */
&nbsp;
&nbsp;/*
&nbsp; * Mounted.java
&nbsp; *
&nbsp; * Created on April 1, 2002, 1:29 PM
&nbsp; */
&nbsp;
&nbsp;package megamek.common;
&nbsp;
&nbsp;import java.io.Serializable;
&nbsp;import java.util.HashSet;
&nbsp;import java.util.List;
&nbsp;import java.util.Set;
&nbsp;import java.util.Vector;
&nbsp;
&nbsp;import megamek.MegaMek;
&nbsp;import megamek.common.actions.WeaponAttackAction;
&nbsp;import megamek.common.options.OptionsConstants;
&nbsp;import megamek.common.options.WeaponQuirks;
&nbsp;import megamek.common.weapons.AmmoWeapon;
&nbsp;import megamek.common.weapons.Weapon;
&nbsp;import megamek.common.weapons.WeaponHandler;
&nbsp;import megamek.common.weapons.bayweapons.AmmoBayWeapon;
&nbsp;import megamek.common.weapons.gaussrifles.GaussWeapon;
&nbsp;
&nbsp;/**
&nbsp; * This describes equipment mounted on a mech.
&nbsp; *
&nbsp; * @author Ben
&nbsp; * @version
&nbsp; */
&nbsp;public class Mounted implements Serializable, RoundUpdated, PhaseUpdated {
&nbsp;
&nbsp;    private static final long serialVersionUID = 6438017987074691566L;
<b class="fc">&nbsp;    private boolean usedThisRound = false;</b>
<b class="fc">&nbsp;    private boolean destroyed = false;</b>
<b class="fc">&nbsp;    private boolean hit = false;</b>
<b class="fc">&nbsp;    private boolean missing = false;</b>
<b class="fc">&nbsp;    private boolean jammed = false;</b>
<b class="fc">&nbsp;    private boolean jammedThisPhase = false;</b>
<b class="fc">&nbsp;    private boolean useless = false;</b>
<b class="fc">&nbsp;    private boolean fired = false; // Only true for used OS stuff and TSEMP.</b>
<b class="fc">&nbsp;    private boolean tsempDowntime = false; // Needed for &quot;every other turn&quot;</b>
&nbsp;                                           // TSEMP.
<b class="fc">&nbsp;    private boolean rapidfire = false; // MGs in rapid-fire mode</b>
<b class="fc">&nbsp;    private boolean hotloaded = false; // Hotloading for ammoType</b>
<b class="fc">&nbsp;    private boolean repairable = true; // can the equipment mounted here be</b>
&nbsp;    // repaired
<b class="fc">&nbsp;    private boolean mechTurretMounted = false; // is this mounted in a</b>
&nbsp;                                               // mechturret
<b class="fc">&nbsp;    private boolean sponsonTurretMounted = false; // is this mounted in a</b>
&nbsp;                                                  // sponsonturret
<b class="fc">&nbsp;    private boolean pintleTurretMounted = false; // is this mounted in a</b>
&nbsp;                                                 // pintleturret
<b class="fc">&nbsp;    private int facing = -1; // facing for turrets</b>
&nbsp;
&nbsp;    private int mode; // Equipment&#39;s current state. On or Off. Sixshot or
&nbsp;    // Fourshot, etc
<b class="fc">&nbsp;    private int pendingMode = -1; // if mode changes happen at end of turn</b>
<b class="fc">&nbsp;    private boolean modeSwitchable = true; // disallow mode switching</b>
&nbsp;    
&nbsp;    private int location;
&nbsp;    private boolean rearMounted;
&nbsp;
<b class="fc">&nbsp;    private Mounted linked = null; // for ammo, or artemis</b>
<b class="fc">&nbsp;    private Mounted linkedBy = null; // reverse link for convenience</b>
&nbsp;
<b class="fc">&nbsp;    private Mounted crossLinkedBy = null; // Weapons with crossLinked capacitors</b>
<b class="fc">&nbsp;    private int linkedBayId = -1;</b>
&nbsp;
&nbsp;    private Entity entity; // what I&#39;m mounted on
&nbsp;
<b class="fc">&nbsp;    private WeaponQuirks quirks = new WeaponQuirks();</b>
&nbsp;
&nbsp;    private transient EquipmentType type;
&nbsp;    private String typeName;
<b class="fc">&nbsp;    private double size = 1.0;</b>
&nbsp;
&nbsp;    // ammo-specific stuff. Probably should be a subclass
&nbsp;    private int shotsLeft;
&nbsp;    // how many shots did we have originally?
&nbsp;    // only used for by-shot ammo
&nbsp;    private int originalShots;
&nbsp;    private boolean m_bPendingDump;
&nbsp;    private boolean m_bDumping;
&nbsp;
&nbsp;    // A list of ids (equipment numbers) for the weapons and ammo linked to
&nbsp;    // this bay (if the mounted is of the BayWeapon type)
&nbsp;    // I can also use this for weapons of the same type on a capital fighter
&nbsp;    //and now Machine Gun Arrays too!
<b class="fc">&nbsp;    private Vector&lt;Integer&gt; bayWeapons = new Vector&lt;Integer&gt;();</b>
<b class="fc">&nbsp;    private Vector&lt;Integer&gt; bayAmmo = new Vector&lt;Integer&gt;();</b>
&nbsp;    
&nbsp;    // on capital fighters and squadrons some weapon mounts actually represent
&nbsp;    // multiple weapons of the same type
&nbsp;    // provide a boolean indicating this type of mount and the number of weapons
&nbsp;    // represented
<b class="fc">&nbsp;    private boolean weaponGroup = false;</b>
<b class="fc">&nbsp;    private int nweapons = 1;</b>
&nbsp;
&nbsp;    // for ammo loaded by shot rather than ton, a boolean
<b class="fc">&nbsp;    private boolean byShot = false;</b>
&nbsp;
&nbsp;    // handle split weapons
<b class="fc">&nbsp;    private boolean bSplit = false;</b>
<b class="fc">&nbsp;    private int nFoundCrits = 0;</b>
<b class="fc">&nbsp;    private int secondLocation = 0;</b>
&nbsp;
&nbsp;    // bomb stuff
<b class="fc">&nbsp;    private boolean bombMounted = false;</b>
&nbsp;
&nbsp;    // mine type
<b class="fc">&nbsp;    private int mineType = MINE_NONE;</b>
&nbsp;    // vibrabomb mine setting
<b class="fc">&nbsp;    private int vibraSetting = 20;</b>
&nbsp;
&nbsp;    //These arrays are used to track individual missing modular components on BA for MHQ
&nbsp;    //in MM they probably shouldn&#39;t need to be touched. They are used to keep track of
&nbsp;    //whether a modular mount is in use or not for a particular trooper.
<b class="fc">&nbsp;    private boolean[] missingForTrooper = {false, false, false, false, false, false};</b>
&nbsp;
&nbsp;    /**
&nbsp;     * Armor value, used for applicable equipment types like minesweepers.
&nbsp;     */
<b class="fc">&nbsp;    private int armorValue = 0;</b>
&nbsp;
<b class="fc">&nbsp;    private IGame.Phase phase = IGame.Phase.PHASE_UNKNOWN;</b>
&nbsp;
&nbsp;    public static final int MINE_NONE = -1;
&nbsp;    public static final int MINE_CONVENTIONAL = 0;
&nbsp;    public static final int MINE_VIBRABOMB = 1;
&nbsp;    public static final int MINE_ACTIVE = 2;
&nbsp;    public static final int MINE_INFERNO = 3;
&nbsp;    public static final int MINE_EMP = 4;
&nbsp;    public static final int MINE_COMMAND_DETONATED = 5;
&nbsp;
&nbsp;    // New stuff for shields
<b class="fc">&nbsp;    protected int baseDamageAbsorptionRate = 0;</b>
<b class="fc">&nbsp;    protected int baseDamageCapacity = 0;</b>
<b class="fc">&nbsp;    protected int damageTaken = 0;</b>
&nbsp;
&nbsp;    /**
&nbsp;     * BA use locations for troopers, so we need a way to keep track of where
&nbsp;     *  a piece of equipment is moutned on BA
&nbsp;     */
<b class="fc">&nbsp;    private int baMountLoc = BattleArmor.MOUNT_LOC_NONE;</b>
&nbsp;
&nbsp;    /**
&nbsp;     *  For BA weapons, is this in a detachable weapon pack?
&nbsp;     */
<b class="fc">&nbsp;    private boolean isDWPMounted = false;</b>
&nbsp;
&nbsp;    /**
&nbsp;     * Does this Mounted represent a weapon that is mounted in an anti-personnel
&nbsp;     * weapon mount?
&nbsp;     */
<b class="fc">&nbsp;    private boolean isAPMMounted = false;</b>
&nbsp;    
&nbsp;    /**
&nbsp;     * Does this Mounted represent equipmented that is pod mounted in an omni unit?
&nbsp;     */
<b class="fc">&nbsp;    private boolean omniPodMounted = false;</b>
&nbsp;
&nbsp;    // for Armored components
<b class="fc">&nbsp;    private boolean armoredComponent = false;</b>
&nbsp;
&nbsp;    // called shots status, sort of like another mode
<b class="fc">&nbsp;    private CalledShot called = new CalledShot();</b>
&nbsp;
&nbsp;    /**
&nbsp;     * Flag that keeps track of whether this &lt;code&gt;Mounted&lt;/code&gt; is mounted as
&nbsp;     * a squad support weapon on &lt;code&gt;BattleArmor&lt;/code&gt;.
&nbsp;     */
&nbsp;    private boolean squadSupportWeapon;
&nbsp;
&nbsp;    /** Creates new Mounted */
<b class="fc">&nbsp;    public Mounted(Entity entity, EquipmentType type) {</b>
<b class="fc">&nbsp;        this.entity = entity;</b>
<b class="fc">&nbsp;        this.type = type;</b>
<b class="fc">&nbsp;        typeName = type.getInternalName();</b>
&nbsp;
<b class="fc">&nbsp;        if (type instanceof AmmoType) {</b>
<b class="fc">&nbsp;            shotsLeft = ((AmmoType) type).getShots();</b>
<b class="fc">&nbsp;            size = type.getTonnage(entity);</b>
&nbsp;        }
<b class="fc">&nbsp;        if ((type instanceof MiscType) &amp;&amp; type.hasFlag(MiscType.F_MINE)) {</b>
<b class="nc">&nbsp;            mineType = MINE_CONVENTIONAL;</b>
&nbsp;            // Used to keep track of the # of mines
<b class="nc">&nbsp;            shotsLeft = 1;</b>
&nbsp;        }
<b class="fc">&nbsp;        if ((type instanceof MiscType) &amp;&amp;</b>
<b class="fc">&nbsp;                type.hasFlag(MiscType.F_VEHICLE_MINE_DISPENSER)) {</b>
<b class="nc">&nbsp;            mineType = MINE_CONVENTIONAL;</b>
&nbsp;            // Used to keep track of the # of mines
<b class="nc">&nbsp;            shotsLeft = 2;</b>
&nbsp;        }
<b class="fc">&nbsp;        if ((type instanceof MiscType)</b>
<b class="fc">&nbsp;                &amp;&amp; type.hasFlag(MiscType.F_SENSOR_DISPENSER)) {</b>
<b class="nc">&nbsp;            setShotsLeft(30);</b>
&nbsp;        }
<b class="fc">&nbsp;        if ((type instanceof MiscType)</b>
<b class="fc">&nbsp;                &amp;&amp; ((((MiscType) type).isShield() || type</b>
<b class="fc">&nbsp;                        .hasFlag(MiscType.F_MODULAR_ARMOR)))) {</b>
<b class="nc">&nbsp;            MiscType shield = (MiscType) type;</b>
<b class="nc">&nbsp;            baseDamageAbsorptionRate = shield.baseDamageAbsorptionRate;</b>
<b class="nc">&nbsp;            baseDamageCapacity = shield.baseDamageCapacity;</b>
<b class="nc">&nbsp;            damageTaken = shield.damageTaken;</b>
&nbsp;        }
<b class="fc">&nbsp;        if ((type instanceof MiscType)</b>
<b class="fc">&nbsp;                &amp;&amp; type.hasFlag(MiscType.F_MINESWEEPER)) {</b>
<b class="nc">&nbsp;            armorValue = 30;</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        quirks.initialize();</b>
<b class="fc">&nbsp;    }</b>
&nbsp;
&nbsp;    /**
&nbsp;     * Changing ammo loadouts allows updating AmmoTypes of existing bins. This
&nbsp;     * is the only circumstance under which this should happen.
&nbsp;     */
&nbsp;
&nbsp;    public void changeAmmoType(AmmoType at) {
<b class="nc">&nbsp;        if (!(type instanceof AmmoType)) {</b>
<b class="nc">&nbsp;            System.out.println(&quot;Attempted to change ammo type of non-ammo&quot;);</b>
<b class="nc">&nbsp;            return;</b>
&nbsp;        }
<b class="nc">&nbsp;        type = at;</b>
<b class="nc">&nbsp;        typeName = at.getInternalName();</b>
<b class="nc">&nbsp;        if (location == Entity.LOC_NONE) {</b>
&nbsp;            // Oneshot launcher
<b class="nc">&nbsp;            shotsLeft = 1;</b>
&nbsp;        } else {
&nbsp;            // Regular launcher
<b class="nc">&nbsp;            shotsLeft = at.getShots();</b>
&nbsp;        }
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    /**
&nbsp;     * Restores the equipment from the name
&nbsp;     */
&nbsp;    public void restore() {
<b class="fc">&nbsp;        if (typeName == null) {</b>
<b class="nc">&nbsp;            typeName = type.getName();</b>
&nbsp;        } else {
<b class="fc">&nbsp;            type = EquipmentType.get(typeName);</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        if (type == null) {</b>
<b class="nc">&nbsp;            System.err</b>
<b class="nc">&nbsp;                    .println(&quot;Mounted.restore: could not restore equipment type \&quot;&quot;</b>
&nbsp;                            + typeName + &quot;\&quot;&quot;);
&nbsp;        }
<b class="fc">&nbsp;    }</b>
&nbsp;
&nbsp;    public EquipmentType getType() {
<b class="fc">&nbsp;        return (null != type) ? type : (type = EquipmentType.get(typeName));</b>
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * @return the current mode of the equipment, or &lt;code&gt;null&lt;/code&gt; if it&#39;s
&nbsp;     *         not available.
&nbsp;     */
&nbsp;    public EquipmentMode curMode() {
<b class="fc">&nbsp;        if ((mode &gt;= 0) &amp;&amp; (mode &lt; type.getModesCount())) {</b>
<b class="fc">&nbsp;            return type.getMode(mode);</b>
&nbsp;        }
<b class="nc">&nbsp;        return EquipmentMode.getMode(&quot;None&quot;);</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * @return the pending mode of the equipment.
&nbsp;     */
&nbsp;    public EquipmentMode pendingMode() {
<b class="nc">&nbsp;        if ((pendingMode &lt; 0) || (pendingMode &gt;= type.getModesCount())) {</b>
<b class="nc">&nbsp;            return EquipmentMode.getMode(&quot;None&quot;);</b>
&nbsp;        }
<b class="nc">&nbsp;        return type.getMode(pendingMode);</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Switches the equipment mode to the next or previous available.
&nbsp;     *
&nbsp;     * @param forward
&nbsp;     *            Flag that determines whether the mode should be advanced
&nbsp;     *            forward or backwards.
&nbsp;     * @return new mode number, or &lt;code&gt;-1&lt;/code&gt; if it&#39;s not available.
&nbsp;     */
&nbsp;    public int switchMode(boolean forward) {
<b class="nc">&nbsp;        if (type.hasModes()) {</b>
<b class="nc">&nbsp;            int nMode = 0;</b>
<b class="nc">&nbsp;            if (pendingMode &gt; -1) {</b>
<b class="nc">&nbsp;                if (forward) {</b>
<b class="nc">&nbsp;                    nMode = (pendingMode + 1) % type.getModesCount();</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    nMode = (pendingMode - 1);</b>
<b class="nc">&nbsp;                    if (nMode &lt; 0) {</b>
<b class="nc">&nbsp;                        nMode = type.getModesCount() - 1;</b>
&nbsp;                    }
&nbsp;                }
&nbsp;            } else {
<b class="nc">&nbsp;                if (forward) {</b>
<b class="nc">&nbsp;                    nMode = (mode + 1) % type.getModesCount();</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    nMode = (mode - 1);</b>
<b class="nc">&nbsp;                    if (nMode &lt; 0) {</b>
<b class="nc">&nbsp;                        nMode = type.getModesCount() - 1;</b>
&nbsp;                    }
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            setMode(nMode);</b>
<b class="nc">&nbsp;            return nMode;</b>
&nbsp;        }
<b class="nc">&nbsp;        return -1;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Sets the equipment mode to the mode denoted by the given mode name
&nbsp;     *
&nbsp;     * @param newMode
&nbsp;     *            the name of the desired new mode
&nbsp;     * @return new mode number on success, &lt;code&gt;-1&lt;code&gt; otherwise.
&nbsp;     */
&nbsp;    public int setMode(String newMode) {
<b class="fc">&nbsp;        for (int x = 0, e = type.getModesCount(); x &lt; e; x++) {</b>
<b class="fc">&nbsp;            if (type.getMode(x).equals(newMode)) {</b>
<b class="fc">&nbsp;                setMode(x);</b>
<b class="fc">&nbsp;                return x;</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        return -1;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Sets the equipment mode to the mode denoted by the given mode number
&nbsp;     *
&nbsp;     * @param newMode
&nbsp;     *            the number of the desired new mode
&nbsp;     */
&nbsp;    public boolean setMode(int newMode) {
<b class="fc">&nbsp;        if (type.hasModes()) {</b>
&nbsp;
<b class="fc">&nbsp;            if (newMode &gt;= type.getModesCount()) {</b>
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
&nbsp;            /*
&nbsp;             * megamek.debug.Assert.assertTrue(newMode &gt;= 0 &amp;&amp; newMode &lt;
&nbsp;             * type.getModesCount(), &quot;Invalid mode, mode=&quot; + newMode +
&nbsp;             * &quot;, modesCount=&quot; + type.getModesCount());
&nbsp;             */
&nbsp;
<b class="fc">&nbsp;            if (canInstantSwitch(newMode)) {</b>
<b class="nc">&nbsp;                mode = newMode;</b>
<b class="nc">&nbsp;                pendingMode = -1;</b>
<b class="fc">&nbsp;            } else if (pendingMode != newMode) {</b>
<b class="fc">&nbsp;                if (mode == newMode) {</b>
<b class="nc">&nbsp;                    pendingMode = -1;</b>
&nbsp;                } else {
<b class="fc">&nbsp;                    pendingMode = newMode;</b>
&nbsp;                }
&nbsp;            }
&nbsp;        }
&nbsp;        // all communications equipment mounteds need to have the same mode at
&nbsp;        // all times
<b class="fc">&nbsp;        if ((getType() instanceof MiscType)</b>
<b class="fc">&nbsp;                &amp;&amp; getType().hasFlag(MiscType.F_COMMUNICATIONS)) {</b>
<b class="nc">&nbsp;            for (Mounted m : entity.getMisc()) {</b>
<b class="nc">&nbsp;                if (!m.equals(this)</b>
<b class="nc">&nbsp;                        &amp;&amp; m.getType().hasFlag(MiscType.F_COMMUNICATIONS)) {</b>
<b class="nc">&nbsp;                    m.setMode(newMode);</b>
&nbsp;                }
<b class="nc">&nbsp;            }</b>
&nbsp;        }
<b class="fc">&nbsp;        return true;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Can the switch from the current mode to the new mode happen instantly?
&nbsp;     *
&nbsp;     * @param newMode
&nbsp;     *            - integer for the new mode
&nbsp;     * @return
&nbsp;     */
&nbsp;    public boolean canInstantSwitch(int newMode) {
<b class="fc">&nbsp;        String newModeName = type.getMode(newMode).getName();</b>
<b class="fc">&nbsp;        String curModeName = curMode().getName();</b>
<b class="fc">&nbsp;        return getType().hasInstantModeSwitch()</b>
<b class="nc">&nbsp;                &amp;&amp; !type.isNextTurnModeSwitch(newModeName)</b>
<b class="nc">&nbsp;                &amp;&amp; !type.isNextTurnModeSwitch(curModeName);</b>
&nbsp;    }
&nbsp;
&nbsp;    public void newRound(int roundNumber) {
<b class="fc">&nbsp;        setUsedThisRound(false);</b>
&nbsp;
<b class="fc">&nbsp;        if ((type != null) &amp;&amp; (type.hasModes() &amp;&amp; (pendingMode != -1))) {</b>
<b class="fc">&nbsp;            mode = pendingMode;</b>
<b class="fc">&nbsp;            pendingMode = -1;</b>
&nbsp;        }
<b class="fc">&nbsp;        called.reset();</b>
<b class="fc">&nbsp;    }</b>
&nbsp;
&nbsp;    public void newPhase(IGame.Phase phase) {
<b class="nc">&nbsp;        jammed = jammedThisPhase;</b>
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    /**
&nbsp;     * Shortcut to type.getName()
&nbsp;     */
&nbsp;    public String getName() {
<b class="fc">&nbsp;        return type.getName(size);</b>
&nbsp;    }
&nbsp;
&nbsp;    public String getShortName() {
<b class="nc">&nbsp;        return type.getShortName(size);</b>
&nbsp;    }
&nbsp;
&nbsp;    public String getDesc() {
&nbsp;        StringBuffer desc;
<b class="nc">&nbsp;        switch (getMineType()) {</b>
&nbsp;            case MINE_CONVENTIONAL:
<b class="nc">&nbsp;                desc = new StringBuffer(</b>
<b class="nc">&nbsp;                        Messages.getString(&quot;Mounted.ConventionalMine&quot;));</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            case MINE_VIBRABOMB:
<b class="nc">&nbsp;                desc = new StringBuffer(</b>
<b class="nc">&nbsp;                        Messages.getString(&quot;Mounted.VibraBombMine&quot;));</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            case MINE_COMMAND_DETONATED:
<b class="nc">&nbsp;                desc = new StringBuffer(</b>
<b class="nc">&nbsp;                        Messages.getString(&quot;Mounted.CommandDetonatedMine&quot;));</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            case MINE_ACTIVE:
<b class="nc">&nbsp;                desc = new StringBuffer(</b>
<b class="nc">&nbsp;                        Messages.getString(&quot;Mounted.ActiveMine&quot;));</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            case MINE_INFERNO:
<b class="nc">&nbsp;                desc = new StringBuffer(</b>
<b class="nc">&nbsp;                        Messages.getString(&quot;Mounted.InfernoMine&quot;));</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            case -1:
&nbsp;            default:
<b class="nc">&nbsp;                desc = new StringBuffer(type.getDesc(getSize()));</b>
&nbsp;        }
<b class="nc">&nbsp;        if (isWeaponGroup()) {</b>
<b class="nc">&nbsp;            desc.append(&quot; (&quot;).append(getNWeapons()).append(&quot;)&quot;);</b>
&nbsp;        }
<b class="nc">&nbsp;        if (destroyed) {</b>
<b class="nc">&nbsp;            if (!repairable) {</b>
<b class="nc">&nbsp;                desc.insert(0, &quot;**&quot;);</b>
&nbsp;            } else {
<b class="nc">&nbsp;                desc.insert(0, &quot;*&quot;);</b>
&nbsp;            }
<b class="nc">&nbsp;        } else if (missing) {</b>
<b class="nc">&nbsp;            desc.insert(0, &quot;x &quot;);</b>
<b class="nc">&nbsp;        } else if (useless) {</b>
<b class="nc">&nbsp;            desc.insert(0, &quot;x &quot;);</b>
<b class="nc">&nbsp;        } else if (usedThisRound) {</b>
<b class="nc">&nbsp;            desc.insert(0, &quot;+&quot;);</b>
<b class="nc">&nbsp;        } else if (jammed) {</b>
<b class="nc">&nbsp;            desc.insert(0, &quot;j &quot;);</b>
<b class="nc">&nbsp;        } else if (fired) {</b>
<b class="nc">&nbsp;            desc.insert(0, &quot;- &quot;);</b>
<b class="nc">&nbsp;        } else if (isPendingDump()) {</b>
<b class="nc">&nbsp;            desc.insert(0, &quot;d &quot;);</b>
&nbsp;        }
<b class="nc">&nbsp;        if (rearMounted) {</b>
<b class="nc">&nbsp;            desc.append(&quot; (R)&quot;);</b>
&nbsp;        }
<b class="nc">&nbsp;        if (mechTurretMounted) {</b>
<b class="nc">&nbsp;            desc.append(&quot; (T)&quot;);</b>
&nbsp;        }
<b class="nc">&nbsp;        if (sponsonTurretMounted) {</b>
<b class="nc">&nbsp;            desc.append(&quot; (ST)&quot;);</b>
&nbsp;        }
<b class="nc">&nbsp;        if (pintleTurretMounted) {</b>
<b class="nc">&nbsp;            desc.append(&quot; (PT)&quot;);</b>
&nbsp;        }
&nbsp;        // Append the facing for VGLs
<b class="nc">&nbsp;        if (getType().hasFlag(WeaponType.F_VGL)) {</b>
<b class="nc">&nbsp;            switch (facing) {</b>
&nbsp;            case 0:
<b class="nc">&nbsp;                desc.append(&quot; (F)&quot;);</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            case 1:
<b class="nc">&nbsp;                desc.append(&quot; (FR)&quot;);</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            case 2:
<b class="nc">&nbsp;                desc.append(&quot; (RR)&quot;);</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            case 3:
<b class="nc">&nbsp;                desc.append(&quot; (R)&quot;);</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            case 4:
<b class="nc">&nbsp;                desc.append(&quot; (RL)&quot;);</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            case 5:
<b class="nc">&nbsp;                desc.append(&quot; (FL)&quot;);</b>
&nbsp;                break;
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        if ((type instanceof AmmoType) &amp;&amp; (location != Entity.LOC_NONE)) {</b>
&nbsp;
<b class="nc">&nbsp;            desc.append(&quot; (&quot;);</b>
<b class="nc">&nbsp;            desc.append(shotsLeft);</b>
<b class="nc">&nbsp;            desc.append(&quot;)&quot;);</b>
&nbsp;        }
<b class="nc">&nbsp;        if (getEntity() instanceof BattleArmor) {</b>
<b class="nc">&nbsp;            if (getBaMountLoc() == BattleArmor.MOUNT_LOC_BODY) {</b>
<b class="nc">&nbsp;                desc.append(&quot; (Body)&quot;);</b>
&nbsp;            }
<b class="nc">&nbsp;            if (getBaMountLoc() == BattleArmor.MOUNT_LOC_LARM) {</b>
<b class="nc">&nbsp;                desc.append(&quot; (Left arm)&quot;);</b>
&nbsp;            }
<b class="nc">&nbsp;            if (getBaMountLoc() == BattleArmor.MOUNT_LOC_RARM) {</b>
<b class="nc">&nbsp;                desc.append(&quot; (Right arm)&quot;);</b>
&nbsp;            }
<b class="nc">&nbsp;            if (getBaMountLoc() == BattleArmor.MOUNT_LOC_TURRET) {</b>
<b class="nc">&nbsp;                desc.append(&quot; (Turret)&quot;);</b>
&nbsp;            }
<b class="nc">&nbsp;            if (isDWPMounted()) {</b>
<b class="nc">&nbsp;                desc.append(&quot; (DWP)&quot;);</b>
&nbsp;            }
<b class="nc">&nbsp;            if (isSquadSupportWeapon()) {</b>
<b class="nc">&nbsp;                desc.append(&quot; (SSWM)&quot;);</b>
&nbsp;            }
<b class="nc">&nbsp;            if (isAPMMounted()) {</b>
<b class="nc">&nbsp;                desc.append(&quot; (APM)&quot;);</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        if (isDumping()) {</b>
<b class="nc">&nbsp;            desc.append(&quot; (dumping)&quot;);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (isArmored()){</b>
<b class="nc">&nbsp;            desc.append(&quot; (armored)&quot;);</b>
&nbsp;        }
<b class="nc">&nbsp;        return desc.toString();</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * @return The weight of the equipment in this mount, using the default rounding method for the {@link Entity}.
&nbsp;     */
&nbsp;    public double getTonnage() {
<b class="fc">&nbsp;        return getTonnage(RoundWeight.STANDARD);</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * @param defaultRounding The method to use in rounding the weight
&nbsp;     * @return                The weight of the equipment in this mount
&nbsp;     */
&nbsp;    public double getTonnage(RoundWeight defaultRounding) {
<b class="fc">&nbsp;        if ((getType() instanceof MiscType) &amp;&amp; getType().hasFlag(MiscType.F_DUMPER)) {</b>
<b class="nc">&nbsp;            final Bay bay = getEntity().getBayById(getLinkedBayId());</b>
<b class="nc">&nbsp;            if (bay != null) {</b>
<b class="nc">&nbsp;                return defaultRounding.round(bay.getCapacity() * 0.05, getEntity());</b>
&nbsp;            }
<b class="nc">&nbsp;            MegaMek.getLogger().warning(&quot;Found dumper not linked to a cargo bay. Using zero for the weight.&quot;);</b>
<b class="nc">&nbsp;            return 0.0;</b>
&nbsp;        }
<b class="fc">&nbsp;        double retVal = getType().getTonnage(getEntity(), getLocation(), getSize(), defaultRounding);</b>
<b class="fc">&nbsp;        if (isDWPMounted()) {</b>
<b class="nc">&nbsp;            return defaultRounding.round(retVal * 0.75, getEntity());</b>
<b class="fc">&nbsp;        } else if (isSquadSupportWeapon()) {</b>
<b class="nc">&nbsp;            retVal *= getEntity().isClan() ? 0.4 : 0.5;</b>
<b class="nc">&nbsp;            return defaultRounding.round(retVal, getEntity());</b>
&nbsp;        }
<b class="fc">&nbsp;        return retVal;</b>
&nbsp;    }
&nbsp;
&nbsp;    public int getCriticals() {
<b class="fc">&nbsp;        return getType().getCriticals(getEntity(), getSize());</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * @return The cost of the mounted equipment
&nbsp;     */
&nbsp;    public double getCost() {
<b class="nc">&nbsp;        return getType().getCost(getEntity(), isArmored(), getLocation(), getSize());</b>
&nbsp;    }
&nbsp;
&nbsp;    public boolean isReady() {
<b class="nc">&nbsp;        return isReady(false);</b>
&nbsp;    }
&nbsp;
&nbsp;    public boolean isReady(boolean isStrafing) {
<b class="nc">&nbsp;        return (!usedThisRound || isStrafing) &amp;&amp; !destroyed &amp;&amp; !missing</b>
&nbsp;                &amp;&amp; !jammed &amp;&amp; !useless &amp;&amp; !fired
<b class="nc">&nbsp;                &amp;&amp; (!isDWPMounted || (isDWPMounted &amp;&amp; (getLinkedBy() != null)));</b>
&nbsp;    }
&nbsp;
&nbsp;    public boolean isUsedThisRound() {
<b class="nc">&nbsp;        return usedThisRound;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setUsedThisRound(boolean usedThisRound) {
<b class="fc">&nbsp;        this.usedThisRound = usedThisRound;</b>
<b class="fc">&nbsp;        if (usedThisRound) {</b>
<b class="nc">&nbsp;            phase = entity.game.getPhase();</b>
&nbsp;        } else {
<b class="fc">&nbsp;            phase = IGame.Phase.PHASE_UNKNOWN;</b>
&nbsp;        }
<b class="fc">&nbsp;    }</b>
&nbsp;
&nbsp;    public IGame.Phase usedInPhase() {
<b class="nc">&nbsp;        if (usedThisRound) {</b>
<b class="nc">&nbsp;            return phase;</b>
&nbsp;        }
<b class="nc">&nbsp;        return IGame.Phase.PHASE_UNKNOWN;</b>
&nbsp;    }
&nbsp;
&nbsp;    public boolean isBreached() {
<b class="fc">&nbsp;        return useless;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setBreached(boolean breached) {
<b class="nc">&nbsp;        useless = breached;</b>
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    public boolean isDestroyed() {
<b class="fc">&nbsp;        return destroyed;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Set this Mounted&#39;s destroyed status NOTE: only set this if this Mounted
&nbsp;     * cannot be used in the current phase anymore. If it still can, use setHit
&nbsp;     * instead
&nbsp;     *
&nbsp;     * @param destroyed
&nbsp;     * @see #setHit(boolean)
&nbsp;     */
&nbsp;    public void setDestroyed(boolean destroyed) {
<b class="nc">&nbsp;        this.destroyed = destroyed;</b>
<b class="nc">&nbsp;        if ((destroyed == true)</b>
<b class="nc">&nbsp;                &amp;&amp; getType().hasFlag(MiscType.F_RADICAL_HEATSINK)){</b>
<b class="nc">&nbsp;            if (entity != null){</b>
<b class="nc">&nbsp;                entity.setHasDamagedRHS(true);</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    public boolean isInoperable() {
<b class="fc">&nbsp;        return destroyed || missing || useless;</b>
&nbsp;    }
&nbsp;
&nbsp;    public boolean isHit() {
<b class="nc">&nbsp;        return hit;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * set that this mounted was or was not hit with a crit this phase Note:
&nbsp;     * stuff that was hit in a phase can still be used in that phase, if that&#39;s
&nbsp;     * not desired, use setDestroyed instead
&nbsp;     *
&nbsp;     * @param hit
&nbsp;     * @see #setDestroyed(boolean)
&nbsp;     */
&nbsp;    public void setHit(boolean hit) {
<b class="nc">&nbsp;        this.hit = hit;</b>
<b class="nc">&nbsp;        if ((hit == true)</b>
<b class="nc">&nbsp;                &amp;&amp; getType().hasFlag(MiscType.F_RADICAL_HEATSINK)){</b>
<b class="nc">&nbsp;            if (entity != null){</b>
<b class="nc">&nbsp;                entity.setHasDamagedRHS(true);</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    public boolean isMissing() {
<b class="nc">&nbsp;        return missing;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setMissing(boolean missing) {
<b class="nc">&nbsp;        this.missing = missing;</b>
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    public boolean isJammed() {
<b class="nc">&nbsp;        return jammed;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setJammed(boolean j) {
<b class="nc">&nbsp;        jammedThisPhase = j;</b>
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    public boolean jammedThisPhase() {
<b class="nc">&nbsp;        return jammedThisPhase;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Clear all jam statuses - used by MHQ, because phase resetting doesn&#39;t work
&nbsp;     */
&nbsp;    public void resetJam() {
<b class="nc">&nbsp;        jammed = false;</b>
<b class="nc">&nbsp;        jammedThisPhase = false;</b>
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    /**
&nbsp;     * The number of shots of ammunition currently stored in this Mounted
&nbsp;     * irregardless of its operational status. Or in other words, the straight
&nbsp;     * value last set by {@link #setShotsLeft(int)}, even if this ammo slot is
&nbsp;     * no longer functional or indeed notionally no longer part of the unit
&nbsp;     * formerly carrying it. This is the &#39;general&#39; base value that should be
&nbsp;     * used for display, reporting, entity encoding and salvage purposes.
&nbsp;     *
&nbsp;     * @see #getHittableShotsLeft()
&nbsp;     * @see #getUsableShotsLeft()
&nbsp;     * @return The base &#39;true&#39; number of shots in this slot.
&nbsp;     */
&nbsp;    public int getBaseShotsLeft() {
<b class="nc">&nbsp;        return shotsLeft;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Convenience method returning the number of shots of ammunition in this
&nbsp;     * Mounted that may be affected by a critical hit. This method returns 0 if
&nbsp;     * this Mounted is marked as destroyed or missing and the same value as
&nbsp;     * {@link #getBaseShotsLeft()} otherwise.
&nbsp;     *
&nbsp;     * @see #getBaseShotsLeft()
&nbsp;     * @see #getUsableShotsLeft()
&nbsp;     * @return The number of &#39;hittable&#39; shots in this slot.
&nbsp;     */
&nbsp;    public int getHittableShotsLeft() {
<b class="nc">&nbsp;        if (destroyed || missing) {</b>
<b class="nc">&nbsp;            return 0;</b>
&nbsp;        }
<b class="nc">&nbsp;        return shotsLeft;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Convenience method returning the number of shots of ammunition in this
&nbsp;     * Mounted that can actually be used &lt;em&gt;as&lt;/em&gt; ammunition. This method
&nbsp;     * returns 0 if this Mounted is marked as destroyed, missing, or breached
&nbsp;     * and thus nonfunctional and the same value as {@link #getBaseShotsLeft()}
&nbsp;     * otherwise.
&nbsp;     *
&nbsp;     * @see #getBaseShotsLeft()
&nbsp;     * @see #getHittableShotsLeft()
&nbsp;     * @return The number of usable shots in this slot.
&nbsp;     */
&nbsp;    public int getUsableShotsLeft() {
<b class="fc">&nbsp;        if (destroyed || missing || useless) {</b>
<b class="nc">&nbsp;            return 0;</b>
&nbsp;        }
<b class="fc">&nbsp;        return shotsLeft;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setShotsLeft(int shotsLeft) {
<b class="fc">&nbsp;        if (shotsLeft &lt; 0) {</b>
<b class="nc">&nbsp;            shotsLeft = 0;</b>
&nbsp;        }
<b class="fc">&nbsp;        this.shotsLeft = shotsLeft;</b>
<b class="fc">&nbsp;    }</b>
&nbsp;
&nbsp;    /**
&nbsp;     * Returns how many shots the weapon is using
&nbsp;     */
&nbsp;    public int getCurrentShots() {
<b class="nc">&nbsp;        WeaponType wtype = (WeaponType) getType();</b>
<b class="nc">&nbsp;        int nShots = getNumShots(wtype, curMode(), false);</b>
&nbsp;        // sets number of shots for MG arrays
<b class="nc">&nbsp;        if (wtype.hasFlag(WeaponType.F_MGA)) {</b>
<b class="nc">&nbsp;            nShots = 0;</b>
<b class="nc">&nbsp;            for(int eqn : getBayWeapons()) {</b>
<b class="nc">&nbsp;                Mounted m = entity.getEquipment(eqn);</b>
<b class="nc">&nbsp;                if(null == m) {</b>
<b class="nc">&nbsp;                    continue;</b>
&nbsp;                }
<b class="nc">&nbsp;                if ((m.getLocation() == getLocation())</b>
<b class="nc">&nbsp;                        &amp;&amp; !m.isDestroyed()</b>
<b class="nc">&nbsp;                        &amp;&amp; !m.isBreached()</b>
<b class="nc">&nbsp;                        &amp;&amp; m.getType().hasFlag(WeaponType.F_MG)</b>
<b class="nc">&nbsp;                        &amp;&amp; (((WeaponType) m.getType()).getRackSize() == ((WeaponType) getType())</b>
<b class="nc">&nbsp;                                .getRackSize())) {</b>
<b class="nc">&nbsp;                    nShots++;</b>
&nbsp;                }
<b class="nc">&nbsp;            }</b>
&nbsp;        }
<b class="nc">&nbsp;        return nShots;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Returns how many shots a weapon type would use.  This can be used without
&nbsp;     * an instantiation of Mounted, which is useful for computing Aero heat.
&nbsp;     * If ignoreMode is true, then mode can be null.
&nbsp;     */
&nbsp;    public static int getNumShots(WeaponType wtype, EquipmentMode mode,
&nbsp;            boolean ignoreMode) {
&nbsp;        // figure out # of shots for variable-shot weapons
<b class="nc">&nbsp;        if (((wtype.getAmmoType() == AmmoType.T_AC_ULTRA) || (wtype</b>
<b class="nc">&nbsp;                .getAmmoType() == AmmoType.T_AC_ULTRA_THB))</b>
<b class="nc">&nbsp;                &amp;&amp; (ignoreMode || mode.equals(Weapon.MODE_UAC_ULTRA))) {</b>
<b class="nc">&nbsp;            return 2;</b>
&nbsp;        }
&nbsp;        // sets number of shots for AC rapid mode
<b class="nc">&nbsp;        else if (((wtype.getAmmoType() == AmmoType.T_AC) </b>
<b class="nc">&nbsp;                || (wtype.getAmmoType() == AmmoType.T_LAC)</b>
<b class="nc">&nbsp;                || (wtype.getAmmoType() == AmmoType.T_AC_IMP)</b>
<b class="nc">&nbsp;                || (wtype.getAmmoType() == AmmoType.T_PAC))</b>
<b class="nc">&nbsp;                &amp;&amp; wtype.hasModes()</b>
<b class="nc">&nbsp;                &amp;&amp; (ignoreMode || mode.equals(Weapon.MODE_AC_RAPID))) {</b>
<b class="nc">&nbsp;            return 2;</b>
<b class="nc">&nbsp;        } else if ((wtype.getAmmoType() == AmmoType.T_AC_ROTARY)</b>
<b class="nc">&nbsp;                || wtype.getInternalName().equals(BattleArmor.MINE_LAUNCHER)) {</b>
<b class="nc">&nbsp;            if (ignoreMode || (mode == null) || mode.equals(Weapon.MODE_RAC_SIX_SHOT)) {</b>
<b class="nc">&nbsp;                return 6;</b>
<b class="nc">&nbsp;            } else if (mode.equals(Weapon.MODE_RAC_TWO_SHOT)) {</b>
<b class="nc">&nbsp;                return 2;</b>
<b class="nc">&nbsp;            } else if (mode.equals(Weapon.MODE_RAC_THREE_SHOT)) {</b>
<b class="nc">&nbsp;                return 3;</b>
<b class="nc">&nbsp;            } else if (mode.equals(Weapon.MODE_RAC_FOUR_SHOT)) {</b>
<b class="nc">&nbsp;                return 4;</b>
<b class="nc">&nbsp;            } else if (mode.equals(Weapon.MODE_RAC_FIVE_SHOT)) {</b>
<b class="nc">&nbsp;                return 5;</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        return 1;</b>
&nbsp;    }
&nbsp;
&nbsp;    public boolean isPendingDump() {
<b class="nc">&nbsp;        return m_bPendingDump;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setPendingDump(boolean b) {
<b class="nc">&nbsp;        m_bPendingDump = b;</b>
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    public boolean isDumping() {
<b class="fc">&nbsp;        return m_bDumping;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setDumping(boolean b) {
<b class="nc">&nbsp;        m_bDumping = b;</b>
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    /**
&nbsp;     * Used for equipment that can vary in size. This is not used for equipment for which
&nbsp;     * size is computed by outside factors such as unit weight or targeting computer-linked
&nbsp;     * weapons, but for equipment that comes in various weights, lengths, or capacities.
&nbsp;     * The meaning of the size varies according to the equipment. For robotic control systems,
&nbsp;     * this is the number of drones that can be controlled. For ladders this is the length in meters.
&nbsp;     * For most other variable equipment this is the weight in tons. Non-variable
&nbsp;     * equipment should return 1.0.
&nbsp;     *
&nbsp;     * @return The size of the mounted equipment
&nbsp;     */
&nbsp;    public double getSize() {
<b class="fc">&nbsp;        return size;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Sets the size of variable-sized equipment.
&nbsp;     *
&nbsp;     * @param size
&nbsp;     * @see #getSize()
&nbsp;     */
&nbsp;    public void setSize(double size) {
<b class="nc">&nbsp;        this.size = size;</b>
<b class="nc">&nbsp;    }</b>
&nbsp;    
&nbsp;    /**
&nbsp;     * The capacity of an ammo bin may be different than the weight of the original shots
&nbsp;     * in the case of AR10s due to variable missile weight.
&nbsp;     * 
&nbsp;     * @return The capacity of a mounted ammo bin in tons.
&nbsp;     * @deprecated Use {@link #getSize()}
&nbsp;     */
&nbsp;    @Deprecated
&nbsp;    public double getAmmoCapacity() {
<b class="nc">&nbsp;        return size;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Sets the maximum tonnage of ammo for a mounted ammo bin.
&nbsp;     * 
&nbsp;     * @param capacity The capacity of the bin in tons.
&nbsp;     * @deprecated Use {@link #setSize(double)}
&nbsp;     */
&nbsp;    @Deprecated
&nbsp;    public void setAmmoCapacity(double capacity) {
<b class="nc">&nbsp;        size = capacity;</b>
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    public boolean isRapidfire() {
<b class="nc">&nbsp;        return rapidfire;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setRapidfire(boolean rapidfire) {
<b class="nc">&nbsp;        this.rapidfire = rapidfire;</b>
<b class="nc">&nbsp;    }</b>
&nbsp;    
&nbsp;       
&nbsp;    /**
&nbsp;     * Checks to see if the current ammo for this weapon is hotloaded
&nbsp;     *
&nbsp;     * @return &lt;code&gt;true&lt;/code&gt; if ammo is hotloaded or &lt;code&gt;false&lt;/code&gt; if
&nbsp;     *         not
&nbsp;     */
&nbsp;    public boolean isHotLoaded() {
&nbsp;
<b class="nc">&nbsp;        boolean isHotLoaded = false;</b>
&nbsp;
<b class="nc">&nbsp;        if (getType() instanceof WeaponType) {</b>
<b class="nc">&nbsp;            Mounted link = getLinked();</b>
<b class="nc">&nbsp;            if ((link == null) || !(link.getType() instanceof AmmoType)) {</b>
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            isHotLoaded = link.hotloaded;</b>
<b class="nc">&nbsp;            if (((AmmoType) link.getType()).getMunitionType() == AmmoType.M_DEAD_FIRE) {</b>
<b class="nc">&nbsp;                return true;</b>
&nbsp;            }
&nbsp;
&nbsp;            // Check to see if the ammo has its mode set to hotloaded.
&nbsp;            // This is for vehicles that can change hotload status during
&nbsp;            // combat.
<b class="nc">&nbsp;            if (!isHotLoaded &amp;&amp; link.getType().hasModes()</b>
<b class="nc">&nbsp;                    &amp;&amp; link.curMode().equals(&quot;HotLoad&quot;)) {</b>
<b class="nc">&nbsp;                isHotLoaded = true;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            return isHotLoaded;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (getType() instanceof AmmoType) {</b>
<b class="nc">&nbsp;            isHotLoaded = hotloaded;</b>
&nbsp;
<b class="nc">&nbsp;            if (((AmmoType) getType()).getMunitionType() == AmmoType.M_DEAD_FIRE) {</b>
<b class="nc">&nbsp;                return true;</b>
&nbsp;            }
&nbsp;
&nbsp;            // Check to see if the ammo has its mode set to hotloaded.
&nbsp;            // This is for vehicles that can change hotload status during
&nbsp;            // combat.
<b class="nc">&nbsp;            if (!isHotLoaded &amp;&amp; getType().hasModes()</b>
<b class="nc">&nbsp;                    &amp;&amp; curMode().equals(&quot;HotLoad&quot;)) {</b>
<b class="nc">&nbsp;                isHotLoaded = true;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            return isHotLoaded;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return false;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Sets the hotloading parameter for this weapons ammo.
&nbsp;     *
&nbsp;     * @param hotload
&nbsp;     */
&nbsp;    public void setHotLoad(boolean hotload) {
&nbsp;
<b class="nc">&nbsp;        if (getType() instanceof WeaponType) {</b>
<b class="nc">&nbsp;            Mounted link = getLinked();</b>
<b class="nc">&nbsp;            if ((link == null) || !(link.getType() instanceof AmmoType)) {</b>
<b class="nc">&nbsp;                return;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (((AmmoType) link.getType()).hasFlag(AmmoType.F_HOTLOAD)) {</b>
<b class="nc">&nbsp;                link.hotloaded = hotload;</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        if (getType() instanceof AmmoType) {</b>
<b class="nc">&nbsp;            if (((AmmoType) getType()).hasFlag(AmmoType.F_HOTLOAD)) {</b>
<b class="nc">&nbsp;                hotloaded = hotload;</b>
&nbsp;            }
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;    }</b>
&nbsp;    
&nbsp;    /** Returns true when m is a PPC Capacitor and not destroyed. */
&nbsp;    private boolean isWorkingCapacitor(Mounted m) {
<b class="nc">&nbsp;        return !m.isDestroyed()</b>
<b class="nc">&nbsp;        &amp;&amp; m.getType() instanceof MiscType</b>
<b class="nc">&nbsp;        &amp;&amp; ((MiscType) m.getType()).hasFlag(MiscType.F_PPC_CAPACITOR);</b>
&nbsp;    }
&nbsp;
&nbsp;    /** 
&nbsp;     * Returns 1 or 2 if this Mounted has a linked
&nbsp;     * and charged (= set to charge in an earlier turn) 
&nbsp;     * PPC Capacitor.
&nbsp;     */
&nbsp;    public int hasChargedCapacitor() {
<b class="nc">&nbsp;        if (getCrossLinkedBy() != null</b>
<b class="nc">&nbsp;                &amp;&amp; isWorkingCapacitor(getCrossLinkedBy())</b>
<b class="nc">&nbsp;                &amp;&amp; getCrossLinkedBy().curMode().equals(&quot;Charge&quot;)) {</b>
<b class="nc">&nbsp;            return 2;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (getLinkedBy() != null</b>
<b class="nc">&nbsp;                &amp;&amp; isWorkingCapacitor(getLinkedBy())</b>
<b class="nc">&nbsp;                &amp;&amp; getLinkedBy().curMode().equals(&quot;Charge&quot;)) {</b>
<b class="nc">&nbsp;            return 1;</b>
&nbsp;        }
<b class="nc">&nbsp;        return 0;</b>
&nbsp;    }
&nbsp;
&nbsp;    /** 
&nbsp;     * Returns 1 or 2 if this Mounted has a linked
&nbsp;     * and charged (= set to charge in an earlier turn) 
&nbsp;     * or charging (= set to charge this turn)
&nbsp;     * PPC Capacitor. Used to determine heat. 
&nbsp;     */
&nbsp;    public int hasChargedOrChargingCapacitor() {
<b class="nc">&nbsp;        int isCharged = hasChargedCapacitor();</b>
<b class="nc">&nbsp;        if (isCharged != 0) {</b>
<b class="nc">&nbsp;            return isCharged;</b>
&nbsp;        } else {
&nbsp;            // When it has been set to charge this turn,
&nbsp;            // pendingMode is set
<b class="nc">&nbsp;            if (getCrossLinkedBy() != null</b>
<b class="nc">&nbsp;                    &amp;&amp; isWorkingCapacitor(getCrossLinkedBy())</b>
<b class="nc">&nbsp;                    &amp;&amp; getCrossLinkedBy().pendingMode().equals(&quot;Charge&quot;)) {</b>
<b class="nc">&nbsp;                return 2;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (getLinkedBy() != null</b>
<b class="nc">&nbsp;                    &amp;&amp; isWorkingCapacitor(getLinkedBy())</b>
<b class="nc">&nbsp;                    &amp;&amp; getLinkedBy().pendingMode().equals(&quot;Charge&quot;)) {</b>
<b class="nc">&nbsp;                return 1;</b>
&nbsp;            }
<b class="nc">&nbsp;            return 0;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    public int getLocation() {
<b class="fc">&nbsp;        return location;</b>
&nbsp;    }
&nbsp;
&nbsp;    public int getSecondLocation() {
<b class="nc">&nbsp;        if (bSplit) {</b>
<b class="nc">&nbsp;            return secondLocation;</b>
&nbsp;        }
<b class="nc">&nbsp;        return -1;</b>
&nbsp;    }
&nbsp;
&nbsp;    public boolean isRearMounted() {
<b class="fc">&nbsp;        return rearMounted;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setLocation(int location) {
<b class="fc">&nbsp;        setLocation(location, false);</b>
<b class="fc">&nbsp;    }</b>
&nbsp;
&nbsp;    public void setSecondLocation(int location) {
<b class="nc">&nbsp;        setSecondLocation(location, false);</b>
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    public void setLocation(int location, boolean rearMounted) {
<b class="fc">&nbsp;        this.location = location;</b>
<b class="fc">&nbsp;        this.rearMounted = rearMounted;</b>
<b class="fc">&nbsp;    }</b>
&nbsp;
&nbsp;    public void setSecondLocation(int location, boolean rearMounted) {
<b class="nc">&nbsp;        secondLocation = location;</b>
<b class="nc">&nbsp;        this.rearMounted = rearMounted;</b>
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    public Mounted getLinked() {
<b class="fc">&nbsp;        return linked;</b>
&nbsp;    }
&nbsp;
&nbsp;    public Mounted getLinkedBy() {
<b class="fc">&nbsp;        return linkedBy;</b>
&nbsp;    }
&nbsp;
&nbsp;    public Mounted getCrossLinkedBy() {
<b class="nc">&nbsp;        return crossLinkedBy;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setLinked(Mounted linked) {
<b class="fc">&nbsp;        this.linked = linked;</b>
<b class="fc">&nbsp;        if (linked != null) {</b>
<b class="fc">&nbsp;            linked.setLinkedBy(this);</b>
&nbsp;        }
<b class="fc">&nbsp;    }</b>
&nbsp;
&nbsp;    public void setCrossLinked(Mounted linked) {
<b class="nc">&nbsp;        this.linked = linked;</b>
<b class="nc">&nbsp;        linked.setCrossLinkedBy(this);</b>
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    // should only be called by setLinked(), or when dumping a DWP
&nbsp;    // in the case of a many-to-one relationship (like ammo) this is meaningless
&nbsp;    public void setLinkedBy(Mounted linker) {
<b class="fc">&nbsp;        if ((linker != null) &amp;&amp; (linker.getLinked() != this)) {</b>
&nbsp;            // liar
<b class="nc">&nbsp;            return;</b>
&nbsp;        }
<b class="fc">&nbsp;        linkedBy = linker;</b>
<b class="fc">&nbsp;    }</b>
&nbsp;
&nbsp;    // called by setCrossLinked() when using cross-linked capacitors.
&nbsp;    public void setCrossLinkedBy(Mounted linker) {
<b class="nc">&nbsp;        if ((linker != null) &amp;&amp; (linker.getLinked() != this)) {</b>
&nbsp;            // liar
<b class="nc">&nbsp;            return;</b>
&nbsp;        }
<b class="nc">&nbsp;        crossLinkedBy = linker;</b>
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    /**
&nbsp;     * Used for associating the equipment mount with a cargo bay. This is for dumpers and transient bays
&nbsp;     * created on load for use by &#39;Mech cargo equipment.
&nbsp;     *
&nbsp;     * @return The index of the bay this mount is linked to, or -1 if it is not linked.
&nbsp;     * @see Entity#getBayById(int)
&nbsp;     */
&nbsp;    public int getLinkedBayId() {
<b class="nc">&nbsp;        return linkedBayId;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setLinkedBayId(int id) {
<b class="nc">&nbsp;        linkedBayId = id;</b>
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    public int getFoundCrits() {
<b class="nc">&nbsp;        return nFoundCrits;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setFoundCrits(int n) {
<b class="nc">&nbsp;        nFoundCrits = n;</b>
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    public boolean isSplit() {
<b class="nc">&nbsp;        return bSplit;</b>
&nbsp;    }
&nbsp;
&nbsp;    public boolean isSplitable() {
<b class="fc">&nbsp;        return (((getType() instanceof WeaponType) &amp;&amp; ((WeaponType)getType()).isSplitable()) || ((getType() instanceof MiscType) &amp;&amp; getType()</b>
<b class="fc">&nbsp;                .hasFlag(MiscType.F_SPLITABLE)));</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setSplit(boolean b) {
<b class="nc">&nbsp;        bSplit = b;</b>
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    public int getExplosionDamage() {
<b class="nc">&nbsp;        if (type instanceof AmmoType) {</b>
<b class="nc">&nbsp;            AmmoType atype = (AmmoType) type;</b>
<b class="nc">&nbsp;            int rackSize = atype.getRackSize();</b>
<b class="nc">&nbsp;            int damagePerShot = atype.getDamagePerShot();</b>
&nbsp;            // Anti-ship EW bomb does no damage but deals a 5-point explosion if LAM bomb bay is hit
<b class="nc">&nbsp;            if ((type instanceof BombType)</b>
<b class="nc">&nbsp;                    &amp;&amp; (((BombType)type).getBombType() == BombType.B_ASEW)) {</b>
<b class="nc">&nbsp;                damagePerShot = 5;</b>
&nbsp;            }
&nbsp;            
&nbsp;            //Capital missiles need a racksize for this
<b class="nc">&nbsp;            if (type.hasFlag(AmmoType.F_CAP_MISSILE)) {</b>
<b class="nc">&nbsp;                rackSize = 1;</b>
&nbsp;            }
&nbsp;            
&nbsp;            //Screen launchers need a racksize. Damage is 15 per TW p251
<b class="nc">&nbsp;            if (atype.getAmmoType() == AmmoType.T_SCREEN_LAUNCHER) {</b>
<b class="nc">&nbsp;                rackSize = 1;</b>
<b class="nc">&nbsp;                damagePerShot = 15;</b>
&nbsp;            }
&nbsp;            
<b class="nc">&nbsp;            long mType = atype.getMunitionType();</b>
&nbsp;            // both Dead-Fire and Tandem-charge SRM&#39;s do 3 points of damage per
&nbsp;            // shot when critted
&nbsp;            // Dead-Fire LRM&#39;s do 2 points of damage per shot when critted.
<b class="nc">&nbsp;            if ((mType == AmmoType.M_DEAD_FIRE)</b>
&nbsp;                    || (mType == AmmoType.M_TANDEM_CHARGE)) {
<b class="nc">&nbsp;                damagePerShot++;</b>
<b class="nc">&nbsp;            } else if (atype.getAmmoType() == AmmoType.T_TASER) {</b>
<b class="nc">&nbsp;                damagePerShot = 6;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (atype.getAmmoType() == AmmoType.T_MEK_MORTAR) {</b>
<b class="nc">&nbsp;                if ((mType == AmmoType.M_AIRBURST)</b>
&nbsp;                        || (mType == AmmoType.M_FLARE)
&nbsp;                        || (mType == AmmoType.M_SMOKE_WARHEAD)) {
<b class="nc">&nbsp;                    damagePerShot = 1;</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    damagePerShot = 2;</b>
&nbsp;                }
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            return damagePerShot * rackSize * shotsLeft;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (type instanceof WeaponType) {</b>
<b class="nc">&nbsp;            WeaponType wtype = (WeaponType) type;</b>
&nbsp;            // TacOps Gauss Weapon rule p. 102
<b class="nc">&nbsp;            if ((type instanceof GaussWeapon) &amp;&amp; type.hasModes()</b>
<b class="nc">&nbsp;                    &amp;&amp; curMode().equals(&quot;Powered Down&quot;)) {</b>
<b class="nc">&nbsp;                return 0;</b>
&nbsp;            }
<b class="nc">&nbsp;            if ((isHotLoaded() || hasQuirk(OptionsConstants.QUIRK_WEAP_NEG_AMMO_FEED_PROBLEMS))</b>
<b class="nc">&nbsp;                    &amp;&amp; (getLinked().getUsableShotsLeft() &gt; 0)) {</b>
<b class="nc">&nbsp;                Mounted link = getLinked();</b>
<b class="nc">&nbsp;                AmmoType atype = ((AmmoType) link.getType());</b>
<b class="nc">&nbsp;                int damagePerShot = atype.getDamagePerShot();</b>
&nbsp;                // Launchers with Dead-Fire missles in them do an extra point of
&nbsp;                // damage per shot when critted
<b class="nc">&nbsp;                if (atype.getAmmoType() == AmmoType.M_DEAD_FIRE) {</b>
<b class="nc">&nbsp;                    damagePerShot++;</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                int damage = wtype.getRackSize() * damagePerShot;</b>
<b class="nc">&nbsp;                return damage;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (wtype.hasFlag(WeaponType.F_PPC) &amp;&amp; (hasChargedCapacitor() != 0)) {</b>
<b class="nc">&nbsp;                if (isFired()) {</b>
<b class="nc">&nbsp;                    if (hasChargedCapacitor() == 2) {</b>
<b class="nc">&nbsp;                        return 15;</b>
&nbsp;                    }
<b class="nc">&nbsp;                    return 0;</b>
&nbsp;                }
<b class="nc">&nbsp;                if (hasChargedCapacitor() == 2) {</b>
<b class="nc">&nbsp;                    return 30;</b>
&nbsp;                }
<b class="nc">&nbsp;                return 15;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if ((wtype.getAmmoType() == AmmoType.T_MPOD) &amp;&amp; isFired()) {</b>
<b class="nc">&nbsp;                return 0;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            return wtype.getExplosionDamage();</b>
&nbsp;
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (type instanceof MiscType) {</b>
<b class="nc">&nbsp;            MiscType mtype = (MiscType) type;</b>
<b class="nc">&nbsp;            if (mtype.hasFlag(MiscType.F_PPC_CAPACITOR)) {</b>
<b class="nc">&nbsp;                if (curMode().equals(&quot;Charge&quot;) &amp;&amp; (linked != null)</b>
<b class="nc">&nbsp;                        &amp;&amp; !linked.isFired()) {</b>
<b class="nc">&nbsp;                    return 15;</b>
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            if (mtype.hasFlag(MiscType.F_FUEL)) {</b>
<b class="nc">&nbsp;                return 20;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (mtype.hasFlag(MiscType.F_BLUE_SHIELD)) {</b>
<b class="nc">&nbsp;                return 5;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (mtype.hasFlag(MiscType.F_JUMP_JET) &amp;&amp; mtype.hasSubType(MiscType.S_PROTOTYPE) &amp;&amp; mtype.hasSubType(MiscType.S_IMPROVED)) {</b>
<b class="nc">&nbsp;                return 10;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (mtype.hasFlag(MiscType.F_RISC_LASER_PULSE_MODULE)) {</b>
<b class="nc">&nbsp;                return 2;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (mtype.hasFlag(MiscType.F_EMERGENCY_COOLANT_SYSTEM)) {</b>
<b class="nc">&nbsp;                return 5;</b>
&nbsp;            }
<b class="nc">&nbsp;            return 0;</b>
&nbsp;        }
&nbsp;        // um, otherwise, I&#39;m not sure
<b class="nc">&nbsp;        MegaMek.getLogger().error(&quot;mounted: unable to determine explosion damage for &quot; + typeName);</b>
<b class="nc">&nbsp;        return 0;</b>
&nbsp;    }
&nbsp;
&nbsp;    public boolean isFired() { // has a oneshot weapon been fired?
<b class="nc">&nbsp;        return fired;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setFired(boolean val) {
<b class="nc">&nbsp;        fired = val;</b>
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    public boolean isTSEMPDowntime() { // is this the &quot;downtime&quot; turn for TSEMP?
<b class="nc">&nbsp;        return tsempDowntime;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setTSEMPDowntime(boolean val) {
<b class="nc">&nbsp;        tsempDowntime = val;</b>
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    /**
&nbsp;     * Confirm that the given entity can fire the indicated equipment.
&nbsp;     *
&nbsp;     * @return &lt;code&gt;true&lt;/code&gt; if the equipment can be fired by the entity;
&nbsp;     *         &lt;code&gt;false&lt;/code&gt; otherwise.
&nbsp;     */
&nbsp;    public boolean canFire() {
<b class="nc">&nbsp;        return canFire(false);</b>
&nbsp;    }
&nbsp;
&nbsp;    public boolean canFire(boolean isStrafing) {
&nbsp;
&nbsp;        // Equipment operational?
<b class="nc">&nbsp;        if (!isReady(isStrafing) || isBreached() || isMissing() || isFired()) {</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;
&nbsp;        // Is the entity even active?
<b class="nc">&nbsp;        if (entity.isShutDown()</b>
<b class="nc">&nbsp;                || ((null != entity.getCrew()) &amp;&amp; !entity.getCrew().isActive())) {</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;
&nbsp;        // Otherwise, the equipment can be fired.
<b class="nc">&nbsp;        return true;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Determines whether this weapon should be considered crippled for damage
&nbsp;     * level purposes.
&nbsp;     *
&nbsp;     * @return {@code true} if the weapon is at least one of: destroyed,
&nbsp;     *         missing, breached, jammed, a detachable weapon no longer attached
&nbsp;     *         to its original battle armor, or simply out of ammo (includes
&nbsp;     *         discharged one-shot weapons), {@code false} otherwise.
&nbsp;     */
&nbsp;    public boolean isCrippled() {
&nbsp;        /*
&nbsp;         * Have to account for jammed weapons here because we&#39;re currently not
&nbsp;         * distinguishing between potentially temporary and permanent jams, and
&nbsp;         * a perma-jammed weapon definitely _is_ crippled. Moreover, even a
&nbsp;         * weapon that could be unjammed again may end up never getting there
&nbsp;         * and isn&#39;t contributing anything in the meantime, so it might as well
&nbsp;         * be considered &quot;crippled&quot; until the jam clears, if ever.
&nbsp;         */
<b class="fc">&nbsp;        if (destroyed || jammed || missing || useless || fired) {</b>
<b class="nc">&nbsp;            return true;</b>
&nbsp;        }
<b class="fc">&nbsp;        if ((type instanceof AmmoWeapon) || (type instanceof AmmoBayWeapon)) {</b>
<b class="fc">&nbsp;            if ((getLinked() == null)</b>
<b class="fc">&nbsp;                    || (entity.getTotalAmmoOfType(getLinked().getType()) &lt; 1)) {</b>
<b class="nc">&nbsp;                return true;</b>
&nbsp;            }
&nbsp;        }
<b class="fc">&nbsp;        if (isDWPMounted &amp;&amp; (getLinkedBy() != null)) {</b>
<b class="nc">&nbsp;            return true;</b>
&nbsp;        }
<b class="fc">&nbsp;        return false;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Returns false if this ammo should not be loaded. Checks if the ammo is
&nbsp;     * already destroyed or missing, is being dumped, has been breached, is
&nbsp;     * already used up, or is locationless (oneshot ammo).
&nbsp;     */
&nbsp;    public boolean isAmmoUsable() {
<b class="fc">&nbsp;        if (destroyed || missing || m_bDumping || useless || (shotsLeft &lt;= 0)</b>
&nbsp;                || (location == Entity.LOC_NONE)) {
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
<b class="fc">&nbsp;        return true;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * @return the type of mine this mounted is, or &lt;code&gt;-1&lt;/code&gt; if it isn&#39;t
&nbsp;     *         a mine
&nbsp;     */
&nbsp;    public int getMineType() {
<b class="nc">&nbsp;        return mineType;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * set the type of mine this should be
&nbsp;     *
&nbsp;     * @param mineType
&nbsp;     */
&nbsp;    public void setMineType(int mineType) {
<b class="nc">&nbsp;        this.mineType = mineType;</b>
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    /**
&nbsp;     * set the vibrabomb sensitivity
&nbsp;     *
&nbsp;     * @param vibraSetting
&nbsp;     *            the &lt;code&gt;int&lt;/code&gt; sensitivity to set
&nbsp;     */
&nbsp;    public void setVibraSetting(int vibraSetting) {
<b class="nc">&nbsp;        this.vibraSetting = vibraSetting;</b>
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    /**
&nbsp;     * get the vibrabomb sensitivity
&nbsp;     *
&nbsp;     * @return the &lt;code&gt;int&lt;/code&gt; vibrabomb sensitity this mine is set to.
&nbsp;     */
&nbsp;    public int getVibraSetting() {
<b class="nc">&nbsp;        return vibraSetting;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public String toString() {
<b class="nc">&nbsp;        return &quot;megamek.common.Mounted (&quot; + typeName + &quot;)&quot;;</b>
&nbsp;    }
&nbsp;
&nbsp;    public int getBaseDamageAbsorptionRate() {
<b class="nc">&nbsp;        return baseDamageAbsorptionRate;</b>
&nbsp;    }
&nbsp;
&nbsp;    public int getBaseDamageCapacity() {
<b class="nc">&nbsp;        return baseDamageCapacity;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Rules state that every time the shield takes a crit its damage absorption
&nbsp;     * for each attack is reduced by 1. Also for every Arm actuator critted
&nbsp;     * damage absorption is reduced by 1 and finally if the shoulder is hit the
&nbsp;     * damage absorption is reduced by 2 making it possble to kill a shield
&nbsp;     * before its gone through its full damage capacity.
&nbsp;     *
&nbsp;     * @param entity
&nbsp;     * @param location
&nbsp;     * @return
&nbsp;     */
&nbsp;    public int getDamageAbsorption(Entity entity, int location) {
&nbsp;        // Shields can only be used in arms so if you&#39;ve got a shield in a
&nbsp;        // location
&nbsp;        // other then an arm your SOL --Torren.
<b class="nc">&nbsp;        if ((location != Mech.LOC_RARM) &amp;&amp; (location != Mech.LOC_LARM)) {</b>
<b class="nc">&nbsp;            return 0;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        int base = baseDamageAbsorptionRate;</b>
&nbsp;
<b class="nc">&nbsp;        for (int slot = 0; slot &lt; entity.getNumberOfCriticals(location); slot++) {</b>
<b class="nc">&nbsp;            CriticalSlot cs = entity.getCritical(location, slot);</b>
&nbsp;
<b class="nc">&nbsp;            if (cs == null) {</b>
<b class="nc">&nbsp;                continue;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (cs.getType() != CriticalSlot.TYPE_EQUIPMENT) {</b>
<b class="nc">&nbsp;                continue;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            Mounted m = cs.getMount();</b>
<b class="nc">&nbsp;            EquipmentType type = m.getType();</b>
<b class="nc">&nbsp;            if ((type instanceof MiscType) &amp;&amp; ((MiscType) type).isShield()) {</b>
<b class="nc">&nbsp;                if (cs.isDamaged()) {</b>
<b class="nc">&nbsp;                    base--;</b>
&nbsp;                }
&nbsp;            }
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (!entity.hasWorkingSystem(Mech.ACTUATOR_SHOULDER, location)) {</b>
<b class="nc">&nbsp;            base -= 2;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (!entity.hasWorkingSystem(Mech.ACTUATOR_LOWER_ARM, location)) {</b>
<b class="nc">&nbsp;            base--;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (!entity.hasWorkingSystem(Mech.ACTUATOR_UPPER_ARM, location)) {</b>
<b class="nc">&nbsp;            base--;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (!entity.hasWorkingSystem(Mech.ACTUATOR_HAND, location)) {</b>
<b class="nc">&nbsp;            base--;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return Math.max(0, base);</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Rules say every time a shield is critted it loses 5 points from its
&nbsp;     * Damage Capacity. basically count down from the top then subtract the
&nbsp;     * amount of damage its already take. The damage capacity is used to
&nbsp;     * determine if the shield is still viable.
&nbsp;     *
&nbsp;     * @param entity
&nbsp;     * @param location
&nbsp;     * @return damage capacity(no less then 0)
&nbsp;     */
&nbsp;    public int getCurrentDamageCapacity(Entity entity, int location) {
&nbsp;        // Shields can only be used in arms so if you&#39;ve got a shield in a
&nbsp;        // location
&nbsp;        // other then an arm your SOL --Torren.
<b class="nc">&nbsp;        if ((location != Mech.LOC_RARM) &amp;&amp; (location != Mech.LOC_LARM)) {</b>
<b class="nc">&nbsp;            return 0;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        int base = baseDamageCapacity;</b>
&nbsp;
<b class="nc">&nbsp;        for (int slot = 0; slot &lt; entity.getNumberOfCriticals(location); slot++) {</b>
<b class="nc">&nbsp;            CriticalSlot cs = entity.getCritical(location, slot);</b>
&nbsp;
<b class="nc">&nbsp;            if (cs == null) {</b>
<b class="nc">&nbsp;                continue;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (cs.getType() != CriticalSlot.TYPE_EQUIPMENT) {</b>
<b class="nc">&nbsp;                continue;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            Mounted m = cs.getMount();</b>
<b class="nc">&nbsp;            EquipmentType type = m.getType();</b>
<b class="nc">&nbsp;            if ((type instanceof MiscType) &amp;&amp; ((MiscType) type).isShield()) {</b>
<b class="nc">&nbsp;                if (cs.isDamaged()) {</b>
<b class="nc">&nbsp;                    base -= 5;</b>
&nbsp;                }
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        if (!entity.hasWorkingSystem(Mech.ACTUATOR_SHOULDER, location)) {</b>
<b class="nc">&nbsp;            base -= 2;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (!entity.hasWorkingSystem(Mech.ACTUATOR_LOWER_ARM, location)) {</b>
<b class="nc">&nbsp;            base--;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (!entity.hasWorkingSystem(Mech.ACTUATOR_UPPER_ARM, location)) {</b>
<b class="nc">&nbsp;            base--;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return Math.max(0, base - damageTaken);</b>
&nbsp;    }
&nbsp;
&nbsp;    public int getDamageTaken() {
<b class="nc">&nbsp;        return damageTaken;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void addWeaponToBay(int w) {
<b class="fc">&nbsp;        bayWeapons.add(w);</b>
<b class="fc">&nbsp;    }</b>
&nbsp;    
&nbsp;    public Vector&lt;Integer&gt; getBayWeapons() {
<b class="fc">&nbsp;        return bayWeapons;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void addAmmoToBay(int a) {
<b class="nc">&nbsp;        bayAmmo.add(a);</b>
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    public Vector&lt;Integer&gt; getBayAmmo() {
<b class="nc">&nbsp;        return bayAmmo;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setByShot(boolean b) {
<b class="nc">&nbsp;        byShot = b;</b>
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    public boolean byShot() {
<b class="nc">&nbsp;        return byShot;</b>
&nbsp;    }
&nbsp;
&nbsp;    // bomb related
&nbsp;    public boolean isBombMounted() {
<b class="nc">&nbsp;        return bombMounted;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setBombMounted(boolean b) {
<b class="nc">&nbsp;        bombMounted = b;</b>
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    /**
&nbsp;     * Convenience &quot;property&quot; to reduce typing, which returns true if the current
&nbsp;     * piece of equipment is a bomb capable of striking ground targets.
&nbsp;     * @return True if 
&nbsp;     */
&nbsp;    public boolean isGroundBomb() {
<b class="nc">&nbsp;        return getType().hasFlag(WeaponType.F_DIVE_BOMB) || getType().hasFlag(WeaponType.F_ALT_BOMB) ||</b>
<b class="nc">&nbsp;                getType().hasFlag(AmmoType.F_GROUND_BOMB);</b>
&nbsp;    }
&nbsp;    
&nbsp;    // is ammo in the same bay as the weapon
&nbsp;    public boolean ammoInBay(int mAmmoId) {
<b class="nc">&nbsp;        for (int nextAmmoId : bayAmmo) {</b>
<b class="nc">&nbsp;            if (nextAmmoId == mAmmoId) {</b>
<b class="nc">&nbsp;                return true;</b>
&nbsp;            }
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;        return false;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * returns the heat for this weapon taking account of rapid-fire weapon
&nbsp;     * status
&nbsp;     */
&nbsp;    public int getCurrentHeat() {
<b class="nc">&nbsp;        if (getType() instanceof WeaponType) {</b>
<b class="nc">&nbsp;            WeaponType wtype = (WeaponType) getType();</b>
<b class="nc">&nbsp;            int heat = wtype.getHeat();</b>
&nbsp;
&nbsp;            // AR10&#39;s have heat based upon the loaded missile
<b class="nc">&nbsp;            if (wtype.getName().equals(&quot;AR10&quot;)){</b>
<b class="nc">&nbsp;                AmmoType ammoType = (AmmoType)getLinked().getType();</b>
<b class="nc">&nbsp;                if (ammoType.hasFlag(AmmoType.F_AR10_BARRACUDA)){</b>
<b class="nc">&nbsp;                    return 10;</b>
<b class="nc">&nbsp;                }else if (ammoType.hasFlag(AmmoType.F_AR10_WHITE_SHARK)){</b>
<b class="nc">&nbsp;                    return 15;</b>
&nbsp;                } else { // AmmoType.F_AR10_KILLER_WHALTE
<b class="nc">&nbsp;                    return 20;</b>
&nbsp;                }
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (wtype.hasFlag(WeaponType.F_ENERGY) &amp;&amp; wtype.hasModes()) {</b>
<b class="nc">&nbsp;                heat = Compute.dialDownHeat(this, wtype);</b>
&nbsp;            }
&nbsp;            // multiply by number of shots and number of weapons
<b class="nc">&nbsp;            heat = heat * getCurrentShots() * getNWeapons();</b>
<b class="nc">&nbsp;            if (hasQuirk(OptionsConstants.QUIRK_WEAP_POS_IMP_COOLING)) {</b>
<b class="nc">&nbsp;                heat = Math.max(1, heat - 1);</b>
&nbsp;            }
<b class="nc">&nbsp;            if (hasQuirk(OptionsConstants.QUIRK_WEAP_NEG_POOR_COOLING)) {</b>
<b class="nc">&nbsp;                heat += 1;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (hasQuirk(OptionsConstants.QUIRK_WEAP_NEG_NO_COOLING)) {</b>
<b class="nc">&nbsp;                heat += 2;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (hasChargedCapacitor() == 2) {</b>
<b class="nc">&nbsp;                heat += 10;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (hasChargedCapacitor() == 1) {</b>
<b class="nc">&nbsp;                heat += 5;</b>
&nbsp;            }
<b class="nc">&nbsp;            if ((getLinkedBy() != null)</b>
<b class="nc">&nbsp;                    &amp;&amp; !getLinkedBy().isInoperable()</b>
<b class="nc">&nbsp;                    &amp;&amp; (getLinkedBy().getType() instanceof MiscType)</b>
<b class="nc">&nbsp;                    &amp;&amp; getLinkedBy().getType().hasFlag(</b>
&nbsp;                            MiscType.F_LASER_INSULATOR)) {
<b class="nc">&nbsp;                heat -= 1;</b>
<b class="nc">&nbsp;                if (heat == 0) {</b>
<b class="nc">&nbsp;                    heat++;</b>
&nbsp;                }
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            return heat;</b>
&nbsp;        }
<b class="nc">&nbsp;        return 0;</b>
&nbsp;    }
&nbsp;
&nbsp;    public boolean isBodyMounted() {
<b class="nc">&nbsp;        return (baMountLoc == BattleArmor.MOUNT_LOC_BODY)</b>
&nbsp;                || (baMountLoc == BattleArmor.MOUNT_LOC_TURRET);
&nbsp;    }
&nbsp;
&nbsp;    public boolean isDWPMounted() {
<b class="fc">&nbsp;        return isDWPMounted;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setDWPMounted(boolean dwpMounted) {
<b class="nc">&nbsp;        isDWPMounted = dwpMounted;</b>
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    public boolean isAPMMounted() {
<b class="nc">&nbsp;        return isAPMMounted;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setAPMMounted(boolean apmMounted) {
<b class="nc">&nbsp;        isAPMMounted = apmMounted;</b>
<b class="nc">&nbsp;    }</b>
&nbsp;    
&nbsp;    public boolean isOmniPodMounted() {
<b class="fc">&nbsp;    	return omniPodMounted;</b>
&nbsp;    }
&nbsp;    
&nbsp;    public void setOmniPodMounted(boolean omniPodMounted) {
<b class="fc">&nbsp;    	this.omniPodMounted = omniPodMounted;</b>
<b class="fc">&nbsp;    }</b>
&nbsp;
&nbsp;    public boolean isWeaponGroup() {
<b class="fc">&nbsp;        return weaponGroup;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setWeaponGroup(boolean b) {
<b class="nc">&nbsp;        weaponGroup = b;</b>
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    public int getNWeapons() {
<b class="nc">&nbsp;        return nweapons;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setNWeapons(int i) {
&nbsp;        // make sure this falls between 1 and 40
<b class="nc">&nbsp;        if (i &lt; 0) {</b>
<b class="nc">&nbsp;            i = 1;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (i &gt; 40) {</b>
<b class="nc">&nbsp;            i = 40;</b>
&nbsp;        }
<b class="nc">&nbsp;        nweapons = i;</b>
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    public void unlink() {
<b class="nc">&nbsp;        linked = null;</b>
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    public void setArmored(boolean armored) {
&nbsp;        // Ammobins cannot be armored.
<b class="fc">&nbsp;        if ((getType() instanceof AmmoType)</b>
<b class="fc">&nbsp;                &amp;&amp; (((AmmoType) getType()).getAmmoType() != AmmoType.T_COOLANT_POD)) {</b>
<b class="fc">&nbsp;            armoredComponent = false;</b>
<b class="fc">&nbsp;        } else if ((getType() instanceof MiscType)</b>
<b class="fc">&nbsp;                &amp;&amp; (getType().hasFlag(MiscType.F_SPIKES)</b>
<b class="fc">&nbsp;                        || getType().hasFlag(MiscType.F_REACTIVE)</b>
<b class="fc">&nbsp;                        || getType().hasFlag(MiscType.F_MODULAR_ARMOR) || ((MiscType) getType())</b>
<b class="fc">&nbsp;                            .isShield())) {</b>
<b class="nc">&nbsp;            armoredComponent = false;</b>
&nbsp;        } else {
<b class="fc">&nbsp;            armoredComponent = armored;</b>
&nbsp;        }
<b class="fc">&nbsp;    }</b>
&nbsp;
&nbsp;    public boolean isArmored() {
<b class="fc">&nbsp;        return armoredComponent;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setQuirks(WeaponQuirks quirks) {
<b class="nc">&nbsp;        this.quirks = quirks;</b>
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    /**
&nbsp;     * Retrieves the quirks object for mounted. DO NOT USE this to check boolean
&nbsp;     * options, as it will not check game options for quirks. Use
&nbsp;     * Mounted#hasQuirk instead
&nbsp;     *
&nbsp;     * @return
&nbsp;     */
&nbsp;    public WeaponQuirks getQuirks() {
<b class="nc">&nbsp;        return quirks;</b>
&nbsp;    }
&nbsp;
&nbsp;    public boolean hasQuirk(String name) {
<b class="nc">&nbsp;        if ((null == entity)</b>
<b class="nc">&nbsp;                || (null == entity.getGame())</b>
<b class="nc">&nbsp;                || !entity.getGame().getOptions()</b>
<b class="nc">&nbsp;                        .booleanOption(OptionsConstants.ADVANCED_STRATOPS_QUIRKS)) {</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
<b class="nc">&nbsp;        return quirks.booleanOption(name);</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Count all the quirks for this &quot;mounted&quot; object, positive and negative
&nbsp;     */
&nbsp;    public int countQuirks() {
<b class="nc">&nbsp;        if ((null == entity) || (null == entity.game)</b>
<b class="nc">&nbsp;                || !entity.game.getOptions().booleanOption(OptionsConstants.ADVANCED_STRATOPS_QUIRKS)) {</b>
<b class="nc">&nbsp;            return 0;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return quirks.count();</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Returns a string of all the quirk &quot;codes&quot; for this entity, using sep as
&nbsp;     * the separator
&nbsp;     */
&nbsp;    public String getQuirkList(String sep) {
<b class="nc">&nbsp;        if ((null == entity) || (null == entity.game)</b>
<b class="nc">&nbsp;                || !entity.game.getOptions().booleanOption(OptionsConstants.ADVANCED_STRATOPS_QUIRKS)) {</b>
<b class="nc">&nbsp;            return &quot;&quot;;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return quirks.getOptionList(sep);</b>
&nbsp;    }
&nbsp;
&nbsp;    public CalledShot getCalledShot() {
<b class="nc">&nbsp;        return called;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setRepairable(boolean repair) {
<b class="nc">&nbsp;        repairable = repair;</b>
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    public boolean isRepairable() {
<b class="nc">&nbsp;        return repairable;</b>
&nbsp;    }
&nbsp;
&nbsp;    public Entity getEntity() {
<b class="fc">&nbsp;        return entity;</b>
&nbsp;    }
&nbsp;
&nbsp;    public boolean isMechTurretMounted() {
<b class="fc">&nbsp;        return mechTurretMounted;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setMechTurretMounted(boolean turret) {
<b class="fc">&nbsp;        mechTurretMounted = turret;</b>
<b class="fc">&nbsp;        if (mechTurretMounted) {</b>
<b class="fc">&nbsp;            setFacing(0);</b>
&nbsp;        }
<b class="fc">&nbsp;    }</b>
&nbsp;
&nbsp;    public void setSponsonTurretMounted(boolean turret) {
<b class="fc">&nbsp;        sponsonTurretMounted = turret;</b>
<b class="fc">&nbsp;    }</b>
&nbsp;
&nbsp;    public boolean isSponsonTurretMounted() {
<b class="nc">&nbsp;        return sponsonTurretMounted;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setPintleTurretMounted(boolean turret) {
<b class="fc">&nbsp;        pintleTurretMounted = turret;</b>
<b class="fc">&nbsp;    }</b>
&nbsp;
&nbsp;    public boolean isPintleTurretMounted() {
<b class="nc">&nbsp;        return pintleTurretMounted;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setFacing(int facing) {
<b class="fc">&nbsp;        this.facing = facing;</b>
<b class="fc">&nbsp;    }</b>
&nbsp;
&nbsp;    public int getFacing() {
<b class="fc">&nbsp;        return facing;</b>
&nbsp;    }
&nbsp;
&nbsp;    public int getOriginalShots() {
<b class="nc">&nbsp;        return originalShots;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setOriginalShots(int shots) {
<b class="fc">&nbsp;        originalShots = shots;</b>
<b class="fc">&nbsp;    }</b>
&nbsp;
&nbsp;    public boolean isModeSwitchable() {
<b class="nc">&nbsp;        return modeSwitchable;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setModeSwitchable(boolean b) {
<b class="nc">&nbsp;        modeSwitchable = b;</b>
<b class="nc">&nbsp;    }</b>
&nbsp;    
&nbsp;    /**
&nbsp;     * Method that checks to see if our capital missile bay is in bearings-only mode
&nbsp;     * Only available in space games
&nbsp;     * @return
&nbsp;     */
&nbsp;    public boolean isInBearingsOnlyMode() {
<b class="nc">&nbsp;        if ((curMode().equals(Weapon.MODE_CAP_MISSILE_BEARING_EXT)</b>
<b class="nc">&nbsp;                    || curMode().equals(Weapon.MODE_CAP_MISSILE_BEARING_LONG)</b>
<b class="nc">&nbsp;                    || curMode().equals(Weapon.MODE_CAP_MISSILE_BEARING_MED)</b>
<b class="nc">&nbsp;                    || curMode().equals(Weapon.MODE_CAP_MISSILE_BEARING_SHORT)</b>
<b class="nc">&nbsp;                    || curMode().equals(Weapon.MODE_CAP_MISSILE_WAYPOINT_BEARING_EXT)</b>
<b class="nc">&nbsp;                    || curMode().equals(Weapon.MODE_CAP_MISSILE_WAYPOINT_BEARING_LONG)</b>
<b class="nc">&nbsp;                    || curMode().equals(Weapon.MODE_CAP_MISSILE_WAYPOINT_BEARING_MED)</b>
<b class="nc">&nbsp;                    || curMode().equals(Weapon.MODE_CAP_MISSILE_WAYPOINT_BEARING_SHORT))</b>
<b class="nc">&nbsp;                &amp;&amp; getEntity().isSpaceborne()) {</b>
<b class="nc">&nbsp;            return true;</b>
&nbsp;        }
<b class="nc">&nbsp;        return false;</b>
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * Method that checks to see if our capital missile bay is in waypoint launch mode
&nbsp;     * Only available in space games
&nbsp;     * @return
&nbsp;     */
&nbsp;    public boolean isInWaypointLaunchMode() {
<b class="nc">&nbsp;        if ((curMode().equals(Weapon.MODE_CAP_MISSILE_WAYPOINT_BEARING_EXT)</b>
<b class="nc">&nbsp;                || curMode().equals(Weapon.MODE_CAP_MISSILE_WAYPOINT_BEARING_LONG)</b>
<b class="nc">&nbsp;                || curMode().equals(Weapon.MODE_CAP_MISSILE_WAYPOINT_BEARING_MED)</b>
<b class="nc">&nbsp;                || curMode().equals(Weapon.MODE_CAP_MISSILE_WAYPOINT_BEARING_SHORT)</b>
<b class="nc">&nbsp;                || curMode().equals(Weapon.MODE_CAP_MISSILE_WAYPOINT))</b>
<b class="nc">&nbsp;            &amp;&amp; getEntity().isSpaceborne()) {</b>
<b class="nc">&nbsp;            return true;</b>
&nbsp;        }
<b class="nc">&nbsp;        return false;</b>
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * Method that adds/removes available capital missile modes as we move between space and atmospheric maps
&nbsp;     * Called by Entity.setGameOptions(), which is in turn called during a mode change by server.
&nbsp;     */
&nbsp;    //Though we can&#39;t currently switch maps, this is needed to ensure space-only modes are removed on ground maps
&nbsp;    public void setModesForMapType() {
&nbsp;        //If the entity is not in space, remove these modes, which get set up based on game options in Weapon before game type is known
<b class="fc">&nbsp;        if (!getEntity().isSpaceborne()) {</b>
<b class="fc">&nbsp;            getType().removeMode(Weapon.MODE_CAP_MISSILE_WAYPOINT_BEARING_EXT);</b>
<b class="fc">&nbsp;            getType().removeMode(Weapon.MODE_CAP_MISSILE_WAYPOINT_BEARING_LONG);</b>
<b class="fc">&nbsp;            getType().removeMode(Weapon.MODE_CAP_MISSILE_WAYPOINT_BEARING_MED);</b>
<b class="fc">&nbsp;            getType().removeMode(Weapon.MODE_CAP_MISSILE_WAYPOINT_BEARING_SHORT);</b>
<b class="fc">&nbsp;            getType().removeMode(Weapon.MODE_CAP_MISSILE_WAYPOINT);</b>
<b class="fc">&nbsp;            getType().removeMode(Weapon.MODE_CAP_MISSILE_TELE_OPERATED);</b>
<b class="fc">&nbsp;            getType().removeMode(Weapon.MODE_CAP_MISSILE_BEARING_EXT);</b>
<b class="fc">&nbsp;            getType().removeMode(Weapon.MODE_CAP_MISSILE_BEARING_LONG);</b>
<b class="fc">&nbsp;            getType().removeMode(Weapon.MODE_CAP_MISSILE_BEARING_MED);</b>
<b class="fc">&nbsp;            getType().removeMode(Weapon.MODE_CAP_MISSILE_BEARING_SHORT);</b>
&nbsp;        }
&nbsp;        /*
&nbsp;        //Placeholder. This will be used to add the space modes back when we&#39;re able to switch maps.
&nbsp;        if (getEntity().isSpaceborne()) {
&nbsp;            
&nbsp;        }
&nbsp;        */
<b class="fc">&nbsp;    }</b>
&nbsp;    
&nbsp;    public int getBaMountLoc() {
<b class="nc">&nbsp;        return baMountLoc;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setBaMountLoc(int baMountLoc) {
<b class="fc">&nbsp;        this.baMountLoc = baMountLoc;</b>
<b class="fc">&nbsp;    }</b>
&nbsp;
&nbsp;    /**
&nbsp;     * Returns true if this Mounted is a one-shot launcher of some kind
&nbsp;     * otherwise returns false.
&nbsp;     *
&nbsp;     * @return
&nbsp;     */
&nbsp;    public boolean isOneShotWeapon() {
<b class="nc">&nbsp;        return (getType() instanceof WeaponType) &amp;&amp; getType().hasFlag(WeaponType.F_ONESHOT);</b>
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * Checks whether this mount is either one a one-shot weapon or ammo for a one-shot weapon.
&nbsp;     * @return
&nbsp;     */
&nbsp;    public boolean isOneShot(){
<b class="nc">&nbsp;        if (isOneShotWeapon()) {</b>
<b class="nc">&nbsp;            return true;</b>
<b class="nc">&nbsp;        } else if ((getType() instanceof AmmoType) &amp;&amp; getLinkedBy() != null) {</b>
&nbsp;            // There should not be any circular references, but we should track where we&#39;ve been just in case.
&nbsp;            // Do a couple checks first to avoid instantiating a set unnecessarily.
<b class="nc">&nbsp;            Set&lt;Mounted&gt; checked = new HashSet&lt;&gt;();</b>
<b class="nc">&nbsp;            for (Mounted current = getLinkedBy(); current != null; current = current.getLinkedBy()) {</b>
<b class="nc">&nbsp;                if (checked.contains(current)) {</b>
<b class="nc">&nbsp;                    return false;</b>
&nbsp;                }
<b class="nc">&nbsp;                if (current.isOneShotWeapon()) {</b>
<b class="nc">&nbsp;                    return true;</b>
&nbsp;                }
<b class="nc">&nbsp;                checked.add(current);</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        return false;</b>
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * Check for whether this mount is linked by a one-shot weapon
&nbsp;     * 
&nbsp;     * @return {@code true} if this is one-shot ammo
&nbsp;     */
&nbsp;    public boolean isOneShotAmmo() {
<b class="nc">&nbsp;        return (getType() instanceof AmmoType)</b>
<b class="nc">&nbsp;                &amp;&amp; (getLinkedBy() != null)</b>
<b class="nc">&nbsp;                &amp;&amp; getLinkedBy().isOneShot();</b>
&nbsp;    }
&nbsp;
&nbsp;    public boolean isSquadSupportWeapon() {
<b class="fc">&nbsp;        return squadSupportWeapon;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setSquadSupportWeapon(boolean squadSupportWeapon) {
<b class="nc">&nbsp;        this.squadSupportWeapon = squadSupportWeapon;</b>
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    public int getArmorValue() {
<b class="nc">&nbsp;        return armorValue;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setArmorValue(int armorValue) {
<b class="nc">&nbsp;        this.armorValue = armorValue;</b>
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    public void setMissingForTrooper(int trooper, boolean b) {
<b class="nc">&nbsp;        trooper = trooper-BattleArmor.LOC_TROOPER_1;</b>
<b class="nc">&nbsp;        if((trooper &lt; 0) || (trooper &gt;= missingForTrooper.length)) {</b>
<b class="nc">&nbsp;            return;</b>
&nbsp;        }
<b class="nc">&nbsp;        missingForTrooper[trooper] = b;</b>
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    public boolean isMissingForTrooper(int trooper) {
<b class="nc">&nbsp;        trooper = trooper-BattleArmor.LOC_TROOPER_1;</b>
<b class="nc">&nbsp;        if((trooper &lt; 0) || (trooper &gt;= missingForTrooper.length)) {</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
<b class="nc">&nbsp;        return missingForTrooper[trooper];</b>
&nbsp;    }
&nbsp;
&nbsp;    public boolean isAnyMissingTroopers() {
<b class="nc">&nbsp;        for(int i = 0; i &lt; missingForTrooper.length; i++) {</b>
<b class="nc">&nbsp;            if(missingForTrooper[i]) {</b>
<b class="nc">&nbsp;                return true;</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        return false;</b>
&nbsp;    }
&nbsp;
&nbsp;    public String getMissingTrooperString() {
<b class="nc">&nbsp;        StringBuffer missings = new StringBuffer();</b>
<b class="nc">&nbsp;        for(int i = 0; i &lt; missingForTrooper.length; i++) {</b>
<b class="nc">&nbsp;            missings.append(missingForTrooper[i]).append(&quot;::&quot;);</b>
&nbsp;        }
<b class="nc">&nbsp;        return missings.toString();</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Assign APDS systems to the most dangerous incoming missile attacks. This
&nbsp;     * should only be called once per turn, or AMS will get extra attacks
&nbsp;     */
&nbsp;    public WeaponAttackAction assignAPDS(List&lt;WeaponHandler&gt; vAttacks) {
&nbsp;        // Shouldn&#39;t have null entity, but if we do...
<b class="nc">&nbsp;        if (getEntity() == null) {</b>
<b class="nc">&nbsp;            return null;</b>
&nbsp;        }
&nbsp;
&nbsp;        // Ensure we only target attacks in our arc &amp; range
<b class="nc">&nbsp;        List&lt;WeaponAttackAction&gt; vAttacksInArc = new Vector&lt;&gt;(vAttacks.size());</b>
<b class="nc">&nbsp;        for (WeaponHandler wr : vAttacks) {</b>
<b class="nc">&nbsp;            boolean isInArc = Compute.isInArc(getEntity().getGame(),</b>
<b class="nc">&nbsp;                    getEntity().getId(), getEntity().getEquipmentNum(this),</b>
<b class="nc">&nbsp;                    getEntity().getGame().getEntity(wr.waa.getEntityId()));</b>
<b class="nc">&nbsp;            boolean isInRange = getEntity().getPosition().distance(</b>
<b class="nc">&nbsp;                    wr.getWaa().getTarget(getEntity().getGame()).getPosition()) &lt;= 3;</b>
<b class="nc">&nbsp;            if (isInArc &amp;&amp; isInRange) {</b>
<b class="nc">&nbsp;                vAttacksInArc.add(wr.waa);</b>
&nbsp;            }
<b class="nc">&nbsp;        }</b>
&nbsp;        // find the most dangerous salvo by expected damage
<b class="nc">&nbsp;        WeaponAttackAction waa = Compute.getHighestExpectedDamage(getEntity()</b>
<b class="nc">&nbsp;                .getGame(), vAttacksInArc, true);</b>
<b class="nc">&nbsp;        if (waa != null) {</b>
<b class="nc">&nbsp;            waa.addCounterEquipment(this);</b>
<b class="nc">&nbsp;            return waa;</b>
&nbsp;        }
<b class="nc">&nbsp;        return null;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Returns true if this Mounted is an APDS.
&nbsp;     * @return
&nbsp;     */
&nbsp;    public boolean isAPDS() {
<b class="nc">&nbsp;        if ((getEntity() instanceof BattleArmor)</b>
<b class="nc">&nbsp;                &amp;&amp; getType().getInternalName().equals(&quot;ISBAAPDS&quot;)) {</b>
<b class="nc">&nbsp;            return true;</b>
<b class="nc">&nbsp;        } else if (getType() instanceof WeaponType) {</b>
<b class="nc">&nbsp;            return ((WeaponType)getType()).getAmmoType() == AmmoType.T_APDS;</b>
&nbsp;        } else {
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * Returns true if this Mounted is ammunition in homing mode.
&nbsp;     */
&nbsp;    public boolean isHomingAmmoInHomingMode() {
<b class="nc">&nbsp;        if(!(getType() instanceof AmmoType)) {</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;        
<b class="nc">&nbsp;        AmmoType ammoType = (AmmoType) getType();</b>
<b class="nc">&nbsp;        return ammoType.getMunitionType() == AmmoType.M_HOMING &amp;&amp;</b>
<b class="nc">&nbsp;                curMode().equals(&quot;Homing&quot;);</b>
&nbsp;    }
&nbsp;
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2023-05-16 16:28</div>
</div>
</body>
</html>
