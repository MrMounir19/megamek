


<!DOCTYPE html>
<html id="htmlId">
<head>
  <title>Coverage Report > SystemPanel</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">megamek.client.ui.swing.unitDisplay</a>
</div>

<h1>Coverage Summary for Class: SystemPanel (megamek.client.ui.swing.unitDisplay)</h1>

<table class="coverageStats">
<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Class, %
</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">SystemPanel</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/18)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/571)
  </span>
</td>
</tr>

</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package megamek.client.ui.swing.unitDisplay;
&nbsp;
&nbsp;import java.awt.Color;
&nbsp;import java.awt.Dimension;
&nbsp;import java.awt.GridBagConstraints;
&nbsp;import java.awt.GridBagLayout;
&nbsp;import java.awt.Image;
&nbsp;import java.awt.Insets;
&nbsp;import java.awt.Rectangle;
&nbsp;import java.awt.event.ActionEvent;
&nbsp;import java.awt.event.ActionListener;
&nbsp;import java.awt.event.ItemEvent;
&nbsp;import java.awt.event.ItemListener;
&nbsp;import java.util.Enumeration;
&nbsp;import java.util.Vector;
&nbsp;
&nbsp;import javax.swing.DefaultComboBoxModel;
&nbsp;import javax.swing.DefaultListModel;
&nbsp;import javax.swing.JButton;
&nbsp;import javax.swing.JComboBox;
&nbsp;import javax.swing.JLabel;
&nbsp;import javax.swing.JList;
&nbsp;import javax.swing.JScrollPane;
&nbsp;import javax.swing.ListSelectionModel;
&nbsp;import javax.swing.SwingConstants;
&nbsp;import javax.swing.event.ListSelectionEvent;
&nbsp;import javax.swing.event.ListSelectionListener;
&nbsp;
&nbsp;import megamek.client.Client;
&nbsp;import megamek.client.ui.Messages;
&nbsp;import megamek.client.ui.swing.ChoiceDialog;
&nbsp;import megamek.client.ui.swing.ClientGUI;
&nbsp;import megamek.client.ui.swing.widget.BackGroundDrawer;
&nbsp;import megamek.client.ui.swing.widget.PMUtil;
&nbsp;import megamek.client.ui.swing.widget.PicMap;
&nbsp;import megamek.client.ui.swing.widget.SkinXMLHandler;
&nbsp;import megamek.client.ui.swing.widget.UnitDisplaySkinSpecification;
&nbsp;import megamek.common.Aero;
&nbsp;import megamek.common.AmmoType;
&nbsp;import megamek.common.BattleArmor;
&nbsp;import megamek.common.Configuration;
&nbsp;import megamek.common.CriticalSlot;
&nbsp;import megamek.common.Entity;
&nbsp;import megamek.common.EquipmentMode;
&nbsp;import megamek.common.IGame;
&nbsp;import megamek.common.ILocationExposureStatus;
&nbsp;import megamek.common.Mech;
&nbsp;import megamek.common.MiscType;
&nbsp;import megamek.common.Mounted;
&nbsp;import megamek.common.Protomech;
&nbsp;import megamek.common.Tank;
&nbsp;import megamek.common.WeaponType;
&nbsp;import megamek.common.options.OptionsConstants;
&nbsp;import megamek.common.util.fileUtils.MegaMekFile;
&nbsp;
&nbsp;/**
&nbsp; * This class shows the critical hits and systems for a mech
&nbsp; */
&nbsp;class SystemPanel extends PicMap implements ItemListener, ActionListener,
&nbsp;        ListSelectionListener {
&nbsp;    
<b class="nc">&nbsp;    private static int LOC_ALL_EQUIP = 0;</b>
<b class="nc">&nbsp;    private static int LOC_ALL_WEAPS = 1;</b>
<b class="nc">&nbsp;    private static int LOC_SPACER = 2;</b>
<b class="nc">&nbsp;    private static int LOC_OFFSET = 3;</b>
&nbsp;    
&nbsp;    /**
&nbsp;     * 
&nbsp;     */
&nbsp;    private final UnitDisplay unitDisplay;
&nbsp;
&nbsp;    /**
&nbsp;     *
&nbsp;     */
&nbsp;    private static final long serialVersionUID = 6660316427898323590L;
&nbsp;
&nbsp;    private JLabel locLabel;
&nbsp;    private JLabel slotLabel;
&nbsp;    private JLabel modeLabel;
&nbsp;    private JLabel unitLabel;
&nbsp;    private JList&lt;String&gt; slotList;
&nbsp;    private JList&lt;String&gt; locList;
&nbsp;    private JList&lt;String&gt; unitList;
&nbsp;
&nbsp;    private JComboBox&lt;String&gt; m_chMode;
&nbsp;    private JButton m_bDumpAmmo;
&nbsp;
&nbsp;    private Entity en;
<b class="nc">&nbsp;    private Vector&lt;Entity&gt; entities = new Vector&lt;Entity&gt;();</b>
&nbsp;
<b class="nc">&nbsp;    private int minTopMargin = 8;</b>
<b class="nc">&nbsp;    private int minLeftMargin = 8;</b>
&nbsp;
<b class="nc">&nbsp;    SystemPanel(UnitDisplay unitDisplay) {</b>
<b class="nc">&nbsp;        this.unitDisplay = unitDisplay;</b>
<b class="nc">&nbsp;        locLabel = new JLabel(</b>
<b class="nc">&nbsp;                Messages.getString(&quot;MechDisplay.Location&quot;), SwingConstants.CENTER); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        locLabel.setOpaque(false);</b>
<b class="nc">&nbsp;        locLabel.setForeground(Color.WHITE);</b>
<b class="nc">&nbsp;        slotLabel = new JLabel(</b>
<b class="nc">&nbsp;                Messages.getString(&quot;MechDisplay.Slot&quot;), SwingConstants.CENTER); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        slotLabel.setOpaque(false);</b>
<b class="nc">&nbsp;        slotLabel.setForeground(Color.WHITE);</b>
&nbsp;
<b class="nc">&nbsp;        unitLabel = new JLabel(</b>
<b class="nc">&nbsp;                Messages.getString(&quot;MechDisplay.Unit&quot;), SwingConstants.CENTER); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        unitLabel.setOpaque(false);</b>
<b class="nc">&nbsp;        unitLabel.setForeground(Color.WHITE);</b>
&nbsp;
<b class="nc">&nbsp;        locList = new JList&lt;String&gt;(new DefaultListModel&lt;String&gt;());</b>
<b class="nc">&nbsp;        locList.setOpaque(false);</b>
<b class="nc">&nbsp;        locList.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);</b>
&nbsp;
<b class="nc">&nbsp;        slotList = new JList&lt;String&gt;(new DefaultListModel&lt;String&gt;());</b>
<b class="nc">&nbsp;        slotList.setOpaque(false);</b>
<b class="nc">&nbsp;        slotList.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);</b>
&nbsp;
<b class="nc">&nbsp;        unitList = new JList&lt;String&gt;(new DefaultListModel&lt;String&gt;());</b>
<b class="nc">&nbsp;        unitList.setOpaque(false);</b>
&nbsp;
<b class="nc">&nbsp;        m_chMode = new JComboBox&lt;String&gt;();</b>
<b class="nc">&nbsp;        m_chMode.addItem(&quot;   &quot;); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        m_chMode.setEnabled(false);</b>
&nbsp;
<b class="nc">&nbsp;        m_bDumpAmmo = new JButton(</b>
<b class="nc">&nbsp;                Messages.getString(&quot;MechDisplay.m_bDumpAmmo&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        m_bDumpAmmo.setEnabled(false);</b>
<b class="nc">&nbsp;        m_bDumpAmmo.setActionCommand(&quot;dump&quot;); //$NON-NLS-1$</b>
&nbsp;
<b class="nc">&nbsp;        modeLabel = new JLabel(</b>
<b class="nc">&nbsp;                Messages.getString(&quot;MechDisplay.modeLabel&quot;), SwingConstants.RIGHT); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        modeLabel.setOpaque(false);</b>
<b class="nc">&nbsp;        modeLabel.setForeground(Color.WHITE);</b>
&nbsp;        // modeLabel.setEnabled(false);
&nbsp;
&nbsp;        // layout main panel
<b class="nc">&nbsp;        GridBagLayout gridbag = new GridBagLayout();</b>
<b class="nc">&nbsp;        GridBagConstraints c = new GridBagConstraints();</b>
<b class="nc">&nbsp;        setLayout(gridbag);</b>
&nbsp;
<b class="nc">&nbsp;        c.fill = GridBagConstraints.BOTH;</b>
<b class="nc">&nbsp;        c.insets = new Insets(15, 9, 1, 1);</b>
<b class="nc">&nbsp;        c.gridy = 0;</b>
<b class="nc">&nbsp;        c.gridx = 0;</b>
<b class="nc">&nbsp;        c.weightx = 0.5;</b>
<b class="nc">&nbsp;        c.weighty = 0.0;</b>
<b class="nc">&nbsp;        c.gridwidth = 1;</b>
<b class="nc">&nbsp;        c.gridheight = 1;</b>
<b class="nc">&nbsp;        gridbag.setConstraints(locLabel, c);</b>
<b class="nc">&nbsp;        add(locLabel);</b>
&nbsp;
<b class="nc">&nbsp;        c.weightx = 0.0;</b>
<b class="nc">&nbsp;        c.gridy = 0;</b>
<b class="nc">&nbsp;        c.gridx = 1;</b>
<b class="nc">&nbsp;        c.gridwidth = GridBagConstraints.REMAINDER;</b>
<b class="nc">&nbsp;        c.insets = new Insets(15, 1, 1, 9);</b>
<b class="nc">&nbsp;        gridbag.setConstraints(slotLabel, c);</b>
<b class="nc">&nbsp;        add(slotLabel);</b>
&nbsp;
<b class="nc">&nbsp;        c.weightx = 0.5;</b>
&nbsp;        // c.weighty = 1.0;
<b class="nc">&nbsp;        c.gridy = 1;</b>
<b class="nc">&nbsp;        c.gridx = 0;</b>
<b class="nc">&nbsp;        c.gridwidth = 1;</b>
<b class="nc">&nbsp;        c.insets = new Insets(1, 9, 15, 1);</b>
<b class="nc">&nbsp;        c.gridheight = 1;</b>
<b class="nc">&nbsp;        gridbag.setConstraints(locList, c);</b>
<b class="nc">&nbsp;        add(locList);</b>
&nbsp;
<b class="nc">&nbsp;        c.fill = GridBagConstraints.BOTH;</b>
<b class="nc">&nbsp;        c.insets = new Insets(15, 9, 1, 1);</b>
<b class="nc">&nbsp;        c.gridy = 2;</b>
<b class="nc">&nbsp;        c.gridx = 0;</b>
<b class="nc">&nbsp;        c.weightx = 0.5;</b>
<b class="nc">&nbsp;        c.weighty = 0.0;</b>
<b class="nc">&nbsp;        c.gridwidth = 1;</b>
<b class="nc">&nbsp;        c.gridheight = 1;</b>
<b class="nc">&nbsp;        gridbag.setConstraints(unitLabel, c);</b>
<b class="nc">&nbsp;        add(unitLabel);</b>
&nbsp;
<b class="nc">&nbsp;        c.weightx = 0.5;</b>
&nbsp;        // c.weighty = 1.0;
<b class="nc">&nbsp;        c.gridy = 3;</b>
<b class="nc">&nbsp;        c.gridx = 0;</b>
<b class="nc">&nbsp;        c.gridwidth = 1;</b>
<b class="nc">&nbsp;        c.insets = new Insets(1, 9, 15, 1);</b>
<b class="nc">&nbsp;        c.gridheight = GridBagConstraints.REMAINDER;</b>
<b class="nc">&nbsp;        gridbag.setConstraints(unitList, c);</b>
<b class="nc">&nbsp;        add(unitList);</b>
&nbsp;
<b class="nc">&nbsp;        c.gridwidth = GridBagConstraints.REMAINDER;</b>
<b class="nc">&nbsp;        c.gridheight = 1;</b>
<b class="nc">&nbsp;        c.gridy = 1;</b>
<b class="nc">&nbsp;        c.gridx = 1;</b>
<b class="nc">&nbsp;        c.weightx = 0.0;</b>
<b class="nc">&nbsp;        c.weighty = 1.0;</b>
<b class="nc">&nbsp;        c.insets = new Insets(1, 1, 1, 9);</b>
<b class="nc">&nbsp;        JScrollPane tSlotScroll = new JScrollPane(slotList);</b>
<b class="nc">&nbsp;        tSlotScroll.setMinimumSize(new Dimension(200, 100));</b>
<b class="nc">&nbsp;        gridbag.setConstraints(tSlotScroll, c);</b>
<b class="nc">&nbsp;        add(tSlotScroll);</b>
&nbsp;
<b class="nc">&nbsp;        c.gridwidth = 1;</b>
<b class="nc">&nbsp;        c.gridy = 2;</b>
<b class="nc">&nbsp;        c.gridx = 1;</b>
<b class="nc">&nbsp;        c.weightx = 0.0;</b>
<b class="nc">&nbsp;        c.weighty = 0.0;</b>
<b class="nc">&nbsp;        gridbag.setConstraints(modeLabel, c);</b>
<b class="nc">&nbsp;        c.insets = new Insets(1, 1, 1, 1);</b>
<b class="nc">&nbsp;        add(modeLabel);</b>
&nbsp;
<b class="nc">&nbsp;        c.weightx = 1.0;</b>
<b class="nc">&nbsp;        c.gridwidth = GridBagConstraints.REMAINDER;</b>
<b class="nc">&nbsp;        c.gridy = 2;</b>
<b class="nc">&nbsp;        c.gridx = 2;</b>
<b class="nc">&nbsp;        c.insets = new Insets(1, 1, 1, 9);</b>
<b class="nc">&nbsp;        gridbag.setConstraints(m_chMode, c);</b>
<b class="nc">&nbsp;        add(m_chMode);</b>
&nbsp;
<b class="nc">&nbsp;        c.gridwidth = GridBagConstraints.REMAINDER;</b>
<b class="nc">&nbsp;        c.gridheight = GridBagConstraints.REMAINDER;</b>
<b class="nc">&nbsp;        c.gridy = 3;</b>
<b class="nc">&nbsp;        c.gridx = 1;</b>
<b class="nc">&nbsp;        c.insets = new Insets(4, 4, 15, 9);</b>
<b class="nc">&nbsp;        gridbag.setConstraints(m_bDumpAmmo, c);</b>
<b class="nc">&nbsp;        add(m_bDumpAmmo);</b>
&nbsp;
<b class="nc">&nbsp;        setBackGround();</b>
<b class="nc">&nbsp;        onResize();</b>
&nbsp;        
<b class="nc">&nbsp;        addListeners();</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public void onResize() {
<b class="nc">&nbsp;        int w = getSize().width;</b>
<b class="nc">&nbsp;        Rectangle r = getContentBounds();</b>
<b class="nc">&nbsp;        if (r == null) {</b>
&nbsp;            return;
&nbsp;        }
<b class="nc">&nbsp;        int dx = Math.round(((w - r.width) / 2));</b>
<b class="nc">&nbsp;        if (dx &lt; minLeftMargin) {</b>
<b class="nc">&nbsp;            dx = minLeftMargin;</b>
&nbsp;        }
<b class="nc">&nbsp;        int dy = minTopMargin;</b>
<b class="nc">&nbsp;        setContentMargins(dx, dy, dx, dy);</b>
&nbsp;    }
&nbsp;
&nbsp;    private CriticalSlot getSelectedCritical() {
<b class="nc">&nbsp;        if ((locList.getSelectedIndex() == LOC_ALL_EQUIP)</b>
<b class="nc">&nbsp;                || (locList.getSelectedIndex() == LOC_ALL_WEAPS)</b>
<b class="nc">&nbsp;                || (locList.getSelectedIndex() == LOC_SPACER)) {</b>
<b class="nc">&nbsp;            return null;</b>
&nbsp;        }
<b class="nc">&nbsp;        int loc = locList.getSelectedIndex();</b>
<b class="nc">&nbsp;        int slot = slotList.getSelectedIndex();</b>
<b class="nc">&nbsp;        loc -= LOC_OFFSET;</b>
<b class="nc">&nbsp;        if ((loc == -1) || (slot == -1)) {</b>
<b class="nc">&nbsp;            return null;</b>
&nbsp;        }
<b class="nc">&nbsp;        return en.getCritical(loc, slot);</b>
&nbsp;    }
&nbsp;
&nbsp;    private Mounted getSelectedEquipment() {
<b class="nc">&nbsp;        if ((locList.getSelectedIndex() == LOC_ALL_EQUIP)) {</b>
<b class="nc">&nbsp;            if (slotList.getSelectedIndex() != -1) { </b>
<b class="nc">&nbsp;                return en.getMisc().get(slotList.getSelectedIndex());</b>
&nbsp;            } else {
<b class="nc">&nbsp;                return null;</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        if (locList.getSelectedIndex() == LOC_ALL_WEAPS) {</b>
<b class="nc">&nbsp;            if (slotList.getSelectedIndex() != -1) { </b>
<b class="nc">&nbsp;                return en.getWeaponList().get(slotList.getSelectedIndex());</b>
&nbsp;            } else {
<b class="nc">&nbsp;                return null;</b>
&nbsp;            }
&nbsp;        }
&nbsp;        
<b class="nc">&nbsp;        final CriticalSlot cs = getSelectedCritical();</b>
<b class="nc">&nbsp;        if ((cs == null) || (unitDisplay.getClientGUI() == null)) {</b>
<b class="nc">&nbsp;            return null;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (cs.getType() == CriticalSlot.TYPE_SYSTEM) {</b>
<b class="nc">&nbsp;            return null;</b>
&nbsp;        }
<b class="nc">&nbsp;        if ((cs.getMount().getType() instanceof MiscType)</b>
<b class="nc">&nbsp;                &amp;&amp; cs.getMount().getType().hasFlag(MiscType.F_BOMB_BAY)) {</b>
<b class="nc">&nbsp;            Mounted m = cs.getMount();</b>
<b class="nc">&nbsp;            while (m.getLinked() != null) {</b>
<b class="nc">&nbsp;                m = m.getLinked();</b>
&nbsp;            }
<b class="nc">&nbsp;            return m;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (cs.getMount2() != null) {</b>
<b class="nc">&nbsp;            ChoiceDialog choiceDialog = new ChoiceDialog(unitDisplay.getClientGUI().frame,</b>
<b class="nc">&nbsp;                    Messages.getString(&quot;MechDisplay.SelectMulti.title&quot;),</b>
<b class="nc">&nbsp;                    Messages.getString(&quot;MechDisplay.SelectMulti.question&quot;),</b>
<b class="nc">&nbsp;                    new String[] { cs.getMount().getName(),</b>
<b class="nc">&nbsp;                            cs.getMount2().getName() }, true);</b>
<b class="nc">&nbsp;            choiceDialog.setVisible(true);</b>
<b class="nc">&nbsp;            if (choiceDialog.getAnswer() == true) {</b>
&nbsp;                // load up the choices
<b class="nc">&nbsp;                int[] toDump = choiceDialog.getChoices();</b>
<b class="nc">&nbsp;                if (toDump[0] == 0) {</b>
<b class="nc">&nbsp;                    return cs.getMount();</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    return cs.getMount2();</b>
&nbsp;                }
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        return cs.getMount();</b>
&nbsp;    }
&nbsp;
&nbsp;    private Entity getSelectedEntity() {
<b class="nc">&nbsp;        int unit = unitList.getSelectedIndex();</b>
<b class="nc">&nbsp;        if ((unit == -1) || (unit &gt; entities.size())) {</b>
<b class="nc">&nbsp;            return null;</b>
&nbsp;        }
<b class="nc">&nbsp;        return entities.elementAt(unit);</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * updates fields for the specified mech
&nbsp;     */
&nbsp;    public void displayMech(Entity newEntity) {
<b class="nc">&nbsp;        en = newEntity;</b>
<b class="nc">&nbsp;        entities.clear();</b>
<b class="nc">&nbsp;        entities.add(newEntity);</b>
<b class="nc">&nbsp;        removeListeners();</b>
<b class="nc">&nbsp;        ((DefaultListModel&lt;String&gt;) unitList.getModel())</b>
<b class="nc">&nbsp;                .removeAllElements();</b>
<b class="nc">&nbsp;        ((DefaultListModel&lt;String&gt;) unitList.getModel())</b>
<b class="nc">&nbsp;                .addElement(Messages.getString(&quot;MechDisplay.Ego&quot;));</b>
<b class="nc">&nbsp;        for (Entity loadee : newEntity.getLoadedUnits()) {</b>
<b class="nc">&nbsp;            ((DefaultListModel&lt;String&gt;) unitList.getModel())</b>
<b class="nc">&nbsp;                    .addElement(loadee.getModel());</b>
<b class="nc">&nbsp;            entities.add(loadee);</b>
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;        unitList.setSelectedIndex(0);</b>
<b class="nc">&nbsp;        displayLocations();</b>
<b class="nc">&nbsp;        addListeners();</b>
&nbsp;    }
&nbsp;    
&nbsp;    public void selectLocation(int loc) {
<b class="nc">&nbsp;        locList.setSelectedIndex(loc + LOC_OFFSET);</b>
&nbsp;    }
&nbsp;
&nbsp;    private void displayLocations() {
<b class="nc">&nbsp;        DefaultListModel&lt;String&gt; locModel = ((DefaultListModel&lt;String&gt;) locList</b>
<b class="nc">&nbsp;                .getModel());</b>
<b class="nc">&nbsp;        locModel.removeAllElements();</b>
<b class="nc">&nbsp;        locModel.insertElementAt(</b>
<b class="nc">&nbsp;                Messages.getString(&quot;MechDisplay.AllEquipment&quot;), LOC_ALL_EQUIP);</b>
<b class="nc">&nbsp;        locModel.insertElementAt(</b>
<b class="nc">&nbsp;                Messages.getString(&quot;MechDisplay.AllWeapons&quot;), LOC_ALL_WEAPS);</b>
<b class="nc">&nbsp;        locModel.insertElementAt(&quot;-----&quot;, LOC_SPACER);</b>
<b class="nc">&nbsp;        for (int loc = 0; loc &lt; en.locations(); loc++) {</b>
<b class="nc">&nbsp;            int idx = loc + LOC_OFFSET;</b>
<b class="nc">&nbsp;            if (en.getNumberOfCriticals(loc) &gt; 0) {</b>
<b class="nc">&nbsp;                locModel.insertElementAt(en.getLocationName(loc), idx);</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        locList.setSelectedIndex(0);</b>
<b class="nc">&nbsp;        displaySlots();</b>
&nbsp;    }
&nbsp;
&nbsp;    private void displaySlots() {
<b class="nc">&nbsp;        int loc = locList.getSelectedIndex();</b>
<b class="nc">&nbsp;        DefaultListModel&lt;String&gt; slotModel = </b>
<b class="nc">&nbsp;                ((DefaultListModel&lt;String&gt;) slotList.getModel()); </b>
<b class="nc">&nbsp;        slotModel.removeAllElements();        </b>
&nbsp;        
&nbsp;        // Display all Equipment
<b class="nc">&nbsp;        if (loc == LOC_ALL_EQUIP) {</b>
<b class="nc">&nbsp;            for (Mounted m : en.getMisc()) {</b>
<b class="nc">&nbsp;                slotModel.addElement(getMountedDisplay(m, loc));</b>
<b class="nc">&nbsp;            }</b>
&nbsp;            return;
&nbsp;        }
&nbsp;        
&nbsp;        // Display all Weapons
<b class="nc">&nbsp;        if (loc == LOC_ALL_WEAPS) {</b>
<b class="nc">&nbsp;            for (Mounted m : en.getWeaponList()) {</b>
<b class="nc">&nbsp;                slotModel.addElement(getMountedDisplay(m, loc));</b>
<b class="nc">&nbsp;            }</b>
&nbsp;            return;
&nbsp;        }
&nbsp;        
&nbsp;        // Display nothing for a spacer
<b class="nc">&nbsp;        if (loc == LOC_SPACER) {</b>
&nbsp;            return;
&nbsp;        }        
&nbsp;
&nbsp;        // Standard location handling
<b class="nc">&nbsp;        loc -= LOC_OFFSET;</b>
<b class="nc">&nbsp;        for (int i = 0; i &lt; en.getNumberOfCriticals(loc); i++) {</b>
<b class="nc">&nbsp;            final CriticalSlot cs = en.getCritical(loc, i);</b>
<b class="nc">&nbsp;            StringBuffer sb = new StringBuffer(32);</b>
<b class="nc">&nbsp;            if (cs == null) {</b>
<b class="nc">&nbsp;                sb.append(&quot;---&quot;); //$NON-NLS-1$</b>
&nbsp;            } else {
<b class="nc">&nbsp;                switch (cs.getType()) {</b>
&nbsp;                    case CriticalSlot.TYPE_SYSTEM:
<b class="nc">&nbsp;                        if (cs.isDestroyed() || cs.isMissing()) {</b>
<b class="nc">&nbsp;                            sb.append(&quot;*&quot;); //$NON-NLS-1$</b>
&nbsp;                        }
<b class="nc">&nbsp;                        if (cs.isBreached()) {</b>
<b class="nc">&nbsp;                            sb.append(&quot;x&quot;); //$NON-NLS-1$</b>
&nbsp;                        }
&nbsp;                        // Protomechs have different system names.
<b class="nc">&nbsp;                        if (en instanceof Protomech) {</b>
<b class="nc">&nbsp;                            sb.append(Protomech.systemNames[cs.getIndex()]);</b>
&nbsp;                        } else {
<b class="nc">&nbsp;                            sb.append(((Mech) en).getSystemName(cs</b>
<b class="nc">&nbsp;                                    .getIndex()));</b>
&nbsp;                        }
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    case CriticalSlot.TYPE_EQUIPMENT:
<b class="nc">&nbsp;                        sb.append(getMountedDisplay(cs.getMount(), loc, cs));</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    default:
&nbsp;                }
<b class="nc">&nbsp;                if (cs.isArmored()) {</b>
<b class="nc">&nbsp;                    sb.append(&quot; (armored)&quot;);  //$NON-NLS-1$</b>
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            slotModel.addElement(sb.toString());</b>
&nbsp;        }
<b class="nc">&nbsp;        onResize();</b>
&nbsp;    }
&nbsp;    
&nbsp;    private String getMountedDisplay(Mounted m, int loc) {
<b class="nc">&nbsp;        return getMountedDisplay(m, loc, null);</b>
&nbsp;    }
&nbsp;    
&nbsp;    private String getMountedDisplay(Mounted m, int loc, CriticalSlot cs) {
<b class="nc">&nbsp;        String hotLoaded = Messages.getString(&quot;MechDisplay.isHotLoaded&quot;); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        StringBuffer sb = new StringBuffer();</b>
&nbsp;        
<b class="nc">&nbsp;        sb.append(m.getDesc());</b>
&nbsp;
<b class="nc">&nbsp;        if ((cs != null) &amp;&amp; cs.getMount2() != null) {</b>
<b class="nc">&nbsp;            sb.append(&quot; &quot;); //$NON-NLS-1$</b>
<b class="nc">&nbsp;            sb.append(cs.getMount2().getDesc()); //$NON-NLS-1$</b>
&nbsp;        }
<b class="nc">&nbsp;        if (m.isHotLoaded()) {</b>
<b class="nc">&nbsp;            sb.append(hotLoaded);</b>
&nbsp;        }
<b class="nc">&nbsp;        if (m.getType().hasModes()) {</b>
<b class="nc">&nbsp;            if (m.curMode().getDisplayableName().length() &gt; 0) {</b>
<b class="nc">&nbsp;                sb.append(&quot; (&quot;); //$NON-NLS-1$</b>
<b class="nc">&nbsp;                sb.append(m.curMode().getDisplayableName());</b>
<b class="nc">&nbsp;                sb.append(&#39;)&#39;); //$NON-NLS-1$</b>
&nbsp;            }
<b class="nc">&nbsp;            if (!m.pendingMode().equals(&quot;None&quot;)) { //$NON-NLS-1$</b>
<b class="nc">&nbsp;                sb.append(&quot; (next turn, &quot;); //$NON-NLS-1$</b>
<b class="nc">&nbsp;                sb.append(m.pendingMode().getDisplayableName());</b>
<b class="nc">&nbsp;                sb.append(&#39;)&#39;); //$NON-NLS-1$</b>
&nbsp;            }
<b class="nc">&nbsp;            if ((m.getType() instanceof MiscType)</b>
<b class="nc">&nbsp;                    &amp;&amp; ((MiscType) m.getType()).isShield()) {</b>
<b class="nc">&nbsp;                sb.append(&quot; &quot; //$NON-NLS-1$</b>
<b class="nc">&nbsp;                        + m.getDamageAbsorption(en, m.getLocation())</b>
&nbsp;                        + &#39;/&#39; //$NON-NLS-1$
<b class="nc">&nbsp;                        + m.getCurrentDamageCapacity(en,</b>
<b class="nc">&nbsp;                                m.getLocation()) + &#39;)&#39;); //$NON-NLS-1$</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        return sb.toString();</b>
&nbsp;    }
&nbsp;
&nbsp;    //
&nbsp;    // ItemListener
&nbsp;    //
&nbsp;    public void itemStateChanged(ItemEvent ev) {
<b class="nc">&nbsp;        removeListeners();</b>
&nbsp;        try {
<b class="nc">&nbsp;            ClientGUI clientgui = unitDisplay.getClientGUI();</b>
<b class="nc">&nbsp;            if (clientgui == null) {</b>
&nbsp;                return;
&nbsp;            }
<b class="nc">&nbsp;            if (ev.getSource().equals(m_chMode)</b>
<b class="nc">&nbsp;                    &amp;&amp; (ev.getStateChange() == ItemEvent.SELECTED)) {</b>
<b class="nc">&nbsp;                Mounted m = getSelectedEquipment();</b>
<b class="nc">&nbsp;                CriticalSlot cs = getSelectedCritical();</b>
<b class="nc">&nbsp;                if ((m != null) &amp;&amp; m.getType().hasModes()) {</b>
<b class="nc">&nbsp;                    int nMode = m_chMode.getSelectedIndex();</b>
<b class="nc">&nbsp;                    if (nMode &gt;= 0) {</b>
&nbsp;
<b class="nc">&nbsp;                        if ((m.getType() instanceof MiscType)</b>
<b class="nc">&nbsp;                                &amp;&amp; ((MiscType) m.getType()).isShield()</b>
<b class="nc">&nbsp;                                &amp;&amp; (clientgui.getClient().getGame()</b>
<b class="nc">&nbsp;                                        .getPhase() != IGame.Phase.PHASE_FIRING)) {</b>
<b class="nc">&nbsp;                            clientgui.systemMessage(Messages.getString(</b>
&nbsp;                                    &quot;MechDisplay.ShieldModePhase&quot;));//$NON-NLS-1$
&nbsp;                            return;
&nbsp;                        }
&nbsp;
<b class="nc">&nbsp;                        if ((m.getType() instanceof MiscType)</b>
<b class="nc">&nbsp;                                &amp;&amp; ((MiscType) m.getType()).isVibroblade()</b>
<b class="nc">&nbsp;                                &amp;&amp; (clientgui.getClient().getGame().getPhase()</b>
&nbsp;                                != IGame.Phase.PHASE_PHYSICAL)) {
<b class="nc">&nbsp;                            clientgui.systemMessage(Messages.getString(</b>
&nbsp;                                    &quot;MechDisplay.VibrobladeModePhase&quot;));//$NON-NLS-1$
&nbsp;                            return;
&nbsp;                        }
&nbsp;
<b class="nc">&nbsp;                        if ((m.getType() instanceof MiscType)</b>
<b class="nc">&nbsp;                                &amp;&amp; m.getType().hasSubType(MiscType.S_RETRACTABLE_BLADE)</b>
<b class="nc">&nbsp;                                &amp;&amp; (clientgui.getClient().getGame().getPhase() != IGame.Phase.PHASE_MOVEMENT)) {</b>
<b class="nc">&nbsp;                            clientgui.systemMessage(Messages.getString(</b>
&nbsp;                                                    &quot;MechDisplay.RetractableBladeModePhase&quot;));//$NON-NLS-1$
&nbsp;                            return;
&nbsp;                        }
&nbsp;
&nbsp;                        // Can only charge a capacitor if the weapon has not
&nbsp;                        // been fired.
<b class="nc">&nbsp;                        if ((m.getType() instanceof MiscType)</b>
<b class="nc">&nbsp;                                &amp;&amp; (m.getLinked() != null)</b>
<b class="nc">&nbsp;                                &amp;&amp; ((MiscType) m.getType())</b>
<b class="nc">&nbsp;                                        .hasFlag(MiscType.F_PPC_CAPACITOR)</b>
<b class="nc">&nbsp;                                &amp;&amp; m.getLinked().isUsedThisRound()</b>
&nbsp;                                &amp;&amp; (nMode == 1)) {
<b class="nc">&nbsp;                            clientgui.systemMessage(Messages.getString(</b>
&nbsp;                                    &quot;MechDisplay.CapacitorCharging&quot;));//$NON-NLS-1$
&nbsp;                            return;
&nbsp;                        }
<b class="nc">&nbsp;                        m.setMode(nMode);</b>
&nbsp;                        // send the event to the server
<b class="nc">&nbsp;                        clientgui.getClient().sendModeChange(en.getId(), en.getEquipmentNum(m), nMode);</b>
&nbsp;
&nbsp;                        // notify the player
<b class="nc">&nbsp;                        if (m.canInstantSwitch(nMode)) {</b>
<b class="nc">&nbsp;                            clientgui.systemMessage(Messages.getString(&quot;MechDisplay.switched&quot;,</b>
<b class="nc">&nbsp;                                    m.getName(), m.curMode().getDisplayableName()));</b>
<b class="nc">&nbsp;                            int weap = this.unitDisplay.wPan.getSelectedWeaponNum();</b>
<b class="nc">&nbsp;                            this.unitDisplay.wPan.displayMech(en);</b>
<b class="nc">&nbsp;                            this.unitDisplay.wPan.selectWeapon(weap);</b>
&nbsp;                            // displaySlots();
<b class="nc">&nbsp;                        } else {</b>
<b class="nc">&nbsp;                            if (IGame.Phase.PHASE_DEPLOYMENT == clientgui.getClient().getGame().getPhase()) {</b>
<b class="nc">&nbsp;                                clientgui.systemMessage(Messages.getString(&quot;MechDisplay.willSwitchAtStart&quot;,</b>
<b class="nc">&nbsp;                                        m.getName(), m.pendingMode().getDisplayableName()));</b>
&nbsp;                            } else {
<b class="nc">&nbsp;                                clientgui.systemMessage(Messages.getString(&quot;MechDisplay.willSwitchAtEnd&quot;,</b>
<b class="nc">&nbsp;                                        m.getName(), m.pendingMode().getDisplayableName()));</b>
&nbsp;                            }
&nbsp;                        }
<b class="nc">&nbsp;                        int loc = slotList.getSelectedIndex();</b>
<b class="nc">&nbsp;                        displaySlots();</b>
<b class="nc">&nbsp;                        slotList.setSelectedIndex(loc);</b>
&nbsp;                    }
<b class="nc">&nbsp;                } else if ((cs != null)</b>
<b class="nc">&nbsp;                        &amp;&amp; (cs.getType() == CriticalSlot.TYPE_SYSTEM)) {</b>
<b class="nc">&nbsp;                    int nMode = m_chMode.getSelectedIndex();</b>
<b class="nc">&nbsp;                    if (nMode &gt;= 0) {</b>
<b class="nc">&nbsp;                        if ((cs.getIndex() == Mech.SYSTEM_COCKPIT)</b>
<b class="nc">&nbsp;                                &amp;&amp; en.hasEiCockpit()</b>
&nbsp;                                &amp;&amp; (en instanceof Mech)) {
<b class="nc">&nbsp;                            Mech mech = (Mech) en;</b>
<b class="nc">&nbsp;                            mech.setCockpitStatus(nMode);</b>
<b class="nc">&nbsp;                            clientgui.getClient().sendSystemModeChange(</b>
<b class="nc">&nbsp;                                    en.getId(), Mech.SYSTEM_COCKPIT, nMode);</b>
<b class="nc">&nbsp;                            if (mech.getCockpitStatus() == mech</b>
<b class="nc">&nbsp;                                    .getCockpitStatusNextRound()) {</b>
<b class="nc">&nbsp;                                clientgui</b>
<b class="nc">&nbsp;                                        .systemMessage(Messages</b>
<b class="nc">&nbsp;                                                .getString(</b>
&nbsp;                                                        &quot;MechDisplay.switched&quot;,
&nbsp;                                                        new Object[] {
&nbsp;                                                                &quot;Cockpit&quot;,
<b class="nc">&nbsp;                                                                m_chMode.getSelectedItem() }));</b>
&nbsp;                                //$NON-NLS-1$
&nbsp;                            } else {
<b class="nc">&nbsp;                                clientgui</b>
<b class="nc">&nbsp;                                        .systemMessage(Messages</b>
<b class="nc">&nbsp;                                                .getString(</b>
&nbsp;                                                        &quot;MechDisplay.willSwitchAtEnd&quot;,
&nbsp;                                                        new Object[] {
&nbsp;                                                                &quot;Cockpit&quot;,
<b class="nc">&nbsp;                                                                m_chMode.getSelectedItem() }));</b>
&nbsp;                                //$NON-NLS-1$
&nbsp;                            }
&nbsp;                        }
&nbsp;                    }
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            onResize();</b>
&nbsp;        } finally {
<b class="nc">&nbsp;            addListeners();</b>
<b class="nc">&nbsp;        }</b>
&nbsp;    }
&nbsp;
&nbsp;    // ActionListener
&nbsp;    public void actionPerformed(ActionEvent ae) {
<b class="nc">&nbsp;        removeListeners();</b>
&nbsp;        try {
<b class="nc">&nbsp;            ClientGUI clientgui = unitDisplay.getClientGUI();</b>
<b class="nc">&nbsp;            if (clientgui == null) {</b>
&nbsp;                return;
&nbsp;            }
<b class="nc">&nbsp;            if (&quot;dump&quot;.equals(ae.getActionCommand())) { //$NON-NLS-1$</b>
<b class="nc">&nbsp;                Mounted m = getSelectedEquipment();</b>
<b class="nc">&nbsp;                boolean bOwner = clientgui.getClient().getLocalPlayer()</b>
<b class="nc">&nbsp;                        .equals(en.getOwner());</b>
<b class="nc">&nbsp;                if ((m == null) || !bOwner) {</b>
&nbsp;                    return;
&nbsp;                }
&nbsp;
&nbsp;                // Check for BA dumping SRM launchers
<b class="nc">&nbsp;                if ((en instanceof BattleArmor) &amp;&amp; (!m.isMissing())</b>
<b class="nc">&nbsp;                        &amp;&amp; m.isBodyMounted()</b>
<b class="nc">&nbsp;                        &amp;&amp; m.getType().hasFlag(WeaponType.F_MISSILE)</b>
<b class="nc">&nbsp;                        &amp;&amp; (m.getLinked() != null)</b>
<b class="nc">&nbsp;                        &amp;&amp; (m.getLinked().getUsableShotsLeft() &gt; 0)) {</b>
<b class="nc">&nbsp;                    boolean isDumping = !m.isPendingDump();</b>
<b class="nc">&nbsp;                    m.setPendingDump(isDumping);</b>
<b class="nc">&nbsp;                    clientgui.getClient().sendModeChange(en.getId(),</b>
<b class="nc">&nbsp;                            en.getEquipmentNum(m), isDumping ? -1 : 0);</b>
<b class="nc">&nbsp;                    int selIdx = slotList.getSelectedIndex();</b>
<b class="nc">&nbsp;                    displaySlots();</b>
<b class="nc">&nbsp;                    slotList.setSelectedIndex(selIdx);</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                if (((!(m.getType() instanceof AmmoType) || (m</b>
<b class="nc">&nbsp;                        .getUsableShotsLeft() &lt;= 0)) &amp;&amp; !m.isDWPMounted())</b>
<b class="nc">&nbsp;                        || (m.isDWPMounted() &amp;&amp; (m.isMissing() == true))) {</b>
&nbsp;                    return;
&nbsp;                }
&nbsp;
&nbsp;                boolean bDumping;
&nbsp;                boolean bConfirmed;
&nbsp;
<b class="nc">&nbsp;                if (m.isPendingDump()) {</b>
<b class="nc">&nbsp;                    bDumping = false;</b>
<b class="nc">&nbsp;                    if (m.getType() instanceof AmmoType) {</b>
<b class="nc">&nbsp;                        String title = Messages</b>
<b class="nc">&nbsp;                                .getString(&quot;MechDisplay.CancelDumping.title&quot;); //$NON-NLS-1$</b>
<b class="nc">&nbsp;                        String body = Messages</b>
<b class="nc">&nbsp;                                .getString(</b>
<b class="nc">&nbsp;                                        &quot;MechDisplay.CancelDumping.message&quot;, new Object[] { m.getName() }); //$NON-NLS-1$</b>
<b class="nc">&nbsp;                        bConfirmed = clientgui.doYesNoDialog(title, body);</b>
<b class="nc">&nbsp;                    } else {</b>
<b class="nc">&nbsp;                        String title = Messages</b>
<b class="nc">&nbsp;                                .getString(&quot;MechDisplay.CancelJettison.title&quot;); //$NON-NLS-1$</b>
<b class="nc">&nbsp;                        String body = Messages</b>
<b class="nc">&nbsp;                                .getString(</b>
<b class="nc">&nbsp;                                        &quot;MechDisplay.CancelJettison.message&quot;, new Object[] { m.getName() }); //$NON-NLS-1$</b>
<b class="nc">&nbsp;                        bConfirmed = clientgui.doYesNoDialog(title, body);</b>
<b class="nc">&nbsp;                    }</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    bDumping = true;</b>
<b class="nc">&nbsp;                    if (m.getType() instanceof AmmoType) {</b>
<b class="nc">&nbsp;                        String title = Messages</b>
<b class="nc">&nbsp;                                .getString(&quot;MechDisplay.Dump.title&quot;); //$NON-NLS-1$</b>
<b class="nc">&nbsp;                        String body = Messages</b>
<b class="nc">&nbsp;                                .getString(</b>
<b class="nc">&nbsp;                                        &quot;MechDisplay.Dump.message&quot;, new Object[] { m.getName() }); //$NON-NLS-1$</b>
<b class="nc">&nbsp;                        bConfirmed = clientgui.doYesNoDialog(title, body);</b>
<b class="nc">&nbsp;                    } else {</b>
<b class="nc">&nbsp;                        String title = Messages</b>
<b class="nc">&nbsp;                                .getString(&quot;MechDisplay.Jettison.title&quot;); //$NON-NLS-1$</b>
<b class="nc">&nbsp;                        String body = Messages</b>
<b class="nc">&nbsp;                                .getString(</b>
<b class="nc">&nbsp;                                        &quot;MechDisplay.Jettison.message&quot;, new Object[] { m.getName() }); //$NON-NLS-1$</b>
<b class="nc">&nbsp;                        bConfirmed = clientgui.doYesNoDialog(title, body);</b>
&nbsp;                    }
&nbsp;
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                if (bConfirmed) {</b>
<b class="nc">&nbsp;                    m.setPendingDump(bDumping);</b>
<b class="nc">&nbsp;                    clientgui.getClient().sendModeChange(en.getId(),</b>
<b class="nc">&nbsp;                            en.getEquipmentNum(m), bDumping ? -1 : 0);</b>
<b class="nc">&nbsp;                    int selIdx = slotList.getSelectedIndex();</b>
<b class="nc">&nbsp;                    displaySlots();</b>
<b class="nc">&nbsp;                    slotList.setSelectedIndex(selIdx);</b>
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            onResize();</b>
&nbsp;        } finally {
<b class="nc">&nbsp;            addListeners();</b>
<b class="nc">&nbsp;        }</b>
&nbsp;    }
&nbsp;
&nbsp;    private void setBackGround() {
&nbsp;        UnitDisplaySkinSpecification udSpec = SkinXMLHandler
<b class="nc">&nbsp;                .getUnitDisplaySkin();</b>
&nbsp;
<b class="nc">&nbsp;        Image tile = getToolkit()</b>
<b class="nc">&nbsp;                .getImage(</b>
<b class="nc">&nbsp;                        new MegaMekFile(Configuration.widgetsDir(), udSpec</b>
<b class="nc">&nbsp;                                .getBackgroundTile()).toString());</b>
<b class="nc">&nbsp;        PMUtil.setImage(tile, this);</b>
<b class="nc">&nbsp;        int b = BackGroundDrawer.TILING_BOTH;</b>
<b class="nc">&nbsp;        addBgDrawer(new BackGroundDrawer(tile, b));</b>
&nbsp;
<b class="nc">&nbsp;        b = BackGroundDrawer.TILING_HORIZONTAL | BackGroundDrawer.VALIGN_TOP;</b>
<b class="nc">&nbsp;        tile = getToolkit().getImage(</b>
<b class="nc">&nbsp;                new MegaMekFile(Configuration.widgetsDir(), udSpec.getTopLine())</b>
<b class="nc">&nbsp;                        .toString());</b>
<b class="nc">&nbsp;        PMUtil.setImage(tile, this);</b>
<b class="nc">&nbsp;        addBgDrawer(new BackGroundDrawer(tile, b));</b>
&nbsp;
<b class="nc">&nbsp;        b = BackGroundDrawer.TILING_HORIZONTAL | BackGroundDrawer.VALIGN_BOTTOM;</b>
<b class="nc">&nbsp;        tile = getToolkit().getImage(</b>
<b class="nc">&nbsp;                new MegaMekFile(Configuration.widgetsDir(), udSpec.getBottomLine())</b>
<b class="nc">&nbsp;                        .toString()); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        PMUtil.setImage(tile, this);</b>
<b class="nc">&nbsp;        addBgDrawer(new BackGroundDrawer(tile, b));</b>
&nbsp;
<b class="nc">&nbsp;        b = BackGroundDrawer.TILING_VERTICAL | BackGroundDrawer.HALIGN_LEFT;</b>
<b class="nc">&nbsp;        tile = getToolkit().getImage(</b>
<b class="nc">&nbsp;                new MegaMekFile(Configuration.widgetsDir(), udSpec.getLeftLine())</b>
<b class="nc">&nbsp;                        .toString()); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        PMUtil.setImage(tile, this);</b>
<b class="nc">&nbsp;        addBgDrawer(new BackGroundDrawer(tile, b));</b>
&nbsp;
<b class="nc">&nbsp;        b = BackGroundDrawer.TILING_VERTICAL | BackGroundDrawer.HALIGN_RIGHT;</b>
<b class="nc">&nbsp;        tile = getToolkit().getImage(</b>
<b class="nc">&nbsp;                new MegaMekFile(Configuration.widgetsDir(), udSpec.getRightLine())</b>
<b class="nc">&nbsp;                        .toString());</b>
<b class="nc">&nbsp;        PMUtil.setImage(tile, this);</b>
<b class="nc">&nbsp;        addBgDrawer(new BackGroundDrawer(tile, b));</b>
&nbsp;
<b class="nc">&nbsp;        b = BackGroundDrawer.NO_TILING | BackGroundDrawer.VALIGN_TOP</b>
&nbsp;                | BackGroundDrawer.HALIGN_LEFT;
<b class="nc">&nbsp;        tile = getToolkit().getImage(</b>
<b class="nc">&nbsp;                new MegaMekFile(Configuration.widgetsDir(), udSpec.getTopLeftCorner())</b>
<b class="nc">&nbsp;                        .toString());</b>
<b class="nc">&nbsp;        PMUtil.setImage(tile, this);</b>
<b class="nc">&nbsp;        addBgDrawer(new BackGroundDrawer(tile, b));</b>
&nbsp;
<b class="nc">&nbsp;        b = BackGroundDrawer.NO_TILING | BackGroundDrawer.VALIGN_BOTTOM</b>
&nbsp;                | BackGroundDrawer.HALIGN_LEFT;
<b class="nc">&nbsp;        tile = getToolkit().getImage(</b>
<b class="nc">&nbsp;                new MegaMekFile(Configuration.widgetsDir(), udSpec</b>
<b class="nc">&nbsp;                        .getBottomLeftCorner()).toString());</b>
<b class="nc">&nbsp;        PMUtil.setImage(tile, this);</b>
<b class="nc">&nbsp;        addBgDrawer(new BackGroundDrawer(tile, b));</b>
&nbsp;
<b class="nc">&nbsp;        b = BackGroundDrawer.NO_TILING | BackGroundDrawer.VALIGN_TOP</b>
&nbsp;                | BackGroundDrawer.HALIGN_RIGHT;
<b class="nc">&nbsp;        tile = getToolkit()</b>
<b class="nc">&nbsp;                .getImage(</b>
<b class="nc">&nbsp;                        new MegaMekFile(Configuration.widgetsDir(), udSpec</b>
<b class="nc">&nbsp;                                .getTopRightCorner()).toString());</b>
<b class="nc">&nbsp;        PMUtil.setImage(tile, this);</b>
<b class="nc">&nbsp;        addBgDrawer(new BackGroundDrawer(tile, b));</b>
&nbsp;
<b class="nc">&nbsp;        b = BackGroundDrawer.NO_TILING | BackGroundDrawer.VALIGN_BOTTOM</b>
&nbsp;                | BackGroundDrawer.HALIGN_RIGHT;
<b class="nc">&nbsp;        tile = getToolkit().getImage(</b>
<b class="nc">&nbsp;                new MegaMekFile(Configuration.widgetsDir(), udSpec</b>
<b class="nc">&nbsp;                        .getBottomRightCorner()).toString());</b>
<b class="nc">&nbsp;        PMUtil.setImage(tile, this);</b>
<b class="nc">&nbsp;        addBgDrawer(new BackGroundDrawer(tile, b));</b>
&nbsp;
&nbsp;    }
&nbsp;
&nbsp;    public void valueChanged(ListSelectionEvent event) {
<b class="nc">&nbsp;        if (event.getValueIsAdjusting()) {</b>
&nbsp;            return;
&nbsp;        }
<b class="nc">&nbsp;        removeListeners();</b>
&nbsp;        try {
<b class="nc">&nbsp;            if (event.getSource().equals(unitList)) {</b>
<b class="nc">&nbsp;                if (null != getSelectedEntity()) {</b>
<b class="nc">&nbsp;                    en = getSelectedEntity();</b>
<b class="nc">&nbsp;                    ((DefaultComboBoxModel&lt;String&gt;) m_chMode.getModel())</b>
<b class="nc">&nbsp;                            .removeAllElements();</b>
<b class="nc">&nbsp;                    m_chMode.setEnabled(false);</b>
<b class="nc">&nbsp;                    displayLocations();</b>
&nbsp;                }
<b class="nc">&nbsp;            } else if (event.getSource().equals(locList)) {</b>
<b class="nc">&nbsp;                ((DefaultComboBoxModel&lt;String&gt;) m_chMode.getModel())</b>
<b class="nc">&nbsp;                        .removeAllElements();</b>
<b class="nc">&nbsp;                m_chMode.setEnabled(false);</b>
<b class="nc">&nbsp;                displaySlots();</b>
<b class="nc">&nbsp;            } else if (event.getSource().equals(slotList)</b>
<b class="nc">&nbsp;                    &amp;&amp; (unitDisplay.getClientGUI() != null)) {</b>
&nbsp;
<b class="nc">&nbsp;                Client client = unitDisplay.getClientGUI().getClient();</b>
<b class="nc">&nbsp;                m_bDumpAmmo.setEnabled(false);</b>
<b class="nc">&nbsp;                m_chMode.setEnabled(false);</b>
<b class="nc">&nbsp;                Mounted m = getSelectedEquipment();</b>
<b class="nc">&nbsp;                boolean carryingBAsOnBack = false;</b>
<b class="nc">&nbsp;                if ((en instanceof Mech)</b>
<b class="nc">&nbsp;                        &amp;&amp; ((en.getExteriorUnitAt(Mech.LOC_CT, true) != null)</b>
<b class="nc">&nbsp;                                || (en.getExteriorUnitAt(Mech.LOC_LT, true) != null) || (en</b>
<b class="nc">&nbsp;                                .getExteriorUnitAt(Mech.LOC_RT, true) != null))) {</b>
<b class="nc">&nbsp;                    carryingBAsOnBack = true;</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                boolean invalidEnvironment = false;</b>
<b class="nc">&nbsp;                if ((en instanceof Mech)</b>
<b class="nc">&nbsp;                        &amp;&amp; (en.getLocationStatus(Mech.LOC_CT) &gt; ILocationExposureStatus.NORMAL)) {</b>
<b class="nc">&nbsp;                    invalidEnvironment = true;</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                if ((en instanceof Tank)</b>
<b class="nc">&nbsp;                        &amp;&amp; (en.getLocationStatus(Tank.LOC_REAR) &gt; ILocationExposureStatus.NORMAL)) {</b>
<b class="nc">&nbsp;                    invalidEnvironment = true;</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                ((DefaultComboBoxModel&lt;String&gt;) m_chMode.getModel())</b>
<b class="nc">&nbsp;                        .removeAllElements();</b>
<b class="nc">&nbsp;                boolean bOwner = client.getLocalPlayer().equals(en.getOwner());</b>
<b class="nc">&nbsp;                if ((m != null)</b>
&nbsp;                        &amp;&amp; bOwner
<b class="nc">&nbsp;                        &amp;&amp; (m.getType() instanceof AmmoType)</b>
<b class="nc">&nbsp;                        &amp;&amp; (client.getGame().getPhase() != IGame.Phase.PHASE_DEPLOYMENT)</b>
<b class="nc">&nbsp;                        &amp;&amp; (client.getGame().getPhase() != IGame.Phase.PHASE_MOVEMENT)</b>
<b class="nc">&nbsp;                        &amp;&amp; (m.getUsableShotsLeft() &gt; 0)</b>
<b class="nc">&nbsp;                        &amp;&amp; !m.isDumping()</b>
<b class="nc">&nbsp;                        &amp;&amp; en.isActive()</b>
<b class="nc">&nbsp;                        &amp;&amp; (client.getGame().getOptions().intOption(OptionsConstants.BASE_DUMPING_FROM_ROUND) </b>
<b class="nc">&nbsp;                                &lt;= client.getGame().getRoundCount())</b>
&nbsp;                        &amp;&amp; !carryingBAsOnBack &amp;&amp; !invalidEnvironment) {
<b class="nc">&nbsp;                    m_bDumpAmmo.setEnabled(true);</b>
<b class="nc">&nbsp;                } else if ((m != null) &amp;&amp; bOwner</b>
<b class="nc">&nbsp;                        &amp;&amp; (m.getType() instanceof WeaponType)</b>
<b class="nc">&nbsp;                        &amp;&amp; !m.isMissing() &amp;&amp; m.isDWPMounted()) {</b>
<b class="nc">&nbsp;                    m_bDumpAmmo.setEnabled(true);</b>
&nbsp;                    // Allow dumping of body-mounted missile launchers on BA
<b class="nc">&nbsp;                } else if ((m != null) &amp;&amp; bOwner</b>
&nbsp;                        &amp;&amp; (en instanceof BattleArmor)
<b class="nc">&nbsp;                        &amp;&amp; (m.getType() instanceof WeaponType)</b>
<b class="nc">&nbsp;                        &amp;&amp; !m.isMissing() &amp;&amp; m.isBodyMounted()</b>
<b class="nc">&nbsp;                        &amp;&amp; m.getType().hasFlag(WeaponType.F_MISSILE)</b>
<b class="nc">&nbsp;                        &amp;&amp; (m.getLinked() != null)</b>
<b class="nc">&nbsp;                        &amp;&amp; (m.getLinked().getUsableShotsLeft() &gt; 0)) {</b>
<b class="nc">&nbsp;                    m_bDumpAmmo.setEnabled(true);</b>
&nbsp;                }
<b class="nc">&nbsp;                int round = client.getGame().getRoundCount();</b>
<b class="nc">&nbsp;                boolean inSquadron = ((en instanceof Aero) &amp;&amp; ((Aero) en)</b>
<b class="nc">&nbsp;                        .isInASquadron());</b>
<b class="nc">&nbsp;                if ((m != null) &amp;&amp; bOwner &amp;&amp; m.getType().hasModes()) {</b>
<b class="nc">&nbsp;                    if (!m.isInoperable() &amp;&amp; !m.isDumping()</b>
<b class="nc">&nbsp;                            &amp;&amp; (en.isActive() || en.isActive(round) || inSquadron)</b>
<b class="nc">&nbsp;                            &amp;&amp; m.isModeSwitchable()) {</b>
<b class="nc">&nbsp;                        m_chMode.setEnabled(true);</b>
&nbsp;                    }
<b class="nc">&nbsp;                    if (!m.isInoperable()</b>
<b class="nc">&nbsp;                            &amp;&amp; (m.getType() instanceof MiscType)</b>
<b class="nc">&nbsp;                            &amp;&amp; m.getType().hasFlag(MiscType.F_STEALTH)</b>
<b class="nc">&nbsp;                            &amp;&amp; m.isModeSwitchable()) {</b>
<b class="nc">&nbsp;                        m_chMode.setEnabled(true);</b>
&nbsp;                    }// if the maxtech eccm option is not set then the ECM
&nbsp;                     // should not show anything.
<b class="nc">&nbsp;                    if (m.getType().hasFlag(MiscType.F_ECM)</b>
<b class="nc">&nbsp;                            &amp;&amp; !(client.getGame().getOptions().booleanOption(OptionsConstants.ADVANCED_TACOPS_ECCM)</b>
<b class="nc">&nbsp;                                    || client.getGame().getOptions().booleanOption(OptionsConstants.ADVANCED_TACOPS_GHOST_TARGET))) {</b>
&nbsp;                        return;
&nbsp;                    }
<b class="nc">&nbsp;                    for (Enumeration&lt;EquipmentMode&gt; e = m.getType()</b>
<b class="nc">&nbsp;                            .getModes(); e.hasMoreElements();) {</b>
<b class="nc">&nbsp;                        EquipmentMode em = e.nextElement();</b>
&nbsp;                        //Hack to prevent showing an option that is disabled by the server, but would
&nbsp;                        //be overwritten by every entity update if made also in the client
<b class="nc">&nbsp;                        if (em.equals(&quot;HotLoad&quot;) &amp;&amp; en instanceof Mech</b>
<b class="nc">&nbsp;                                &amp;&amp; !client.getGame().getOptions().booleanOption(OptionsConstants.ADVCOMBAT_HOTLOAD_IN_GAME)) {</b>
<b class="nc">&nbsp;                            continue;</b>
&nbsp;                        }
<b class="nc">&nbsp;                        m_chMode.addItem(em.getDisplayableName());</b>
<b class="nc">&nbsp;                    }</b>
<b class="nc">&nbsp;                    if (m_chMode.getModel().getSize() &lt;= 1) {</b>
<b class="nc">&nbsp;                        m_chMode.removeAllItems();</b>
<b class="nc">&nbsp;                        m_chMode.setEnabled(false);</b>
&nbsp;                    } else {
<b class="nc">&nbsp;                        if (m.pendingMode().equals(&quot;None&quot;)) {</b>
<b class="nc">&nbsp;                            m_chMode.setSelectedItem(m.curMode()</b>
<b class="nc">&nbsp;                                    .getDisplayableName());</b>
&nbsp;                        } else {
<b class="nc">&nbsp;                            m_chMode.setSelectedItem(m.pendingMode()</b>
<b class="nc">&nbsp;                                    .getDisplayableName());</b>
&nbsp;                        }
&nbsp;                    }
&nbsp;                } else {
<b class="nc">&nbsp;                    CriticalSlot cs = getSelectedCritical();</b>
<b class="nc">&nbsp;                    if ((cs != null)</b>
<b class="nc">&nbsp;                            &amp;&amp; (cs.getType() == CriticalSlot.TYPE_SYSTEM)) {</b>
<b class="nc">&nbsp;                        if ((cs.getIndex() == Mech.SYSTEM_COCKPIT)</b>
<b class="nc">&nbsp;                                &amp;&amp; en.hasEiCockpit()</b>
&nbsp;                                &amp;&amp; (en instanceof Mech)) {
<b class="nc">&nbsp;                            m_chMode.setEnabled(true);</b>
<b class="nc">&nbsp;                            m_chMode.addItem(&quot;EI Off&quot;);</b>
<b class="nc">&nbsp;                            m_chMode.addItem(&quot;EI On&quot;);</b>
<b class="nc">&nbsp;                            m_chMode.addItem(&quot;Aimed shot&quot;);</b>
<b class="nc">&nbsp;                            m_chMode.setSelectedItem(Integer.valueOf(</b>
<b class="nc">&nbsp;                                    ((Mech) en).getCockpitStatusNextRound()));</b>
&nbsp;                        }
&nbsp;                    }
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            onResize();</b>
&nbsp;        } finally {
<b class="nc">&nbsp;            addListeners();</b>
<b class="nc">&nbsp;        }</b>
&nbsp;    }
&nbsp;    
&nbsp;    private void addListeners() {
<b class="nc">&nbsp;        locList.addListSelectionListener(this);</b>
<b class="nc">&nbsp;        slotList.addListSelectionListener(this);</b>
<b class="nc">&nbsp;        unitList.addListSelectionListener(this);</b>
&nbsp;        
<b class="nc">&nbsp;        m_chMode.addItemListener(this);</b>
<b class="nc">&nbsp;        m_bDumpAmmo.addActionListener(this);</b>
&nbsp;    }
&nbsp;    
&nbsp;    private void removeListeners() {
<b class="nc">&nbsp;        locList.removeListSelectionListener(this);</b>
<b class="nc">&nbsp;        slotList.removeListSelectionListener(this);</b>
<b class="nc">&nbsp;        unitList.removeListSelectionListener(this);</b>
&nbsp;        
<b class="nc">&nbsp;        m_chMode.removeItemListener(this);</b>
<b class="nc">&nbsp;        m_bDumpAmmo.removeActionListener(this);</b>
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2023-05-16 16:28</div>
</div>
</body>
</html>
