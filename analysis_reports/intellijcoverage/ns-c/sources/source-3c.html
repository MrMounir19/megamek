


<!DOCTYPE html>
<html id="htmlId">
<head>
  <title>Coverage Report > PhysicalDisplay</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">megamek.client.ui.swing</a>
</div>

<h1>Coverage Summary for Class: PhysicalDisplay (megamek.client.ui.swing)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">PhysicalDisplay</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/53)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/981)
  </span>
</td>
</tr>
  <tr>
    <td class="name">PhysicalDisplay$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/8)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">PhysicalDisplay$AimedShotHandler</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/7)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/38)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">PhysicalDisplay$PhysicalCommand</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/6)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/23)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/68)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1050)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;/*
&nbsp; * MegaMek - Copyright (C) 2000,2001,2002,2003,2004 Ben Mazur (bmazur@sev.org)
&nbsp; *
&nbsp; *  This program is free software; you can redistribute it and/or modify it
&nbsp; *  under the terms of the GNU General Public License as published by the Free
&nbsp; *  Software Foundation; either version 2 of the License, or (at your option)
&nbsp; *  any later version.
&nbsp; *
&nbsp; *  This program is distributed in the hope that it will be useful, but
&nbsp; *  WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
&nbsp; *  or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License
&nbsp; *  for more details.
&nbsp; */
&nbsp;
&nbsp;package megamek.client.ui.swing;
&nbsp;
&nbsp;import java.awt.event.ActionEvent;
&nbsp;import java.awt.event.ActionListener;
&nbsp;import java.awt.event.InputEvent;
&nbsp;import java.awt.event.ItemEvent;
&nbsp;import java.awt.event.ItemListener;
&nbsp;import java.util.ArrayList;
&nbsp;import java.util.Arrays;
&nbsp;import java.util.Comparator;
&nbsp;import java.util.HashMap;
&nbsp;import java.util.Iterator;
&nbsp;import java.util.List;
&nbsp;import java.util.Map;
&nbsp;import java.util.Vector;
&nbsp;
&nbsp;import javax.swing.JOptionPane;
&nbsp;
&nbsp;import megamek.client.event.BoardViewEvent;
&nbsp;import megamek.client.ui.Messages;
&nbsp;import megamek.client.ui.SharedUtility;
&nbsp;import megamek.client.ui.swing.widget.IndexedRadioButton;
&nbsp;import megamek.client.ui.swing.widget.MegamekButton;
&nbsp;import megamek.client.ui.swing.widget.SkinSpecification;
&nbsp;import megamek.common.BattleArmor;
&nbsp;import megamek.common.BipedMech;
&nbsp;import megamek.common.Building;
&nbsp;import megamek.common.BuildingTarget;
&nbsp;import megamek.common.Compute;
&nbsp;import megamek.common.Coords;
&nbsp;import megamek.common.Entity;
&nbsp;import megamek.common.GameTurn;
&nbsp;import megamek.common.IAimingModes;
&nbsp;import megamek.common.IGame;
&nbsp;import megamek.common.INarcPod;
&nbsp;import megamek.common.Infantry;
&nbsp;import megamek.common.Mech;
&nbsp;import megamek.common.MiscType;
&nbsp;import megamek.common.Mounted;
&nbsp;import megamek.common.QuadMech;
&nbsp;import megamek.common.TargetRoll;
&nbsp;import megamek.common.Targetable;
&nbsp;import megamek.common.ToHitData;
&nbsp;import megamek.common.actions.BAVibroClawAttackAction;
&nbsp;import megamek.common.actions.BreakGrappleAttackAction;
&nbsp;import megamek.common.actions.BrushOffAttackAction;
&nbsp;import megamek.common.actions.ClubAttackAction;
&nbsp;import megamek.common.actions.DodgeAction;
&nbsp;import megamek.common.actions.EntityAction;
&nbsp;import megamek.common.actions.GrappleAttackAction;
&nbsp;import megamek.common.actions.JumpJetAttackAction;
&nbsp;import megamek.common.actions.KickAttackAction;
&nbsp;import megamek.common.actions.LayExplosivesAttackAction;
&nbsp;import megamek.common.actions.ProtomechPhysicalAttackAction;
&nbsp;import megamek.common.actions.PunchAttackAction;
&nbsp;import megamek.common.actions.PushAttackAction;
&nbsp;import megamek.common.actions.SearchlightAttackAction;
&nbsp;import megamek.common.actions.ThrashAttackAction;
&nbsp;import megamek.common.actions.TripAttackAction;
&nbsp;import megamek.common.event.GamePhaseChangeEvent;
&nbsp;import megamek.common.event.GameTurnChangeEvent;
&nbsp;import megamek.common.options.OptionsConstants;
&nbsp;
&nbsp;public class PhysicalDisplay extends StatusBarPhaseDisplay {
&nbsp;
&nbsp;    /**
&nbsp;     *
&nbsp;     */
&nbsp;    private static final long serialVersionUID = -3274750006768636001L;
&nbsp;
&nbsp;    /**
&nbsp;     * This enumeration lists all of the possible ActionCommands that can be
&nbsp;     * carried out during the physical phase.  Each command has a string for the
&nbsp;     * command plus a flag that determines what unit type it is appropriate for.
&nbsp;     *
&nbsp;     * @author arlith
&nbsp;     */
<b class="nc">&nbsp;    public static enum PhysicalCommand implements PhaseCommand {</b>
<b class="nc">&nbsp;        PHYSICAL_NEXT(&quot;next&quot;),</b>
<b class="nc">&nbsp;        PHYSICAL_PUNCH(&quot;punch&quot;),</b>
<b class="nc">&nbsp;        PHYSICAL_KICK(&quot;kick&quot;),</b>
<b class="nc">&nbsp;        PHYSICAL_CLUB(&quot;club&quot;),</b>
<b class="nc">&nbsp;        PHYSICAL_BRUSH_OFF(&quot;brushOff&quot;),</b>
<b class="nc">&nbsp;        PHYSICAL_THRASH(&quot;thrash&quot;),</b>
<b class="nc">&nbsp;        PHYSICAL_DODGE(&quot;dodge&quot;),</b>
<b class="nc">&nbsp;        PHYSICAL_PUSH(&quot;push&quot;),</b>
<b class="nc">&nbsp;        PHYSICAL_TRIP(&quot;trip&quot;),</b>
<b class="nc">&nbsp;        PHYSICAL_GRAPPLE(&quot;grapple&quot;),</b>
<b class="nc">&nbsp;        PHYSICAL_JUMPJET(&quot;jumpjet&quot;),</b>
<b class="nc">&nbsp;        PHYSICAL_PROTO(&quot;protoPhysical&quot;),</b>
<b class="nc">&nbsp;        PHYSICAL_SEARCHLIGHT(&quot;fireSearchlight&quot;),</b>
<b class="nc">&nbsp;        PHYSICAL_EXPLOSIVES(&quot;explosives&quot;),</b>
<b class="nc">&nbsp;        PHYSICAL_VIBRO(&quot;vibro&quot;),</b>
<b class="nc">&nbsp;        PHYSICAL_MORE(&quot;more&quot;);</b>
&nbsp;
&nbsp;        String cmd;
&nbsp;
&nbsp;        /**
&nbsp;         * Priority that determines this buttons order
&nbsp;         */
&nbsp;        public int priority;
&nbsp;
<b class="nc">&nbsp;        private PhysicalCommand(String c) {</b>
<b class="nc">&nbsp;            cmd = c;</b>
&nbsp;        }
&nbsp;
&nbsp;        public String getCmd() {
<b class="nc">&nbsp;            return cmd;</b>
&nbsp;        }
&nbsp;
&nbsp;        public int getPriority() {
<b class="nc">&nbsp;            return priority;</b>
&nbsp;        }
&nbsp;
&nbsp;        public void setPriority(int p) {
<b class="nc">&nbsp;            priority = p;</b>
&nbsp;        }
&nbsp;
&nbsp;        public String toString() {
<b class="nc">&nbsp;            return Messages.getString(&quot;PhysicalDisplay.&quot; + getCmd());</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    // buttons
&nbsp;    protected Map&lt;PhysicalCommand, MegamekButton&gt; buttons;
&nbsp;
&nbsp;    // let&#39;s keep track of what we&#39;re shooting and at what, too
<b class="nc">&nbsp;    private int cen = Entity.NONE; // current entity number</b>
&nbsp;    Targetable target; // target
&nbsp;
&nbsp;    // stuff we want to do
&nbsp;    private Vector&lt;EntityAction&gt; attacks;
&nbsp;
<b class="nc">&nbsp;    private AimedShotHandler ash = new AimedShotHandler();</b>
&nbsp;
&nbsp;    /**
&nbsp;     * Creates and lays out a new movement phase display for the specified
&nbsp;     * clientgui.getClient().
&nbsp;     */
&nbsp;    public PhysicalDisplay(ClientGUI clientgui) {
<b class="nc">&nbsp;        super(clientgui);</b>
&nbsp;
<b class="nc">&nbsp;        clientgui.getClient().getGame().addGameListener(this);</b>
&nbsp;
<b class="nc">&nbsp;        clientgui.getBoardView().addBoardViewListener(this);</b>
<b class="nc">&nbsp;        setupStatusBar(Messages</b>
<b class="nc">&nbsp;                               .getString(&quot;PhysicalDisplay.waitingForPhysicalAttackPhase&quot;)); //$NON-NLS-1$</b>
&nbsp;
<b class="nc">&nbsp;        attacks = new Vector&lt;EntityAction&gt;();</b>
&nbsp;
<b class="nc">&nbsp;        buttons = new HashMap&lt;PhysicalCommand, MegamekButton&gt;(</b>
<b class="nc">&nbsp;                (int) (PhysicalCommand.values().length * 1.25 + 0.5));</b>
<b class="nc">&nbsp;        for (PhysicalCommand cmd : PhysicalCommand.values()) {</b>
<b class="nc">&nbsp;            String title = Messages.getString(&quot;PhysicalDisplay.&quot;</b>
<b class="nc">&nbsp;                                              + cmd.getCmd());</b>
<b class="nc">&nbsp;            MegamekButton newButton = new MegamekButton(title,</b>
<b class="nc">&nbsp;                    SkinSpecification.UIComponents.PhaseDisplayButton.getComp());</b>
<b class="nc">&nbsp;            String ttKey = &quot;PhysicalDisplay.&quot; + cmd.getCmd() + &quot;.tooltip&quot;;</b>
<b class="nc">&nbsp;            if (Messages.keyExists(ttKey)) {</b>
<b class="nc">&nbsp;                newButton.setToolTipText(Messages.getString(ttKey));</b>
&nbsp;            }
<b class="nc">&nbsp;            newButton.addActionListener(this);</b>
<b class="nc">&nbsp;            newButton.setActionCommand(cmd.getCmd());</b>
<b class="nc">&nbsp;            newButton.setEnabled(false);</b>
<b class="nc">&nbsp;            buttons.put(cmd, newButton);</b>
&nbsp;        }
<b class="nc">&nbsp;        numButtonGroups =</b>
<b class="nc">&nbsp;                (int) Math.ceil((buttons.size() + 0.0) / buttonsPerGroup);</b>
&nbsp;
<b class="nc">&nbsp;        butDone.setText(&quot;&lt;html&gt;&lt;b&gt;&quot; + Messages.getString(</b>
&nbsp;                &quot;PhysicalDisplay.Done&quot;) + &quot;&lt;/b&gt;&lt;/html&gt;&quot;); //$NON-NLS-1$
<b class="nc">&nbsp;        butDone.setEnabled(false);</b>
&nbsp;
<b class="nc">&nbsp;        layoutScreen();</b>
&nbsp;
<b class="nc">&nbsp;        setupButtonPanel();</b>
&nbsp;
&nbsp;    }
&nbsp;
&nbsp;    protected ArrayList&lt;MegamekButton&gt; getButtonList() {
<b class="nc">&nbsp;        ArrayList&lt;MegamekButton&gt; buttonList = new ArrayList&lt;MegamekButton&gt;();</b>
<b class="nc">&nbsp;        int i = 0;</b>
<b class="nc">&nbsp;        PhysicalCommand commands[] = PhysicalCommand.values();</b>
<b class="nc">&nbsp;        CommandComparator comparator = new CommandComparator();</b>
<b class="nc">&nbsp;        Arrays.sort(commands, comparator);</b>
<b class="nc">&nbsp;        for (PhysicalCommand cmd : commands) {</b>
<b class="nc">&nbsp;            if (cmd == PhysicalCommand.PHYSICAL_NEXT</b>
&nbsp;                || cmd == PhysicalCommand.PHYSICAL_MORE) {
<b class="nc">&nbsp;                continue;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (i % buttonsPerGroup == 0) {</b>
<b class="nc">&nbsp;                buttonList.add(buttons.get(PhysicalCommand.PHYSICAL_NEXT));</b>
<b class="nc">&nbsp;                i++;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            buttonList.add(buttons.get(cmd));</b>
<b class="nc">&nbsp;            i++;</b>
&nbsp;
<b class="nc">&nbsp;            if ((i + 1) % buttonsPerGroup == 0) {</b>
<b class="nc">&nbsp;                buttonList.add(buttons.get(PhysicalCommand.PHYSICAL_MORE));</b>
<b class="nc">&nbsp;                i++;</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        if (!buttonList.get(i - 1).getActionCommand().</b>
<b class="nc">&nbsp;                equals(PhysicalCommand.PHYSICAL_MORE.getCmd())) {</b>
<b class="nc">&nbsp;            while ((i + 1) % buttonsPerGroup != 0) {</b>
<b class="nc">&nbsp;                buttonList.add(null);</b>
<b class="nc">&nbsp;                i++;</b>
&nbsp;            }
<b class="nc">&nbsp;            buttonList.add(buttons.get(PhysicalCommand.PHYSICAL_MORE));</b>
&nbsp;        }
<b class="nc">&nbsp;        return buttonList;</b>
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;    /**
&nbsp;     * Selects an entity, by number, for movement.
&nbsp;     */
&nbsp;    public void selectEntity(int en) {
<b class="nc">&nbsp;        if (clientgui.getClient().getGame().getEntity(en) == null) {</b>
<b class="nc">&nbsp;            System.err</b>
<b class="nc">&nbsp;                    .println(&quot;PhysicalDisplay: tried to select non-existant entity: &quot; + en); //$NON-NLS-1$</b>
&nbsp;            return;
&nbsp;        }
&nbsp;        
<b class="nc">&nbsp;        if ((ce() != null) &amp;&amp;ce().isWeapOrderChanged()) {</b>
<b class="nc">&nbsp;            clientgui.getClient().sendEntityWeaponOrderUpdate(ce());</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        cen = en;</b>
<b class="nc">&nbsp;        clientgui.setSelectedEntityNum(en);</b>
&nbsp;
<b class="nc">&nbsp;        Entity entity = ce();</b>
&nbsp;
<b class="nc">&nbsp;        target(null);</b>
<b class="nc">&nbsp;        if (entity instanceof Mech) {</b>
<b class="nc">&nbsp;            int grapple = ((Mech) entity).getGrappled();</b>
<b class="nc">&nbsp;            if (grapple != Entity.NONE) {</b>
<b class="nc">&nbsp;                Entity t = clientgui.getClient().getGame().getEntity(grapple);</b>
<b class="nc">&nbsp;                if (t != null) {</b>
<b class="nc">&nbsp;                    target(t);</b>
&nbsp;                }
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        clientgui.getBoardView().highlight(ce().getPosition());</b>
<b class="nc">&nbsp;        clientgui.getBoardView().select(null);</b>
<b class="nc">&nbsp;        clientgui.getBoardView().cursor(null);</b>
&nbsp;
<b class="nc">&nbsp;        clientgui.mechD.displayEntity(entity);</b>
<b class="nc">&nbsp;        clientgui.mechD.showPanel(&quot;movement&quot;); //$NON-NLS-1$</b>
&nbsp;
<b class="nc">&nbsp;        clientgui.bv.centerOnHex(entity.getPosition());</b>
&nbsp;
&nbsp;        // Update the menu bar.
<b class="nc">&nbsp;        clientgui.getMenuBar().setEntity(ce());</b>
&nbsp;
&nbsp;        // does it have a club?
<b class="nc">&nbsp;        String clubLabel = null;</b>
<b class="nc">&nbsp;        for (Mounted club : entity.getClubs()) {</b>
&nbsp;            String thisLab;
<b class="nc">&nbsp;            if (club.getName().endsWith(&quot;Club&quot;)) { //$NON-NLS-1$</b>
<b class="nc">&nbsp;                thisLab = Messages.getString(&quot;PhysicalDisplay.Club&quot;); //$NON-NLS-1$</b>
&nbsp;            } else {
<b class="nc">&nbsp;                thisLab = club.getName();</b>
&nbsp;            }
<b class="nc">&nbsp;            if (clubLabel == null) {</b>
<b class="nc">&nbsp;                clubLabel = thisLab;</b>
&nbsp;            } else {
<b class="nc">&nbsp;                clubLabel = clubLabel + &quot;/&quot; + thisLab;</b>
&nbsp;            }
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;        if (clubLabel == null) {</b>
<b class="nc">&nbsp;            clubLabel = Messages.getString(&quot;PhysicalDisplay.Club&quot;); //$NON-NLS-1$</b>
&nbsp;        }
<b class="nc">&nbsp;        buttons.get(PhysicalCommand.PHYSICAL_CLUB).setText(clubLabel);</b>
&nbsp;
<b class="nc">&nbsp;        if ((entity instanceof Mech)</b>
<b class="nc">&nbsp;            &amp;&amp; !entity.isProne()</b>
<b class="nc">&nbsp;            &amp;&amp; entity.hasAbility(OptionsConstants.PILOT_DODGE_MANEUVER)) { //$NON-NLS-1$</b>
<b class="nc">&nbsp;            setDodgeEnabled(true);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Does turn start stuff
&nbsp;     */
&nbsp;    private void beginMyTurn() {
<b class="nc">&nbsp;        clientgui.setDisplayVisible(true);</b>
<b class="nc">&nbsp;        GameTurn turn = clientgui.getClient().getMyTurn();</b>
&nbsp;        // There&#39;s special processing for countering break grapple.
<b class="nc">&nbsp;        if (turn instanceof GameTurn.CounterGrappleTurn) {</b>
<b class="nc">&nbsp;            disableButtons();</b>
<b class="nc">&nbsp;            selectEntity(((GameTurn.CounterGrappleTurn) turn).getEntityNum());</b>
<b class="nc">&nbsp;            grapple(true);</b>
<b class="nc">&nbsp;            ready();</b>
&nbsp;        } else {
<b class="nc">&nbsp;            target(null);</b>
<b class="nc">&nbsp;            selectEntity(clientgui.getClient().getFirstEntityNum());</b>
<b class="nc">&nbsp;            setNextEnabled(true);</b>
<b class="nc">&nbsp;            butDone.setEnabled(true);</b>
<b class="nc">&nbsp;            if (numButtonGroups &gt; 1)</b>
<b class="nc">&nbsp;                buttons.get(PhysicalCommand.PHYSICAL_MORE).setEnabled(true);</b>
&nbsp;        }
<b class="nc">&nbsp;        clientgui.getBoardView().select(null);</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Does end turn stuff.
&nbsp;     */
&nbsp;    private void endMyTurn() {
&nbsp;        // end my turn, then.
<b class="nc">&nbsp;        Entity next = clientgui.getClient().getGame()</b>
<b class="nc">&nbsp;                .getNextEntity(clientgui.getClient().getGame().getTurnIndex());</b>
<b class="nc">&nbsp;        if ((IGame.Phase.PHASE_PHYSICAL == clientgui.getClient().getGame()</b>
<b class="nc">&nbsp;                .getPhase())</b>
&nbsp;            &amp;&amp; (null != next)
<b class="nc">&nbsp;            &amp;&amp; (null != ce())</b>
<b class="nc">&nbsp;            &amp;&amp; (next.getOwnerId() != ce().getOwnerId())) {</b>
<b class="nc">&nbsp;            clientgui.setDisplayVisible(false);</b>
&nbsp;        }
<b class="nc">&nbsp;        cen = Entity.NONE;</b>
<b class="nc">&nbsp;        target(null);</b>
<b class="nc">&nbsp;        clientgui.getBoardView().select(null);</b>
<b class="nc">&nbsp;        clientgui.getBoardView().highlight(null);</b>
<b class="nc">&nbsp;        clientgui.getBoardView().cursor(null);</b>
<b class="nc">&nbsp;        clientgui.bv.clearMovementData();</b>
<b class="nc">&nbsp;        clientgui.setSelectedEntityNum(Entity.NONE);</b>
<b class="nc">&nbsp;        disableButtons();</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Disables all buttons in the interface
&nbsp;     */
&nbsp;    private void disableButtons() {
<b class="nc">&nbsp;        setKickEnabled(false);</b>
<b class="nc">&nbsp;        setPunchEnabled(false);</b>
<b class="nc">&nbsp;        setPushEnabled(false);</b>
<b class="nc">&nbsp;        setTripEnabled(false);</b>
<b class="nc">&nbsp;        setGrappleEnabled(false);</b>
<b class="nc">&nbsp;        setJumpJetEnabled(false);</b>
<b class="nc">&nbsp;        setClubEnabled(false);</b>
<b class="nc">&nbsp;        setBrushOffEnabled(false);</b>
<b class="nc">&nbsp;        setThrashEnabled(false);</b>
<b class="nc">&nbsp;        setDodgeEnabled(false);</b>
<b class="nc">&nbsp;        setProtoEnabled(false);</b>
<b class="nc">&nbsp;        setVibroEnabled(false);</b>
<b class="nc">&nbsp;        setExplosivesEnabled(false);</b>
<b class="nc">&nbsp;        butDone.setEnabled(false);</b>
<b class="nc">&nbsp;        setNextEnabled(false);</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Called when the current entity is done with physical attacks.
&nbsp;     */
&nbsp;    @Override
&nbsp;    public void ready() {
<b class="nc">&nbsp;        if (attacks.isEmpty()</b>
<b class="nc">&nbsp;                &amp;&amp; GUIPreferences.getInstance().getNagForNoAction()) {</b>
&nbsp;            // comfirm this action
<b class="nc">&nbsp;            ConfirmDialog response = clientgui</b>
<b class="nc">&nbsp;                    .doYesNoBotherDialog(</b>
<b class="nc">&nbsp;                            Messages.getString(&quot;PhysicalDisplay.DontPhysicalAttackDialog.title&quot;), //$NON-NLS-1$</b>
<b class="nc">&nbsp;                            Messages.getString(&quot;PhysicalDisplay.DontPhysicalAttackDialog.message&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;            if (!response.getShowAgain()) {</b>
<b class="nc">&nbsp;                GUIPreferences.getInstance().setNagForNoAction(false);</b>
&nbsp;            }
<b class="nc">&nbsp;            if (!response.getAnswer()) {</b>
&nbsp;                return;
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        disableButtons();</b>
<b class="nc">&nbsp;        clientgui.getClient().sendAttackData(cen, attacks);</b>
<b class="nc">&nbsp;        attacks.removeAllElements();</b>
&nbsp;        // close aimed shot display, if any
<b class="nc">&nbsp;        ash.closeDialog();</b>
<b class="nc">&nbsp;        if (ce().isWeapOrderChanged()) {</b>
<b class="nc">&nbsp;            clientgui.getClient().sendEntityWeaponOrderUpdate(ce());</b>
&nbsp;        }
<b class="nc">&nbsp;        endMyTurn();</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Clears all current actions
&nbsp;     */
&nbsp;    @Override
&nbsp;    public void clear() {
<b class="nc">&nbsp;        if (attacks.size() &gt; 0) {</b>
<b class="nc">&nbsp;            attacks.removeAllElements();</b>
&nbsp;        }
<b class="nc">&nbsp;        if (ce() != null) {</b>
<b class="nc">&nbsp;            clientgui.mechD.wPan.displayMech(ce());</b>
&nbsp;        }
<b class="nc">&nbsp;        updateTarget();</b>
&nbsp;
<b class="nc">&nbsp;        Entity entity = clientgui.getClient().getGame().getEntity(cen);</b>
<b class="nc">&nbsp;        entity.dodging = true;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Punch the target!
&nbsp;     */
&nbsp;    void punch() {
<b class="nc">&nbsp;        if (ce() == null) {</b>
&nbsp;            return;
&nbsp;        }
<b class="nc">&nbsp;        final Entity en = ce();</b>
<b class="nc">&nbsp;        final boolean isAptPiloting = (en.getCrew() != null)</b>
<b class="nc">&nbsp;                &amp;&amp; en.hasAbility(OptionsConstants.PILOT_APTITUDE_PILOTING);</b>
<b class="nc">&nbsp;        final boolean canZweihander = null != en</b>
&nbsp;                &amp;&amp; (en instanceof BipedMech) 
<b class="nc">&nbsp;                &amp;&amp; ((BipedMech)en).canZweihander()</b>
<b class="nc">&nbsp;                &amp;&amp; Compute.isInArc(en.getPosition(), en.getSecondaryFacing(), target, en.getForwardArc());;</b>
<b class="nc">&nbsp;        final boolean isMeleeMaster = (en.getCrew() != null)</b>
<b class="nc">&nbsp;                &amp;&amp; en.hasAbility(OptionsConstants.PILOT_MELEE_MASTER);</b>
&nbsp;        
&nbsp;              
<b class="nc">&nbsp;        final ToHitData leftArm = PunchAttackAction.toHit(clientgui.getClient()</b>
<b class="nc">&nbsp;                .getGame(), cen, target, PunchAttackAction.LEFT, false);</b>
<b class="nc">&nbsp;        final ToHitData rightArm = PunchAttackAction.toHit(clientgui</b>
<b class="nc">&nbsp;                .getClient().getGame(), cen, target, PunchAttackAction.RIGHT, false);</b>
&nbsp;        
<b class="nc">&nbsp;        final double punchOddsRight = Compute.oddsAbove(rightArm.getValue(),</b>
&nbsp;                isAptPiloting);
<b class="nc">&nbsp;        final int punchDmgRight = PunchAttackAction.getDamageFor(en,</b>
&nbsp;                PunchAttackAction.RIGHT, (target instanceof Infantry)
&nbsp;                        &amp;&amp; !(target instanceof BattleArmor), false);
&nbsp;        
<b class="nc">&nbsp;        final double punchOddsLeft = Compute.oddsAbove(leftArm.getValue(),</b>
&nbsp;                isAptPiloting);
<b class="nc">&nbsp;        final int punchDmgLeft = PunchAttackAction.getDamageFor(en,</b>
&nbsp;                PunchAttackAction.LEFT, (target instanceof Infantry)
&nbsp;                        &amp;&amp; !(target instanceof BattleArmor), false);
&nbsp;        
<b class="nc">&nbsp;        String title = Messages.getString(&quot;PhysicalDisplay.PunchDialog.title&quot;, //$NON-NLS-1$</b>
<b class="nc">&nbsp;                new Object[] { target.getDisplayName() }); </b>
<b class="nc">&nbsp;        String message = Messages</b>
<b class="nc">&nbsp;                .getString(&quot;PhysicalDisplay.PunchDialog.message&quot;, //$NON-NLS-1$ </b>
&nbsp;                        new Object[] {
<b class="nc">&nbsp;                                rightArm.getValueAsString(),</b>
<b class="nc">&nbsp;                                punchOddsRight,</b>
<b class="nc">&nbsp;                                rightArm.getDesc(),</b>
<b class="nc">&nbsp;                                punchDmgRight,</b>
<b class="nc">&nbsp;                                rightArm.getTableDesc(),</b>
<b class="nc">&nbsp;                                leftArm.getValueAsString(),</b>
<b class="nc">&nbsp;                                punchOddsLeft,</b>
<b class="nc">&nbsp;                                leftArm.getDesc(),</b>
<b class="nc">&nbsp;                                punchDmgLeft,</b>
<b class="nc">&nbsp;                                leftArm.getTableDesc() });</b>
<b class="nc">&nbsp;        if (isMeleeMaster) {</b>
<b class="nc">&nbsp;            message = Messages.getString(&quot;PhysicalDisplay.MeleeMaster&quot;) + &quot;\n\n&quot;</b>
&nbsp;                    + message;
&nbsp;        }
<b class="nc">&nbsp;        if (clientgui.doYesNoDialog(title, message)) {</b>
&nbsp;            // check for retractable blade that can be extended in each arm
<b class="nc">&nbsp;            boolean leftBladeExtend = false;</b>
<b class="nc">&nbsp;            boolean rightBladeExtend = false;</b>
<b class="nc">&nbsp;            if ((en instanceof Mech)</b>
&nbsp;                    &amp;&amp; (target instanceof Entity)
<b class="nc">&nbsp;                    &amp;&amp; clientgui.getClient().getGame().getOptions()</b>
<b class="nc">&nbsp;                            .booleanOption(OptionsConstants.ADVCOMBAT_TACOPS_RETRACTABLE_BLADES)</b>
<b class="nc">&nbsp;                    &amp;&amp; (leftArm.getValue() != TargetRoll.IMPOSSIBLE)</b>
<b class="nc">&nbsp;                    &amp;&amp; ((Mech) ce()).hasRetractedBlade(Mech.LOC_LARM)) {</b>
<b class="nc">&nbsp;                leftBladeExtend = clientgui.doYesNoDialog(Messages</b>
<b class="nc">&nbsp;                        .getString(&quot;PhysicalDisplay.ExtendBladeDialog.title&quot;),</b>
<b class="nc">&nbsp;                        Messages.getString(</b>
&nbsp;                                &quot;PhysicalDisplay.ExtendBladeDialog.message&quot;,
<b class="nc">&nbsp;                                new Object[] { ce().getLocationName(</b>
&nbsp;                                        Mech.LOC_LARM) }));
&nbsp;            }
<b class="nc">&nbsp;            if ((en instanceof Mech)</b>
&nbsp;                    &amp;&amp; (target instanceof Entity)
<b class="nc">&nbsp;                    &amp;&amp; (rightArm.getValue() != TargetRoll.IMPOSSIBLE)</b>
<b class="nc">&nbsp;                    &amp;&amp; clientgui.getClient().getGame().getOptions()</b>
<b class="nc">&nbsp;                            .booleanOption(OptionsConstants.ADVCOMBAT_TACOPS_RETRACTABLE_BLADES)</b>
<b class="nc">&nbsp;                    &amp;&amp; ((Mech) en).hasRetractedBlade(Mech.LOC_RARM)) {</b>
<b class="nc">&nbsp;                rightBladeExtend = clientgui.doYesNoDialog(Messages</b>
<b class="nc">&nbsp;                        .getString(&quot;PhysicalDisplay.ExtendBladeDialog&quot;</b>
<b class="nc">&nbsp;                                + &quot;.title&quot;), Messages.getString(</b>
&nbsp;                        &quot;PhysicalDisplay.ExtendBladeDialog.message&quot;,
<b class="nc">&nbsp;                        new Object[] { en.getLocationName(Mech.LOC_RARM) }));</b>
&nbsp;            }
&nbsp;            
<b class="nc">&nbsp;            boolean zweihandering = false;</b>
<b class="nc">&nbsp;            int armChosenZwei = PunchAttackAction.RIGHT;</b>
<b class="nc">&nbsp;            if(canZweihander) {</b>
&nbsp;                
&nbsp;                //need to choose a primary arm. Do it based on highest predicted damage     		
<b class="nc">&nbsp;                ToHitData leftArmZwei = PunchAttackAction.toHit(clientgui.getClient()</b>
<b class="nc">&nbsp;                        .getGame(), cen, target, PunchAttackAction.LEFT, true);</b>
<b class="nc">&nbsp;                ToHitData rightArmZwei = PunchAttackAction.toHit(clientgui</b>
<b class="nc">&nbsp;                        .getClient().getGame(), cen, target, PunchAttackAction.RIGHT, true);</b>
<b class="nc">&nbsp;                int damageRightZwei = PunchAttackAction.getDamageFor(en,</b>
&nbsp;                        PunchAttackAction.RIGHT, (target instanceof Infantry)
&nbsp;                                &amp;&amp; !(target instanceof BattleArmor), true);
<b class="nc">&nbsp;                int damageLeftZwei = PunchAttackAction.getDamageFor(en,</b>
&nbsp;                        PunchAttackAction.LEFT, (target instanceof Infantry)
&nbsp;                                &amp;&amp; !(target instanceof BattleArmor), true);
<b class="nc">&nbsp;                double oddsLeft = Compute.oddsAbove(leftArmZwei.getValue(), isAptPiloting);</b>
<b class="nc">&nbsp;                double oddsRight = Compute.oddsAbove(rightArmZwei.getValue(), isAptPiloting);</b>
<b class="nc">&nbsp;                ToHitData toHitZwei = rightArmZwei;</b>
<b class="nc">&nbsp;                int damageZwei = damageRightZwei;</b>
<b class="nc">&nbsp;                double oddsZwei = oddsRight;</b>
<b class="nc">&nbsp;                if ((oddsLeft * damageLeftZwei) &gt; (oddsRight * damageRightZwei)) {</b>
<b class="nc">&nbsp;                    toHitZwei = leftArmZwei;</b>
<b class="nc">&nbsp;                    damageZwei = damageLeftZwei;</b>
<b class="nc">&nbsp;                    oddsZwei = oddsLeft;</b>
<b class="nc">&nbsp;                    armChosenZwei = PunchAttackAction.LEFT;</b>
&nbsp;                } 
&nbsp;                              
<b class="nc">&nbsp;                zweihandering = clientgui.doYesNoDialog(Messages</b>
<b class="nc">&nbsp;                        .getString(&quot;PhysicalDisplay.ZweihanderPunchDialog.title&quot;),</b>
<b class="nc">&nbsp;                        Messages.getString(&quot;PhysicalDisplay.ZweihanderPunchDialog.message&quot;,</b>
&nbsp;                            new Object[] { 
<b class="nc">&nbsp;                                    toHitZwei.getValueAsString(),</b>
<b class="nc">&nbsp;                                    oddsZwei,</b>
<b class="nc">&nbsp;                                    toHitZwei.getDesc(),</b>
<b class="nc">&nbsp;                                    damageZwei,</b>
<b class="nc">&nbsp;                                    toHitZwei.getTableDesc()}));</b>
&nbsp;            }
&nbsp;            
<b class="nc">&nbsp;            if(zweihandering) {</b>
<b class="nc">&nbsp;                if(armChosenZwei==PunchAttackAction.LEFT) {</b>
<b class="nc">&nbsp;                    leftArm.addModifier(TargetRoll.IMPOSSIBLE, &quot;zweihandering with other arm&quot;);</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    rightArm.addModifier(TargetRoll.IMPOSSIBLE, &quot;zweihandering with other arm&quot;);</b>
&nbsp;                }
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            disableButtons();</b>
&nbsp;            // declare searchlight, if possible
<b class="nc">&nbsp;            if (GUIPreferences.getInstance().getAutoDeclareSearchlight()) {</b>
<b class="nc">&nbsp;                doSearchlight();</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if ((leftArm.getValue() != TargetRoll.IMPOSSIBLE)</b>
<b class="nc">&nbsp;                    &amp;&amp; (rightArm.getValue() != TargetRoll.IMPOSSIBLE)) {</b>
<b class="nc">&nbsp;                attacks.addElement(new PunchAttackAction(cen, target</b>
<b class="nc">&nbsp;                        .getTargetType(), target.getTargetId(),</b>
&nbsp;                        PunchAttackAction.BOTH, leftBladeExtend,
&nbsp;                        rightBladeExtend, zweihandering));
<b class="nc">&nbsp;                if (isMeleeMaster &amp;&amp; !zweihandering) {</b>
&nbsp;                    // hit &#39;em again!
<b class="nc">&nbsp;                    attacks.addElement(new PunchAttackAction(cen, target</b>
<b class="nc">&nbsp;                            .getTargetType(), target.getTargetId(),</b>
&nbsp;                            PunchAttackAction.BOTH, leftBladeExtend,
&nbsp;                            rightBladeExtend, zweihandering));
&nbsp;                }
<b class="nc">&nbsp;            } else if (leftArm.getValue() &lt; rightArm.getValue()) {</b>
<b class="nc">&nbsp;                attacks.addElement(new PunchAttackAction(cen, target</b>
<b class="nc">&nbsp;                        .getTargetType(), target.getTargetId(),</b>
&nbsp;                        PunchAttackAction.LEFT, leftBladeExtend,
&nbsp;                        rightBladeExtend, zweihandering));
<b class="nc">&nbsp;                if (isMeleeMaster  &amp;&amp; !zweihandering) {</b>
&nbsp;                    // hit &#39;em again!
<b class="nc">&nbsp;                    attacks.addElement(new PunchAttackAction(cen, target</b>
<b class="nc">&nbsp;                            .getTargetType(), target.getTargetId(),</b>
&nbsp;                            PunchAttackAction.LEFT, leftBladeExtend,
&nbsp;                            rightBladeExtend, zweihandering));
&nbsp;                }
&nbsp;            } else {
<b class="nc">&nbsp;                attacks.addElement(new PunchAttackAction(cen, target</b>
<b class="nc">&nbsp;                        .getTargetType(), target.getTargetId(),</b>
&nbsp;                        PunchAttackAction.RIGHT, leftBladeExtend,
&nbsp;                        rightBladeExtend, zweihandering));
<b class="nc">&nbsp;                if (isMeleeMaster &amp;&amp; !zweihandering) {</b>
&nbsp;                    // hit &#39;em again!
<b class="nc">&nbsp;                    attacks.addElement(new PunchAttackAction(cen, target</b>
<b class="nc">&nbsp;                            .getTargetType(), target.getTargetId(),</b>
&nbsp;                            PunchAttackAction.RIGHT, leftBladeExtend,
&nbsp;                            rightBladeExtend, zweihandering));
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            ready();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void doSearchlight() {
&nbsp;        // validate
<b class="nc">&nbsp;        if ((ce() == null) || (target == null)) {</b>
<b class="nc">&nbsp;            throw new IllegalArgumentException(</b>
&nbsp;                    &quot;current searchlight parameters are invalid&quot;); //$NON-NLS-1$
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (!SearchlightAttackAction.isPossible(clientgui.getClient().getGame(),</b>
&nbsp;                                                cen, target, null)) {
&nbsp;            return;
&nbsp;        }
&nbsp;
&nbsp;        // create and queue a searchlight action
<b class="nc">&nbsp;        SearchlightAttackAction saa = new SearchlightAttackAction(cen, target</b>
<b class="nc">&nbsp;                .getTargetType(), target.getTargetId());</b>
<b class="nc">&nbsp;        attacks.addElement(saa);</b>
&nbsp;
&nbsp;        // and add it into the game, temporarily
<b class="nc">&nbsp;        clientgui.getClient().getGame().addAction(saa);</b>
<b class="nc">&nbsp;        clientgui.bv.addAttack(saa);</b>
<b class="nc">&nbsp;        clientgui.minimap.drawMap();</b>
&nbsp;
&nbsp;        // and prevent duplicates
<b class="nc">&nbsp;        setSearchlightEnabled(false);</b>
&nbsp;
&nbsp;        // refresh weapon panel, as bth will have changed
<b class="nc">&nbsp;        updateTarget();</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Kick the target!
&nbsp;     */
&nbsp;    void kick() {
<b class="nc">&nbsp;        if (ce() == null) {</b>
&nbsp;            return;
&nbsp;        }
<b class="nc">&nbsp;        final Entity en = ce();</b>
<b class="nc">&nbsp;        final boolean isAptPiloting = (en.getCrew() != null)</b>
<b class="nc">&nbsp;                &amp;&amp; en.hasAbility(OptionsConstants.PILOT_APTITUDE_PILOTING);</b>
<b class="nc">&nbsp;        final boolean isMeleeMaster = (en.getCrew() != null)</b>
<b class="nc">&nbsp;                &amp;&amp; en.hasAbility(OptionsConstants.PILOT_MELEE_MASTER);</b>
&nbsp;        
<b class="nc">&nbsp;        ToHitData leftLeg = KickAttackAction.toHit(clientgui.getClient()</b>
<b class="nc">&nbsp;                .getGame(), cen, target, KickAttackAction.LEFT);</b>
<b class="nc">&nbsp;        ToHitData rightLeg = KickAttackAction.toHit(clientgui.getClient()</b>
<b class="nc">&nbsp;                .getGame(), cen, target, KickAttackAction.RIGHT);</b>
<b class="nc">&nbsp;        ToHitData rightRearLeg = null;</b>
<b class="nc">&nbsp;        ToHitData leftRearLeg = null;</b>
&nbsp;
&nbsp;        ToHitData attackLeg;
<b class="nc">&nbsp;        int attackSide = KickAttackAction.LEFT;</b>
<b class="nc">&nbsp;        int value = leftLeg.getValue();</b>
<b class="nc">&nbsp;        attackLeg = leftLeg;</b>
&nbsp;
<b class="nc">&nbsp;        if (value &gt; rightLeg.getValue()) {</b>
<b class="nc">&nbsp;            value = rightLeg.getValue();</b>
<b class="nc">&nbsp;            attackSide = KickAttackAction.RIGHT;</b>
<b class="nc">&nbsp;            attackLeg = rightLeg;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (clientgui.getClient().getGame().getEntity(cen) instanceof QuadMech) {</b>
<b class="nc">&nbsp;            rightRearLeg = KickAttackAction.toHit(clientgui.getClient()</b>
<b class="nc">&nbsp;                    .getGame(), cen, target, KickAttackAction.RIGHTMULE);</b>
<b class="nc">&nbsp;            leftRearLeg = KickAttackAction.toHit(clientgui.getClient()</b>
<b class="nc">&nbsp;                    .getGame(), cen, target, KickAttackAction.LEFTMULE);</b>
<b class="nc">&nbsp;            if (value &gt; rightRearLeg.getValue()) {</b>
<b class="nc">&nbsp;                value = rightRearLeg.getValue();</b>
<b class="nc">&nbsp;                attackSide = KickAttackAction.RIGHTMULE;</b>
<b class="nc">&nbsp;                attackLeg = rightRearLeg;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (value &gt; leftRearLeg.getValue()) {</b>
<b class="nc">&nbsp;                value = leftRearLeg.getValue();</b>
<b class="nc">&nbsp;                attackSide = KickAttackAction.LEFTMULE;</b>
<b class="nc">&nbsp;                attackLeg = leftRearLeg;</b>
&nbsp;            }
&nbsp;        }
&nbsp;        
<b class="nc">&nbsp;        final double kickOdds = Compute.oddsAbove(attackLeg.getValue(),</b>
&nbsp;                isAptPiloting);
<b class="nc">&nbsp;        final int kickDmg = KickAttackAction.getDamageFor(en, attackSide,</b>
&nbsp;                (target instanceof Infantry)
&nbsp;                        &amp;&amp; !(target instanceof BattleArmor));
&nbsp;        
<b class="nc">&nbsp;        String title = Messages.getString(&quot;PhysicalDisplay.KickDialog.title&quot;, //$NON-NLS-1$ </b>
<b class="nc">&nbsp;                new Object[]{target.getDisplayName()});</b>
<b class="nc">&nbsp;        String message = Messages</b>
<b class="nc">&nbsp;                .getString(&quot;PhysicalDisplay.KickDialog.message&quot;, //$NON-NLS-1$ </b>
&nbsp;                        new Object[] {
<b class="nc">&nbsp;                                attackLeg.getValueAsString(),</b>
<b class="nc">&nbsp;                                kickOdds,</b>
<b class="nc">&nbsp;                                attackLeg.getDesc(),</b>
<b class="nc">&nbsp;                                kickDmg,</b>
<b class="nc">&nbsp;                                attackLeg.getTableDesc() });</b>
&nbsp;        
<b class="nc">&nbsp;        if (isMeleeMaster) {</b>
<b class="nc">&nbsp;            message = Messages.getString(&quot;PhysicalDisplay.MeleeMaster&quot;) + &quot;\n\n&quot;</b>
&nbsp;                    + message;
&nbsp;        }
&nbsp;        
<b class="nc">&nbsp;        if (clientgui.doYesNoDialog(title, message)) {</b>
<b class="nc">&nbsp;            disableButtons();</b>
&nbsp;            // declare searchlight, if possible
<b class="nc">&nbsp;            if (GUIPreferences.getInstance().getAutoDeclareSearchlight()) {</b>
<b class="nc">&nbsp;                doSearchlight();</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            attacks.addElement(new KickAttackAction(cen,</b>
<b class="nc">&nbsp;                    target.getTargetType(), target.getTargetId(), attackSide));</b>
<b class="nc">&nbsp;            if (isMeleeMaster) {</b>
&nbsp;                // hit &#39;em again!
<b class="nc">&nbsp;                attacks.addElement(new KickAttackAction(cen, target</b>
<b class="nc">&nbsp;                        .getTargetType(), target.getTargetId(), attackSide));</b>
&nbsp;            }
<b class="nc">&nbsp;            ready();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Push that target!
&nbsp;     */
&nbsp;    void push() {
<b class="nc">&nbsp;        ToHitData toHit = PushAttackAction.toHit(clientgui.getClient()</b>
<b class="nc">&nbsp;                .getGame(), cen, target);</b>
<b class="nc">&nbsp;        String title = Messages</b>
<b class="nc">&nbsp;                .getString(</b>
<b class="nc">&nbsp;                        &quot;PhysicalDisplay.PushDialog.title&quot;, new Object[] { target.getDisplayName() }); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        String message = Messages</b>
<b class="nc">&nbsp;                .getString(</b>
&nbsp;                        &quot;PhysicalDisplay.PushDialog.message&quot;, new Object[] {//$NON-NLS-1$
<b class="nc">&nbsp;                                toHit.getValueAsString(),</b>
<b class="nc">&nbsp;                                Double.valueOf(</b>
<b class="nc">&nbsp;                                        Compute.oddsAbove(</b>
<b class="nc">&nbsp;                                                toHit.getValue(),</b>
<b class="nc">&nbsp;                                                ce().hasAbility(OptionsConstants.PILOT_APTITUDE_PILOTING))),</b>
<b class="nc">&nbsp;                                toHit.getDesc() });</b>
<b class="nc">&nbsp;        if (clientgui.doYesNoDialog(title, message)) {</b>
<b class="nc">&nbsp;            disableButtons();</b>
&nbsp;            // declare searchlight, if possible
<b class="nc">&nbsp;            if (GUIPreferences.getInstance().getAutoDeclareSearchlight()) {</b>
<b class="nc">&nbsp;                doSearchlight();</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            attacks.addElement(new PushAttackAction(cen,</b>
<b class="nc">&nbsp;                    target.getTargetType(), target.getTargetId(), target</b>
<b class="nc">&nbsp;                            .getPosition()));</b>
<b class="nc">&nbsp;            ready();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Trip that target!
&nbsp;     */
&nbsp;    void trip() {
<b class="nc">&nbsp;        ToHitData toHit = TripAttackAction.toHit(clientgui.getClient()</b>
<b class="nc">&nbsp;                .getGame(), cen, target);</b>
<b class="nc">&nbsp;        String title = Messages</b>
<b class="nc">&nbsp;                .getString(</b>
<b class="nc">&nbsp;                        &quot;PhysicalDisplay.TripDialog.title&quot;, new Object[] { target.getDisplayName() }); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        String message = Messages</b>
<b class="nc">&nbsp;                .getString(</b>
&nbsp;                        &quot;PhysicalDisplay.TripDialog.message&quot;, new Object[] { //$NON-NLS-1$
<b class="nc">&nbsp;                                toHit.getValueAsString(),</b>
<b class="nc">&nbsp;                                Double.valueOf(</b>
<b class="nc">&nbsp;                                        Compute.oddsAbove(</b>
<b class="nc">&nbsp;                                                toHit.getValue(),</b>
<b class="nc">&nbsp;                                                ce().hasAbility(OptionsConstants.PILOT_APTITUDE_PILOTING))),</b>
<b class="nc">&nbsp;                                toHit.getDesc() });</b>
<b class="nc">&nbsp;        if (clientgui.doYesNoDialog(title, message)) {</b>
<b class="nc">&nbsp;            disableButtons();</b>
&nbsp;            // declare searchlight, if possible
<b class="nc">&nbsp;            if (GUIPreferences.getInstance().getAutoDeclareSearchlight()) {</b>
<b class="nc">&nbsp;                doSearchlight();</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            attacks.addElement(new TripAttackAction(cen,</b>
<b class="nc">&nbsp;                    target.getTargetType(), target.getTargetId()));</b>
<b class="nc">&nbsp;            ready();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Grapple that target!
&nbsp;     */
&nbsp;    void doGrapple() {
<b class="nc">&nbsp;        if (((Mech) ce()).getGrappled() == Entity.NONE) {</b>
<b class="nc">&nbsp;            grapple(false);</b>
&nbsp;        } else {
<b class="nc">&nbsp;            breakGrapple();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void grapple(boolean counter) {
<b class="nc">&nbsp;        ToHitData toHit = GrappleAttackAction.toHit(clientgui.getClient()</b>
<b class="nc">&nbsp;                .getGame(), cen, target);</b>
<b class="nc">&nbsp;        String title = Messages</b>
<b class="nc">&nbsp;                .getString(</b>
<b class="nc">&nbsp;                        &quot;PhysicalDisplay.GrappleDialog.title&quot;, new Object[] { target.getDisplayName() }); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        String message = Messages</b>
<b class="nc">&nbsp;                .getString(</b>
&nbsp;                        &quot;PhysicalDisplay.GrappleDialog.message&quot;, new Object[] { //$NON-NLS-1$
<b class="nc">&nbsp;                                toHit.getValueAsString(),</b>
<b class="nc">&nbsp;                                Double.valueOf(</b>
<b class="nc">&nbsp;                                        Compute.oddsAbove(</b>
<b class="nc">&nbsp;                                                toHit.getValue(),</b>
<b class="nc">&nbsp;                                                ce().hasAbility(OptionsConstants.PILOT_APTITUDE_PILOTING))),</b>
<b class="nc">&nbsp;                                toHit.getDesc() });</b>
<b class="nc">&nbsp;        if (counter) {</b>
<b class="nc">&nbsp;            message = Messages</b>
<b class="nc">&nbsp;                    .getString(</b>
&nbsp;                            &quot;PhysicalDisplay.CounterGrappleDialog.message&quot;, new Object[] { //$NON-NLS-1$
<b class="nc">&nbsp;                                    target.getDisplayName(),</b>
<b class="nc">&nbsp;                                    toHit.getValueAsString(),</b>
<b class="nc">&nbsp;                                    Double.valueOf(</b>
<b class="nc">&nbsp;                                            Compute.oddsAbove(</b>
<b class="nc">&nbsp;                                                    toHit.getValue(),</b>
<b class="nc">&nbsp;                                                    ce().hasAbility(OptionsConstants.PILOT_APTITUDE_PILOTING))),</b>
<b class="nc">&nbsp;                                    toHit.getDesc() });</b>
&nbsp;        }
<b class="nc">&nbsp;        if (clientgui.doYesNoDialog(title, message)) {</b>
<b class="nc">&nbsp;            disableButtons();</b>
&nbsp;            // declare searchlight, if possible
<b class="nc">&nbsp;            if (GUIPreferences.getInstance().getAutoDeclareSearchlight()) {</b>
<b class="nc">&nbsp;                doSearchlight();</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            attacks.addElement(new GrappleAttackAction(cen, target</b>
<b class="nc">&nbsp;                    .getTargetType(), target.getTargetId()));</b>
<b class="nc">&nbsp;            ready();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void breakGrapple() {
<b class="nc">&nbsp;        ToHitData toHit = BreakGrappleAttackAction.toHit(clientgui.getClient()</b>
<b class="nc">&nbsp;                .getGame(), cen, target);</b>
<b class="nc">&nbsp;        String title = Messages.getString(</b>
&nbsp;                &quot;PhysicalDisplay.BreakGrappleDialog.title&quot;,
<b class="nc">&nbsp;                new Object[] { target.getDisplayName() });</b>
&nbsp;        //$NON-NLS-1$
<b class="nc">&nbsp;        String message = Messages</b>
<b class="nc">&nbsp;                .getString(</b>
&nbsp;                        &quot;PhysicalDisplay.BreakGrappleDialog.message&quot;, new Object[] { //$NON-NLS-1$
<b class="nc">&nbsp;                                toHit.getValueAsString(),</b>
<b class="nc">&nbsp;                                Double.valueOf(</b>
<b class="nc">&nbsp;                                        Compute.oddsAbove(</b>
<b class="nc">&nbsp;                                                toHit.getValue(),</b>
<b class="nc">&nbsp;                                                ce().hasAbility(OptionsConstants.PILOT_APTITUDE_PILOTING))),</b>
<b class="nc">&nbsp;                                toHit.getDesc() });</b>
<b class="nc">&nbsp;        if (clientgui.doYesNoDialog(title, message)) {</b>
<b class="nc">&nbsp;            disableButtons();</b>
&nbsp;            // declare searchlight, if possible
<b class="nc">&nbsp;            if (GUIPreferences.getInstance().getAutoDeclareSearchlight()) {</b>
<b class="nc">&nbsp;                doSearchlight();</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            attacks.addElement(new BreakGrappleAttackAction(cen, target</b>
<b class="nc">&nbsp;                    .getTargetType(), target.getTargetId()));</b>
<b class="nc">&nbsp;            ready();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * slice &#39;em up with your vibroclaws
&nbsp;     */
&nbsp;    public void vibroclawatt() {
<b class="nc">&nbsp;        BAVibroClawAttackAction act = new BAVibroClawAttackAction(cen,</b>
<b class="nc">&nbsp;                target.getTargetType(), target.getTargetId());</b>
<b class="nc">&nbsp;        ToHitData toHit = act.toHit(clientgui.getClient().getGame());</b>
&nbsp;
<b class="nc">&nbsp;        String title = Messages</b>
<b class="nc">&nbsp;                .getString(</b>
<b class="nc">&nbsp;                        &quot;PhysicalDisplay.BAVibroClawDialog.title&quot;, new Object[] { target.getDisplayName() }); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        String message = Messages</b>
<b class="nc">&nbsp;                .getString(</b>
&nbsp;                        &quot;PhysicalDisplay.BAVibroClawDialog.message&quot;, new Object[] {//$NON-NLS-1$
<b class="nc">&nbsp;                                toHit.getValueAsString(),</b>
<b class="nc">&nbsp;                                Double.valueOf(</b>
<b class="nc">&nbsp;                                        Compute.oddsAbove(</b>
<b class="nc">&nbsp;                                                toHit.getValue(),</b>
<b class="nc">&nbsp;                                                ce().hasAbility(OptionsConstants.PILOT_APTITUDE_PILOTING))),</b>
<b class="nc">&nbsp;                                toHit.getDesc(),</b>
<b class="nc">&nbsp;                                ce().getVibroClaws() + toHit.getTableDesc() });</b>
&nbsp;
&nbsp;        // Give the user to cancel the attack.
<b class="nc">&nbsp;        if (clientgui.doYesNoDialog(title, message)) {</b>
<b class="nc">&nbsp;            disableButtons();</b>
<b class="nc">&nbsp;            attacks.addElement(act);</b>
<b class="nc">&nbsp;            ready();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    void jumpjetatt() {
&nbsp;        ToHitData toHit;
&nbsp;        int leg;
&nbsp;        int damage;
<b class="nc">&nbsp;        if (ce().isProne()) {</b>
<b class="nc">&nbsp;            toHit = JumpJetAttackAction.toHit(clientgui.getClient().getGame(),</b>
&nbsp;                    cen, target, JumpJetAttackAction.BOTH);
<b class="nc">&nbsp;            leg = JumpJetAttackAction.BOTH;</b>
<b class="nc">&nbsp;            damage = JumpJetAttackAction.getDamageFor(ce(),</b>
&nbsp;                    JumpJetAttackAction.BOTH);
&nbsp;        } else {
<b class="nc">&nbsp;            ToHitData left = JumpJetAttackAction.toHit(clientgui.getClient()</b>
<b class="nc">&nbsp;                    .getGame(), cen, target, JumpJetAttackAction.LEFT);</b>
<b class="nc">&nbsp;            ToHitData right = JumpJetAttackAction.toHit(clientgui.getClient()</b>
<b class="nc">&nbsp;                    .getGame(), cen, target, JumpJetAttackAction.RIGHT);</b>
<b class="nc">&nbsp;            int d_left = JumpJetAttackAction.getDamageFor(ce(),</b>
&nbsp;                    JumpJetAttackAction.LEFT);
<b class="nc">&nbsp;            int d_right = JumpJetAttackAction.getDamageFor(ce(),</b>
&nbsp;                    JumpJetAttackAction.RIGHT);
<b class="nc">&nbsp;            if ((d_left * Compute.oddsAbove(</b>
<b class="nc">&nbsp;                    left.getValue(),</b>
<b class="nc">&nbsp;                    ce().hasAbility(OptionsConstants.PILOT_APTITUDE_PILOTING))) &gt; (d_right * Compute</b>
<b class="nc">&nbsp;                    .oddsAbove(</b>
<b class="nc">&nbsp;                            right.getValue(),</b>
<b class="nc">&nbsp;                            ce().hasAbility(OptionsConstants.PILOT_APTITUDE_PILOTING)))) {</b>
<b class="nc">&nbsp;                toHit = left;</b>
<b class="nc">&nbsp;                leg = JumpJetAttackAction.LEFT;</b>
<b class="nc">&nbsp;                damage = d_left;</b>
&nbsp;            } else {
<b class="nc">&nbsp;                toHit = right;</b>
<b class="nc">&nbsp;                leg = JumpJetAttackAction.RIGHT;</b>
<b class="nc">&nbsp;                damage = d_right;</b>
&nbsp;            }
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        String title = Messages</b>
<b class="nc">&nbsp;                .getString(</b>
<b class="nc">&nbsp;                        &quot;PhysicalDisplay.JumpJetDialog.title&quot;, new Object[] { target.getDisplayName() }); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        String message = Messages</b>
<b class="nc">&nbsp;                .getString(</b>
&nbsp;                        &quot;PhysicalDisplay.JumpJetDialog.message&quot;, new Object[] { //$NON-NLS-1$
<b class="nc">&nbsp;                                toHit.getValueAsString(),</b>
<b class="nc">&nbsp;                                Double.valueOf(</b>
<b class="nc">&nbsp;                                        Compute.oddsAbove(</b>
<b class="nc">&nbsp;                                                toHit.getValue(),</b>
<b class="nc">&nbsp;                                                ce().hasAbility(OptionsConstants.PILOT_APTITUDE_PILOTING))),</b>
<b class="nc">&nbsp;                                toHit.getDesc(), damage });</b>
<b class="nc">&nbsp;        if (clientgui.doYesNoDialog(title, message)) {</b>
<b class="nc">&nbsp;            disableButtons();</b>
&nbsp;            // declare searchlight, if possible
<b class="nc">&nbsp;            if (GUIPreferences.getInstance().getAutoDeclareSearchlight()) {</b>
<b class="nc">&nbsp;                doSearchlight();</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            attacks.addElement(new JumpJetAttackAction(cen, target</b>
<b class="nc">&nbsp;                    .getTargetType(), target.getTargetId(), leg));</b>
<b class="nc">&nbsp;            ready();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private Mounted chooseClub() {
<b class="nc">&nbsp;        java.util.List&lt;Mounted&gt; clubs = ce().getClubs();</b>
<b class="nc">&nbsp;        if (clubs.size() == 1) {</b>
<b class="nc">&nbsp;            return clubs.get(0);</b>
<b class="nc">&nbsp;        } else if (clubs.size() &gt; 1) {</b>
<b class="nc">&nbsp;            String[] names = new String[clubs.size()];</b>
<b class="nc">&nbsp;            for (int loop = 0; loop &lt; names.length; loop++) {</b>
<b class="nc">&nbsp;                Mounted club = clubs.get(loop);</b>
<b class="nc">&nbsp;                boolean targetConvInf = (target instanceof Infantry)</b>
&nbsp;                        &amp;&amp; !(target instanceof BattleArmor);
<b class="nc">&nbsp;                final ToHitData toHit = ClubAttackAction.toHit(clientgui</b>
<b class="nc">&nbsp;                        .getClient().getGame(), cen, target, club, ash</b>
<b class="nc">&nbsp;                        .getAimTable(), false);</b>
<b class="nc">&nbsp;                final int dmg = ClubAttackAction.getDamageFor(ce(), club,</b>
&nbsp;                        targetConvInf, false);
&nbsp;                // Need to do this outside getDamageFor, as it only returns int
<b class="nc">&nbsp;                String dmgString = dmg + &quot;&quot;;</b>
<b class="nc">&nbsp;                if ((((MiscType) club.getType()).hasSubType(MiscType.S_COMBINE)</b>
<b class="nc">&nbsp;                        || ((MiscType) club.getType()).hasSubType(MiscType.S_CHAINSAW)</b>
<b class="nc">&nbsp;                        || ((MiscType) club.getType()).hasSubType(MiscType.S_DUAL_SAW))</b>
&nbsp;                        &amp;&amp; targetConvInf) {
<b class="nc">&nbsp;                    dmgString = &quot;1d6&quot;;</b>
&nbsp;                }
<b class="nc">&nbsp;                names[loop] = Messages.getString(</b>
&nbsp;                                &quot;PhysicalDisplay.ChooseClubDialog.line&quot;, //$NON-NLS-1$
<b class="nc">&nbsp;                                new Object[] { club.getName(),</b>
<b class="nc">&nbsp;                                        toHit.getValueAsString(), dmgString });</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            String input = (String) JOptionPane</b>
<b class="nc">&nbsp;                    .showInputDialog(</b>
&nbsp;                            clientgui,
<b class="nc">&nbsp;                            Messages.getString(&quot;PhysicalDisplay.ChooseClubDialog.message&quot;), //$NON-NLS-1$</b>
<b class="nc">&nbsp;                            Messages.getString(&quot;PhysicalDisplay.ChooseClubDialog.title&quot;), //$NON-NLS-1$</b>
&nbsp;                            JOptionPane.QUESTION_MESSAGE, null, names, null);
<b class="nc">&nbsp;            if (input != null) {</b>
<b class="nc">&nbsp;                for (int i = 0; i &lt; clubs.size(); i++) {</b>
<b class="nc">&nbsp;                    if (input.equals(names[i])) {</b>
<b class="nc">&nbsp;                        return clubs.get(i);</b>
&nbsp;                    }
&nbsp;                }
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        return null;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Club that target!
&nbsp;     */
&nbsp;    void club() {
<b class="nc">&nbsp;        Mounted club = chooseClub();</b>
<b class="nc">&nbsp;        club(club);</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Club that target!
&nbsp;     */
&nbsp;    void club(Mounted club) {
<b class="nc">&nbsp;        if (null == club) {</b>
&nbsp;            return;
&nbsp;        }
<b class="nc">&nbsp;        if (ce() == null) {</b>
&nbsp;            return;
&nbsp;        }
<b class="nc">&nbsp;        final Entity en = ce();</b>
&nbsp;        
<b class="nc">&nbsp;        final boolean isAptPiloting = (en.getCrew() != null)</b>
<b class="nc">&nbsp;                &amp;&amp; en.hasAbility(OptionsConstants.PILOT_APTITUDE_PILOTING);</b>
<b class="nc">&nbsp;        final boolean isMeleeMaster = (en.getCrew() != null)</b>
<b class="nc">&nbsp;                &amp;&amp; en.hasAbility(OptionsConstants.PILOT_MELEE_MASTER);</b>
<b class="nc">&nbsp;        final boolean canZweihander = null != en</b>
&nbsp;                &amp;&amp; (en instanceof BipedMech) 
<b class="nc">&nbsp;                &amp;&amp; ((BipedMech)en).canZweihander()</b>
<b class="nc">&nbsp;                &amp;&amp; Compute.isInArc(en.getPosition(), en.getSecondaryFacing(), target, en.getForwardArc());</b>
&nbsp;                
<b class="nc">&nbsp;        final ToHitData toHit = ClubAttackAction.toHit(clientgui.getClient()</b>
<b class="nc">&nbsp;                .getGame(), cen, target, club, ash.getAimTable(), false);</b>
<b class="nc">&nbsp;        boolean targetConvInf = (target instanceof Infantry)</b>
&nbsp;                &amp;&amp; !(target instanceof BattleArmor);
<b class="nc">&nbsp;        final double clubOdds = Compute.oddsAbove(toHit.getValue(),</b>
&nbsp;                isAptPiloting);
<b class="nc">&nbsp;        final int clubDmg = ClubAttackAction.getDamageFor(en, club,</b>
&nbsp;                targetConvInf, false);
&nbsp;        // Need to do this outside getDamageFor, as it only returns int
<b class="nc">&nbsp;        String dmgString = clubDmg + &quot;&quot;;</b>
<b class="nc">&nbsp;        if ((((MiscType) club.getType()).hasSubType(MiscType.S_COMBINE)</b>
<b class="nc">&nbsp;                || ((MiscType) club.getType()).hasSubType(MiscType.S_CHAINSAW)</b>
<b class="nc">&nbsp;                || ((MiscType) club.getType()).hasSubType(MiscType.S_DUAL_SAW))</b>
&nbsp;                &amp;&amp; targetConvInf) {
<b class="nc">&nbsp;            dmgString = &quot;1d6&quot;;</b>
&nbsp;        }
<b class="nc">&nbsp;        String title = Messages.getString(&quot;PhysicalDisplay.ClubDialog.title&quot;, //$NON-NLS-1$ </b>
<b class="nc">&nbsp;                new Object[] { target.getDisplayName() });</b>
<b class="nc">&nbsp;        String message = Messages</b>
<b class="nc">&nbsp;                .getString(&quot;PhysicalDisplay.ClubDialog.message&quot;, //$NON-NLS-1$ </b>
&nbsp;                        new Object[] { 
<b class="nc">&nbsp;                                toHit.getValueAsString(),</b>
<b class="nc">&nbsp;                                clubOdds,</b>
<b class="nc">&nbsp;                                toHit.getDesc(),</b>
&nbsp;                                dmgString,
<b class="nc">&nbsp;                                toHit.getTableDesc() });</b>
&nbsp;        
<b class="nc">&nbsp;        if (isMeleeMaster) {</b>
<b class="nc">&nbsp;            message = Messages.getString(&quot;PhysicalDisplay.MeleeMaster&quot;) + &quot;\n\n&quot;</b>
&nbsp;                    + message;
&nbsp;        }
&nbsp;        
<b class="nc">&nbsp;        if (clientgui.doYesNoDialog(title, message)) {</b>
<b class="nc">&nbsp;            boolean zweihandering = false;</b>
<b class="nc">&nbsp;            if(canZweihander) {</b>
<b class="nc">&nbsp;                ToHitData toHitZwei = ClubAttackAction.toHit(clientgui.getClient()</b>
<b class="nc">&nbsp;                        .getGame(), cen, target, club, ash.getAimTable(), true);</b>
<b class="nc">&nbsp;                zweihandering = clientgui.doYesNoDialog(Messages</b>
<b class="nc">&nbsp;                        .getString(&quot;PhysicalDisplay.ZweihanderClubDialog.title&quot;),</b>
<b class="nc">&nbsp;                        Messages.getString(&quot;PhysicalDisplay.ZweihanderClubDialog.message&quot;,</b>
&nbsp;                                new Object[] { 
<b class="nc">&nbsp;                                        toHitZwei.getValueAsString(),</b>
<b class="nc">&nbsp;                                        Compute.oddsAbove(toHit.getValue(),</b>
&nbsp;                                                isAptPiloting),
<b class="nc">&nbsp;                                        toHitZwei.getDesc(),</b>
<b class="nc">&nbsp;                                        ClubAttackAction.getDamageFor(en, club,</b>
&nbsp;                                                targetConvInf, true),
<b class="nc">&nbsp;                                        toHitZwei.getTableDesc() }));</b>
&nbsp;            }
&nbsp;            
<b class="nc">&nbsp;            disableButtons();</b>
&nbsp;            // declare searchlight, if possible
<b class="nc">&nbsp;            if (GUIPreferences.getInstance().getAutoDeclareSearchlight()) {</b>
<b class="nc">&nbsp;                doSearchlight();</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            attacks.addElement(new ClubAttackAction(cen,</b>
<b class="nc">&nbsp;                    target.getTargetType(), target.getTargetId(), club, ash</b>
<b class="nc">&nbsp;                            .getAimTable(), zweihandering));</b>
<b class="nc">&nbsp;            if (isMeleeMaster &amp;&amp; !zweihandering) {</b>
&nbsp;                // hit &#39;em again!
<b class="nc">&nbsp;                attacks.addElement(new ClubAttackAction(cen, target</b>
<b class="nc">&nbsp;                        .getTargetType(), target.getTargetId(), club, ash</b>
<b class="nc">&nbsp;                        .getAimTable(), zweihandering));</b>
&nbsp;            }
<b class="nc">&nbsp;            ready();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Make a protomech physical attack on the target.
&nbsp;     */
&nbsp;    private void proto() {
<b class="nc">&nbsp;        ToHitData proto = ProtomechPhysicalAttackAction.toHit(clientgui</b>
<b class="nc">&nbsp;                .getClient().getGame(), cen, target);</b>
<b class="nc">&nbsp;        String title = Messages.getString(</b>
&nbsp;                &quot;PhysicalDisplay.ProtoMechAttackDialog.title&quot;,
<b class="nc">&nbsp;                new Object[] { target.getDisplayName() });</b>
&nbsp;        //$NON-NLS-1$
<b class="nc">&nbsp;        String message = Messages</b>
<b class="nc">&nbsp;                .getString(</b>
&nbsp;                        &quot;PhysicalDisplay.ProtoMechAttackDialog.message&quot;, new Object[] {//$NON-NLS-1$
<b class="nc">&nbsp;                                proto.getValueAsString(),</b>
<b class="nc">&nbsp;                                Double.valueOf(</b>
<b class="nc">&nbsp;                                        Compute.oddsAbove(</b>
<b class="nc">&nbsp;                                                proto.getValue(),</b>
<b class="nc">&nbsp;                                                ce().hasAbility(OptionsConstants.PILOT_APTITUDE_PILOTING))),</b>
<b class="nc">&nbsp;                                proto.getDesc(),</b>
<b class="nc">&nbsp;                                ProtomechPhysicalAttackAction.getDamageFor(</b>
<b class="nc">&nbsp;                                        ce(), target) + proto.getTableDesc() });</b>
<b class="nc">&nbsp;        if (clientgui.doYesNoDialog(title, message)) {</b>
<b class="nc">&nbsp;            disableButtons();</b>
&nbsp;            // declare searchlight, if possible
<b class="nc">&nbsp;            if (GUIPreferences.getInstance().getAutoDeclareSearchlight()) {</b>
<b class="nc">&nbsp;                doSearchlight();</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            attacks.addElement(new ProtomechPhysicalAttackAction(cen, target</b>
<b class="nc">&nbsp;                    .getTargetType(), target.getTargetId()));</b>
<b class="nc">&nbsp;            ready();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void explosives() {
<b class="nc">&nbsp;        ToHitData explo = LayExplosivesAttackAction.toHit(clientgui.getClient()</b>
<b class="nc">&nbsp;                .getGame(), cen, target);</b>
<b class="nc">&nbsp;        String title = Messages.getString(</b>
&nbsp;                &quot;PhysicalDisplay.LayExplosivesAttackDialog.title&quot;,
<b class="nc">&nbsp;                new Object[] { target.getDisplayName() });</b>
&nbsp;        //$NON-NLS-1$
<b class="nc">&nbsp;        String message = Messages</b>
<b class="nc">&nbsp;                .getString(</b>
&nbsp;                        &quot;PhysicalDisplay.LayExplosivesAttackDialog.message&quot;, new Object[] {//$NON-NLS-1$
<b class="nc">&nbsp;                                explo.getValueAsString(),</b>
<b class="nc">&nbsp;                                Double.valueOf(Compute.oddsAbove(explo.getValue())),</b>
<b class="nc">&nbsp;                                explo.getDesc() });</b>
<b class="nc">&nbsp;        if (clientgui.doYesNoDialog(title, message)) {</b>
<b class="nc">&nbsp;            disableButtons();</b>
<b class="nc">&nbsp;            attacks.addElement(new LayExplosivesAttackAction(cen, target</b>
<b class="nc">&nbsp;                    .getTargetType(), target.getTargetId()));</b>
<b class="nc">&nbsp;            ready();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Sweep off the target with the arms that the player selects.
&nbsp;     */
&nbsp;    private void brush() {
<b class="nc">&nbsp;        ToHitData toHitLeft = BrushOffAttackAction.toHit(clientgui.getClient()</b>
<b class="nc">&nbsp;                .getGame(), cen, target, BrushOffAttackAction.LEFT);</b>
<b class="nc">&nbsp;        ToHitData toHitRight = BrushOffAttackAction.toHit(clientgui.getClient()</b>
<b class="nc">&nbsp;                .getGame(), cen, target, BrushOffAttackAction.RIGHT);</b>
<b class="nc">&nbsp;        boolean canHitLeft = (TargetRoll.IMPOSSIBLE != toHitLeft.getValue());</b>
<b class="nc">&nbsp;        boolean canHitRight = (TargetRoll.IMPOSSIBLE != toHitRight.getValue());</b>
<b class="nc">&nbsp;        int damageLeft = 0;</b>
<b class="nc">&nbsp;        int damageRight = 0;</b>
<b class="nc">&nbsp;        String title = null;</b>
<b class="nc">&nbsp;        StringBuffer warn = null;</b>
<b class="nc">&nbsp;        String left = null;</b>
<b class="nc">&nbsp;        String right = null;</b>
<b class="nc">&nbsp;        String both = null;</b>
<b class="nc">&nbsp;        String[] choices = null;</b>
&nbsp;
&nbsp;        // If the entity can&#39;t brush off, display an error message and abort.
<b class="nc">&nbsp;        if (!canHitLeft &amp;&amp; !canHitRight) {</b>
<b class="nc">&nbsp;            clientgui.doAlertDialog(</b>
<b class="nc">&nbsp;                    Messages.getString(&quot;PhysicalDisplay.AlertDialog.title&quot;), //$NON-NLS-1$</b>
<b class="nc">&nbsp;                    Messages.getString(&quot;PhysicalDisplay.AlertDialog.message&quot;)); //$NON-NLS-1$</b>
&nbsp;            return;
&nbsp;        }
&nbsp;
&nbsp;        // If we can hit with both arms, the player will have to make a choice.
&nbsp;        // Otherwise, the player is just confirming the arm in the attack.
<b class="nc">&nbsp;        if (canHitLeft &amp;&amp; canHitRight) {</b>
<b class="nc">&nbsp;            both = Messages.getString(&quot;PhysicalDisplay.bothArms&quot;); //$NON-NLS-1$</b>
<b class="nc">&nbsp;            warn = new StringBuffer(</b>
<b class="nc">&nbsp;                    Messages.getString(&quot;PhysicalDisplay.whichArm&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;            title = Messages.getString(&quot;PhysicalDisplay.chooseBrushOff&quot;); //$NON-NLS-1$</b>
&nbsp;        } else {
<b class="nc">&nbsp;            warn = new StringBuffer(</b>
<b class="nc">&nbsp;                    Messages.getString(&quot;PhysicalDisplay.confirmArm&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;            title = Messages.getString(&quot;PhysicalDisplay.confirmBrushOff&quot;); //$NON-NLS-1$</b>
&nbsp;        }
&nbsp;
&nbsp;        // Build the rest of the warning string.
&nbsp;        // Use correct text when the target is an iNarc pod.
<b class="nc">&nbsp;        if (Targetable.TYPE_INARC_POD == target.getTargetType()) {</b>
<b class="nc">&nbsp;            warn.append(Messages.getString(</b>
&nbsp;                    &quot;PhysicalDisplay.brushOff1&quot;, new Object[] { target })); //$NON-NLS-1$
&nbsp;        } else {
<b class="nc">&nbsp;            warn.append(Messages.getString(&quot;PhysicalDisplay.brushOff2&quot;)); //$NON-NLS-1$</b>
&nbsp;        }
&nbsp;
&nbsp;        // If we can hit with the left arm, get
&nbsp;        // the damage and construct the string.
<b class="nc">&nbsp;        if (canHitLeft) {</b>
<b class="nc">&nbsp;            damageLeft = BrushOffAttackAction.getDamageFor(ce(),</b>
&nbsp;                    BrushOffAttackAction.LEFT);
<b class="nc">&nbsp;            left = Messages</b>
<b class="nc">&nbsp;                    .getString(</b>
&nbsp;                            &quot;PhysicalDisplay.LAHit&quot;, new Object[] {//$NON-NLS-1$
<b class="nc">&nbsp;                                    toHitLeft.getValueAsString(),</b>
<b class="nc">&nbsp;                                    Double.valueOf(</b>
<b class="nc">&nbsp;                                            Compute.oddsAbove(</b>
<b class="nc">&nbsp;                                                    toHitLeft.getValue(),</b>
<b class="nc">&nbsp;                                                    ce().hasAbility(OptionsConstants.PILOT_APTITUDE_PILOTING))),</b>
<b class="nc">&nbsp;                                    Integer.valueOf(damageLeft) });</b>
&nbsp;        }
&nbsp;
&nbsp;        // If we can hit with the right arm, get
&nbsp;        // the damage and construct the string.
<b class="nc">&nbsp;        if (canHitRight) {</b>
<b class="nc">&nbsp;            damageRight = BrushOffAttackAction.getDamageFor(ce(),</b>
&nbsp;                    BrushOffAttackAction.RIGHT);
<b class="nc">&nbsp;            right = Messages</b>
<b class="nc">&nbsp;                    .getString(</b>
&nbsp;                            &quot;PhysicalDisplay.RAHit&quot;, new Object[] {//$NON-NLS-1$
<b class="nc">&nbsp;                                    toHitRight.getValueAsString(),</b>
<b class="nc">&nbsp;                                    Double.valueOf(</b>
<b class="nc">&nbsp;                                            Compute.oddsAbove(</b>
<b class="nc">&nbsp;                                                    toHitRight.getValue(),</b>
<b class="nc">&nbsp;                                                    ce().hasAbility(OptionsConstants.PILOT_APTITUDE_PILOTING))),</b>
<b class="nc">&nbsp;                                    Integer.valueOf(damageRight) });</b>
&nbsp;        }
&nbsp;
&nbsp;        // Allow the player to cancel or choose which arm(s) to use.
<b class="nc">&nbsp;        if (canHitLeft &amp;&amp; canHitRight) {</b>
<b class="nc">&nbsp;            choices = new String[3];</b>
<b class="nc">&nbsp;            choices[0] = left;</b>
<b class="nc">&nbsp;            choices[1] = right;</b>
<b class="nc">&nbsp;            choices[2] = both;</b>
&nbsp;
<b class="nc">&nbsp;            String input = (String) JOptionPane.showInputDialog(clientgui,</b>
<b class="nc">&nbsp;                    warn.toString(), title, JOptionPane.WARNING_MESSAGE, null,</b>
&nbsp;                    choices, null);
<b class="nc">&nbsp;            int index = -1;</b>
<b class="nc">&nbsp;            if (input != null) {</b>
<b class="nc">&nbsp;                for (int i = 0; i &lt; choices.length; i++) {</b>
<b class="nc">&nbsp;                    if (input.equals(choices[i])) {</b>
<b class="nc">&nbsp;                        index = i;</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    }
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            if (index != -1) {</b>
<b class="nc">&nbsp;                disableButtons();</b>
<b class="nc">&nbsp;                switch (index) {</b>
&nbsp;                case 0:
<b class="nc">&nbsp;                    attacks.addElement(new BrushOffAttackAction(cen, target</b>
<b class="nc">&nbsp;                            .getTargetType(), target.getTargetId(),</b>
&nbsp;                            BrushOffAttackAction.LEFT));
<b class="nc">&nbsp;                    break;</b>
&nbsp;                case 1:
<b class="nc">&nbsp;                    attacks.addElement(new BrushOffAttackAction(cen, target</b>
<b class="nc">&nbsp;                            .getTargetType(), target.getTargetId(),</b>
&nbsp;                            BrushOffAttackAction.RIGHT));
<b class="nc">&nbsp;                    break;</b>
&nbsp;                case 2:
<b class="nc">&nbsp;                    attacks.addElement(new BrushOffAttackAction(cen, target</b>
<b class="nc">&nbsp;                            .getTargetType(), target.getTargetId(),</b>
&nbsp;                            BrushOffAttackAction.BOTH));
&nbsp;                    break;
&nbsp;                }
<b class="nc">&nbsp;                ready();</b>
&nbsp;
&nbsp;            } // End not-cancel
&nbsp;
<b class="nc">&nbsp;        } // End choose-attack(s)</b>
&nbsp;
&nbsp;        // If only the left arm is available, confirm that choice.
<b class="nc">&nbsp;        else if (canHitLeft) {</b>
<b class="nc">&nbsp;            choices = new String[1];</b>
<b class="nc">&nbsp;            choices[0] = left;</b>
<b class="nc">&nbsp;            String input = (String) JOptionPane.showInputDialog(clientgui,</b>
<b class="nc">&nbsp;                    warn.toString(), title, JOptionPane.WARNING_MESSAGE, null,</b>
&nbsp;                    choices, null);
<b class="nc">&nbsp;            if (input != null) {</b>
<b class="nc">&nbsp;                disableButtons();</b>
<b class="nc">&nbsp;                attacks.addElement(new BrushOffAttackAction(cen, target</b>
<b class="nc">&nbsp;                        .getTargetType(), target.getTargetId(),</b>
&nbsp;                        BrushOffAttackAction.LEFT));
<b class="nc">&nbsp;                ready();</b>
&nbsp;
&nbsp;            } // End not-cancel
&nbsp;
<b class="nc">&nbsp;        } // End confirm-left</b>
&nbsp;
&nbsp;        // If only the right arm is available, confirm that choice.
<b class="nc">&nbsp;        else if (canHitRight) {</b>
<b class="nc">&nbsp;            choices = new String[1];</b>
<b class="nc">&nbsp;            choices[0] = right;</b>
<b class="nc">&nbsp;            String input = (String) JOptionPane.showInputDialog(clientgui,</b>
<b class="nc">&nbsp;                    warn.toString(), title, JOptionPane.WARNING_MESSAGE, null,</b>
&nbsp;                    choices, null);
<b class="nc">&nbsp;            if (input != null) {</b>
<b class="nc">&nbsp;                disableButtons();</b>
<b class="nc">&nbsp;                attacks.addElement(new BrushOffAttackAction(cen, target</b>
<b class="nc">&nbsp;                        .getTargetType(), target.getTargetId(),</b>
&nbsp;                        BrushOffAttackAction.RIGHT));
<b class="nc">&nbsp;                ready();</b>
&nbsp;
&nbsp;            } // End not-cancel
&nbsp;
&nbsp;        } // End confirm-right
&nbsp;
&nbsp;    } // End private void brush()
&nbsp;
&nbsp;    /**
&nbsp;     * Thrash at the target, unless the player cancels the action.
&nbsp;     */
&nbsp;    void thrash() {
<b class="nc">&nbsp;        ThrashAttackAction act = new ThrashAttackAction(cen,</b>
<b class="nc">&nbsp;                target.getTargetType(), target.getTargetId());</b>
<b class="nc">&nbsp;        ToHitData toHit = act.toHit(clientgui.getClient().getGame());</b>
&nbsp;
<b class="nc">&nbsp;        String title = Messages</b>
<b class="nc">&nbsp;                .getString(</b>
<b class="nc">&nbsp;                        &quot;PhysicalDisplay.TrashDialog.title&quot;, new Object[] { target.getDisplayName() }); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        String message = Messages</b>
<b class="nc">&nbsp;                .getString(</b>
&nbsp;                        &quot;PhysicalDisplay.TrashDialog.message&quot;, new Object[] {//$NON-NLS-1$
<b class="nc">&nbsp;                                toHit.getValueAsString(),</b>
<b class="nc">&nbsp;                                Double.valueOf(</b>
<b class="nc">&nbsp;                                        Compute.oddsAbove(</b>
<b class="nc">&nbsp;                                                toHit.getValue(),</b>
<b class="nc">&nbsp;                                                ce().hasAbility(OptionsConstants.PILOT_APTITUDE_PILOTING))),</b>
<b class="nc">&nbsp;                                toHit.getDesc(),</b>
<b class="nc">&nbsp;                                ThrashAttackAction.getDamageFor(ce())</b>
<b class="nc">&nbsp;                                        + toHit.getTableDesc() });</b>
&nbsp;
&nbsp;        // Give the user to cancel the attack.
<b class="nc">&nbsp;        if (clientgui.doYesNoDialog(title, message)) {</b>
<b class="nc">&nbsp;            disableButtons();</b>
<b class="nc">&nbsp;            attacks.addElement(act);</b>
<b class="nc">&nbsp;            ready();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Dodge like that guy in that movie that I won&#39;t name for copywrite
&nbsp;     * reasons!
&nbsp;     */
&nbsp;    void dodge() {
<b class="nc">&nbsp;        if (clientgui.doYesNoDialog(</b>
<b class="nc">&nbsp;                Messages.getString(&quot;PhysicalDisplay.DodgeDialog.title&quot;),</b>
<b class="nc">&nbsp;                Messages.getString(&quot;PhysicalDisplay&quot; + &quot;.DodgeDialog&quot;</b>
&nbsp;                        + &quot;.message&quot;))) {
&nbsp;            //$NON-NLS-1$
&nbsp;            // $NON-NLS-2$
<b class="nc">&nbsp;            disableButtons();</b>
&nbsp;
<b class="nc">&nbsp;            Entity entity = clientgui.getClient().getGame().getEntity(cen);</b>
<b class="nc">&nbsp;            entity.dodging = true;</b>
&nbsp;
<b class="nc">&nbsp;            DodgeAction act = new DodgeAction(cen);</b>
<b class="nc">&nbsp;            attacks.addElement(act);</b>
&nbsp;
<b class="nc">&nbsp;            ready();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Targets something
&nbsp;     */
&nbsp;    void target(Targetable t) {
<b class="nc">&nbsp;        target = t;</b>
<b class="nc">&nbsp;        updateTarget();</b>
<b class="nc">&nbsp;        ash.showDialog();</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Targets an entity
&nbsp;     */
&nbsp;    void updateTarget() {
&nbsp;        // dis/enable physical attach buttons
<b class="nc">&nbsp;        if ((cen != Entity.NONE) &amp;&amp; (target != null)) {</b>
<b class="nc">&nbsp;            if (target.getTargetType() != Targetable.TYPE_INARC_POD) {</b>
&nbsp;                // punch?
<b class="nc">&nbsp;                final ToHitData leftArm = PunchAttackAction.toHit(clientgui</b>
<b class="nc">&nbsp;                        .getClient().getGame(), cen, target,</b>
&nbsp;                        PunchAttackAction.LEFT, false);
<b class="nc">&nbsp;                final ToHitData rightArm = PunchAttackAction.toHit(clientgui</b>
<b class="nc">&nbsp;                        .getClient().getGame(), cen, target,</b>
&nbsp;                        PunchAttackAction.RIGHT, false);
<b class="nc">&nbsp;                boolean canPunch = (leftArm.getValue() != TargetRoll.IMPOSSIBLE)</b>
<b class="nc">&nbsp;                        || (rightArm.getValue() != TargetRoll.IMPOSSIBLE);</b>
<b class="nc">&nbsp;                setPunchEnabled(canPunch);</b>
&nbsp;
&nbsp;                // kick?
<b class="nc">&nbsp;                ToHitData leftLeg = KickAttackAction.toHit(clientgui</b>
<b class="nc">&nbsp;                        .getClient().getGame(), cen, target,</b>
&nbsp;                        KickAttackAction.LEFT);
<b class="nc">&nbsp;                ToHitData rightLeg = KickAttackAction.toHit(clientgui</b>
<b class="nc">&nbsp;                        .getClient().getGame(), cen, target,</b>
&nbsp;                        KickAttackAction.RIGHT);
<b class="nc">&nbsp;                boolean canKick = (leftLeg.getValue() != TargetRoll.IMPOSSIBLE)</b>
<b class="nc">&nbsp;                        || (rightLeg.getValue() != TargetRoll.IMPOSSIBLE);</b>
<b class="nc">&nbsp;                ToHitData rightRearLeg = KickAttackAction.toHit(clientgui</b>
<b class="nc">&nbsp;                        .getClient().getGame(), cen, target,</b>
&nbsp;                        KickAttackAction.RIGHTMULE);
<b class="nc">&nbsp;                ToHitData leftRearLeg = KickAttackAction.toHit(clientgui</b>
<b class="nc">&nbsp;                        .getClient().getGame(), cen, target,</b>
&nbsp;                        KickAttackAction.LEFTMULE);
<b class="nc">&nbsp;                canKick |= (leftRearLeg.getValue() != TargetRoll.IMPOSSIBLE)</b>
<b class="nc">&nbsp;                        || (rightRearLeg.getValue() != TargetRoll.IMPOSSIBLE);</b>
&nbsp;
<b class="nc">&nbsp;                setKickEnabled(canKick);</b>
&nbsp;
&nbsp;                // how about push?
<b class="nc">&nbsp;                ToHitData push = PushAttackAction.toHit(clientgui.getClient()</b>
<b class="nc">&nbsp;                        .getGame(), cen, target);</b>
<b class="nc">&nbsp;                setPushEnabled(push.getValue() != TargetRoll.IMPOSSIBLE);</b>
&nbsp;
&nbsp;                // how about trip?
<b class="nc">&nbsp;                ToHitData trip = TripAttackAction.toHit(clientgui.getClient()</b>
<b class="nc">&nbsp;                        .getGame(), cen, target);</b>
<b class="nc">&nbsp;                setTripEnabled(trip.getValue() != TargetRoll.IMPOSSIBLE);</b>
&nbsp;
&nbsp;                // how about grapple?
<b class="nc">&nbsp;                ToHitData grap = GrappleAttackAction.toHit(clientgui</b>
<b class="nc">&nbsp;                        .getClient().getGame(), cen, target);</b>
<b class="nc">&nbsp;                ToHitData bgrap = BreakGrappleAttackAction.toHit(clientgui</b>
<b class="nc">&nbsp;                        .getClient().getGame(), cen, target);</b>
<b class="nc">&nbsp;                setGrappleEnabled((grap.getValue() != TargetRoll.IMPOSSIBLE)</b>
<b class="nc">&nbsp;                        || (bgrap.getValue() != TargetRoll.IMPOSSIBLE));</b>
&nbsp;
&nbsp;                // how about JJ?
<b class="nc">&nbsp;                ToHitData jjl = JumpJetAttackAction.toHit(clientgui.getClient()</b>
<b class="nc">&nbsp;                        .getGame(), cen, target, JumpJetAttackAction.LEFT);</b>
<b class="nc">&nbsp;                ToHitData jjr = JumpJetAttackAction.toHit(clientgui.getClient()</b>
<b class="nc">&nbsp;                        .getGame(), cen, target, JumpJetAttackAction.RIGHT);</b>
<b class="nc">&nbsp;                ToHitData jjb = JumpJetAttackAction.toHit(clientgui.getClient()</b>
<b class="nc">&nbsp;                        .getGame(), cen, target, JumpJetAttackAction.BOTH);</b>
<b class="nc">&nbsp;                setJumpJetEnabled(!((jjl.getValue() == TargetRoll.IMPOSSIBLE)</b>
<b class="nc">&nbsp;                        &amp;&amp; (jjr.getValue() == TargetRoll.IMPOSSIBLE) &amp;&amp; (jjb</b>
<b class="nc">&nbsp;                            .getValue() == TargetRoll.IMPOSSIBLE)));</b>
&nbsp;
&nbsp;                // clubbing?
<b class="nc">&nbsp;                boolean canClub = false;</b>
<b class="nc">&nbsp;                boolean canAim = false;</b>
<b class="nc">&nbsp;                for (Mounted club : ce().getClubs()) {</b>
<b class="nc">&nbsp;                    if (club != null) {</b>
<b class="nc">&nbsp;                        ToHitData clubToHit = ClubAttackAction.toHit(clientgui</b>
<b class="nc">&nbsp;                                .getClient().getGame(), cen, target, club, ash</b>
<b class="nc">&nbsp;                                .getAimTable(), false);</b>
<b class="nc">&nbsp;                        canClub |= (clubToHit.getValue() != TargetRoll.IMPOSSIBLE);</b>
&nbsp;                        // assuming S7 vibroswords count as swords and maces
&nbsp;                        // count as hatchets
<b class="nc">&nbsp;                        if (club.getType().hasSubType(MiscType.S_SWORD)</b>
<b class="nc">&nbsp;                                || club.getType()</b>
<b class="nc">&nbsp;                                        .hasSubType(MiscType.S_HATCHET)</b>
<b class="nc">&nbsp;                                || club.getType().hasSubType(</b>
&nbsp;                                        MiscType.S_VIBRO_SMALL)
<b class="nc">&nbsp;                                || club.getType().hasSubType(</b>
&nbsp;                                        MiscType.S_VIBRO_MEDIUM)
<b class="nc">&nbsp;                                || club.getType().hasSubType(</b>
&nbsp;                                        MiscType.S_VIBRO_LARGE)
<b class="nc">&nbsp;                                || club.getType().hasSubType(MiscType.S_MACE)</b>
<b class="nc">&nbsp;                                || club.getType().hasSubType(</b>
&nbsp;                                        MiscType.S_MACE_THB)
<b class="nc">&nbsp;                                || club.getType().hasSubType(MiscType.S_LANCE)</b>
<b class="nc">&nbsp;                                || club.getType().hasSubType(</b>
&nbsp;                                        MiscType.S_CHAIN_WHIP)
<b class="nc">&nbsp;                                || club.getType().hasSubType(</b>
&nbsp;                                        MiscType.S_RETRACTABLE_BLADE)
<b class="nc">&nbsp;                                || club.getType().hasSubType(</b>
&nbsp;                                        MiscType.S_SHIELD_LARGE)
<b class="nc">&nbsp;                                || club.getType().hasSubType(</b>
&nbsp;                                        MiscType.S_SHIELD_MEDIUM)
<b class="nc">&nbsp;                                || club.getType().hasSubType(</b>
&nbsp;                                        MiscType.S_SHIELD_SMALL)) {
<b class="nc">&nbsp;                            canAim = true;</b>
&nbsp;                        }
&nbsp;                    }
<b class="nc">&nbsp;                }</b>
<b class="nc">&nbsp;                setClubEnabled(canClub);</b>
<b class="nc">&nbsp;                ash.setCanAim(canAim);</b>
&nbsp;
&nbsp;                // Thrash at infantry?
<b class="nc">&nbsp;                ToHitData thrash = new ThrashAttackAction(cen, target)</b>
<b class="nc">&nbsp;                        .toHit(clientgui.getClient().getGame());</b>
<b class="nc">&nbsp;                setThrashEnabled(thrash.getValue() != TargetRoll.IMPOSSIBLE);</b>
&nbsp;
&nbsp;                // make a Protomech physical attack?
<b class="nc">&nbsp;                ToHitData proto = ProtomechPhysicalAttackAction.toHit(clientgui</b>
<b class="nc">&nbsp;                        .getClient().getGame(), cen, target);</b>
<b class="nc">&nbsp;                setProtoEnabled(proto.getValue() != TargetRoll.IMPOSSIBLE);</b>
&nbsp;
<b class="nc">&nbsp;                ToHitData explo = LayExplosivesAttackAction.toHit(clientgui</b>
<b class="nc">&nbsp;                        .getClient().getGame(), cen, target);</b>
<b class="nc">&nbsp;                setExplosivesEnabled(explo.getValue() != TargetRoll.IMPOSSIBLE);</b>
&nbsp;
&nbsp;                // vibro attack?
<b class="nc">&nbsp;                ToHitData vibro = BAVibroClawAttackAction.toHit(clientgui</b>
<b class="nc">&nbsp;                        .getClient().getGame(), cen, target);</b>
<b class="nc">&nbsp;                setVibroEnabled(vibro.getValue() != TargetRoll.IMPOSSIBLE);</b>
&nbsp;            }
&nbsp;            // Brush off swarming infantry or iNarcPods?
<b class="nc">&nbsp;            ToHitData brushRight = BrushOffAttackAction.toHit(clientgui</b>
<b class="nc">&nbsp;                    .getClient().getGame(), cen, target,</b>
&nbsp;                    BrushOffAttackAction.RIGHT);
<b class="nc">&nbsp;            ToHitData brushLeft = BrushOffAttackAction.toHit(clientgui</b>
<b class="nc">&nbsp;                    .getClient().getGame(), cen, target,</b>
&nbsp;                    BrushOffAttackAction.LEFT);
<b class="nc">&nbsp;            boolean canBrush = ((brushRight.getValue() != TargetRoll.IMPOSSIBLE) || (brushLeft</b>
<b class="nc">&nbsp;                    .getValue() != TargetRoll.IMPOSSIBLE));</b>
<b class="nc">&nbsp;            setBrushOffEnabled(canBrush);</b>
<b class="nc">&nbsp;        } else {</b>
<b class="nc">&nbsp;            setPunchEnabled(false);</b>
<b class="nc">&nbsp;            setPushEnabled(false);</b>
<b class="nc">&nbsp;            setTripEnabled(false);</b>
<b class="nc">&nbsp;            setGrappleEnabled(false);</b>
<b class="nc">&nbsp;            setJumpJetEnabled(false);</b>
<b class="nc">&nbsp;            setKickEnabled(false);</b>
<b class="nc">&nbsp;            setClubEnabled(false);</b>
<b class="nc">&nbsp;            setBrushOffEnabled(false);</b>
<b class="nc">&nbsp;            setThrashEnabled(false);</b>
<b class="nc">&nbsp;            setProtoEnabled(false);</b>
<b class="nc">&nbsp;            setVibroEnabled(false);</b>
&nbsp;        }
<b class="nc">&nbsp;        setSearchlightEnabled((ce() != null) &amp;&amp; (target != null)</b>
<b class="nc">&nbsp;                &amp;&amp; ce().isUsingSpotlight());</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Returns the current entity.
&nbsp;     */
&nbsp;    Entity ce() {
<b class="nc">&nbsp;        return clientgui.getClient().getGame().getEntity(cen);</b>
&nbsp;    }
&nbsp;
&nbsp;    //
&nbsp;    // BoardListener
&nbsp;    //
&nbsp;    @Override
&nbsp;    public void hexMoused(BoardViewEvent b) {
&nbsp;
&nbsp;        // Are we ignoring events?
<b class="nc">&nbsp;        if (isIgnoringEvents()) {</b>
&nbsp;            return;
&nbsp;        }
&nbsp;
&nbsp;        // control pressed means a line of sight check.
<b class="nc">&nbsp;        if ((b.getModifiers() &amp; InputEvent.CTRL_MASK) != 0) {</b>
&nbsp;            return;
&nbsp;        }
<b class="nc">&nbsp;        if (clientgui.getClient().isMyTurn()</b>
<b class="nc">&nbsp;            &amp;&amp; ((b.getModifiers() &amp; InputEvent.BUTTON1_MASK) != 0)) {</b>
<b class="nc">&nbsp;            if (b.getType() == BoardViewEvent.BOARD_HEX_DRAGGED) {</b>
<b class="nc">&nbsp;                if (!b.getCoords().equals(</b>
<b class="nc">&nbsp;                        clientgui.getBoardView().getLastCursor())) {</b>
<b class="nc">&nbsp;                    clientgui.getBoardView().cursor(b.getCoords());</b>
&nbsp;                }
<b class="nc">&nbsp;            } else if (b.getType() == BoardViewEvent.BOARD_HEX_CLICKED) {</b>
<b class="nc">&nbsp;                clientgui.getBoardView().select(b.getCoords());</b>
&nbsp;            }
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public void hexSelected(BoardViewEvent b) {
&nbsp;        // Are we ignoring events?
<b class="nc">&nbsp;        if (isIgnoringEvents()) {</b>
&nbsp;            return;
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (clientgui.getClient().isMyTurn() &amp;&amp; (b.getCoords() != null)</b>
<b class="nc">&nbsp;            &amp;&amp; (ce() != null)) {</b>
<b class="nc">&nbsp;            final Targetable targ = chooseTarget(b.getCoords());</b>
<b class="nc">&nbsp;            if (targ != null) {</b>
<b class="nc">&nbsp;                target(targ);</b>
&nbsp;            } else {
<b class="nc">&nbsp;                target(null);</b>
&nbsp;            }
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Have the player select a target from the entities at the given coords.
&nbsp;     *
&nbsp;     * @param pos - the &lt;code&gt;Coords&lt;/code&gt; containing targets.
&nbsp;     */
&nbsp;    private Targetable chooseTarget(Coords pos) {
<b class="nc">&nbsp;        final IGame game = clientgui.getClient().getGame();</b>
&nbsp;        // Assume that we have *no* choice.
<b class="nc">&nbsp;        Targetable choice = null;</b>
&nbsp;
&nbsp;        // Get the available choices.
<b class="nc">&nbsp;        Iterator&lt;Entity&gt; choices = game.getEntities(pos);</b>
&nbsp;
&nbsp;        // Convert the choices into a List of targets.
<b class="nc">&nbsp;        List&lt;Targetable&gt; targets = new ArrayList&lt;Targetable&gt;();</b>
<b class="nc">&nbsp;        boolean friendlyFire = game.getOptions().booleanOption(OptionsConstants.BASE_FRIENDLY_FIRE);</b>
<b class="nc">&nbsp;        while (choices.hasNext()) {</b>
<b class="nc">&nbsp;            choice = choices.next();</b>
<b class="nc">&nbsp;            if (!ce().equals(choice) &amp;&amp; (friendlyFire || choice.isEnemyOf(ce()))) {</b>
<b class="nc">&nbsp;                targets.add(choice);</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        targets.sort(new Comparator&lt;Targetable&gt;(){</b>
&nbsp;
&nbsp;            @Override
&nbsp;            public int compare(Targetable o1, Targetable o2) {
<b class="nc">&nbsp;                boolean enemy1 = o1.isEnemyOf(ce());</b>
<b class="nc">&nbsp;                boolean enemy2 = o2.isEnemyOf(ce());</b>
<b class="nc">&nbsp;                if (enemy1 &amp;&amp; enemy2) {</b>
<b class="nc">&nbsp;                    return 0;</b>
<b class="nc">&nbsp;                } else if (enemy1 &amp;&amp; !enemy2) {</b>
<b class="nc">&nbsp;                    return -1;</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    return 1;</b>
&nbsp;                }
&nbsp;            }});
&nbsp;
&nbsp;        // Is there a building in the hex?
<b class="nc">&nbsp;        Building bldg = game.getBoard().getBuildingAt(pos);</b>
<b class="nc">&nbsp;        if (bldg != null) {</b>
<b class="nc">&nbsp;            targets.add(new BuildingTarget(pos, game.getBoard(), false));</b>
&nbsp;        }
&nbsp;
&nbsp;        // Is the attacker targeting its own hex?
<b class="nc">&nbsp;        if (ce().getPosition().equals(pos)) {</b>
&nbsp;            // Add any iNarc pods attached to the entity.
<b class="nc">&nbsp;            Iterator&lt;INarcPod&gt; pods = ce().getINarcPodsAttached();</b>
<b class="nc">&nbsp;            while (pods.hasNext()) {</b>
<b class="nc">&nbsp;                choice = pods.next();</b>
<b class="nc">&nbsp;                targets.add(choice);</b>
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;        // Do we have a single choice?
<b class="nc">&nbsp;        if (targets.size() == 1) {</b>
&nbsp;            // Return that choice.
<b class="nc">&nbsp;            choice = targets.get(0);</b>
&nbsp;        }
&nbsp;
&nbsp;        // If we have multiple choices, display a selection dialog.
<b class="nc">&nbsp;        else if (targets.size() &gt; 1) {</b>
<b class="nc">&nbsp;            String input = (String) JOptionPane</b>
<b class="nc">&nbsp;                    .showInputDialog(</b>
&nbsp;                            clientgui,
<b class="nc">&nbsp;                            Messages.getString(</b>
&nbsp;                                    &quot;PhysicalDisplay.ChooseTargetDialog.message&quot;,
<b class="nc">&nbsp;                                    new Object[] { pos.getBoardNum() }), //$NON-NLS-1$</b>
<b class="nc">&nbsp;                            Messages.getString(&quot;PhysicalDisplay.ChooseTargetDialog.title&quot;), //$NON-NLS-1$</b>
&nbsp;                            JOptionPane.QUESTION_MESSAGE, null, SharedUtility
<b class="nc">&nbsp;                                    .getDisplayArray(targets), null);</b>
<b class="nc">&nbsp;            choice = SharedUtility.getTargetPicked(targets, input);</b>
&nbsp;        } // End have-choices
&nbsp;
&nbsp;        // Return the chosen unit.
<b class="nc">&nbsp;        return choice;</b>
&nbsp;
&nbsp;    } // End private Targetable chooseTarget( Coords )
&nbsp;
&nbsp;    //
&nbsp;    // GameListener
&nbsp;    //
&nbsp;    @Override
&nbsp;    public void gameTurnChange(GameTurnChangeEvent e) {
&nbsp;
&nbsp;        // Are we ignoring events?
<b class="nc">&nbsp;        if (isIgnoringEvents()) {</b>
&nbsp;            return;
&nbsp;        }
&nbsp;        // On simultaneous phases, each player ending their turn will generalte a turn change
&nbsp;        // We want to ignore turns from other players and only listen to events we generated
&nbsp;        // Except on the first turn
<b class="nc">&nbsp;        if (clientgui.getClient().getGame().isPhaseSimultaneous()</b>
<b class="nc">&nbsp;                &amp;&amp; (e.getPreviousPlayerId() != clientgui.getClient().getLocalPlayerNumber())</b>
<b class="nc">&nbsp;                &amp;&amp; (clientgui.getClient().getGame().getTurnIndex() != 0)) {</b>
&nbsp;            return;
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (clientgui.getClient().getGame().getPhase() == IGame.Phase.PHASE_PHYSICAL) {</b>
&nbsp;
<b class="nc">&nbsp;            if (clientgui.getClient().isMyTurn()) {</b>
<b class="nc">&nbsp;                if (cen == Entity.NONE) {</b>
<b class="nc">&nbsp;                    beginMyTurn();</b>
&nbsp;                }
<b class="nc">&nbsp;                setStatusBarText(Messages</b>
<b class="nc">&nbsp;                        .getString(&quot;PhysicalDisplay.its_your_turn&quot;)); //$NON-NLS-1$</b>
&nbsp;            } else {
<b class="nc">&nbsp;                endMyTurn();</b>
&nbsp;                String playerName;
<b class="nc">&nbsp;                if (e.getPlayer() != null) {</b>
<b class="nc">&nbsp;                    playerName = e.getPlayer().getName();</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    playerName = &quot;Unknown&quot;;</b>
&nbsp;                }
<b class="nc">&nbsp;                setStatusBarText(Messages.getString(</b>
&nbsp;                        &quot;PhysicalDisplay.its_others_turn&quot;, //$NON-NLS-1$
&nbsp;                        new Object[] { playerName }));
<b class="nc">&nbsp;            }</b>
&nbsp;        } else {
<b class="nc">&nbsp;            System.err</b>
<b class="nc">&nbsp;                    .println(&quot;PhysicalDisplay: got turnchange event when it&#39;s not the physical attacks phase&quot;);</b>
&nbsp;            //$NON-NLS-1$
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public void gamePhaseChange(GamePhaseChangeEvent e) {
&nbsp;
&nbsp;        // In case of a /reset command, ensure the state gets reset
<b class="nc">&nbsp;        if (clientgui.getClient().getGame().getPhase() == IGame.Phase.PHASE_LOUNGE) {</b>
<b class="nc">&nbsp;            endMyTurn();</b>
&nbsp;        }
&nbsp;
&nbsp;        // Are we ignoring events?
<b class="nc">&nbsp;        if (isIgnoringEvents()) {</b>
&nbsp;            return;
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (clientgui.getClient().isMyTurn()</b>
<b class="nc">&nbsp;                &amp;&amp; (clientgui.getClient().getGame().getPhase() != IGame.Phase.PHASE_PHYSICAL)) {</b>
<b class="nc">&nbsp;            endMyTurn();</b>
&nbsp;        }
&nbsp;        // if we&#39;re ending the firing phase, unregister stuff.
<b class="nc">&nbsp;        if (clientgui.getClient().getGame().getPhase() == IGame.Phase.PHASE_PHYSICAL) {</b>
<b class="nc">&nbsp;            setStatusBarText(Messages</b>
<b class="nc">&nbsp;                    .getString(&quot;PhysicalDisplay.waitingForPhysicalAttackPhase&quot;)); //$NON-NLS-1$</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    //
&nbsp;    // ActionListener
&nbsp;    //
&nbsp;    public void actionPerformed(ActionEvent ev) {
&nbsp;
&nbsp;        // Are we ignoring events?
<b class="nc">&nbsp;        if (isIgnoringEvents()) {</b>
&nbsp;            return;
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (statusBarActionPerformed(ev, clientgui.getClient())) {</b>
&nbsp;            return;
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (!clientgui.getClient().isMyTurn()) {</b>
&nbsp;            // odd...
&nbsp;            return;
&nbsp;        }
<b class="nc">&nbsp;        if (ev.getActionCommand().equals(PhysicalCommand.PHYSICAL_PUNCH.getCmd())) {</b>
<b class="nc">&nbsp;            punch();</b>
<b class="nc">&nbsp;        } else if (ev.getActionCommand().equals(PhysicalCommand.PHYSICAL_KICK.getCmd())) {</b>
<b class="nc">&nbsp;            kick();</b>
<b class="nc">&nbsp;        } else if (ev.getActionCommand().equals(PhysicalCommand.PHYSICAL_PUSH.getCmd())) {</b>
<b class="nc">&nbsp;            push();</b>
<b class="nc">&nbsp;        } else if (ev.getActionCommand().equals(PhysicalCommand.PHYSICAL_TRIP.getCmd())) {</b>
<b class="nc">&nbsp;            trip();</b>
<b class="nc">&nbsp;        } else if (ev.getActionCommand().equals(PhysicalCommand.PHYSICAL_GRAPPLE.getCmd())) {</b>
<b class="nc">&nbsp;            doGrapple();</b>
<b class="nc">&nbsp;        } else if (ev.getActionCommand().equals(PhysicalCommand.PHYSICAL_JUMPJET.getCmd())) {</b>
<b class="nc">&nbsp;            jumpjetatt();</b>
<b class="nc">&nbsp;        } else if (ev.getActionCommand().equals(PhysicalCommand.PHYSICAL_CLUB.getCmd())) {</b>
<b class="nc">&nbsp;            club();</b>
<b class="nc">&nbsp;        } else if (ev.getActionCommand().equals(PhysicalCommand.PHYSICAL_BRUSH_OFF.getCmd())) {</b>
<b class="nc">&nbsp;            brush();</b>
<b class="nc">&nbsp;        } else if (ev.getActionCommand().equals(PhysicalCommand.PHYSICAL_THRASH.getCmd())) {</b>
<b class="nc">&nbsp;            thrash();</b>
<b class="nc">&nbsp;        } else if (ev.getActionCommand().equals(PhysicalCommand.PHYSICAL_DODGE.getCmd())) {</b>
<b class="nc">&nbsp;            dodge();</b>
<b class="nc">&nbsp;        } else if (ev.getActionCommand().equals(PhysicalCommand.PHYSICAL_PROTO.getCmd())) {</b>
<b class="nc">&nbsp;            proto();</b>
<b class="nc">&nbsp;        } else if (ev.getActionCommand().equals(PhysicalCommand.PHYSICAL_EXPLOSIVES.getCmd())) {</b>
<b class="nc">&nbsp;            explosives();</b>
<b class="nc">&nbsp;        } else if (ev.getActionCommand().equals(PhysicalCommand.PHYSICAL_VIBRO.getCmd())) {</b>
<b class="nc">&nbsp;            vibroclawatt();</b>
<b class="nc">&nbsp;        } else if (ev.getActionCommand().equals(PhysicalCommand.PHYSICAL_NEXT.getCmd())) {</b>
<b class="nc">&nbsp;            selectEntity(clientgui.getClient().getNextEntityNum(cen));</b>
<b class="nc">&nbsp;        } else if (ev.getActionCommand().equals(PhysicalCommand.PHYSICAL_SEARCHLIGHT.getCmd())) {</b>
<b class="nc">&nbsp;            doSearchlight();</b>
<b class="nc">&nbsp;        } else if (ev.getActionCommand().equals(PhysicalCommand.PHYSICAL_MORE.getCmd())) {</b>
<b class="nc">&nbsp;            currentButtonGroup++;</b>
<b class="nc">&nbsp;            currentButtonGroup %= numButtonGroups;</b>
<b class="nc">&nbsp;            setupButtonPanel();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    //
&nbsp;    // BoardViewListener
&nbsp;    //
&nbsp;    @Override
&nbsp;    public void finishedMovingUnits(BoardViewEvent b) {
&nbsp;        // no action
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    @Override
&nbsp;    public void unitSelected(BoardViewEvent b) {
&nbsp;
&nbsp;        // Are we ignoring events?
<b class="nc">&nbsp;        if (isIgnoringEvents()) {</b>
&nbsp;            return;
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        Entity e = clientgui.getClient().getGame().getEntity(b.getEntityId());</b>
<b class="nc">&nbsp;        if (clientgui.getClient().isMyTurn()) {</b>
<b class="nc">&nbsp;            if (clientgui.getClient().getMyTurn()</b>
<b class="nc">&nbsp;                    .isValidEntity(e, clientgui.getClient().getGame())) {</b>
<b class="nc">&nbsp;                selectEntity(e.getId());</b>
&nbsp;            }
&nbsp;        } else {
<b class="nc">&nbsp;            clientgui.setDisplayVisible(true);</b>
<b class="nc">&nbsp;            clientgui.mechD.displayEntity(e);</b>
<b class="nc">&nbsp;            if (e.isDeployed()) {</b>
<b class="nc">&nbsp;                clientgui.bv.centerOnHex(e.getPosition());</b>
&nbsp;            }
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    public void setThrashEnabled(boolean enabled) {
<b class="nc">&nbsp;        buttons.get(PhysicalCommand.PHYSICAL_THRASH).setEnabled(enabled);</b>
<b class="nc">&nbsp;        clientgui.getMenuBar().setPhysicalThrashEnabled(enabled);</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setPunchEnabled(boolean enabled) {
<b class="nc">&nbsp;        buttons.get(PhysicalCommand.PHYSICAL_PUNCH).setEnabled(enabled);</b>
<b class="nc">&nbsp;        clientgui.getMenuBar().setPhysicalPunchEnabled(enabled);</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setKickEnabled(boolean enabled) {
<b class="nc">&nbsp;        buttons.get(PhysicalCommand.PHYSICAL_KICK).setEnabled(enabled);</b>
<b class="nc">&nbsp;        clientgui.getMenuBar().setPhysicalKickEnabled(enabled);</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setPushEnabled(boolean enabled) {
<b class="nc">&nbsp;        buttons.get(PhysicalCommand.PHYSICAL_PUSH).setEnabled(enabled);</b>
<b class="nc">&nbsp;        clientgui.getMenuBar().setPhysicalPushEnabled(enabled);</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setTripEnabled(boolean enabled) {
<b class="nc">&nbsp;        buttons.get(PhysicalCommand.PHYSICAL_TRIP).setEnabled(enabled);</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setGrappleEnabled(boolean enabled) {
<b class="nc">&nbsp;        buttons.get(PhysicalCommand.PHYSICAL_GRAPPLE).setEnabled(enabled);</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setJumpJetEnabled(boolean enabled) {
<b class="nc">&nbsp;        buttons.get(PhysicalCommand.PHYSICAL_JUMPJET).setEnabled(enabled);</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setClubEnabled(boolean enabled) {
<b class="nc">&nbsp;        buttons.get(PhysicalCommand.PHYSICAL_CLUB).setEnabled(enabled);</b>
<b class="nc">&nbsp;        clientgui.getMenuBar().setPhysicalClubEnabled(enabled);</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setBrushOffEnabled(boolean enabled) {
<b class="nc">&nbsp;        buttons.get(PhysicalCommand.PHYSICAL_BRUSH_OFF).setEnabled(enabled);</b>
<b class="nc">&nbsp;        clientgui.getMenuBar().setPhysicalBrushOffEnabled(enabled);</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setDodgeEnabled(boolean enabled) {
<b class="nc">&nbsp;        buttons.get(PhysicalCommand.PHYSICAL_DODGE).setEnabled(enabled);</b>
<b class="nc">&nbsp;        clientgui.getMenuBar().setPhysicalDodgeEnabled(enabled);</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setProtoEnabled(boolean enabled) {
<b class="nc">&nbsp;        buttons.get(PhysicalCommand.PHYSICAL_PROTO).setEnabled(enabled);</b>
<b class="nc">&nbsp;        clientgui.getMenuBar().setPhysicalProtoEnabled(enabled);</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setVibroEnabled(boolean enabled) {
<b class="nc">&nbsp;        buttons.get(PhysicalCommand.PHYSICAL_VIBRO).setEnabled(enabled);</b>
<b class="nc">&nbsp;        clientgui.getMenuBar().setPhysicalVibroEnabled(enabled);</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setExplosivesEnabled(boolean enabled) {
<b class="nc">&nbsp;        buttons.get(PhysicalCommand.PHYSICAL_EXPLOSIVES).setEnabled(enabled);</b>
&nbsp;        // clientgui.getMenuBar().setExplosivesEnabled(enabled);
&nbsp;    }
&nbsp;
&nbsp;    public void setNextEnabled(boolean enabled) {
<b class="nc">&nbsp;        buttons.get(PhysicalCommand.PHYSICAL_NEXT).setEnabled(enabled);</b>
<b class="nc">&nbsp;        clientgui.getMenuBar().setPhysicalNextEnabled(enabled);</b>
&nbsp;    }
&nbsp;
&nbsp;    private void setSearchlightEnabled(boolean enabled) {
<b class="nc">&nbsp;        buttons.get(PhysicalCommand.PHYSICAL_SEARCHLIGHT).setEnabled(enabled);</b>
<b class="nc">&nbsp;        clientgui.getMenuBar().setFireSearchlightEnabled(enabled);</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Stop just ignoring events and actually stop listening to them.
&nbsp;     */
&nbsp;    public void removeAllListeners() {
<b class="nc">&nbsp;        clientgui.getClient().getGame().removeGameListener(this);</b>
<b class="nc">&nbsp;        clientgui.getBoardView().removeBoardViewListener(this);</b>
&nbsp;    }
&nbsp;
&nbsp;    private class AimedShotHandler implements ActionListener, ItemListener {
<b class="nc">&nbsp;        private int aimingAt = -1;</b>
&nbsp;
<b class="nc">&nbsp;        private int aimingMode = IAimingModes.AIM_MODE_NONE;</b>
&nbsp;
&nbsp;        private AimedShotDialog asd;
&nbsp;
&nbsp;        private boolean canAim;
&nbsp;
<b class="nc">&nbsp;        public AimedShotHandler() {</b>
&nbsp;            // no action
&nbsp;        }
&nbsp;
&nbsp;        public int getAimTable() {
<b class="nc">&nbsp;            switch (aimingAt) {</b>
&nbsp;                case 0:
<b class="nc">&nbsp;                    return ToHitData.HIT_PUNCH;</b>
&nbsp;                case 1:
<b class="nc">&nbsp;                    return ToHitData.HIT_KICK;</b>
&nbsp;                default:
<b class="nc">&nbsp;                    return ToHitData.HIT_NORMAL;</b>
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;        public void setCanAim(boolean v) {
<b class="nc">&nbsp;            canAim = v;</b>
&nbsp;        }
&nbsp;
&nbsp;        public void showDialog() {
&nbsp;
<b class="nc">&nbsp;            if ((ce() == null) || (target == null)) {</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (asd != null) {</b>
<b class="nc">&nbsp;                int oldAimingMode = aimingMode;</b>
<b class="nc">&nbsp;                closeDialog();</b>
<b class="nc">&nbsp;                aimingMode = oldAimingMode;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (canAim) {</b>
&nbsp;
<b class="nc">&nbsp;                final int attackerElevation = ce().getElevation()</b>
<b class="nc">&nbsp;                        + ce().getGame().getBoard().getHex(ce().getPosition())</b>
<b class="nc">&nbsp;                                .getLevel();</b>
<b class="nc">&nbsp;                final int targetElevation = target.getElevation()</b>
<b class="nc">&nbsp;                        + ce().getGame().getBoard()</b>
<b class="nc">&nbsp;                                .getHex(target.getPosition()).getLevel();</b>
&nbsp;
<b class="nc">&nbsp;                if ((target instanceof Mech) &amp;&amp; (ce() instanceof Mech)</b>
&nbsp;                        &amp;&amp; (attackerElevation == targetElevation)) {
<b class="nc">&nbsp;                    String[] options = { &quot;punch&quot;, &quot;kick&quot; };</b>
<b class="nc">&nbsp;                    boolean[] enabled = { true, true };</b>
&nbsp;
<b class="nc">&nbsp;                    asd = new AimedShotDialog(</b>
&nbsp;                            clientgui.frame,
<b class="nc">&nbsp;                            Messages.getString(&quot;PhysicalDisplay.AimedShotDialog.title&quot;), //$NON-NLS-1$</b>
<b class="nc">&nbsp;                            Messages.getString(&quot;PhysicalDisplay.AimedShotDialog.message&quot;), //$NON-NLS-1$</b>
&nbsp;                            options, enabled, aimingAt, this, this);
&nbsp;
<b class="nc">&nbsp;                    asd.setVisible(true);</b>
<b class="nc">&nbsp;                    updateTarget();</b>
&nbsp;                }
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;        public void closeDialog() {
<b class="nc">&nbsp;            if (asd != null) {</b>
<b class="nc">&nbsp;                aimingAt = Entity.LOC_NONE;</b>
<b class="nc">&nbsp;                aimingMode = IAimingModes.AIM_MODE_NONE;</b>
<b class="nc">&nbsp;                asd.dispose();</b>
<b class="nc">&nbsp;                asd = null;</b>
<b class="nc">&nbsp;                updateTarget();</b>
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;        // ActionListener, listens to the button in the dialog.
&nbsp;        public void actionPerformed(ActionEvent ev) {
<b class="nc">&nbsp;            closeDialog();</b>
&nbsp;        }
&nbsp;
&nbsp;        // ItemListener, listens to the radiobuttons in the dialog.
&nbsp;        public void itemStateChanged(ItemEvent ev) {
<b class="nc">&nbsp;            IndexedRadioButton icb = (IndexedRadioButton) ev.getSource();</b>
<b class="nc">&nbsp;            aimingAt = icb.getIndex();</b>
<b class="nc">&nbsp;            updateTarget();</b>
&nbsp;        }
&nbsp;
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2023-05-16 16:28</div>
</div>
</body>
</html>
