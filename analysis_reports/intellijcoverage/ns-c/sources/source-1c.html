


<!DOCTYPE html>
<html id="htmlId">
<head>
  <title>Coverage Report > CommonSettingsDialog</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">megamek.client.ui.swing</a>
</div>

<h1>Coverage Summary for Class: CommonSettingsDialog (megamek.client.ui.swing)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">CommonSettingsDialog</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/21)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1071)
  </span>
</td>
</tr>
  <tr>
    <td class="name">CommonSettingsDialog$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">CommonSettingsDialog$2</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">CommonSettingsDialog$3</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">CommonSettingsDialog$4</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">CommonSettingsDialog$5</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">CommonSettingsDialog$6</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/6)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">CommonSettingsDialog$7</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/6)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">CommonSettingsDialog$8</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/7)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">CommonSettingsDialog$AdvancedOptionData</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/8)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">CommonSettingsDialog$PhaseCommandListMouseAdapter</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/20)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/51)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1128)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;/*
&nbsp; * MegaMek - Copyright (C) 2003, 2004, 2005 Ben Mazur (bmazur@sev.org)
&nbsp; *
&nbsp; *  This program is free software; you can redistribute it and/or modify it
&nbsp; *  under the terms of the GNU General Public License as published by the Free
&nbsp; *  Software Foundation; either version 2 of the License, or (at your option)
&nbsp; *  any later version.
&nbsp; *
&nbsp; *  This program is distributed in the hope that it will be useful, but
&nbsp; *  WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
&nbsp; *  or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License
&nbsp; *  for more details.
&nbsp; */
&nbsp;
&nbsp;package megamek.client.ui.swing;
&nbsp;
&nbsp;import java.awt.BorderLayout;
&nbsp;import java.awt.Component;
&nbsp;import java.awt.Dimension;
&nbsp;import java.awt.FlowLayout;
&nbsp;import java.awt.Font;
&nbsp;import java.awt.GridBagConstraints;
&nbsp;import java.awt.GridBagLayout;
&nbsp;import java.awt.GridLayout;
&nbsp;import java.awt.Insets;
&nbsp;import java.awt.event.ActionEvent;
&nbsp;import java.awt.event.ActionListener;
&nbsp;import java.awt.event.FocusEvent;
&nbsp;import java.awt.event.FocusListener;
&nbsp;import java.awt.event.ItemEvent;
&nbsp;import java.awt.event.ItemListener;
&nbsp;import java.awt.event.KeyEvent;
&nbsp;import java.awt.event.KeyListener;
&nbsp;import java.awt.event.MouseEvent;
&nbsp;import java.awt.event.MouseMotionAdapter;
&nbsp;import java.awt.event.WindowAdapter;
&nbsp;import java.awt.event.WindowEvent;
&nbsp;import java.io.File;
&nbsp;import java.io.FilenameFilter;
&nbsp;import java.util.ArrayList;
&nbsp;import java.util.Arrays;
&nbsp;import java.util.Collections;
&nbsp;import java.util.HashMap;
&nbsp;import java.util.List;
&nbsp;import java.util.Map;
&nbsp;
&nbsp;import javax.swing.Box;
&nbsp;import javax.swing.BoxLayout;
&nbsp;import javax.swing.DefaultListModel;
&nbsp;import javax.swing.JButton;
&nbsp;import javax.swing.JCheckBox;
&nbsp;import javax.swing.JComboBox;
&nbsp;import javax.swing.JFrame;
&nbsp;import javax.swing.JLabel;
&nbsp;import javax.swing.JList;
&nbsp;import javax.swing.JOptionPane;
&nbsp;import javax.swing.JPanel;
&nbsp;import javax.swing.JScrollPane;
&nbsp;import javax.swing.JSeparator;
&nbsp;import javax.swing.JSlider;
&nbsp;import javax.swing.JTabbedPane;
&nbsp;import javax.swing.JTextField;
&nbsp;import javax.swing.ListSelectionModel;
&nbsp;import javax.swing.SwingConstants;
&nbsp;import javax.swing.SwingUtilities;
&nbsp;import javax.swing.ToolTipManager;
&nbsp;import javax.swing.UIManager;
&nbsp;import javax.swing.UIManager.LookAndFeelInfo;
&nbsp;import javax.swing.border.EmptyBorder;
&nbsp;import javax.swing.event.ChangeEvent;
&nbsp;import javax.swing.event.ChangeListener;
&nbsp;import javax.swing.event.ListSelectionEvent;
&nbsp;import javax.swing.event.ListSelectionListener;
&nbsp;import javax.swing.event.MouseInputAdapter;
&nbsp;
&nbsp;import megamek.client.ui.Messages;
&nbsp;import megamek.client.ui.swing.StatusBarPhaseDisplay.PhaseCommand;
&nbsp;import megamek.client.ui.swing.util.KeyCommandBind;
&nbsp;import megamek.client.ui.swing.widget.SkinXMLHandler;
&nbsp;import megamek.common.Configuration;
&nbsp;import megamek.common.Entity;
&nbsp;import megamek.common.IGame;
&nbsp;import megamek.common.KeyBindParser;
&nbsp;import megamek.common.preference.IClientPreferences;
&nbsp;import megamek.common.preference.PreferenceManager;
&nbsp;
<b class="nc">&nbsp;public class CommonSettingsDialog extends ClientDialog implements</b>
&nbsp;        ActionListener, ItemListener, FocusListener, ListSelectionListener,
&nbsp;        ChangeListener {
&nbsp;
&nbsp;    /**
&nbsp;     * A class for storing information about an GUIPreferences advanced option.
&nbsp;     *
&nbsp;     * @author arlith
&nbsp;     *
&nbsp;     */
&nbsp;    private class AdvancedOptionData implements Comparable&lt;AdvancedOptionData&gt; {
&nbsp;
&nbsp;        public String option;
&nbsp;
<b class="nc">&nbsp;        public AdvancedOptionData(String option) {</b>
<b class="nc">&nbsp;            this.option = option;</b>
&nbsp;        }
&nbsp;
&nbsp;        /**
&nbsp;         * Returns true if this option has tooltip text.
&nbsp;         *
&nbsp;         * @return
&nbsp;         */
&nbsp;        public boolean hasTooltipText() {
<b class="nc">&nbsp;            return Messages.keyExists(&quot;AdvancedOptions.&quot; + option + &quot;.tooltip&quot;);</b>
&nbsp;        }
&nbsp;
&nbsp;        /**
&nbsp;         * Returns the tooltip text for this option.
&nbsp;         *
&nbsp;         * @return
&nbsp;         */
&nbsp;        public String getTooltipText() {
<b class="nc">&nbsp;            return Messages.getString(&quot;AdvancedOptions.&quot; + option + &quot;.tooltip&quot;);</b>
&nbsp;        }
&nbsp;
&nbsp;        /**
&nbsp;         * Returns a human-readable name for this advanced option.
&nbsp;         *
&nbsp;         */
&nbsp;        public String toString() {
<b class="nc">&nbsp;            if (Messages.keyExists(&quot;AdvancedOptions.&quot; + option + &quot;.name&quot;)) {</b>
<b class="nc">&nbsp;                return Messages.getString(&quot;AdvancedOptions.&quot; + option + &quot;.name&quot;);</b>
&nbsp;            } else {
<b class="nc">&nbsp;                return option;</b>
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public int compareTo(AdvancedOptionData other) {
<b class="nc">&nbsp;            return this.toString().compareTo(other.toString());</b>
&nbsp;        }
&nbsp;    }
&nbsp;
<b class="nc">&nbsp;    private class PhaseCommandListMouseAdapter extends MouseInputAdapter {</b>
<b class="nc">&nbsp;        private boolean mouseDragging = false;</b>
&nbsp;        private int dragSourceIndex;
&nbsp;
&nbsp;        @Override
&nbsp;        public void mousePressed(MouseEvent e) {
<b class="nc">&nbsp;            if (SwingUtilities.isLeftMouseButton(e)) {</b>
<b class="nc">&nbsp;                Object src = e.getSource();</b>
<b class="nc">&nbsp;                if (src instanceof JList) {</b>
<b class="nc">&nbsp;                    dragSourceIndex = ((JList&lt;?&gt;) src).getSelectedIndex();</b>
<b class="nc">&nbsp;                    mouseDragging = true;</b>
&nbsp;                }                
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void mouseReleased(MouseEvent e) {
<b class="nc">&nbsp;            mouseDragging = false;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void mouseDragged(MouseEvent e) {
<b class="nc">&nbsp;            Object src = e.getSource();</b>
<b class="nc">&nbsp;            if (mouseDragging &amp;&amp; (src instanceof JList)) {</b>
<b class="nc">&nbsp;                JList&lt;?&gt; srcList = (JList&lt;?&gt;) src;</b>
<b class="nc">&nbsp;                DefaultListModel&lt;?&gt; srcModel = (DefaultListModel&lt;?&gt;) srcList.getModel();</b>
<b class="nc">&nbsp;                int currentIndex = srcList.locationToIndex(e.getPoint());</b>
<b class="nc">&nbsp;                if (currentIndex != dragSourceIndex) {</b>
<b class="nc">&nbsp;                    int dragTargetIndex = srcList.getSelectedIndex();</b>
<b class="nc">&nbsp;                    moveElement(srcModel, dragSourceIndex, dragTargetIndex);</b>
<b class="nc">&nbsp;                    dragSourceIndex = currentIndex;</b>
&nbsp;                }
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;        private &lt;T&gt; void moveElement(DefaultListModel&lt;T&gt; srcModel, int srcIndex, int trgIndex) {
<b class="nc">&nbsp;            T dragElement = srcModel.get(srcIndex);</b>
<b class="nc">&nbsp;            srcModel.remove(srcIndex);</b>
<b class="nc">&nbsp;            srcModel.add(trgIndex, dragElement);</b>
&nbsp;        }
&nbsp;
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     *
&nbsp;     */
&nbsp;    private static final long serialVersionUID = 1535370193846895473L;
&nbsp;
&nbsp;    private JCheckBox autoEndFiring;
&nbsp;    private JCheckBox autoDeclareSearchlight;
&nbsp;    private JCheckBox nagForMASC;
&nbsp;    private JCheckBox nagForPSR;
&nbsp;    private JCheckBox nagForWiGELanding;
&nbsp;    private JCheckBox nagForNoAction;
&nbsp;    private JCheckBox animateMove;
&nbsp;    private JCheckBox showWrecks;
&nbsp;    private JCheckBox soundMute;
&nbsp;    private JCheckBox showWpsinTT;
&nbsp;    private JCheckBox showArmorMiniVisTT;
&nbsp;    private JCheckBox showPilotPortraitTT;
&nbsp;    private JCheckBox chkAntiAliasing;
&nbsp;    private JComboBox&lt;String&gt; defaultWeaponSortOrder;
&nbsp;    private JTextField tooltipDelay;
&nbsp;    private JTextField tooltipDismissDelay;
&nbsp;    private JTextField tooltipDistSupression;
&nbsp;    private JComboBox&lt;String&gt; unitStartChar;
&nbsp;    private JTextField maxPathfinderTime;
&nbsp;    private JCheckBox getFocus;
&nbsp;
&nbsp;    private JCheckBox keepGameLog;
&nbsp;    private JTextField gameLogFilename;
&nbsp;    // private JTextField gameLogMaxSize;
&nbsp;    private JCheckBox stampFilenames;
&nbsp;    private JTextField stampFormat;
&nbsp;    private JCheckBox defaultAutoejectDisabled;
&nbsp;    private JCheckBox useAverageSkills;
&nbsp;    private JCheckBox generateNames;
&nbsp;    private JCheckBox showUnitId;
&nbsp;    private JComboBox&lt;String&gt; displayLocale;
&nbsp;
&nbsp;    private JCheckBox showDamageLevel;
&nbsp;    private JCheckBox showDamageDecal;
&nbsp;    private JCheckBox showMapsheets;
&nbsp;    private JCheckBox aOHexShadows;
&nbsp;    private JCheckBox floatingIso;
&nbsp;    private JCheckBox mmSymbol;
&nbsp;    private JCheckBox entityOwnerColor;
&nbsp;    private JCheckBox teamColoring;
&nbsp;    private JCheckBox useSoftCenter;
&nbsp;    private JCheckBox levelhighlight;
&nbsp;    private JCheckBox shadowMap;
&nbsp;    private JCheckBox hexInclines;
&nbsp;    private JCheckBox mouseWheelZoom;
&nbsp;    private JCheckBox mouseWheelZoomFlip;
&nbsp;
&nbsp;    // Tactical Overlay Options
&nbsp;    private JCheckBox fovInsideEnabled;
&nbsp;    private JSlider fovHighlightAlpha;
&nbsp;    private JCheckBox fovOutsideEnabled;
&nbsp;    private JSlider fovDarkenAlpha;
&nbsp;    private JSlider numStripesSlider;
&nbsp;    private JCheckBox fovGrayscaleEnabled;
&nbsp;    private JTextField fovHighlightRingsRadii;
&nbsp;    private JTextField fovHighlightRingsColors;
&nbsp;    
&nbsp;    // Labels (there to make it possible to disable them)
&nbsp;    private JLabel darkenAlphaLabel;
&nbsp;    private JLabel numStripesLabel;
&nbsp;    private JLabel fovHighlightRingsColorsLabel;
&nbsp;    private JLabel fovHighlightRingsRadiiLabel;
&nbsp;    private JLabel highlightAlphaLabel;
&nbsp;    
&nbsp;    private JLabel stampFormatLabel;
&nbsp;    private JLabel gameLogFilenameLabel;
&nbsp;
&nbsp;    private JCheckBox gameSummaryBV;
&nbsp;    private JCheckBox gameSummaryMM;
&nbsp;
&nbsp;    private JComboBox&lt;String&gt; skinFiles;
&nbsp;
&nbsp;    private JComboBox&lt;UITheme&gt; uiThemes;
&nbsp;
&nbsp;    // Avanced Settings
&nbsp;    private JList&lt;AdvancedOptionData&gt; advancedKeys;
<b class="nc">&nbsp;    private int advancedKeyIndex = 0;</b>
&nbsp;    private JTextField advancedValue;
&nbsp;
&nbsp;    // Button order
&nbsp;    private DefaultListModel&lt;StatusBarPhaseDisplay.PhaseCommand&gt; movePhaseCommands;
&nbsp;    private DefaultListModel&lt;StatusBarPhaseDisplay.PhaseCommand&gt; deployPhaseCommands;
&nbsp;    private DefaultListModel&lt;StatusBarPhaseDisplay.PhaseCommand&gt; firingPhaseCommands;
&nbsp;    private DefaultListModel&lt;StatusBarPhaseDisplay.PhaseCommand&gt; physicalPhaseCommands;
&nbsp;    private DefaultListModel&lt;StatusBarPhaseDisplay.PhaseCommand&gt; targetingPhaseCommands;
<b class="nc">&nbsp;    private StatusBarPhaseDisplay.CommandComparator cmdComp = new StatusBarPhaseDisplay.CommandComparator(); </b>
<b class="nc">&nbsp;    private PhaseCommandListMouseAdapter cmdMouseAdaptor = new PhaseCommandListMouseAdapter();</b>
&nbsp;    
&nbsp;    private JComboBox&lt;String&gt; tileSetChoice;
&nbsp;    private List&lt;File&gt; tileSets;
&nbsp;
&nbsp;    /**
&nbsp;     * A Map that maps command strings to a JTextField for updating the modifier
&nbsp;     * for the command.
&nbsp;     */
&nbsp;    private Map&lt;String, JTextField&gt; cmdModifierMap;
&nbsp;
&nbsp;    /**
&nbsp;     * A Map that maps command strings to a Integer for updating the key
&nbsp;     * for the command.
&nbsp;     */
&nbsp;    private Map&lt;String, Integer&gt; cmdKeyMap;
&nbsp;
&nbsp;    /**
&nbsp;     * A Map that maps command strings to a JCheckBox for updating the
&nbsp;     * isRepeatable flag.
&nbsp;     */
&nbsp;    private Map&lt;String, JCheckBox&gt; cmdRepeatableMap;
&nbsp;    
<b class="nc">&nbsp;    private ClientGUI clientgui = null;</b>
&nbsp;
&nbsp;    private static final String CANCEL = &quot;CANCEL&quot;; //$NON-NLS-1$
&nbsp;    private static final String UPDATE = &quot;UPDATE&quot;; //$NON-NLS-1$
&nbsp;
<b class="nc">&nbsp;    private static final String[] LOCALE_CHOICES = { &quot;en&quot;, &quot;de&quot;, &quot;ru&quot; }; //$NON-NLS-1$</b>
&nbsp;    
<b class="nc">&nbsp;    private static final Dimension LABEL_SPACER = new Dimension(5,0);</b>
<b class="nc">&nbsp;    private static final Dimension DEPENDENT_INSET = new Dimension(25,0);</b>
&nbsp;    
&nbsp;    // Save some values to restore them when the dialog is canceled
&nbsp;    private boolean savedFovHighlight;
&nbsp;    private boolean savedFovDarken;
&nbsp;    private boolean savedFovGrayscale;
&nbsp;    private boolean savedAOHexShadows;
&nbsp;    private boolean savedShadowMap;
&nbsp;    private boolean savedHexInclines;
&nbsp;    private boolean savedLevelhighlight;
&nbsp;    private boolean savedFloatingIso;
&nbsp;    private boolean savedMmSymbol;
&nbsp;    private boolean savedTeamColoring;
&nbsp;    private boolean savedUnitLabelBorder;
&nbsp;    private boolean savedShowDamageDecal;
&nbsp;    private boolean savedShowDamageLabel;
&nbsp;    private String savedFovHighlightRingsRadii;
&nbsp;    private String savedFovHighlightRingsColors;
&nbsp;    private int savedFovHighlightAlpha;
&nbsp;    private int savedFovDarkenAlpha;
&nbsp;    private int savedNumStripesSlider;
<b class="nc">&nbsp;    HashMap&lt;String, String&gt; savedAdvancedOpt = new HashMap&lt;&gt;();</b>
&nbsp;
&nbsp;    /**
&nbsp;     * Standard constructor. There is no default constructor for this class.
&nbsp;     *
&nbsp;     * @param owner - the &lt;code&gt;Frame&lt;/code&gt; that owns this dialog.
&nbsp;     */
&nbsp;    public CommonSettingsDialog(JFrame owner, ClientGUI cg) {
<b class="nc">&nbsp;        this(owner);</b>
<b class="nc">&nbsp;        clientgui = cg;</b>
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * Standard constructor. There is no default constructor for this class.
&nbsp;     *
&nbsp;     * @param owner - the &lt;code&gt;Frame&lt;/code&gt; that owns this dialog.
&nbsp;     */
&nbsp;    public CommonSettingsDialog(JFrame owner) {
<b class="nc">&nbsp;        super(owner, Messages.getString(&quot;CommonSettingsDialog.title&quot;), true);</b>
&nbsp;
<b class="nc">&nbsp;        JTabbedPane panTabs = new JTabbedPane();</b>
<b class="nc">&nbsp;        setLayout(new BorderLayout());</b>
<b class="nc">&nbsp;        getContentPane().add(panTabs, BorderLayout.CENTER);</b>
<b class="nc">&nbsp;        getContentPane().add(getButtonsPanel(), BorderLayout.PAGE_END);</b>
&nbsp;        // Close this dialog when the window manager says to.
<b class="nc">&nbsp;        addWindowListener(new WindowAdapter() {</b>
&nbsp;            @Override
&nbsp;            public void windowClosing(WindowEvent e) {
<b class="nc">&nbsp;                cancel();</b>
&nbsp;            }
&nbsp;        });
&nbsp;
&nbsp;        // Add the tabs
<b class="nc">&nbsp;        JPanel settingsPanel = getSettingsPanel();</b>
<b class="nc">&nbsp;        JScrollPane settingsPane = new JScrollPane(getSettingsPanel());</b>
<b class="nc">&nbsp;        settingsPane.getVerticalScrollBar().setUnitIncrement(16);</b>
<b class="nc">&nbsp;        panTabs.add(&quot;Main&quot;, settingsPane);</b>
&nbsp;        
<b class="nc">&nbsp;        JScrollPane graphicsPane = new JScrollPane(getGraphicsPanel());</b>
<b class="nc">&nbsp;        graphicsPane.getVerticalScrollBar().setUnitIncrement(16);</b>
<b class="nc">&nbsp;        panTabs.add(&quot;Graphics&quot;, graphicsPane);</b>
&nbsp;
<b class="nc">&nbsp;        JScrollPane keyBindPane = new JScrollPane(getKeyBindPanel());</b>
<b class="nc">&nbsp;        keyBindPane.getVerticalScrollBar().setUnitIncrement(16);</b>
<b class="nc">&nbsp;        panTabs.add(&quot;Key Binds&quot;, keyBindPane);</b>
&nbsp;
<b class="nc">&nbsp;        panTabs.add(&quot;Button Order&quot;, getButtonOrderPanel());</b>
&nbsp;        
<b class="nc">&nbsp;        JScrollPane advancedSettingsPane = new JScrollPane(getAdvancedSettingsPanel());</b>
<b class="nc">&nbsp;        advancedSettingsPane.getVerticalScrollBar().setUnitIncrement(16);</b>
<b class="nc">&nbsp;        panTabs.add(&quot;Advanced&quot;, advancedSettingsPane);</b>
&nbsp;
<b class="nc">&nbsp;        pack();</b>
<b class="nc">&nbsp;        setLocationAndSize(getPreferredSize().width, settingsPanel.getPreferredSize().height);</b>
&nbsp;    }
&nbsp;
&nbsp;    private JPanel getButtonsPanel() {
&nbsp;        // Add the dialog controls.
<b class="nc">&nbsp;        JPanel buttons = new JPanel();</b>
<b class="nc">&nbsp;        buttons.setLayout(new GridLayout(1, 0, 20, 5));</b>
<b class="nc">&nbsp;        JButton update = new JButton(Messages.getString(&quot;CommonSettingsDialog.Update&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        update.setActionCommand(UPDATE);</b>
<b class="nc">&nbsp;        update.addActionListener(this);</b>
<b class="nc">&nbsp;        buttons.add(update);</b>
<b class="nc">&nbsp;        JButton cancel = new JButton(Messages.getString(&quot;Cancel&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        cancel.setActionCommand(CANCEL);</b>
<b class="nc">&nbsp;        cancel.addActionListener(this);</b>
<b class="nc">&nbsp;        buttons.add(cancel);</b>
&nbsp;
<b class="nc">&nbsp;        return buttons;</b>
&nbsp;    }
&nbsp;
&nbsp;    private JPanel getSettingsPanel() {
&nbsp;
<b class="nc">&nbsp;        ArrayList&lt;ArrayList&lt;Component&gt;&gt; comps = new ArrayList&lt;ArrayList&lt;Component&gt;&gt;();</b>
&nbsp;        ArrayList&lt;Component&gt; row;
&nbsp;
&nbsp;        // displayLocale settings
<b class="nc">&nbsp;        JLabel displayLocaleLabel = new JLabel(Messages.getString(&quot;CommonSettingsDialog.locale&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        displayLocale = new JComboBox&lt;String&gt;();</b>
<b class="nc">&nbsp;        displayLocale.addItem(Messages.getString(&quot;CommonSettingsDialog.locale.English&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        displayLocale.addItem(Messages.getString(&quot;CommonSettingsDialog.locale.Deutsch&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        displayLocale.addItem(Messages.getString(&quot;CommonSettingsDialog.locale.Russian&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        displayLocale.setMaximumSize(new Dimension(150,40));</b>
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(displayLocaleLabel);</b>
<b class="nc">&nbsp;        row.add(displayLocale);</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;        
&nbsp;        // Horizontal Line and Spacer
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(Box.createRigidArea(new Dimension(0, 10)));</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;
<b class="nc">&nbsp;        JSeparator Sep = new JSeparator(SwingConstants.HORIZONTAL);</b>
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(Sep);</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;        
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(Box.createRigidArea(new Dimension(0, 5)));</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;        // --------------        
&nbsp;
<b class="nc">&nbsp;        showDamageLevel = new JCheckBox(Messages.getString(&quot;CommonSettingsDialog.showDamageLevel&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        showDamageLevel.addItemListener(this);</b>
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(showDamageLevel);</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;        
<b class="nc">&nbsp;        showDamageDecal = new JCheckBox(Messages.getString(&quot;CommonSettingsDialog.showDamageDecal&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        showDamageDecal.addItemListener(this);</b>
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(showDamageDecal);</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;        
<b class="nc">&nbsp;        showUnitId = new JCheckBox(Messages.getString(&quot;CommonSettingsDialog.showUnitId&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        showUnitId.addItemListener(this);</b>
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(showUnitId);</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;
<b class="nc">&nbsp;        entityOwnerColor = new JCheckBox(Messages.getString(&quot;CommonSettingsDialog.entityOwnerColor&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        entityOwnerColor.setToolTipText(Messages.getString(&quot;CommonSettingsDialog.entityOwnerColorTip&quot;));</b>
<b class="nc">&nbsp;        entityOwnerColor.addItemListener(this);</b>
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(entityOwnerColor);</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;        
<b class="nc">&nbsp;        teamColoring = new JCheckBox(Messages.getString(&quot;CommonSettingsDialog.teamColoring&quot;));</b>
<b class="nc">&nbsp;        teamColoring.setToolTipText(Messages.getString(&quot;CommonSettingsDialog.teamColoringTip&quot;));</b>
<b class="nc">&nbsp;        teamColoring.addItemListener(this);</b>
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(teamColoring);</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;        
<b class="nc">&nbsp;        useSoftCenter = new JCheckBox(Messages.getString(&quot;CommonSettingsDialog.useSoftCenter&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        useSoftCenter.setToolTipText(Messages.getString(&quot;CommonSettingsDialog.useSoftCenterTip&quot;));</b>
<b class="nc">&nbsp;        useSoftCenter.addItemListener(this);</b>
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(useSoftCenter);</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;        
&nbsp;        // Horizontal Line and Spacer
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(Box.createRigidArea(new Dimension(0, 10)));</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;
<b class="nc">&nbsp;        Sep = new JSeparator(SwingConstants.HORIZONTAL);</b>
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(Sep);</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;        
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(Box.createRigidArea(new Dimension(0, 5)));</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;        // --------------        
&nbsp;
&nbsp;        // Tooltip Stuff
&nbsp;        //
&nbsp;        // Popup Delay and Dismiss Delay
<b class="nc">&nbsp;        tooltipDelay = new JTextField(4);</b>
<b class="nc">&nbsp;        tooltipDelay.setMaximumSize(new Dimension(150,40));</b>
<b class="nc">&nbsp;        JLabel tooltipDelayLabel = new JLabel(Messages.getString(&quot;CommonSettingsDialog.tooltipDelay&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(tooltipDelayLabel);</b>
<b class="nc">&nbsp;        row.add(tooltipDelay);</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;
<b class="nc">&nbsp;        tooltipDismissDelay = new JTextField(4);</b>
<b class="nc">&nbsp;        tooltipDismissDelay.setMaximumSize(new Dimension(150,40));</b>
<b class="nc">&nbsp;        tooltipDismissDelay.setToolTipText(Messages.getString(&quot;CommonSettingsDialog.tooltipDismissDelayTooltip&quot;));</b>
<b class="nc">&nbsp;        JLabel tooltipDismissDelayLabel = new JLabel(Messages.getString(&quot;CommonSettingsDialog.tooltipDismissDelay&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        tooltipDismissDelayLabel.setToolTipText(Messages.getString(&quot;CommonSettingsDialog.tooltipDismissDelayTooltip&quot;));</b>
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(tooltipDismissDelayLabel);</b>
<b class="nc">&nbsp;        row.add(tooltipDismissDelay);</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;        
<b class="nc">&nbsp;        tooltipDistSupression = new JTextField(4);</b>
<b class="nc">&nbsp;        tooltipDistSupression.setMaximumSize(new Dimension(150,40));</b>
<b class="nc">&nbsp;        tooltipDistSupression.setToolTipText(Messages.getString(&quot;CommonSettingsDialog.tooltipDistSuppressionTooltip&quot;));</b>
<b class="nc">&nbsp;        JLabel tooltipDistSupressionLabel = new JLabel(Messages.getString(&quot;CommonSettingsDialog.tooltipDistSuppression&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        tooltipDistSupressionLabel.setToolTipText(Messages.getString(&quot;CommonSettingsDialog.tooltipDistSuppressionTooltip&quot;));</b>
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(tooltipDistSupressionLabel);</b>
<b class="nc">&nbsp;        row.add(tooltipDistSupression);</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;
<b class="nc">&nbsp;        showWpsinTT = new JCheckBox(Messages.getString(&quot;CommonSettingsDialog.showWpsinTT&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(showWpsinTT);</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;
&nbsp;        // copied from showWpsinTT, kept comment as it looks like a relevant compiler/editor flag?
<b class="nc">&nbsp;        showArmorMiniVisTT = new JCheckBox(Messages.getString(&quot;CommonSettingsDialog.showArmorMiniVisTT&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(showArmorMiniVisTT);</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;        
<b class="nc">&nbsp;        showPilotPortraitTT = new JCheckBox(Messages.getString(&quot;CommonSettingsDialog.showPilotPortraitTT&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(showPilotPortraitTT);</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;        
&nbsp;        // Horizontal Line and Spacer
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(Box.createRigidArea(new Dimension(0, 10)));</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;
<b class="nc">&nbsp;        Sep = new JSeparator(SwingConstants.HORIZONTAL);</b>
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(Sep);</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;        
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(Box.createRigidArea(new Dimension(0, 5)));</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;        // --------------        
&nbsp;        
<b class="nc">&nbsp;        soundMute = new JCheckBox(Messages.getString(&quot;CommonSettingsDialog.soundMute&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(soundMute);</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;        
<b class="nc">&nbsp;        JLabel maxPathfinderTimeLabel = new JLabel(Messages.getString(&quot;CommonSettingsDialog.pathFiderTimeLimit&quot;));</b>
<b class="nc">&nbsp;        maxPathfinderTime = new JTextField(5);</b>
<b class="nc">&nbsp;        maxPathfinderTime.setMaximumSize(new Dimension(150,40));</b>
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(maxPathfinderTimeLabel);</b>
<b class="nc">&nbsp;        row.add(maxPathfinderTime);</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;
&nbsp;        // Horizontal Line and Spacer
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(Box.createRigidArea(new Dimension(0, 10)));</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;
<b class="nc">&nbsp;        Sep = new JSeparator(SwingConstants.HORIZONTAL);</b>
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(Sep);</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;        
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(Box.createRigidArea(new Dimension(0, 5)));</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;        // --------------
&nbsp;        
<b class="nc">&nbsp;        nagForMASC = new JCheckBox(Messages.getString(&quot;CommonSettingsDialog.nagForMASC&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(nagForMASC);</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;
<b class="nc">&nbsp;        nagForPSR = new JCheckBox(Messages.getString(&quot;CommonSettingsDialog.nagForPSR&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(nagForPSR);</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;
<b class="nc">&nbsp;        nagForWiGELanding = new JCheckBox(Messages.getString(&quot;CommonSettingsDialog.nagForWiGELanding&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(nagForWiGELanding);</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;
<b class="nc">&nbsp;        nagForNoAction = new JCheckBox(Messages.getString(&quot;CommonSettingsDialog.nagForNoAction&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(nagForNoAction);</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;        
<b class="nc">&nbsp;        getFocus = new JCheckBox(Messages.getString(&quot;CommonSettingsDialog.getFocus&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(getFocus);</b>
<b class="nc">&nbsp;        comps.add(row);</b>
<b class="nc">&nbsp;        mouseWheelZoom = new JCheckBox(Messages.getString(&quot;CommonSettingsDialog.mouseWheelZoom&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(mouseWheelZoom);</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;
<b class="nc">&nbsp;        mouseWheelZoomFlip = new JCheckBox(Messages.getString(&quot;CommonSettingsDialog.mouseWheelZoomFlip&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(mouseWheelZoomFlip);</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;
<b class="nc">&nbsp;        autoEndFiring = new JCheckBox(Messages.getString(&quot;CommonSettingsDialog.autoEndFiring&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(autoEndFiring);</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;
<b class="nc">&nbsp;        autoDeclareSearchlight = new JCheckBox(Messages.getString(&quot;CommonSettingsDialog.autoDeclareSearchlight&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(autoDeclareSearchlight);</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;        
<b class="nc">&nbsp;        JLabel defaultSortOrderLabel = new JLabel(Messages.getString(&quot;CommonSettingsDialog.defaultWeaponSortOrder&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        String toolTip = Messages</b>
<b class="nc">&nbsp;                .getString(&quot;CommonSettingsDialog.defaultWeaponSortOrderTooltip&quot;);</b>
<b class="nc">&nbsp;        defaultSortOrderLabel.setToolTipText(toolTip);</b>
<b class="nc">&nbsp;        defaultWeaponSortOrder = new JComboBox&lt;&gt;();</b>
<b class="nc">&nbsp;        defaultWeaponSortOrder.setToolTipText(toolTip);</b>
<b class="nc">&nbsp;        for (Entity.WeaponSortOrder s : Entity.WeaponSortOrder.values()) {</b>
&nbsp;            // Skip custom: it doesn&#39;t make sense as a default.
<b class="nc">&nbsp;            if (s.equals(Entity.WeaponSortOrder.CUSTOM)) {</b>
<b class="nc">&nbsp;                continue;</b>
&nbsp;            }
<b class="nc">&nbsp;            String entry = &quot;MechDisplay.WeaponSortOrder.&quot; + s.i18nEntry;</b>
<b class="nc">&nbsp;            defaultWeaponSortOrder.addItem(Messages.getString(entry));</b>
&nbsp;        }
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(defaultSortOrderLabel);</b>
<b class="nc">&nbsp;        row.add(defaultWeaponSortOrder);</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;
&nbsp;        // Horizontal Line and Spacer
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(Box.createRigidArea(new Dimension(0, 10)));</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;
<b class="nc">&nbsp;        Sep = new JSeparator(SwingConstants.HORIZONTAL);</b>
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(Sep);</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;        
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(Box.createRigidArea(new Dimension(0, 5)));</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;        // --------------        
&nbsp;
<b class="nc">&nbsp;        JLabel unitStartCharLabel = new JLabel(Messages.getString(&quot;CommonSettingsDialog.protoMechUnitCodes&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        unitStartChar = new JComboBox&lt;String&gt;();</b>
&nbsp;        // Add option for &quot;A, B, C, D...&quot;
<b class="nc">&nbsp;        unitStartChar.addItem(&quot;\u0041, \u0042, \u0043, \u0044...&quot;); //$NON-NLS-1$</b>
&nbsp;        // Add option for &quot;ALPHA, BETA, GAMMA, DELTA...&quot;
<b class="nc">&nbsp;        unitStartChar.addItem(&quot;\u0391, \u0392, \u0393, \u0394...&quot;); //$NON-NLS-1$</b>
&nbsp;        // Add option for &quot;alpha, beta, gamma, delta...&quot;
<b class="nc">&nbsp;        unitStartChar.addItem(&quot;\u03B1, \u03B2, \u03B3, \u03B4...&quot;); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        unitStartChar.setMaximumSize(new Dimension(150,40));</b>
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(unitStartCharLabel);</b>
<b class="nc">&nbsp;        row.add(unitStartChar);</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;
&nbsp;        // player-specific settings
<b class="nc">&nbsp;        defaultAutoejectDisabled = new JCheckBox(Messages.getString(&quot;CommonSettingsDialog.defaultAutoejectDisabled&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        defaultAutoejectDisabled.addItemListener(this);</b>
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(defaultAutoejectDisabled);</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;
<b class="nc">&nbsp;        useAverageSkills = new JCheckBox(Messages.getString(&quot;CommonSettingsDialog.useAverageSkills&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        useAverageSkills.addItemListener(this);</b>
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(useAverageSkills);</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;
<b class="nc">&nbsp;        generateNames = new JCheckBox(Messages.getString(&quot;CommonSettingsDialog.generateNames&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        generateNames.addItemListener(this);</b>
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(generateNames);</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;        
&nbsp;        // Horizontal Line and Spacer
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(Box.createRigidArea(new Dimension(0, 10)));</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;
<b class="nc">&nbsp;        Sep = new JSeparator(SwingConstants.HORIZONTAL);</b>
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(Sep);</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;        
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(Box.createRigidArea(new Dimension(0, 5)));</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;        // --------------  
&nbsp;
&nbsp;        // client-side gameLog settings
<b class="nc">&nbsp;        keepGameLog = new JCheckBox(Messages.getString(&quot;CommonSettingsDialog.keepGameLog&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        keepGameLog.addItemListener(this);</b>
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(keepGameLog);</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;
<b class="nc">&nbsp;        gameLogFilenameLabel = new JLabel(Messages.getString(&quot;CommonSettingsDialog.logFileName&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        gameLogFilename = new JTextField(15);</b>
<b class="nc">&nbsp;        gameLogFilename.setMaximumSize(new Dimension(250,40));</b>
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(Box.createRigidArea(DEPENDENT_INSET));</b>
<b class="nc">&nbsp;        row.add(gameLogFilenameLabel);</b>
<b class="nc">&nbsp;        row.add(gameLogFilename);</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;        
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(Box.createRigidArea(new Dimension(0, 5)));</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;
<b class="nc">&nbsp;        stampFilenames = new JCheckBox(Messages.getString(&quot;CommonSettingsDialog.stampFilenames&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        stampFilenames.addItemListener(this);</b>
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(stampFilenames);</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;
<b class="nc">&nbsp;        stampFormatLabel = new JLabel(Messages.getString(&quot;CommonSettingsDialog.stampFormat&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        stampFormat = new JTextField(15);</b>
<b class="nc">&nbsp;        stampFormat.setMaximumSize(new Dimension(15*13,40));</b>
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(Box.createRigidArea(DEPENDENT_INSET));</b>
<b class="nc">&nbsp;        row.add(stampFormatLabel);</b>
<b class="nc">&nbsp;        row.add(stampFormat);</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;
<b class="nc">&nbsp;        return createSettingsPanel(comps);</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Display the current settings in this dialog. &lt;p/&gt; Overrides
&nbsp;     * &lt;code&gt;Dialog#setVisible(boolean)&lt;/code&gt;.
&nbsp;     */
&nbsp;    @Override
&nbsp;    public void setVisible(boolean visible) {
&nbsp;        // Initialize the dialog when it&#39;s being shown
<b class="nc">&nbsp;        if (visible) {</b>
<b class="nc">&nbsp;            GUIPreferences gs = GUIPreferences.getInstance();</b>
<b class="nc">&nbsp;            IClientPreferences cs = PreferenceManager.getClientPreferences();</b>
&nbsp;
<b class="nc">&nbsp;            autoEndFiring.setSelected(gs.getAutoEndFiring());</b>
<b class="nc">&nbsp;            autoDeclareSearchlight.setSelected(gs.getAutoDeclareSearchlight());</b>
<b class="nc">&nbsp;            nagForMASC.setSelected(gs.getNagForMASC());</b>
<b class="nc">&nbsp;            nagForPSR.setSelected(gs.getNagForPSR());</b>
<b class="nc">&nbsp;            nagForWiGELanding.setSelected(gs.getNagForWiGELanding());</b>
<b class="nc">&nbsp;            nagForNoAction.setSelected(gs.getNagForNoAction());</b>
<b class="nc">&nbsp;            animateMove.setSelected(gs.getShowMoveStep());</b>
<b class="nc">&nbsp;            showWrecks.setSelected(gs.getShowWrecks());</b>
<b class="nc">&nbsp;            soundMute.setSelected(gs.getSoundMute());</b>
<b class="nc">&nbsp;            tooltipDelay.setText(Integer.toString(gs.getTooltipDelay()));</b>
<b class="nc">&nbsp;            tooltipDismissDelay.setText(Integer.toString(gs.getTooltipDismissDelay()));</b>
<b class="nc">&nbsp;            tooltipDistSupression.setText(Integer.toString(gs.getTooltipDistSuppression()));</b>
<b class="nc">&nbsp;            showWpsinTT.setSelected(gs.getShowWpsinTT());</b>
<b class="nc">&nbsp;            showArmorMiniVisTT.setSelected(gs.getshowArmorMiniVisTT());</b>
<b class="nc">&nbsp;            showPilotPortraitTT.setSelected(gs.getshowPilotPortraitTT());</b>
&nbsp;
<b class="nc">&nbsp;            defaultWeaponSortOrder.setSelectedIndex(gs.getDefaultWeaponSortOrder());</b>
&nbsp;            
<b class="nc">&nbsp;            mouseWheelZoom.setSelected(gs.getMouseWheelZoom());</b>
<b class="nc">&nbsp;            mouseWheelZoomFlip.setSelected(gs.getMouseWheelZoomFlip());</b>
&nbsp;
&nbsp;            // Select the correct char set (give a nice default to start).
<b class="nc">&nbsp;            unitStartChar.setSelectedIndex(0);</b>
<b class="nc">&nbsp;            for (int loop = 0; loop &lt; unitStartChar.getItemCount(); loop++) {</b>
<b class="nc">&nbsp;                if (unitStartChar.getItemAt(loop).charAt(0) == PreferenceManager</b>
<b class="nc">&nbsp;                        .getClientPreferences().getUnitStartChar()) {</b>
<b class="nc">&nbsp;                    unitStartChar.setSelectedIndex(loop);</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                }
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            maxPathfinderTime.setText(Integer.toString(cs.getMaxPathfinderTime()));</b>
&nbsp;
<b class="nc">&nbsp;            keepGameLog.setSelected(cs.keepGameLog());</b>
<b class="nc">&nbsp;            gameLogFilename.setEnabled(keepGameLog.isSelected());</b>
<b class="nc">&nbsp;            gameLogFilename.setText(cs.getGameLogFilename());</b>
&nbsp;            // gameLogMaxSize.setEnabled(keepGameLog.isSelected());
&nbsp;            // gameLogMaxSize.setText( Integer.toString(cs.getGameLogMaxSize()) );
<b class="nc">&nbsp;            stampFilenames.setSelected(cs.stampFilenames());</b>
<b class="nc">&nbsp;            stampFormat.setEnabled(stampFilenames.isSelected());</b>
<b class="nc">&nbsp;            stampFormat.setText(cs.getStampFormat());</b>
&nbsp;
<b class="nc">&nbsp;            defaultAutoejectDisabled.setSelected(cs.defaultAutoejectDisabled());</b>
<b class="nc">&nbsp;            useAverageSkills.setSelected(cs.useAverageSkills());</b>
<b class="nc">&nbsp;            generateNames.setSelected(cs.generateNames());</b>
<b class="nc">&nbsp;            showUnitId.setSelected(cs.getShowUnitId());</b>
&nbsp;
<b class="nc">&nbsp;            int index = 0;</b>
<b class="nc">&nbsp;            if (cs.getLocaleString().startsWith(&quot;de&quot;)) {</b>
<b class="nc">&nbsp;                index = 1;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (cs.getLocaleString().startsWith(&quot;ru&quot;)) {</b>
<b class="nc">&nbsp;                index = 2;</b>
&nbsp;            }
<b class="nc">&nbsp;            displayLocale.setSelectedIndex(index);</b>
&nbsp;
<b class="nc">&nbsp;            showMapsheets.setSelected(gs.getShowMapsheets());</b>
<b class="nc">&nbsp;            chkAntiAliasing.setSelected(gs.getAntiAliasing());</b>
<b class="nc">&nbsp;            showDamageLevel.setSelected(gs.getShowDamageLevel());</b>
<b class="nc">&nbsp;            showDamageDecal.setSelected(gs.getShowDamageDecal());</b>
<b class="nc">&nbsp;            aOHexShadows.setSelected(gs.getAOHexShadows());</b>
<b class="nc">&nbsp;            floatingIso.setSelected(gs.getFloatingIso());</b>
<b class="nc">&nbsp;            mmSymbol.setSelected(gs.getMmSymbol());</b>
<b class="nc">&nbsp;            levelhighlight.setSelected(gs.getLevelHighlight());</b>
<b class="nc">&nbsp;            shadowMap.setSelected(gs.getShadowMap());</b>
<b class="nc">&nbsp;            hexInclines.setSelected(gs.getHexInclines());</b>
<b class="nc">&nbsp;            useSoftCenter.setSelected(gs.getBoolean(&quot;SOFTCENTER&quot;));</b>
<b class="nc">&nbsp;            entityOwnerColor.setSelected(gs.getUnitLabelBorder());</b>
<b class="nc">&nbsp;            teamColoring.setSelected(gs.getTeamColoring());</b>
&nbsp;
<b class="nc">&nbsp;            File dir = Configuration.hexesDir();</b>
<b class="nc">&nbsp;            tileSets = new ArrayList&lt;&gt;(Arrays.asList(dir.listFiles(new FilenameFilter() {</b>
&nbsp;                public boolean accept(File direc, String name) {
<b class="nc">&nbsp;                    return name.endsWith(&quot;.tileset&quot;);</b>
&nbsp;                }
&nbsp;            })));
<b class="nc">&nbsp;            dir = new File(Configuration.userdataDir(),</b>
<b class="nc">&nbsp;                    Configuration.hexesDir().toString());</b>
<b class="nc">&nbsp;            File[] userDataTilesets = dir.listFiles(new FilenameFilter() {</b>
&nbsp;                public boolean accept(File direc, String name) {
<b class="nc">&nbsp;                    return name.endsWith(&quot;.tileset&quot;);</b>
&nbsp;                }
&nbsp;            });
<b class="nc">&nbsp;            if (userDataTilesets != null) {</b>
<b class="nc">&nbsp;                tileSets.addAll(Arrays.asList(userDataTilesets));</b>
&nbsp;            }
<b class="nc">&nbsp;            tileSetChoice.removeAllItems();</b>
<b class="nc">&nbsp;            for (int i = 0; (tileSets != null) &amp;&amp; i &lt; tileSets.size(); i++) {</b>
<b class="nc">&nbsp;                String name = tileSets.get(i).getName();</b>
<b class="nc">&nbsp;                tileSetChoice.addItem(name.substring(0, name.length() - 8));</b>
<b class="nc">&nbsp;                if (name.equals(cs.getMapTileset())) {</b>
<b class="nc">&nbsp;                    tileSetChoice.setSelectedIndex(i);</b>
&nbsp;                }
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;	        gameSummaryBV.setSelected(gs.getGameSummaryBoardView());</b>
<b class="nc">&nbsp;	        gameSummaryMM.setSelected(gs.getGameSummaryMiniMap());</b>
&nbsp;
<b class="nc">&nbsp;            skinFiles.removeAllItems();</b>
<b class="nc">&nbsp;            List&lt;String&gt; xmlFiles = new ArrayList&lt;&gt;(Arrays</b>
<b class="nc">&nbsp;                    .asList(Configuration.skinsDir().list(new FilenameFilter() {</b>
&nbsp;                        public boolean accept(File directory, String fileName) {
<b class="nc">&nbsp;                            return fileName.endsWith(&quot;.xml&quot;);</b>
&nbsp;                        }
&nbsp;                    })));
<b class="nc">&nbsp;            String[] files = new File(Configuration.userdataDir(), Configuration.skinsDir().toString())</b>
<b class="nc">&nbsp;                    .list(new FilenameFilter() {</b>
&nbsp;                        public boolean accept(File directory, String fileName) {
<b class="nc">&nbsp;                            return fileName.endsWith(&quot;.xml&quot;);</b>
&nbsp;                        }
&nbsp;                    });
<b class="nc">&nbsp;            if (files != null) {</b>
<b class="nc">&nbsp;                xmlFiles.addAll(Arrays.asList(files));</b>
&nbsp;
&nbsp;            }
<b class="nc">&nbsp;            Collections.sort(xmlFiles);</b>
<b class="nc">&nbsp;            for (String file : xmlFiles) {</b>
<b class="nc">&nbsp;                if (SkinXMLHandler.validSkinSpecFile(file)) {</b>
<b class="nc">&nbsp;                    skinFiles.addItem(file);</b>
&nbsp;                }
<b class="nc">&nbsp;            }</b>
&nbsp;            // Select the default file first
<b class="nc">&nbsp;            skinFiles.setSelectedItem(SkinXMLHandler.defaultSkinXML);</b>
&nbsp;            // If this select fials, the default skin will be selected
<b class="nc">&nbsp;            skinFiles.setSelectedItem(GUIPreferences.getInstance().getSkinFile());</b>
&nbsp;
<b class="nc">&nbsp;            uiThemes.removeAllItems();</b>
<b class="nc">&nbsp;            for (LookAndFeelInfo lafInfo : UIManager.getInstalledLookAndFeels()) {</b>
<b class="nc">&nbsp;                uiThemes.addItem(new UITheme(lafInfo.getClassName(), lafInfo.getName()));</b>
&nbsp;            }
<b class="nc">&nbsp;            uiThemes.setSelectedItem(new UITheme(GUIPreferences.getInstance().getUITheme()));</b>
&nbsp;
<b class="nc">&nbsp;            fovInsideEnabled.setSelected(gs.getFovHighlight());</b>
<b class="nc">&nbsp;            fovHighlightAlpha.setValue(gs.getFovHighlightAlpha());</b>
<b class="nc">&nbsp;            fovHighlightRingsRadii.setText( gs.getFovHighlightRingsRadii());</b>
<b class="nc">&nbsp;            fovHighlightRingsColors.setText( gs.getFovHighlightRingsColorsHsb() );</b>
<b class="nc">&nbsp;            fovOutsideEnabled.setSelected(gs.getFovDarken());</b>
<b class="nc">&nbsp;            fovDarkenAlpha.setValue(gs.getFovDarkenAlpha());</b>
<b class="nc">&nbsp;            numStripesSlider.setValue(gs.getFovStripes());</b>
<b class="nc">&nbsp;            fovGrayscaleEnabled.setSelected(gs.getFovGrayscale());</b>
&nbsp;
<b class="nc">&nbsp;            fovHighlightAlpha.setEnabled(fovInsideEnabled.isSelected());</b>
<b class="nc">&nbsp;            fovHighlightRingsRadii.setEnabled(fovInsideEnabled.isSelected());</b>
<b class="nc">&nbsp;            fovHighlightRingsColors.setEnabled(fovInsideEnabled.isSelected());</b>
<b class="nc">&nbsp;            fovDarkenAlpha.setEnabled(fovOutsideEnabled.isSelected());</b>
<b class="nc">&nbsp;            numStripesSlider.setEnabled(fovOutsideEnabled.isSelected());</b>
<b class="nc">&nbsp;            fovGrayscaleEnabled.setEnabled(fovOutsideEnabled.isSelected());</b>
&nbsp;
<b class="nc">&nbsp;            darkenAlphaLabel.setEnabled(fovOutsideEnabled.isSelected());</b>
<b class="nc">&nbsp;            numStripesLabel.setEnabled(fovOutsideEnabled.isSelected());</b>
<b class="nc">&nbsp;            fovHighlightRingsColorsLabel.setEnabled(fovInsideEnabled.isSelected());</b>
<b class="nc">&nbsp;            fovHighlightRingsRadiiLabel.setEnabled(fovInsideEnabled.isSelected());</b>
<b class="nc">&nbsp;            highlightAlphaLabel.setEnabled(fovInsideEnabled.isSelected());</b>
&nbsp;
<b class="nc">&nbsp;            stampFormatLabel.setEnabled(stampFilenames.isSelected());</b>
<b class="nc">&nbsp;            gameLogFilenameLabel.setEnabled(keepGameLog.isSelected());</b>
&nbsp;
<b class="nc">&nbsp;            getFocus.setSelected(gs.getFocus());</b>
&nbsp;            
<b class="nc">&nbsp;            savedFovHighlight = gs.getFovHighlight();</b>
<b class="nc">&nbsp;            savedFovDarken = gs.getFovDarken();</b>
<b class="nc">&nbsp;            savedFovGrayscale = gs.getFovGrayscale();</b>
<b class="nc">&nbsp;            savedAOHexShadows = gs.getAOHexShadows();</b>
<b class="nc">&nbsp;            savedShadowMap = gs.getShadowMap();</b>
<b class="nc">&nbsp;            savedHexInclines = gs.getHexInclines();</b>
<b class="nc">&nbsp;            savedLevelhighlight = gs.getLevelHighlight();</b>
<b class="nc">&nbsp;            savedFloatingIso = gs.getFloatingIso();</b>
<b class="nc">&nbsp;            savedMmSymbol = gs.getMmSymbol();</b>
<b class="nc">&nbsp;            savedTeamColoring = gs.getTeamColoring();</b>
<b class="nc">&nbsp;            savedUnitLabelBorder = gs.getUnitLabelBorder();</b>
<b class="nc">&nbsp;            savedShowDamageDecal = gs.getShowDamageDecal();</b>
<b class="nc">&nbsp;            savedShowDamageLabel = gs.getShowDamageLevel();</b>
<b class="nc">&nbsp;            savedFovHighlightRingsRadii = gs.getFovHighlightRingsRadii();</b>
<b class="nc">&nbsp;            savedFovHighlightRingsColors = gs.getFovHighlightRingsColorsHsb();</b>
<b class="nc">&nbsp;            savedFovHighlightAlpha = gs.getFovHighlightAlpha();</b>
<b class="nc">&nbsp;            savedFovDarkenAlpha = gs.getFovDarkenAlpha();</b>
<b class="nc">&nbsp;            savedNumStripesSlider = gs.getFovStripes();</b>
<b class="nc">&nbsp;            savedAdvancedOpt.clear();</b>
&nbsp;            
<b class="nc">&nbsp;            advancedKeys.clearSelection();</b>
&nbsp;            
&nbsp;        }   
<b class="nc">&nbsp;        super.setVisible(visible);</b>
&nbsp;    }       
&nbsp;            
&nbsp;    /** Cancel any updates made in this dialog and close it.  */     
&nbsp;    void cancel() {
&nbsp;        // Restore values that are immediately updated by player clicks
<b class="nc">&nbsp;        GUIPreferences guip = GUIPreferences.getInstance();</b>
<b class="nc">&nbsp;        guip.setFovHighlight(savedFovHighlight);</b>
<b class="nc">&nbsp;        guip.setFovDarken(savedFovDarken);</b>
<b class="nc">&nbsp;        guip.setFovGrayscale(savedFovGrayscale);</b>
<b class="nc">&nbsp;        guip.setAOHexShadows(savedAOHexShadows);</b>
<b class="nc">&nbsp;        guip.setShadowMap(savedShadowMap);</b>
<b class="nc">&nbsp;        guip.setHexInclines(savedHexInclines);</b>
<b class="nc">&nbsp;        guip.setLevelHighlight(savedLevelhighlight);</b>
<b class="nc">&nbsp;        guip.setFloatingIso(savedFloatingIso);</b>
<b class="nc">&nbsp;        guip.setMmSymbol(savedMmSymbol);</b>
<b class="nc">&nbsp;        guip.setTeamColoring(savedTeamColoring);</b>
<b class="nc">&nbsp;        guip.setUnitLabelBorder(savedUnitLabelBorder);</b>
<b class="nc">&nbsp;        guip.setShowDamageDecal(savedShowDamageDecal);</b>
<b class="nc">&nbsp;        guip.setShowDamageLevel(savedShowDamageLabel);</b>
<b class="nc">&nbsp;        guip.setFovHighlightRingsRadii(savedFovHighlightRingsRadii);</b>
<b class="nc">&nbsp;        guip.setFovHighlightRingsColorsHsb(savedFovHighlightRingsColors);</b>
<b class="nc">&nbsp;        guip.setFovHighlightAlpha(savedFovHighlightAlpha);</b>
<b class="nc">&nbsp;        guip.setFovDarkenAlpha(savedFovDarkenAlpha);</b>
<b class="nc">&nbsp;        guip.setFovStripes(savedNumStripesSlider);</b>
&nbsp;         
<b class="nc">&nbsp;        for (String option: savedAdvancedOpt.keySet()) {</b>
<b class="nc">&nbsp;            GUIPreferences.getInstance().setValue(option, savedAdvancedOpt.get(option));</b>
<b class="nc">&nbsp;        }</b>
&nbsp;
<b class="nc">&nbsp;        setVisible(false);</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Update the settings from this dialog&#39;s values, then closes it.
&nbsp;     */
&nbsp;    private void update() {
<b class="nc">&nbsp;        GUIPreferences gs = GUIPreferences.getInstance();</b>
<b class="nc">&nbsp;        IClientPreferences cs = PreferenceManager.getClientPreferences();</b>
&nbsp;
<b class="nc">&nbsp;        gs.setShowDamageLevel(showDamageLevel.isSelected());</b>
<b class="nc">&nbsp;        gs.setShowDamageDecal(showDamageDecal.isSelected());</b>
<b class="nc">&nbsp;        gs.setUnitLabelBorder(entityOwnerColor.isSelected());</b>
<b class="nc">&nbsp;        gs.setTeamColoring(teamColoring.isSelected());</b>
<b class="nc">&nbsp;        gs.setAutoEndFiring(autoEndFiring.isSelected());</b>
<b class="nc">&nbsp;        gs.setAutoDeclareSearchlight(autoDeclareSearchlight.isSelected());</b>
<b class="nc">&nbsp;        gs.setDefaultWeaponSortOrder(defaultWeaponSortOrder.getSelectedIndex());</b>
<b class="nc">&nbsp;        gs.setNagForMASC(nagForMASC.isSelected());</b>
<b class="nc">&nbsp;        gs.setNagForPSR(nagForPSR.isSelected());</b>
<b class="nc">&nbsp;        gs.setNagForWiGELanding(nagForWiGELanding.isSelected());</b>
<b class="nc">&nbsp;        gs.setNagForNoAction(nagForNoAction.isSelected());</b>
<b class="nc">&nbsp;        gs.setShowMoveStep(animateMove.isSelected());</b>
<b class="nc">&nbsp;        gs.setShowWrecks(showWrecks.isSelected());</b>
<b class="nc">&nbsp;        gs.setSoundMute(soundMute.isSelected());</b>
<b class="nc">&nbsp;        gs.setShowWpsinTT(showWpsinTT.isSelected());</b>
<b class="nc">&nbsp;        gs.setshowArmorMiniVisTT(showArmorMiniVisTT.isSelected());</b>
<b class="nc">&nbsp;        gs.setshowPilotPortraitTT(showPilotPortraitTT.isSelected());</b>
<b class="nc">&nbsp;        gs.setTooltipDelay(Integer.parseInt(tooltipDelay.getText()));</b>
<b class="nc">&nbsp;        gs.setTooltipDismissDelay(Integer.parseInt(tooltipDismissDelay.getText()));</b>
<b class="nc">&nbsp;        gs.setTooltipDistSuppression(Integer.parseInt(tooltipDistSupression.getText()));</b>
<b class="nc">&nbsp;        cs.setUnitStartChar(((String) unitStartChar.getSelectedItem())</b>
<b class="nc">&nbsp;                .charAt(0));</b>
&nbsp;        
<b class="nc">&nbsp;        gs.setMouseWheelZoom(mouseWheelZoom.isSelected());</b>
<b class="nc">&nbsp;        gs.setMouseWheelZoomFlip(mouseWheelZoomFlip.isSelected());</b>
&nbsp;
<b class="nc">&nbsp;        cs.setMaxPathfinderTime(Integer.parseInt(maxPathfinderTime.getText()));</b>
&nbsp;
<b class="nc">&nbsp;        gs.setGetFocus(getFocus.isSelected());</b>
&nbsp;
<b class="nc">&nbsp;        cs.setKeepGameLog(keepGameLog.isSelected());</b>
<b class="nc">&nbsp;        cs.setGameLogFilename(gameLogFilename.getText());</b>
&nbsp;        // cs.setGameLogMaxSize(Integer.parseInt(gameLogMaxSize.getText()));
<b class="nc">&nbsp;        cs.setStampFilenames(stampFilenames.isSelected());</b>
<b class="nc">&nbsp;        cs.setStampFormat(stampFormat.getText());</b>
&nbsp;
<b class="nc">&nbsp;        cs.setDefaultAutoejectDisabled(defaultAutoejectDisabled.isSelected());</b>
<b class="nc">&nbsp;        cs.setUseAverageSkills(useAverageSkills.isSelected());</b>
<b class="nc">&nbsp;        cs.setGenerateNames(generateNames.isSelected());</b>
<b class="nc">&nbsp;        cs.setShowUnitId(showUnitId.isSelected());</b>
<b class="nc">&nbsp;        if ((clientgui != null) &amp;&amp; (clientgui.bv != null)) {</b>
<b class="nc">&nbsp;            clientgui.bv.updateEntityLabels();</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        cs.setLocale(CommonSettingsDialog.LOCALE_CHOICES[displayLocale</b>
<b class="nc">&nbsp;                .getSelectedIndex()]);</b>
&nbsp;
<b class="nc">&nbsp;        gs.setShowMapsheets(showMapsheets.isSelected());</b>
<b class="nc">&nbsp;        gs.setAOHexShadows(aOHexShadows.isSelected());</b>
<b class="nc">&nbsp;        gs.setFloatingIso(floatingIso.isSelected());</b>
<b class="nc">&nbsp;        gs.setMmSymbol(mmSymbol.isSelected());</b>
<b class="nc">&nbsp;        gs.setLevelHighlight(levelhighlight.isSelected());</b>
<b class="nc">&nbsp;        gs.setShadowMap(shadowMap.isSelected());</b>
<b class="nc">&nbsp;        gs.setHexInclines(hexInclines.isSelected());</b>
<b class="nc">&nbsp;        gs.setValue(&quot;SOFTCENTER&quot;, useSoftCenter.isSelected());</b>
&nbsp;
<b class="nc">&nbsp;        if ((gs.getAntiAliasing() != chkAntiAliasing.isSelected()) &amp;&amp;</b>
&nbsp;                ((clientgui != null) &amp;&amp; (clientgui.bv != null))) {            
<b class="nc">&nbsp;            clientgui.bv.clearHexImageCache();</b>
<b class="nc">&nbsp;            clientgui.bv.repaint();</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        gs.setAntiAliasing(chkAntiAliasing.isSelected());</b>
&nbsp;
<b class="nc">&nbsp;        gs.setGameSummaryBoardView(gameSummaryBV.isSelected());</b>
<b class="nc">&nbsp;        gs.setGameSummaryMiniMap(gameSummaryMM.isSelected());</b>
&nbsp;
<b class="nc">&nbsp;        UITheme newUITheme = (UITheme)uiThemes.getSelectedItem();</b>
<b class="nc">&nbsp;        String oldUITheme = gs.getUITheme();</b>
<b class="nc">&nbsp;        if (!oldUITheme.equals(newUITheme.getClassName())) {</b>
<b class="nc">&nbsp;            gs.setUITheme(newUITheme.getClassName());</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        String newSkinFile = (String)skinFiles.getSelectedItem();</b>
<b class="nc">&nbsp;        String oldSkinFile = gs.getSkinFile();</b>
<b class="nc">&nbsp;        if (!oldSkinFile.equals(newSkinFile)) {</b>
<b class="nc">&nbsp;            boolean success = SkinXMLHandler.initSkinXMLHandler(newSkinFile);</b>
<b class="nc">&nbsp;            if (!success) {</b>
<b class="nc">&nbsp;                SkinXMLHandler.initSkinXMLHandler(oldSkinFile);</b>
<b class="nc">&nbsp;                String title = Messages</b>
<b class="nc">&nbsp;                        .getString(&quot;CommonSettingsDialog.skinFileFail.title&quot;);</b>
<b class="nc">&nbsp;                String msg = Messages</b>
<b class="nc">&nbsp;                        .getString(&quot;CommonSettingsDialog.skinFileFail.msg&quot;);</b>
<b class="nc">&nbsp;                JOptionPane.showMessageDialog(owner, msg, title,</b>
&nbsp;                        JOptionPane.ERROR_MESSAGE);
<b class="nc">&nbsp;            } else {</b>
<b class="nc">&nbsp;                gs.setSkinFile(newSkinFile);</b>
&nbsp;            }            
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (tileSetChoice.getSelectedIndex() &gt;= 0) {</b>
<b class="nc">&nbsp;            String tileSetFileName = tileSets.get(tileSetChoice.getSelectedIndex()).getName();</b>
<b class="nc">&nbsp;            if (!cs.getMapTileset().equals(tileSetFileName) &amp;&amp;</b>
&nbsp;                    (clientgui != null) &amp;&amp; (clientgui.bv != null))  {
<b class="nc">&nbsp;                clientgui.bv.clearShadowMap();</b>
&nbsp;            }
<b class="nc">&nbsp;            cs.setMapTileset(tileSetFileName);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        ToolTipManager.sharedInstance().setInitialDelay(gs.getTooltipDelay());</b>
<b class="nc">&nbsp;        if (gs.getTooltipDismissDelay() &gt; 0) {</b>
<b class="nc">&nbsp;            ToolTipManager.sharedInstance().setDismissDelay(gs.getTooltipDismissDelay());</b>
&nbsp;        }
&nbsp;
&nbsp;        // Lets iterate through all of the KeyCommandBinds and see if they&#39;ve
&nbsp;        //  changed
<b class="nc">&nbsp;        boolean bindsChanged = false;</b>
<b class="nc">&nbsp;        for (KeyCommandBind kcb : KeyCommandBind.values()){</b>
<b class="nc">&nbsp;            JTextField txtModifiers = cmdModifierMap.get(kcb.cmd);</b>
<b class="nc">&nbsp;            JCheckBox repeatable = cmdRepeatableMap.get(kcb.cmd);</b>
<b class="nc">&nbsp;            Integer keyCode = cmdKeyMap.get(kcb.cmd);</b>
&nbsp;            // This shouldn&#39;t happen, but just to be safe...
<b class="nc">&nbsp;            if (txtModifiers == null || keyCode == null || repeatable == null){</b>
<b class="nc">&nbsp;                continue;</b>
&nbsp;            }
<b class="nc">&nbsp;            int modifiers = 0;</b>
<b class="nc">&nbsp;            if (txtModifiers.getText().contains(</b>
<b class="nc">&nbsp;                    KeyEvent.getKeyModifiersText(KeyEvent.SHIFT_MASK))){</b>
<b class="nc">&nbsp;                modifiers |= KeyEvent.SHIFT_MASK;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (txtModifiers.getText().contains(</b>
<b class="nc">&nbsp;                    KeyEvent.getKeyModifiersText(KeyEvent.ALT_MASK))){</b>
<b class="nc">&nbsp;                modifiers |= KeyEvent.ALT_MASK;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (txtModifiers.getText().contains(</b>
<b class="nc">&nbsp;                    KeyEvent.getKeyModifiersText(KeyEvent.CTRL_MASK))){</b>
<b class="nc">&nbsp;                modifiers |= KeyEvent.CTRL_MASK;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (kcb.modifiers != modifiers){</b>
<b class="nc">&nbsp;                bindsChanged = true;</b>
<b class="nc">&nbsp;                kcb.modifiers = modifiers;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (kcb.key != keyCode){</b>
<b class="nc">&nbsp;                bindsChanged = true;</b>
<b class="nc">&nbsp;                kcb.key = keyCode;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (kcb.isRepeatable != repeatable.isSelected()){</b>
<b class="nc">&nbsp;                bindsChanged = true;</b>
<b class="nc">&nbsp;                kcb.isRepeatable = repeatable.isSelected();</b>
&nbsp;            }
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (bindsChanged){</b>
<b class="nc">&nbsp;            KeyBindParser.writeKeyBindings();</b>
&nbsp;        }
&nbsp;        
&nbsp;        // Button Order
&nbsp;        // Movement
<b class="nc">&nbsp;        ButtonOrderPreferences bop = ButtonOrderPreferences.getInstance();</b>
<b class="nc">&nbsp;        boolean buttonOrderChanged = false;</b>
<b class="nc">&nbsp;        for (int i = 0; i &lt; movePhaseCommands.getSize(); i++) {</b>
<b class="nc">&nbsp;            StatusBarPhaseDisplay.PhaseCommand cmd = movePhaseCommands.get(i);</b>
<b class="nc">&nbsp;            if (cmd.getPriority() != i) {</b>
<b class="nc">&nbsp;                cmd.setPriority(i);</b>
<b class="nc">&nbsp;                bop.setValue(cmd.getCmd(), i);</b>
<b class="nc">&nbsp;                buttonOrderChanged = true;</b>
&nbsp;            }
&nbsp;        }
&nbsp;        
&nbsp;        // Need to do stuff if the order changes.
<b class="nc">&nbsp;        if (buttonOrderChanged &amp;&amp; (clientgui != null)) {</b>
<b class="nc">&nbsp;            clientgui.updateButtonPanel(IGame.Phase.PHASE_MOVEMENT);</b>
&nbsp;        }
&nbsp;        
&nbsp;        // Deploy
<b class="nc">&nbsp;        buttonOrderChanged = false;</b>
<b class="nc">&nbsp;        for (int i = 0; i &lt; deployPhaseCommands.getSize(); i++) {</b>
<b class="nc">&nbsp;            StatusBarPhaseDisplay.PhaseCommand cmd = deployPhaseCommands.get(i);</b>
<b class="nc">&nbsp;            if (cmd.getPriority() != i) {</b>
<b class="nc">&nbsp;                cmd.setPriority(i);</b>
<b class="nc">&nbsp;                bop.setValue(cmd.getCmd(), i);</b>
<b class="nc">&nbsp;                buttonOrderChanged = true;</b>
&nbsp;            }
&nbsp;        }
&nbsp;        
&nbsp;        // Need to do stuff if the order changes.
<b class="nc">&nbsp;        if (buttonOrderChanged &amp;&amp; (clientgui != null)) {</b>
<b class="nc">&nbsp;            clientgui.updateButtonPanel(IGame.Phase.PHASE_DEPLOYMENT);</b>
&nbsp;        }        
&nbsp;        
&nbsp;        // Firing
<b class="nc">&nbsp;        buttonOrderChanged = false;</b>
<b class="nc">&nbsp;        for (int i = 0; i &lt; firingPhaseCommands.getSize(); i++) {</b>
<b class="nc">&nbsp;            StatusBarPhaseDisplay.PhaseCommand cmd = firingPhaseCommands.get(i);</b>
<b class="nc">&nbsp;            if (cmd.getPriority() != i) {</b>
<b class="nc">&nbsp;                cmd.setPriority(i);</b>
<b class="nc">&nbsp;                bop.setValue(cmd.getCmd(), i);</b>
<b class="nc">&nbsp;                buttonOrderChanged = true;</b>
&nbsp;            }
&nbsp;        }
&nbsp;        
&nbsp;        // Need to do stuff if the order changes.
<b class="nc">&nbsp;        if (buttonOrderChanged &amp;&amp; (clientgui != null)) {</b>
<b class="nc">&nbsp;            clientgui.updateButtonPanel(IGame.Phase.PHASE_FIRING);</b>
&nbsp;        }
&nbsp;        
&nbsp;        // Physical
<b class="nc">&nbsp;        buttonOrderChanged = false;</b>
<b class="nc">&nbsp;        for (int i = 0; i &lt; physicalPhaseCommands.getSize(); i++) {</b>
<b class="nc">&nbsp;            StatusBarPhaseDisplay.PhaseCommand cmd = physicalPhaseCommands.get(i);</b>
<b class="nc">&nbsp;            if (cmd.getPriority() != i) {</b>
<b class="nc">&nbsp;                cmd.setPriority(i);</b>
<b class="nc">&nbsp;                bop.setValue(cmd.getCmd(), i);</b>
<b class="nc">&nbsp;                buttonOrderChanged = true;</b>
&nbsp;            }
&nbsp;        }
&nbsp;        
&nbsp;        // Need to do stuff if the order changes.
<b class="nc">&nbsp;        if (buttonOrderChanged &amp;&amp; (clientgui != null)) {</b>
<b class="nc">&nbsp;            clientgui.updateButtonPanel(IGame.Phase.PHASE_PHYSICAL);</b>
&nbsp;        }
&nbsp;        
&nbsp;        // Targeting
<b class="nc">&nbsp;        buttonOrderChanged = false;</b>
<b class="nc">&nbsp;        for (int i = 0; i &lt; targetingPhaseCommands.getSize(); i++) {</b>
<b class="nc">&nbsp;            StatusBarPhaseDisplay.PhaseCommand cmd = targetingPhaseCommands.get(i);</b>
<b class="nc">&nbsp;            if (cmd.getPriority() != i) {</b>
<b class="nc">&nbsp;                cmd.setPriority(i);</b>
<b class="nc">&nbsp;                bop.setValue(cmd.getCmd(), i);</b>
<b class="nc">&nbsp;                buttonOrderChanged = true;</b>
&nbsp;            }
&nbsp;        }
&nbsp;        
&nbsp;        // Need to do stuff if the order changes.
<b class="nc">&nbsp;        if (buttonOrderChanged &amp;&amp; (clientgui != null)) {</b>
<b class="nc">&nbsp;            clientgui.updateButtonPanel(IGame.Phase.PHASE_TARGETING);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        setVisible(false);</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Handle the player pressing the action buttons. &lt;p/&gt; Implements the
&nbsp;     * &lt;code&gt;ActionListener&lt;/code&gt; interface.
&nbsp;     *
&nbsp;     * @param event - the &lt;code&gt;ActionEvent&lt;/code&gt; that initiated this call.
&nbsp;     */
&nbsp;    public void actionPerformed(ActionEvent event) {
<b class="nc">&nbsp;        String command = event.getActionCommand();</b>
<b class="nc">&nbsp;        if (command.equals(UPDATE)) {</b>
<b class="nc">&nbsp;            update();</b>
<b class="nc">&nbsp;        } else if (command.equals(CANCEL)) {</b>
<b class="nc">&nbsp;            cancel();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    /** Handle some setting changes that directly update e.g. the board. */
&nbsp;    public void itemStateChanged(ItemEvent event) {
<b class="nc">&nbsp;        Object source = event.getItemSelectable();</b>
<b class="nc">&nbsp;        GUIPreferences guip = GUIPreferences.getInstance();</b>
<b class="nc">&nbsp;        if (source.equals(keepGameLog)) {</b>
<b class="nc">&nbsp;            gameLogFilename.setEnabled(keepGameLog.isSelected());</b>
<b class="nc">&nbsp;            stampFormatLabel.setEnabled(stampFilenames.isSelected());</b>
<b class="nc">&nbsp;            gameLogFilenameLabel.setEnabled(keepGameLog.isSelected());</b>
&nbsp;            // gameLogMaxSize.setEnabled(keepGameLog.isSelected());
<b class="nc">&nbsp;        } else if (source.equals(stampFilenames)) {</b>
<b class="nc">&nbsp;            stampFormat.setEnabled(stampFilenames.isSelected());</b>
<b class="nc">&nbsp;            stampFormatLabel.setEnabled(stampFilenames.isSelected());</b>
<b class="nc">&nbsp;        } else if (source.equals(fovInsideEnabled)) {</b>
<b class="nc">&nbsp;            guip.setFovHighlight(fovInsideEnabled.isSelected());</b>
<b class="nc">&nbsp;            fovHighlightAlpha.setEnabled(fovInsideEnabled.isSelected());</b>
<b class="nc">&nbsp;            fovHighlightRingsRadii.setEnabled(fovInsideEnabled.isSelected());</b>
<b class="nc">&nbsp;            fovHighlightRingsColors.setEnabled(fovInsideEnabled.isSelected());</b>
<b class="nc">&nbsp;            fovHighlightRingsColorsLabel.setEnabled(fovInsideEnabled.isSelected());</b>
<b class="nc">&nbsp;            fovHighlightRingsRadiiLabel.setEnabled(fovInsideEnabled.isSelected());</b>
<b class="nc">&nbsp;            highlightAlphaLabel.setEnabled(fovInsideEnabled.isSelected());</b>
<b class="nc">&nbsp;        } else if (source.equals(fovOutsideEnabled)) {</b>
<b class="nc">&nbsp;            guip.setFovDarken(fovOutsideEnabled.isSelected());</b>
<b class="nc">&nbsp;            fovDarkenAlpha.setEnabled(fovOutsideEnabled.isSelected());</b>
<b class="nc">&nbsp;            numStripesSlider.setEnabled(fovOutsideEnabled.isSelected());</b>
<b class="nc">&nbsp;            darkenAlphaLabel.setEnabled(fovOutsideEnabled.isSelected());</b>
<b class="nc">&nbsp;            numStripesLabel.setEnabled(fovOutsideEnabled.isSelected());</b>
<b class="nc">&nbsp;            fovGrayscaleEnabled.setEnabled(fovOutsideEnabled.isSelected());</b>
<b class="nc">&nbsp;        } else if (source.equals(fovGrayscaleEnabled)) {</b>
<b class="nc">&nbsp;            guip.setFovGrayscale(fovGrayscaleEnabled.isSelected());</b>
<b class="nc">&nbsp;        } else if (source.equals(aOHexShadows)) {</b>
<b class="nc">&nbsp;            guip.setAOHexShadows(aOHexShadows.isSelected());</b>
<b class="nc">&nbsp;        } else if (source.equals(shadowMap)) {</b>
<b class="nc">&nbsp;            guip.setShadowMap(shadowMap.isSelected());</b>
<b class="nc">&nbsp;        } else if (source.equals(hexInclines)) {</b>
<b class="nc">&nbsp;            guip.setHexInclines(hexInclines.isSelected());</b>
<b class="nc">&nbsp;        } else if (source.equals(levelhighlight)) {</b>
<b class="nc">&nbsp;            guip.setLevelHighlight(levelhighlight.isSelected());</b>
<b class="nc">&nbsp;        } else if (source.equals(floatingIso)) {</b>
<b class="nc">&nbsp;            guip.setFloatingIso(floatingIso.isSelected());</b>
<b class="nc">&nbsp;        } else if (source.equals(mmSymbol)) {</b>
<b class="nc">&nbsp;            guip.setMmSymbol(mmSymbol.isSelected());</b>
<b class="nc">&nbsp;            if ((clientgui != null) &amp;&amp; (clientgui.minimap != null)) {</b>
<b class="nc">&nbsp;                clientgui.minimap.drawMap();</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;        } else if (source.equals(teamColoring)) {</b>
<b class="nc">&nbsp;            guip.setTeamColoring(teamColoring.isSelected());</b>
<b class="nc">&nbsp;            if ((clientgui != null) &amp;&amp; (clientgui.minimap != null)) {</b>
<b class="nc">&nbsp;                clientgui.minimap.drawMap();</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;        } else if (source.equals(entityOwnerColor)) {</b>
<b class="nc">&nbsp;            guip.setUnitLabelBorder(entityOwnerColor.isSelected());</b>
&nbsp;            
<b class="nc">&nbsp;        } else if (source.equals(showDamageDecal)) {</b>
<b class="nc">&nbsp;            guip.setShowDamageDecal(showDamageDecal.isSelected());</b>
<b class="nc">&nbsp;        } else if (source.equals(showDamageLevel)) {</b>
<b class="nc">&nbsp;            guip.setShowDamageLevel(showDamageLevel.isSelected());</b>
&nbsp;        }
&nbsp;    }
&nbsp;
<b class="nc">&nbsp;    public void focusGained(FocusEvent e) { }</b>
&nbsp;
&nbsp;    public void focusLost(FocusEvent e) {
<b class="nc">&nbsp;        Object src = e.getSource();</b>
<b class="nc">&nbsp;        GUIPreferences guip = GUIPreferences.getInstance();          </b>
<b class="nc">&nbsp;        if (src.equals(fovHighlightRingsRadii)) {</b>
<b class="nc">&nbsp;            guip.setFovHighlightRingsRadii(fovHighlightRingsRadii.getText());</b>
&nbsp;            return;
<b class="nc">&nbsp;        } else if (src.equals(fovHighlightRingsColors)) {</b>
<b class="nc">&nbsp;            guip.setFovHighlightRingsColorsHsb(fovHighlightRingsColors.getText());</b>
&nbsp;            return;
&nbsp;        } 
&nbsp;        // For Advanced options
<b class="nc">&nbsp;        String option = &quot;Advanced&quot; + advancedKeys.getModel().getElementAt(advancedKeyIndex).option;</b>
<b class="nc">&nbsp;        savedAdvancedOpt.put(option, guip.getString(option));        </b>
<b class="nc">&nbsp;        guip.setValue(option, advancedValue.getText());</b>
&nbsp;    }
&nbsp;
&nbsp;    /** 
&nbsp;     * The Graphics Tab
&nbsp;     */
&nbsp;    private JPanel getGraphicsPanel() {
&nbsp;
<b class="nc">&nbsp;        ArrayList&lt;ArrayList&lt;Component&gt;&gt; comps = new ArrayList&lt;ArrayList&lt;Component&gt;&gt;();</b>
&nbsp;        ArrayList&lt;Component&gt; row;
&nbsp;        
&nbsp;        // Anti-Aliasing
<b class="nc">&nbsp;        chkAntiAliasing = new JCheckBox(Messages.getString(</b>
&nbsp;                &quot;CommonSettingsDialog.antiAliasing&quot;)); //$NON-NLS-1$
<b class="nc">&nbsp;        chkAntiAliasing.setToolTipText(Messages.getString(</b>
&nbsp;                &quot;CommonSettingsDialog.antiAliasingToolTip&quot;));
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(chkAntiAliasing);</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;        
&nbsp;        // Animate Moves
<b class="nc">&nbsp;        animateMove = new JCheckBox(Messages.getString(&quot;CommonSettingsDialog.animateMove&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(animateMove);</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;
&nbsp;        // Show Wrecks
<b class="nc">&nbsp;        showWrecks = new JCheckBox(Messages.getString(&quot;CommonSettingsDialog.showWrecks&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(showWrecks);</b>
<b class="nc">&nbsp;        comps.add(row);     </b>
&nbsp;        
&nbsp;        // Show Mapsheet borders
<b class="nc">&nbsp;        showMapsheets = new JCheckBox(Messages.getString(&quot;CommonSettingsDialog.showMapsheets&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(showMapsheets);</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;
&nbsp;        // Hill Base AO Shadows
<b class="nc">&nbsp;        aOHexShadows = new JCheckBox(Messages.getString(&quot;CommonSettingsDialog.AOHexSHadows&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        aOHexShadows.addItemListener(this);</b>
<b class="nc">&nbsp;        row.add(aOHexShadows);</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;        
&nbsp;        // Shadow Map = Terrain and Building shadows
<b class="nc">&nbsp;        shadowMap = new JCheckBox(Messages.getString(&quot;CommonSettingsDialog.useShadowMap&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        shadowMap.addItemListener(this);</b>
<b class="nc">&nbsp;        row.add(shadowMap);</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;        
&nbsp;        // Use Incline graphics (hex border highlights/shadows)
<b class="nc">&nbsp;        hexInclines = new JCheckBox(Messages.getString(&quot;CommonSettingsDialog.useInclines&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        hexInclines.addItemListener(this);</b>
<b class="nc">&nbsp;        row.add(hexInclines);</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;        
&nbsp;        // Level Highlight = borders around level changes
<b class="nc">&nbsp;        levelhighlight = new JCheckBox(Messages.getString(&quot;CommonSettingsDialog.levelHighlight&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        levelhighlight.addItemListener(this);</b>
<b class="nc">&nbsp;        row.add(levelhighlight);</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;        
&nbsp;        // Floating Isometric = do not draw hex sides
<b class="nc">&nbsp;        floatingIso = new JCheckBox(Messages.getString(&quot;CommonSettingsDialog.floatingIso&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        floatingIso.addItemListener(this);</b>
<b class="nc">&nbsp;        row.add(floatingIso);</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;
&nbsp;        // Type of symbol used on the minimap 
<b class="nc">&nbsp;        mmSymbol = new JCheckBox(Messages.getString(&quot;CommonSettingsDialog.mmSymbol&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        mmSymbol.addItemListener(this);</b>
<b class="nc">&nbsp;        row.add(mmSymbol);</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;
&nbsp;        // Game Summary - BoardView
<b class="nc">&nbsp;        gameSummaryBV = new JCheckBox(Messages.getString(&quot;CommonSettingsDialog.gameSummaryBV.name&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        gameSummaryBV.setToolTipText(Messages.getString(&quot;CommonSettingsDialog.gameSummaryBV.tooltip&quot;, //$NON-NLS-1$</b>
<b class="nc">&nbsp;                new Object[] { Configuration.gameSummaryImagesBVDir() }));</b>
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        gameSummaryBV.addItemListener(this);</b>
<b class="nc">&nbsp;        row.add(gameSummaryBV);</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;
&nbsp;        // Game Summary - Mini-map
<b class="nc">&nbsp;        gameSummaryMM = new JCheckBox(Messages.getString(&quot;CommonSettingsDialog.gameSummaryMM.name&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        gameSummaryMM.setToolTipText(Messages.getString(&quot;CommonSettingsDialog.gameSummaryMM.tooltip&quot;, //$NON-NLS-1$</b>
<b class="nc">&nbsp;                new Object[] { Configuration.gameSummaryImagesMMDir() }));</b>
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        gameSummaryMM.addItemListener(this);</b>
<b class="nc">&nbsp;        row.add(gameSummaryMM);</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;
&nbsp;        // UI Theme
<b class="nc">&nbsp;        uiThemes = new JComboBox&lt;UITheme&gt;();</b>
<b class="nc">&nbsp;        uiThemes.setMaximumSize(new Dimension(400,uiThemes.getMaximumSize().height));</b>
<b class="nc">&nbsp;        JLabel uiThemesLabel = new JLabel(Messages.getString(&quot;CommonSettingsDialog.uiTheme&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(uiThemesLabel);</b>
<b class="nc">&nbsp;        row.add(uiThemes);</b>
<b class="nc">&nbsp;        comps.add(row);   </b>
&nbsp;        
&nbsp;        // Spacer
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(Box.createRigidArea(new Dimension(0, 5)));</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;
&nbsp;        // Skin
<b class="nc">&nbsp;        skinFiles = new JComboBox&lt;String&gt;();</b>
<b class="nc">&nbsp;        skinFiles.setMaximumSize(new Dimension(400,skinFiles.getMaximumSize().height));</b>
<b class="nc">&nbsp;        JLabel skinFileLabel = new JLabel(Messages.getString(&quot;CommonSettingsDialog.skinFile&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(skinFileLabel);</b>
<b class="nc">&nbsp;        row.add(skinFiles);</b>
<b class="nc">&nbsp;        comps.add(row);   </b>
&nbsp;        
&nbsp;        // Spacer
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(Box.createRigidArea(new Dimension(0, 5)));</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;
&nbsp;        // Tileset
<b class="nc">&nbsp;        JLabel tileSetChoiceLabel = new JLabel(Messages.getString(&quot;CommonSettingsDialog.tileset&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        tileSetChoice = new JComboBox&lt;String&gt;(); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        tileSetChoice.setMaximumSize(new Dimension(400,tileSetChoice.getMaximumSize().height));</b>
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(tileSetChoiceLabel);</b>
<b class="nc">&nbsp;        row.add(Box.createHorizontalStrut(15));</b>
<b class="nc">&nbsp;        row.add(tileSetChoice);</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;        
&nbsp;        // Horizontal Line and Spacer
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(Box.createRigidArea(new Dimension(0, 10)));</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;
<b class="nc">&nbsp;        JSeparator highlightSep = new JSeparator(SwingConstants.HORIZONTAL);</b>
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(highlightSep);</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;        
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(Box.createRigidArea(new Dimension(0, 5)));</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;        
&nbsp;        // Highlighting Radius inside FoV
&nbsp;        //
&nbsp;        // Highlight inside Check box
<b class="nc">&nbsp;        fovInsideEnabled = new JCheckBox(Messages.getString(&quot;TacticalOverlaySettingsDialog.FovInsideEnabled&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        fovInsideEnabled.addItemListener(this);</b>
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(fovInsideEnabled);</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;
&nbsp;        // Add some vertical spacing
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(Box.createVerticalStrut(2));</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;
&nbsp;        // Inside Opaqueness slider
<b class="nc">&nbsp;        fovHighlightAlpha = new JSlider(0, 255);</b>
<b class="nc">&nbsp;        fovHighlightAlpha.setMajorTickSpacing(25);</b>
<b class="nc">&nbsp;        fovHighlightAlpha.setMinorTickSpacing(5);</b>
<b class="nc">&nbsp;        fovHighlightAlpha.setPaintTicks(true);</b>
<b class="nc">&nbsp;        fovHighlightAlpha.setPaintLabels(true);</b>
<b class="nc">&nbsp;        fovHighlightAlpha.setMaximumSize(new Dimension(400, 100));</b>
<b class="nc">&nbsp;        fovHighlightAlpha.addChangeListener(this);</b>
<b class="nc">&nbsp;        fovHighlightAlpha.setToolTipText(Messages.getString(&quot;TacticalOverlaySettingsDialog.AlphaTooltip&quot;));</b>
&nbsp;        // Label
<b class="nc">&nbsp;        highlightAlphaLabel = new JLabel(Messages.getString(&quot;TacticalOverlaySettingsDialog.FovHighlightAlpha&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(Box.createRigidArea(DEPENDENT_INSET));</b>
<b class="nc">&nbsp;        row.add(highlightAlphaLabel);</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;        
&nbsp;        // Add some vertical spacing
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(Box.createVerticalStrut(1));</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;        
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(Box.createRigidArea(DEPENDENT_INSET));</b>
<b class="nc">&nbsp;        row.add(fovHighlightAlpha);</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;        
&nbsp;        // Add some vertical spacing
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(Box.createVerticalStrut(3));</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        fovHighlightRingsRadiiLabel = new JLabel(Messages.getString(&quot;TacticalOverlaySettingsDialog.FovHighlightRingsRadii&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        row.add(Box.createRigidArea(DEPENDENT_INSET));</b>
<b class="nc">&nbsp;        row.add(fovHighlightRingsRadiiLabel);</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;        
&nbsp;        // Add some vertical spacing
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(Box.createVerticalStrut(2));</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;        
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        fovHighlightRingsRadii= new JTextField((2+1)*7);</b>
<b class="nc">&nbsp;        fovHighlightRingsRadii.addFocusListener(this);</b>
<b class="nc">&nbsp;        fovHighlightRingsRadii.setMaximumSize(new Dimension(100,fovHighlightRingsRadii.getPreferredSize().height) );</b>
<b class="nc">&nbsp;        row.add(Box.createRigidArea(DEPENDENT_INSET));</b>
<b class="nc">&nbsp;        row.add(fovHighlightRingsRadii);</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;
&nbsp;        // Add some vertical spacing
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(Box.createVerticalStrut(2));</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;        
<b class="nc">&nbsp;        row= new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        fovHighlightRingsColorsLabel = new JLabel(Messages.getString(&quot;TacticalOverlaySettingsDialog.FovHighlightRingsColors&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        row.add(Box.createRigidArea(DEPENDENT_INSET));</b>
<b class="nc">&nbsp;        row.add(fovHighlightRingsColorsLabel);</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;                
&nbsp;        // Add some vertical spacing
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(Box.createVerticalStrut(2));</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;        
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        fovHighlightRingsColors= new JTextField(50);//      ((3+1)*3+1)*7);</b>
<b class="nc">&nbsp;        fovHighlightRingsColors.addFocusListener(this);</b>
<b class="nc">&nbsp;        fovHighlightRingsColors.setMaximumSize(new Dimension(200,fovHighlightRingsColors.getPreferredSize().height) );</b>
<b class="nc">&nbsp;        row.add(Box.createRigidArea(DEPENDENT_INSET));</b>
<b class="nc">&nbsp;        row.add(fovHighlightRingsColors);</b>
<b class="nc">&nbsp;        row.add(Box.createHorizontalGlue());</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;
&nbsp;        // Horizontal Line and Spacer
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(Box.createRigidArea(new Dimension(0, 10)));</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;
<b class="nc">&nbsp;        JSeparator OutSideSep = new JSeparator(SwingConstants.HORIZONTAL);</b>
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(OutSideSep);</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;        
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(Box.createRigidArea(new Dimension(0, 5)));</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;        
&nbsp;        // Outside FoV Darkening
&nbsp;        //
&nbsp;        // Activation Checkbox
<b class="nc">&nbsp;        fovOutsideEnabled = new JCheckBox(Messages.getString(&quot;TacticalOverlaySettingsDialog.FovOutsideEnabled&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        fovOutsideEnabled.addItemListener(this);</b>
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(fovOutsideEnabled);</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;        
&nbsp;        // Add some vertical spacing
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(Box.createVerticalStrut(1));</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;
<b class="nc">&nbsp;        fovDarkenAlpha = new JSlider(0, 255);</b>
<b class="nc">&nbsp;        fovDarkenAlpha.setMajorTickSpacing(25);</b>
<b class="nc">&nbsp;        fovDarkenAlpha.setMinorTickSpacing(5);</b>
<b class="nc">&nbsp;        fovDarkenAlpha.setPaintTicks(true);</b>
<b class="nc">&nbsp;        fovDarkenAlpha.setPaintLabels(true);</b>
<b class="nc">&nbsp;        fovDarkenAlpha.setMaximumSize(new Dimension(400, 100));</b>
<b class="nc">&nbsp;        fovDarkenAlpha.addChangeListener(this);</b>
<b class="nc">&nbsp;        fovDarkenAlpha.setToolTipText(Messages.getString(&quot;TacticalOverlaySettingsDialog.AlphaTooltip&quot;));</b>
<b class="nc">&nbsp;        darkenAlphaLabel = new JLabel(Messages.getString(&quot;TacticalOverlaySettingsDialog.FovDarkenAlpha&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        darkenAlphaLabel.setToolTipText(Messages.getString(&quot;TacticalOverlaySettingsDialog.AlphaTooltip&quot;));</b>
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(Box.createRigidArea(new Dimension(4,0)));</b>
<b class="nc">&nbsp;        row.add(Box.createRigidArea(DEPENDENT_INSET));</b>
<b class="nc">&nbsp;        row.add(darkenAlphaLabel);</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;        
&nbsp;        // Add some vertical spacing
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(Box.createVerticalStrut(2));</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;        
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(Box.createRigidArea(DEPENDENT_INSET));</b>
<b class="nc">&nbsp;        row.add(fovDarkenAlpha);</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;        
&nbsp;        // Add some vertical spacing
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(Box.createVerticalStrut(4));</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;        
<b class="nc">&nbsp;        numStripesSlider = new JSlider(0, 50);</b>
<b class="nc">&nbsp;        numStripesSlider.setMajorTickSpacing(10);</b>
<b class="nc">&nbsp;        numStripesSlider.setMinorTickSpacing(5);</b>
<b class="nc">&nbsp;        numStripesSlider.setPaintTicks(true);</b>
<b class="nc">&nbsp;        numStripesSlider.setPaintLabels(true);</b>
<b class="nc">&nbsp;        numStripesSlider.setMaximumSize(new Dimension(250, 100));</b>
<b class="nc">&nbsp;        numStripesSlider.addChangeListener(this);</b>
<b class="nc">&nbsp;        numStripesSlider.setToolTipText(Messages.getString(&quot;TacticalOverlaySettingsDialog.FovStripesTooltip&quot;));</b>
<b class="nc">&nbsp;        numStripesLabel = new JLabel(</b>
<b class="nc">&nbsp;                Messages.getString(&quot;TacticalOverlaySettingsDialog.FovStripes&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        numStripesLabel.setToolTipText(Messages.getString(&quot;TacticalOverlaySettingsDialog.FovStripesTooltip&quot;));</b>
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(Box.createRigidArea(new Dimension(4,0)));</b>
<b class="nc">&nbsp;        row.add(Box.createRigidArea(DEPENDENT_INSET));</b>
<b class="nc">&nbsp;        row.add(numStripesLabel);</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;        
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(Box.createVerticalStrut(1));</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;        
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(Box.createRigidArea(new Dimension(4,0)));</b>
<b class="nc">&nbsp;        row.add(Box.createRigidArea(DEPENDENT_INSET));</b>
<b class="nc">&nbsp;        row.add(numStripesSlider);</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;        
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        row.add(Box.createVerticalStrut(3));</b>
<b class="nc">&nbsp;        comps.add(row);</b>
&nbsp;        
<b class="nc">&nbsp;        row = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        fovGrayscaleEnabled = new JCheckBox(</b>
<b class="nc">&nbsp;                Messages.getString(&quot;TacticalOverlaySettingsDialog.FovGrayscale&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        fovGrayscaleEnabled.addItemListener(this);</b>
<b class="nc">&nbsp;        row.add(Box.createRigidArea(new Dimension(4,0)));</b>
<b class="nc">&nbsp;        row.add(Box.createRigidArea(DEPENDENT_INSET));</b>
<b class="nc">&nbsp;        row.add(fovGrayscaleEnabled);</b>
<b class="nc">&nbsp;        comps.add(row);   </b>
&nbsp;        
<b class="nc">&nbsp;        return createSettingsPanel(comps);</b>
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * Creates a panel with a box for all of the commands that can be bound to
&nbsp;     * keys.
&nbsp;     *
&nbsp;     * @return
&nbsp;     */
&nbsp;    private JPanel getKeyBindPanel() {
&nbsp;        // Create the panel to hold all the components
&nbsp;        // We will have an N x 43 grid, the first column is for labels, the
&nbsp;        //  second column will hold text fields for modifiers, the third
&nbsp;        //  column holds text fields for keys, and the fourth has a checkbox for
&nbsp;        //  isRepeatable.
<b class="nc">&nbsp;        JPanel outer = new JPanel();</b>
<b class="nc">&nbsp;        outer.setLayout(new FlowLayout(FlowLayout.LEFT));</b>
&nbsp;        
<b class="nc">&nbsp;        JPanel keyBinds = new JPanel(new GridBagLayout());</b>
<b class="nc">&nbsp;        outer.add(keyBinds);</b>
<b class="nc">&nbsp;        GridBagConstraints gbc = new GridBagConstraints();</b>
<b class="nc">&nbsp;        gbc.gridx = gbc.gridy = 0;</b>
<b class="nc">&nbsp;        gbc.insets = new Insets(0,10,5,10);</b>
&nbsp;        
&nbsp;        // Create header: labels for describing what each column does
<b class="nc">&nbsp;        JLabel headers = new JLabel(&quot;Name&quot;);</b>
<b class="nc">&nbsp;        headers.setToolTipText(&quot;The name of the action&quot;);</b>
<b class="nc">&nbsp;        keyBinds.add(headers, gbc);</b>
<b class="nc">&nbsp;        gbc.gridx++;</b>
<b class="nc">&nbsp;        headers = new JLabel(&quot;Modifier&quot;);</b>
<b class="nc">&nbsp;        headers.setToolTipText(&quot;The modifier key, like shift, ctrl, alt&quot;);</b>
<b class="nc">&nbsp;        keyBinds.add(headers, gbc);</b>
<b class="nc">&nbsp;        gbc.gridx++;</b>
<b class="nc">&nbsp;        headers = new JLabel(&quot;Key&quot;);</b>
<b class="nc">&nbsp;        headers.setToolTipText(&quot;The key&quot;);</b>
<b class="nc">&nbsp;        keyBinds.add(headers, gbc);</b>
<b class="nc">&nbsp;        gbc.gridx++;</b>
<b class="nc">&nbsp;        headers = new JLabel(&quot;Repeatable?&quot;);</b>
<b class="nc">&nbsp;        headers.setToolTipText(&quot;Should this action repeat rapidly &quot; +</b>
&nbsp;                &quot;when the key is held down?&quot;);
<b class="nc">&nbsp;        keyBinds.add(headers, gbc);</b>
<b class="nc">&nbsp;        gbc.gridy++;</b>
<b class="nc">&nbsp;        gbc.gridx = 0;</b>
<b class="nc">&nbsp;        gbc.gridwidth = 4;</b>
&nbsp;        
<b class="nc">&nbsp;        gbc.fill = GridBagConstraints.BOTH;</b>
<b class="nc">&nbsp;        JSeparator sep = new JSeparator(SwingConstants.HORIZONTAL);</b>
<b class="nc">&nbsp;        keyBinds.add(sep,gbc);</b>
&nbsp;        
<b class="nc">&nbsp;        gbc.fill = GridBagConstraints.NONE;</b>
<b class="nc">&nbsp;        gbc.gridy++;</b>
<b class="nc">&nbsp;        gbc.gridwidth = 1;</b>
&nbsp;        
&nbsp;
&nbsp;        // Create maps to retrieve the text fields for saving
<b class="nc">&nbsp;        int numBinds = KeyCommandBind.values().length;</b>
<b class="nc">&nbsp;        cmdModifierMap = new HashMap&lt;String,JTextField&gt;((int)(numBinds*1.26));</b>
<b class="nc">&nbsp;        cmdKeyMap = new HashMap&lt;String,Integer&gt;((int)(numBinds*1.26));</b>
<b class="nc">&nbsp;        cmdRepeatableMap = new HashMap&lt;String,JCheckBox&gt;((int)(numBinds*1.26));</b>
&nbsp;
&nbsp;        // For each keyCommandBind, create a label and two text fields
<b class="nc">&nbsp;        for (KeyCommandBind kcb : KeyCommandBind.values()){</b>
<b class="nc">&nbsp;            JLabel name = new JLabel(</b>
<b class="nc">&nbsp;                    Messages.getString(&quot;KeyBinds.cmdNames.&quot; + kcb.cmd));</b>
<b class="nc">&nbsp;            name.setToolTipText(</b>
<b class="nc">&nbsp;                    Messages.getString(&quot;KeyBinds.cmdDesc.&quot; + kcb.cmd));</b>
<b class="nc">&nbsp;            gbc.anchor = GridBagConstraints.EAST;</b>
<b class="nc">&nbsp;            keyBinds.add(name, gbc);</b>
<b class="nc">&nbsp;            gbc.gridx++;</b>
<b class="nc">&nbsp;            gbc.anchor = GridBagConstraints.CENTER;</b>
&nbsp;
<b class="nc">&nbsp;            final JTextField modifiers = new JTextField(10);</b>
<b class="nc">&nbsp;            modifiers.setText(KeyEvent.getKeyModifiersText(kcb.modifiers));</b>
<b class="nc">&nbsp;            for (KeyListener kl : modifiers.getKeyListeners()){</b>
<b class="nc">&nbsp;                modifiers.removeKeyListener(kl);</b>
&nbsp;            }
&nbsp;            // Update how typing in the text field works
<b class="nc">&nbsp;            modifiers.addKeyListener(new KeyListener(){</b>
&nbsp;
&nbsp;                @Override
&nbsp;                public void keyPressed(KeyEvent evt) {
<b class="nc">&nbsp;                    modifiers.setText(</b>
<b class="nc">&nbsp;                            KeyEvent.getKeyModifiersText(evt.getModifiers()));</b>
<b class="nc">&nbsp;                    evt.consume();</b>
&nbsp;                }
&nbsp;
&nbsp;                @Override
&nbsp;                public void keyReleased(KeyEvent evt) {
<b class="nc">&nbsp;                }</b>
&nbsp;
&nbsp;                @Override
&nbsp;                public void keyTyped(KeyEvent evt) {
&nbsp;                    // This might be a bit hackish, but we want to deal with
&nbsp;                    //  the key code, so the code to update the text is in
&nbsp;                    //  keyPressed.  We&#39;ve already done what we want with the
&nbsp;                    //  typed key, and we don&#39;t want anything else acting upon
&nbsp;                    //  the key typed event, so we consume it here.
<b class="nc">&nbsp;                    evt.consume();</b>
&nbsp;                }
&nbsp;
&nbsp;            });
<b class="nc">&nbsp;            keyBinds.add(modifiers, gbc);</b>
<b class="nc">&nbsp;            gbc.gridx++;</b>
<b class="nc">&nbsp;            cmdModifierMap.put(kcb.cmd, modifiers);</b>
<b class="nc">&nbsp;            final JTextField key  = new JTextField(10);</b>
<b class="nc">&nbsp;            key.setName(kcb.cmd);</b>
<b class="nc">&nbsp;            key.setText(KeyEvent.getKeyText(kcb.key));</b>
&nbsp;            // Update how typing in the text field works
<b class="nc">&nbsp;            final String cmd = kcb.cmd;</b>
<b class="nc">&nbsp;            cmdKeyMap.put(cmd, kcb.key);</b>
<b class="nc">&nbsp;            key.addKeyListener(new KeyListener(){</b>
&nbsp;
&nbsp;                @Override
&nbsp;                public void keyPressed(KeyEvent evt) {
<b class="nc">&nbsp;                    key.setText(KeyEvent.getKeyText(evt.getKeyCode()));</b>
<b class="nc">&nbsp;                    cmdKeyMap.put(cmd, evt.getKeyCode());</b>
<b class="nc">&nbsp;                    evt.consume();</b>
&nbsp;                }
&nbsp;
&nbsp;                @Override
&nbsp;                public void keyReleased(KeyEvent evt) {
<b class="nc">&nbsp;                }</b>
&nbsp;
&nbsp;                @Override
&nbsp;                public void keyTyped(KeyEvent evt) {
&nbsp;                    // This might be a bit hackish, but we want to deal with
&nbsp;                    //  the key code, so the code to update the text is in
&nbsp;                    //  keyPressed.  We&#39;ve already done what we want with the
&nbsp;                    //  typed key, and we don&#39;t want anything else acting upon
&nbsp;                    //  the key typed event, so we consume it here.
<b class="nc">&nbsp;                    evt.consume();</b>
&nbsp;                }
&nbsp;
&nbsp;            });
<b class="nc">&nbsp;            keyBinds.add(key, gbc);</b>
<b class="nc">&nbsp;            gbc.gridx++;</b>
&nbsp;
<b class="nc">&nbsp;            JCheckBox repeatable = new JCheckBox(&quot;Repeatable?&quot;);</b>
<b class="nc">&nbsp;            repeatable.setSelected(kcb.isRepeatable);</b>
<b class="nc">&nbsp;            cmdRepeatableMap.put(kcb.cmd,repeatable);</b>
<b class="nc">&nbsp;            keyBinds.add(repeatable, gbc);</b>
<b class="nc">&nbsp;            gbc.gridx = 0;</b>
<b class="nc">&nbsp;            gbc.gridy++;</b>
&nbsp;            
&nbsp;            // deactivate TABbing through fields here so TAB can be caught as a keybind
<b class="nc">&nbsp;            modifiers.setFocusTraversalKeysEnabled(false);</b>
<b class="nc">&nbsp;            key.setFocusTraversalKeysEnabled(false);</b>
<b class="nc">&nbsp;            repeatable.setFocusTraversalKeysEnabled(false);</b>
&nbsp;        }
<b class="nc">&nbsp;        return outer;</b>
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * Creates a panel with a list boxes that allow the button order to be 
&nbsp;     * changed.
&nbsp;     *
&nbsp;     * @return
&nbsp;     */
&nbsp;    private JPanel getButtonOrderPanel(){
<b class="nc">&nbsp;        JPanel buttonOrderPanel = new JPanel();</b>
<b class="nc">&nbsp;        buttonOrderPanel.setLayout(new BoxLayout(buttonOrderPanel, BoxLayout.Y_AXIS));</b>
<b class="nc">&nbsp;        JTabbedPane phasePane = new JTabbedPane();</b>
<b class="nc">&nbsp;        buttonOrderPanel.add(phasePane);</b>
&nbsp;        
&nbsp;        // MovementPhaseDisplay        
<b class="nc">&nbsp;        movePhaseCommands = new DefaultListModel&lt;StatusBarPhaseDisplay.PhaseCommand&gt;();</b>
<b class="nc">&nbsp;        phasePane.add(&quot;Movement&quot;, getButtonOrderPane(movePhaseCommands,</b>
<b class="nc">&nbsp;                MovementDisplay.MoveCommand.values()));</b>
&nbsp;        
&nbsp;        // DeploymentPhaseDisplay
<b class="nc">&nbsp;        deployPhaseCommands = new DefaultListModel&lt;StatusBarPhaseDisplay.PhaseCommand&gt;();</b>
<b class="nc">&nbsp;        phasePane.add(&quot;Deployment&quot;, getButtonOrderPane(deployPhaseCommands,</b>
<b class="nc">&nbsp;                DeploymentDisplay.DeployCommand.values()));</b>
&nbsp;        
&nbsp;        // FiringPhaseDisplay
<b class="nc">&nbsp;        firingPhaseCommands = new DefaultListModel&lt;StatusBarPhaseDisplay.PhaseCommand&gt;();</b>
<b class="nc">&nbsp;        phasePane.add(&quot;Firing&quot;, getButtonOrderPane(firingPhaseCommands,</b>
<b class="nc">&nbsp;                FiringDisplay.FiringCommand.values()));</b>
&nbsp;        
&nbsp;        // PhysicalPhaseDisplay
<b class="nc">&nbsp;        physicalPhaseCommands = new DefaultListModel&lt;StatusBarPhaseDisplay.PhaseCommand&gt;();</b>
<b class="nc">&nbsp;        phasePane.add(&quot;Physical&quot;, getButtonOrderPane(physicalPhaseCommands,</b>
<b class="nc">&nbsp;                PhysicalDisplay.PhysicalCommand.values()));          </b>
&nbsp;        
&nbsp;        // TargetingPhaseDisplay
<b class="nc">&nbsp;        targetingPhaseCommands = new DefaultListModel&lt;StatusBarPhaseDisplay.PhaseCommand&gt;();</b>
<b class="nc">&nbsp;        phasePane.add(&quot;Targeting&quot;, getButtonOrderPane(targetingPhaseCommands,</b>
<b class="nc">&nbsp;                TargetingPhaseDisplay.TargetingCommand.values()));</b>
&nbsp;        
<b class="nc">&nbsp;        return buttonOrderPanel;</b>
&nbsp;    }
&nbsp;
&nbsp;    /** Constructs the button ordering panel for one phase. */ 
&nbsp;    private JScrollPane getButtonOrderPane(DefaultListModel&lt;PhaseCommand&gt; list, 
&nbsp;            StatusBarPhaseDisplay.PhaseCommand[] commands) {
<b class="nc">&nbsp;        JPanel panel = new JPanel();</b>
<b class="nc">&nbsp;        Arrays.sort(commands, cmdComp);        </b>
<b class="nc">&nbsp;        for (StatusBarPhaseDisplay.PhaseCommand cmd : commands) {</b>
<b class="nc">&nbsp;            list.addElement(cmd);</b>
&nbsp;        }
<b class="nc">&nbsp;        JList&lt;StatusBarPhaseDisplay.PhaseCommand&gt; jlist = new JList&lt;&gt;(list);</b>
<b class="nc">&nbsp;        jlist.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);</b>
<b class="nc">&nbsp;        jlist.addMouseListener(cmdMouseAdaptor);</b>
<b class="nc">&nbsp;        jlist.addMouseMotionListener(cmdMouseAdaptor);</b>
<b class="nc">&nbsp;        panel.add(jlist);</b>
<b class="nc">&nbsp;        JScrollPane scrollPane = new JScrollPane(panel);</b>
<b class="nc">&nbsp;        scrollPane.getVerticalScrollBar().setUnitIncrement(16);</b>
<b class="nc">&nbsp;        return scrollPane;</b>
&nbsp;    }
&nbsp;
&nbsp;    private JPanel createSettingsPanel(ArrayList&lt;ArrayList&lt;Component&gt;&gt; comps) {
<b class="nc">&nbsp;        JPanel panel = new JPanel();</b>
<b class="nc">&nbsp;        panel.setLayout(new BorderLayout());</b>
<b class="nc">&nbsp;        Box innerpanel = new Box(BoxLayout.PAGE_AXIS);</b>
<b class="nc">&nbsp;        for (ArrayList&lt;Component&gt; cs : comps) {</b>
<b class="nc">&nbsp;            Box subPanel = new Box(BoxLayout.LINE_AXIS);</b>
<b class="nc">&nbsp;            for (Component c : cs) {</b>
<b class="nc">&nbsp;                if (c instanceof JLabel) {</b>
<b class="nc">&nbsp;                    subPanel.add(Box.createRigidArea(LABEL_SPACER));</b>
<b class="nc">&nbsp;                    subPanel.add(c);</b>
<b class="nc">&nbsp;                    subPanel.add(Box.createRigidArea(LABEL_SPACER));</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    subPanel.add(c);    </b>
&nbsp;                }
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;            subPanel.setAlignmentX(Component.LEFT_ALIGNMENT);</b>
<b class="nc">&nbsp;            innerpanel.add(subPanel);</b>
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;        innerpanel.add(Box.createVerticalGlue());</b>
<b class="nc">&nbsp;        innerpanel.setBorder(new EmptyBorder(10,10,10,10));</b>
<b class="nc">&nbsp;        panel.add(innerpanel,BorderLayout.PAGE_START);</b>
<b class="nc">&nbsp;        return panel;</b>
&nbsp;    }
&nbsp;
&nbsp;    private JPanel getAdvancedSettingsPanel() {
<b class="nc">&nbsp;        JPanel p = new JPanel();</b>
&nbsp;
<b class="nc">&nbsp;        String[] s = GUIPreferences.getInstance().getAdvancedProperties();</b>
<b class="nc">&nbsp;        AdvancedOptionData[] opts = new AdvancedOptionData[s.length];</b>
<b class="nc">&nbsp;        for (int i = 0; i &lt; s.length; i++) {</b>
<b class="nc">&nbsp;            s[i] = s[i].substring(s[i].indexOf(&quot;Advanced&quot;) + 8, s[i].length());</b>
<b class="nc">&nbsp;            opts[i] = new AdvancedOptionData(s[i]);</b>
&nbsp;        }
<b class="nc">&nbsp;        Arrays.sort(opts);</b>
<b class="nc">&nbsp;        advancedKeys = new JList&lt;&gt;(opts);</b>
<b class="nc">&nbsp;        advancedKeys.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);</b>
<b class="nc">&nbsp;        advancedKeys.addListSelectionListener(this);</b>
<b class="nc">&nbsp;        advancedKeys.addMouseMotionListener(new MouseMotionAdapter() {</b>
&nbsp;            @Override
&nbsp;            public void mouseMoved(MouseEvent e) {
<b class="nc">&nbsp;                int index = advancedKeys.locationToIndex(e.getPoint());</b>
<b class="nc">&nbsp;                if (index &gt; -1) {</b>
<b class="nc">&nbsp;                    AdvancedOptionData dat = advancedKeys.getModel().getElementAt(index);</b>
<b class="nc">&nbsp;                    if (dat.hasTooltipText()) {</b>
<b class="nc">&nbsp;                        advancedKeys.setToolTipText(dat.getTooltipText());</b>
&nbsp;                    } else {
<b class="nc">&nbsp;                        advancedKeys.setToolTipText(null);</b>
&nbsp;                    }
&nbsp;                }
&nbsp;            }
&nbsp;        });
<b class="nc">&nbsp;        p.add(advancedKeys);</b>
&nbsp;
<b class="nc">&nbsp;        advancedValue = new JTextField(10);</b>
<b class="nc">&nbsp;        advancedValue.setFont(new Font(Font.SANS_SERIF, Font.PLAIN, 16));</b>
<b class="nc">&nbsp;        advancedValue.addFocusListener(this);</b>
<b class="nc">&nbsp;        p.add(advancedValue);</b>
&nbsp;
<b class="nc">&nbsp;        return p;</b>
&nbsp;    }
&nbsp;
&nbsp;    /** Used to note which advanced setting is currently clicked. */  
&nbsp;    public void valueChanged(ListSelectionEvent event) {
<b class="nc">&nbsp;        if (event.getValueIsAdjusting()) {</b>
&nbsp;            return;
&nbsp;        }
<b class="nc">&nbsp;        if (event.getSource().equals(advancedKeys)) {</b>
<b class="nc">&nbsp;            advancedValue.setText(GUIPreferences.getInstance().getString(</b>
<b class="nc">&nbsp;                    &quot;Advanced&quot; + advancedKeys.getSelectedValue().option));</b>
<b class="nc">&nbsp;            advancedKeyIndex = advancedKeys.getSelectedIndex();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public void stateChanged(ChangeEvent evt) {
<b class="nc">&nbsp;        GUIPreferences guip = GUIPreferences.getInstance();</b>
<b class="nc">&nbsp;        if (evt.getSource().equals(fovHighlightAlpha)) {</b>
<b class="nc">&nbsp;            guip.setFovHighlightAlpha(Math.max(0, Math.min(255, (int) fovHighlightAlpha.getValue())));</b>
<b class="nc">&nbsp;        } else if (evt.getSource().equals(fovDarkenAlpha)) {</b>
<b class="nc">&nbsp;            guip.setFovDarkenAlpha(Math.max(0, Math.min(255, (int) fovDarkenAlpha.getValue())));</b>
<b class="nc">&nbsp;        } else if (evt.getSource().equals(numStripesSlider)) {</b>
<b class="nc">&nbsp;            guip.setFovStripes(numStripesSlider.getValue());</b>
&nbsp;        }
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2023-05-16 16:28</div>
</div>
</body>
</html>
