


<!DOCTYPE html>
<html id="htmlId">
<head>
  <title>Coverage Report > GameOptionsDialog</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">megamek.client.ui.swing</a>
</div>

<h1>Coverage Summary for Class: GameOptionsDialog (megamek.client.ui.swing)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">GameOptionsDialog</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/23)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/526)
  </span>
</td>
</tr>
  <tr>
    <td class="name">GameOptionsDialog$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">GameOptionsDialog$2</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">GameOptionsDialog$3</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/14)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/32)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/546)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;/**
&nbsp; * MegaMek - Copyright (C) 2000,2001,2002,2003,2004,2005 Ben Mazur (bmazur@sev.org)
&nbsp; *
&nbsp; *  This program is free software; you can redistribute it and/or modify it
&nbsp; *  under the terms of the GNU General Public License as published by the Free
&nbsp; *  Software Foundation; either version 2 of the License, or (at your option)
&nbsp; *  any later version.
&nbsp; *
&nbsp; *  This program is distributed in the hope that it will be useful, but
&nbsp; *  WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
&nbsp; *  or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License
&nbsp; *  for more details.
&nbsp; */
&nbsp;
&nbsp;/*
&nbsp; * GameOptionsDialog.java
&nbsp; *
&nbsp; * Created on April 26, 2002, 2:14 PM
&nbsp; */
&nbsp;
&nbsp;package megamek.client.ui.swing;
&nbsp;
&nbsp;import java.awt.BorderLayout;
&nbsp;import java.awt.Dimension;
&nbsp;import java.awt.GridBagConstraints;
&nbsp;import java.awt.GridBagLayout;
&nbsp;import java.awt.Insets;
&nbsp;import java.awt.event.ActionEvent;
&nbsp;import java.awt.event.ActionListener;
&nbsp;import java.awt.event.WindowAdapter;
&nbsp;import java.awt.event.WindowEvent;
&nbsp;import java.io.File;
&nbsp;import java.util.ArrayList;
&nbsp;import java.util.Collections;
&nbsp;import java.util.Enumeration;
&nbsp;import java.util.HashMap;
&nbsp;import java.util.List;
&nbsp;import java.util.Map;
&nbsp;import java.util.Vector;
&nbsp;
&nbsp;import javax.swing.BoxLayout;
&nbsp;import javax.swing.JButton;
&nbsp;import javax.swing.JDialog;
&nbsp;import javax.swing.JFileChooser;
&nbsp;import javax.swing.JFrame;
&nbsp;import javax.swing.JLabel;
&nbsp;import javax.swing.JPanel;
&nbsp;import javax.swing.JScrollPane;
&nbsp;import javax.swing.JTabbedPane;
&nbsp;import javax.swing.JTextField;
&nbsp;import javax.swing.ScrollPaneConstants;
&nbsp;import javax.swing.event.DocumentEvent;
&nbsp;import javax.swing.event.DocumentListener;
&nbsp;import javax.swing.filechooser.FileFilter;
&nbsp;import javax.xml.parsers.DocumentBuilder;
&nbsp;
&nbsp;import org.w3c.dom.Document;
&nbsp;import org.w3c.dom.NodeList;
&nbsp;
&nbsp;import megamek.client.ui.GBC;
&nbsp;import megamek.client.ui.Messages;
&nbsp;import megamek.common.Entity;
&nbsp;import megamek.common.Mech;
&nbsp;import megamek.common.Tank;
&nbsp;import megamek.common.TechConstants;
&nbsp;import megamek.common.options.GameOptions;
&nbsp;import megamek.common.options.IBasicOption;
&nbsp;import megamek.common.options.IOption;
&nbsp;import megamek.common.options.IOptionGroup;
&nbsp;import megamek.common.options.OptionsConstants;
&nbsp;import megamek.common.weapons.bayweapons.CapitalMissileBayWeapon;
&nbsp;import megamek.utils.MegaMekXmlUtil;
&nbsp;
&nbsp;/**
&nbsp; * Responsible for displaying the current game options and allowing the user to
&nbsp; * change them.
&nbsp; *
&nbsp; * @author Ben
&nbsp; */
<b class="nc">&nbsp;public class GameOptionsDialog extends JDialog implements ActionListener, DialogOptionListener {</b>
&nbsp;
&nbsp;    /**
&nbsp;     *
&nbsp;     */
&nbsp;    private static final long serialVersionUID = -6072295678938594119L;
&nbsp;    private ClientGUI client;
&nbsp;    private GameOptions options;
&nbsp;
<b class="nc">&nbsp;    private boolean editable = true;</b>
<b class="nc">&nbsp;    private boolean cancelled = false;</b>
&nbsp;
&nbsp;    /**
&nbsp;     * A map that maps an option to a collection of DialogOptionComponents that
&nbsp;     * can effect the value of this option.
&nbsp;     */
<b class="nc">&nbsp;    private Map&lt;String, List&lt;DialogOptionComponent&gt;&gt; optionComps = new HashMap&lt;&gt;();</b>
&nbsp;
&nbsp;    /**
&nbsp;     * Keeps track of the DialogOptionComponents that have been added to the
&nbsp;     * search panel. This is used to remove those components from optionComps
&nbsp;     * when they get removed.
&nbsp;     */
<b class="nc">&nbsp;    private ArrayList&lt;DialogOptionComponent&gt; searchComps = new ArrayList&lt;&gt;();</b>
&nbsp;
&nbsp;    private int maxOptionWidth;
&nbsp;
<b class="nc">&nbsp;    private JTabbedPane panOptions = new JTabbedPane();</b>
&nbsp;
&nbsp;    /**
&nbsp;     * Panel that holds all of the options found via search
&nbsp;     */
&nbsp;    private JPanel panSearchOptions;
&nbsp;    /**
&nbsp;     * Text field that contains text to search on
&nbsp;     */
&nbsp;    private JTextField txtSearch;
<b class="nc">&nbsp;    private JPanel panPassword = new JPanel();</b>
<b class="nc">&nbsp;    private JLabel labPass = new JLabel(Messages.getString(&quot;GameOptionsDialog.Password&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;    private JTextField texPass = new JTextField(15);</b>
<b class="nc">&nbsp;    private JPanel panButtons = new JPanel();</b>
<b class="nc">&nbsp;    private JButton butSave = new JButton(Messages.getString(&quot;GameOptionsDialog.Save&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;    private JButton butLoad = new JButton(Messages.getString(&quot;GameOptionsDialog.Load&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;    private JButton butDefaults = new JButton(Messages.getString(&quot;GameOptionsDialog.Defaults&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;    private JButton butOkay = new JButton(Messages.getString(&quot;Okay&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;    private JButton butCancel = new JButton(Messages.getString(&quot;Cancel&quot;)); //$NON-NLS-1$</b>
&nbsp;
&nbsp;    /**
&nbsp;     * When the OK button is pressed, the options can be saved to a file; this
&nbsp;     * behavior happens by default but there are some situations where the
&nbsp;     * options should not be saved, such as when loading a scenario.
&nbsp;     */
<b class="nc">&nbsp;    private boolean performSave = true;</b>
&nbsp;
&nbsp;    /**
&nbsp;     * Initialize this dialog.
&nbsp;     *
&nbsp;     * @param frame
&nbsp;     *            - the &lt;code&gt;Frame&lt;/code&gt; parent of this dialog.
&nbsp;     * @param options
&nbsp;     *            - the &lt;code&gt;GameOptions&lt;/code&gt; to be displayed.
&nbsp;     */
&nbsp;    private void init(JFrame frame, GameOptions options) {
<b class="nc">&nbsp;        this.options = options;</b>
&nbsp;
<b class="nc">&nbsp;        setupButtons();</b>
<b class="nc">&nbsp;        setupPassword();</b>
<b class="nc">&nbsp;        JPanel mainPanel = new JPanel(new GridBagLayout());</b>
&nbsp;
&nbsp;        // layout
<b class="nc">&nbsp;        mainPanel.add(panOptions, GBC.eol().fill(GridBagConstraints.BOTH).insets(5, 5, 5, 5));</b>
<b class="nc">&nbsp;        mainPanel.add(panPassword, GBC.eol().fill(GridBagConstraints.HORIZONTAL).insets(5, 5, 5, 5));</b>
<b class="nc">&nbsp;        mainPanel.add(panButtons, GBC.eol().anchor(GridBagConstraints.CENTER));</b>
&nbsp;
<b class="nc">&nbsp;        getContentPane().add(mainPanel);</b>
&nbsp;
<b class="nc">&nbsp;        addWindowListener(new WindowAdapter() {</b>
&nbsp;            @Override
&nbsp;            public void windowClosing(WindowEvent e) {
<b class="nc">&nbsp;                setVisible(false);</b>
&nbsp;            }
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        pack();</b>
<b class="nc">&nbsp;        GUIPreferences guip = GUIPreferences.getInstance();</b>
<b class="nc">&nbsp;        int width = guip.getGameOptionsSizeWidth();</b>
<b class="nc">&nbsp;        int height = guip.getGameOptionsSizeHeight();</b>
<b class="nc">&nbsp;        setSize(width, height);</b>
<b class="nc">&nbsp;        setResizable(true);</b>
<b class="nc">&nbsp;        setLocationRelativeTo(frame);</b>
<b class="nc">&nbsp;        Dimension size = new Dimension((getSize().width * 40) / 100, (getSize().height * 59) / 100);</b>
<b class="nc">&nbsp;        panOptions.setPreferredSize(size);</b>
<b class="nc">&nbsp;        panOptions.setMinimumSize(size);</b>
<b class="nc">&nbsp;        panOptions.setMaximumSize(size);</b>
&nbsp;
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Creates new &lt;code&gt;GameOptionsDialog&lt;/code&gt; for a &lt;code&gt;Client&lt;/code&gt;
&nbsp;     *
&nbsp;     * @param client
&nbsp;     *            - the &lt;code&gt;Client&lt;/code&gt; parent of this dialog.
&nbsp;     */
&nbsp;    public GameOptionsDialog(ClientGUI client) {
<b class="nc">&nbsp;        super(client.frame, Messages.getString(&quot;GameOptionsDialog.title&quot;), true); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        this.client = client;</b>
<b class="nc">&nbsp;        init(client.frame, client.getClient().getGame().getOptions());</b>
&nbsp;    }
&nbsp;
&nbsp;    public GameOptionsDialog(JFrame frame, GameOptions options, boolean shouldSave) {
<b class="nc">&nbsp;        super(frame, Messages.getString(&quot;GameOptionsDialog.title&quot;), true);</b>
&nbsp;        // $NON-NLS-1$
<b class="nc">&nbsp;        performSave = shouldSave;</b>
<b class="nc">&nbsp;        init(frame, options);</b>
<b class="nc">&nbsp;        butOkay.setEnabled(false);</b>
&nbsp;    }
&nbsp;
&nbsp;    public void update(GameOptions options) {
<b class="nc">&nbsp;        this.options = options;</b>
<b class="nc">&nbsp;        refreshOptions();</b>
&nbsp;    }
&nbsp;
&nbsp;    private void send() {
<b class="nc">&nbsp;        Vector&lt;IBasicOption&gt; changed = new Vector&lt;IBasicOption&gt;();</b>
&nbsp;
<b class="nc">&nbsp;        for (List&lt;DialogOptionComponent&gt; comps : optionComps.values()) {</b>
&nbsp;            // Each option in the list should have the same value, so picking
&nbsp;            // the first is fine
<b class="nc">&nbsp;            if (comps.size() &gt; 0) {</b>
<b class="nc">&nbsp;                DialogOptionComponent comp = comps.get(0);</b>
<b class="nc">&nbsp;                if (comp.hasChanged()) {</b>
<b class="nc">&nbsp;                    changed.addElement(comp.changedOption());</b>
<b class="nc">&nbsp;                    comp.setOptionChanged(false);</b>
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;        }</b>
&nbsp;
<b class="nc">&nbsp;        if ((client != null) &amp;&amp; (changed.size() &gt; 0)) {</b>
<b class="nc">&nbsp;            client.getClient().sendGameOptions(texPass.getText(), changed);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void doSave() {
<b class="nc">&nbsp;        GameOptions.saveOptions(getOptions());</b>
&nbsp;    }
&nbsp;
&nbsp;    public Vector&lt;IBasicOption&gt; getOptions() {
<b class="nc">&nbsp;        Vector&lt;IBasicOption&gt; output = new Vector&lt;IBasicOption&gt;();</b>
&nbsp;
<b class="nc">&nbsp;        for (List&lt;DialogOptionComponent&gt; comps : optionComps.values()) {</b>
&nbsp;            // Each option in the list should have the same value, so picking
&nbsp;            // the first is fine
<b class="nc">&nbsp;            if (comps.size() &gt; 0) {</b>
<b class="nc">&nbsp;                IBasicOption option = comps.get(0).changedOption();</b>
<b class="nc">&nbsp;                output.addElement(option);</b>
&nbsp;            }
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;        return output;</b>
&nbsp;    }
&nbsp;
&nbsp;    private void resetToDefaults() {
<b class="nc">&nbsp;        for (List&lt;DialogOptionComponent&gt; comps : optionComps.values()) {</b>
<b class="nc">&nbsp;            for (DialogOptionComponent comp : comps) {</b>
<b class="nc">&nbsp;                if (!comp.isDefaultValue()) {</b>
<b class="nc">&nbsp;                    comp.resetToDefault();</b>
&nbsp;                }
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;        }</b>
&nbsp;    }
&nbsp;
&nbsp;    public void refreshOptions() {
<b class="nc">&nbsp;        panOptions.removeAll();</b>
<b class="nc">&nbsp;        optionComps = new HashMap&lt;&gt;();</b>
&nbsp;
<b class="nc">&nbsp;        for (Enumeration&lt;IOptionGroup&gt; i = options.getGroups(); i.hasMoreElements();) {</b>
<b class="nc">&nbsp;            IOptionGroup group = i.nextElement();</b>
&nbsp;
<b class="nc">&nbsp;            JPanel groupPanel = addGroup(group);</b>
&nbsp;
<b class="nc">&nbsp;            for (Enumeration&lt;IOption&gt; j = group.getOptions(); j.hasMoreElements();) {</b>
<b class="nc">&nbsp;                IOption option = j.nextElement();</b>
<b class="nc">&nbsp;                addOption(groupPanel, option);</b>
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;        }</b>
&nbsp;
<b class="nc">&nbsp;        addSearchPanel();</b>
&nbsp;
&nbsp;        // Make the width accomadate the longest game option label
&nbsp;        // without needing to scroll horizontally.
<b class="nc">&nbsp;        setSize(Math.max(getSize().width, maxOptionWidth + 30), Math.max(getSize().height, 400));</b>
&nbsp;
<b class="nc">&nbsp;        validate();</b>
&nbsp;    }
&nbsp;
&nbsp;    private void refreshSearchPanel() {
<b class="nc">&nbsp;        panSearchOptions.removeAll();</b>
&nbsp;        // We need to first remove all of the DialogOptionComponents
&nbsp;        // that were on the search panel
<b class="nc">&nbsp;        for (DialogOptionComponent comp : searchComps) {</b>
<b class="nc">&nbsp;            List&lt;DialogOptionComponent&gt; compList = optionComps.get(comp.option.getName());</b>
<b class="nc">&nbsp;            if (compList != null) { // Shouldn&#39;t be null...</b>
<b class="nc">&nbsp;                compList.remove(comp);</b>
&nbsp;            }
<b class="nc">&nbsp;        }</b>
&nbsp;
&nbsp;        // Add new DialogOptionComponents for all matching Options
<b class="nc">&nbsp;        final String searchText = txtSearch.getText().toLowerCase();</b>
<b class="nc">&nbsp;        ArrayList&lt;DialogOptionComponent&gt; allNewComps = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        for (List&lt;DialogOptionComponent&gt; comps : optionComps.values()) {</b>
<b class="nc">&nbsp;            ArrayList&lt;DialogOptionComponent&gt; newComps = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;            for (DialogOptionComponent comp : comps) {</b>
<b class="nc">&nbsp;                String optName = comp.option.getDisplayableName().toLowerCase();</b>
<b class="nc">&nbsp;                String optDesc = comp.option.getDescription().toLowerCase();</b>
<b class="nc">&nbsp;                if ((optName.contains(searchText) || optDesc.contains(searchText)) &amp;&amp; !searchText.equals(&quot;&quot;)) {</b>
<b class="nc">&nbsp;                    DialogOptionComponent newComp = new DialogOptionComponent(this, comp.option);</b>
<b class="nc">&nbsp;                    newComp.setEditable(comp.getEditable());</b>
<b class="nc">&nbsp;                    searchComps.add(newComp);</b>
<b class="nc">&nbsp;                    newComps.add(newComp);</b>
&nbsp;                }
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;            comps.addAll(newComps);</b>
<b class="nc">&nbsp;            allNewComps.addAll(newComps);</b>
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;        Collections.sort(allNewComps);</b>
<b class="nc">&nbsp;        for (DialogOptionComponent comp : allNewComps) {</b>
<b class="nc">&nbsp;            panSearchOptions.add(comp);</b>
<b class="nc">&nbsp;        }</b>
&nbsp;        // panSearchOptions.validate();
<b class="nc">&nbsp;        panOptions.repaint();</b>
&nbsp;    }
&nbsp;
&nbsp;    private JPanel addGroup(IOptionGroup group) {
<b class="nc">&nbsp;        JPanel groupPanel = new JPanel();</b>
<b class="nc">&nbsp;        JScrollPane scrOptions = new JScrollPane(groupPanel);</b>
<b class="nc">&nbsp;        groupPanel.setLayout(new BoxLayout(groupPanel, BoxLayout.Y_AXIS));</b>
<b class="nc">&nbsp;        scrOptions.setAutoscrolls(true);</b>
<b class="nc">&nbsp;        scrOptions.setVerticalScrollBarPolicy(ScrollPaneConstants.VERTICAL_SCROLLBAR_ALWAYS);</b>
<b class="nc">&nbsp;        scrOptions.setHorizontalScrollBarPolicy(ScrollPaneConstants.HORIZONTAL_SCROLLBAR_AS_NEEDED);</b>
&nbsp;
<b class="nc">&nbsp;        panOptions.addTab(group.getDisplayableName(), scrOptions);</b>
<b class="nc">&nbsp;        return groupPanel;</b>
&nbsp;    }
&nbsp;
&nbsp;    private void addSearchPanel() {
<b class="nc">&nbsp;        JPanel panSearch = new JPanel();</b>
<b class="nc">&nbsp;        JScrollPane scrOptions = new JScrollPane(panSearch);</b>
<b class="nc">&nbsp;        scrOptions.setAutoscrolls(true);</b>
<b class="nc">&nbsp;        scrOptions.setVerticalScrollBarPolicy(ScrollPaneConstants.VERTICAL_SCROLLBAR_ALWAYS);</b>
<b class="nc">&nbsp;        scrOptions.setHorizontalScrollBarPolicy(ScrollPaneConstants.HORIZONTAL_SCROLLBAR_AS_NEEDED);</b>
&nbsp;
&nbsp;        // Panel for holding the label and text field for searching
<b class="nc">&nbsp;        JPanel panText = new JPanel();</b>
<b class="nc">&nbsp;        JLabel lblSearch = new JLabel(Messages.getString(&quot;GameOptionsDialog.Search&quot;) + &quot;:&quot;);</b>
<b class="nc">&nbsp;        txtSearch = new JTextField(&quot;&quot;);</b>
<b class="nc">&nbsp;	lblSearch.setLabelFor(txtSearch);</b>
<b class="nc">&nbsp;        lblSearch.setToolTipText(Messages.getString(&quot;GameOptionsDialog.SearchToolTip&quot;));</b>
<b class="nc">&nbsp;        txtSearch.setToolTipText(Messages.getString(&quot;GameOptionsDialog.SearchToolTip&quot;));</b>
<b class="nc">&nbsp;        txtSearch.getDocument().addDocumentListener(new DocumentListener() {</b>
&nbsp;            public void changedUpdate(DocumentEvent e) {
<b class="nc">&nbsp;                refreshSearchPanel();</b>
&nbsp;            }
&nbsp;
&nbsp;            public void insertUpdate(DocumentEvent e) {
<b class="nc">&nbsp;                refreshSearchPanel();</b>
&nbsp;            }
&nbsp;
&nbsp;            public void removeUpdate(DocumentEvent e) {
<b class="nc">&nbsp;                refreshSearchPanel();</b>
&nbsp;            }
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        panText.setLayout(new GridBagLayout());</b>
<b class="nc">&nbsp;        GridBagConstraints gbc = new GridBagConstraints();</b>
<b class="nc">&nbsp;        gbc.gridx = gbc.gridy = 0;</b>
<b class="nc">&nbsp;        gbc.insets = new Insets(10, 5, 15, 5);</b>
<b class="nc">&nbsp;        gbc.anchor = GridBagConstraints.NORTHWEST;</b>
<b class="nc">&nbsp;        gbc.fill = GridBagConstraints.NONE;</b>
<b class="nc">&nbsp;        panText.add(lblSearch, gbc);</b>
<b class="nc">&nbsp;        gbc.gridx++;</b>
<b class="nc">&nbsp;        gbc.weightx = 0.7;</b>
<b class="nc">&nbsp;        gbc.fill = GridBagConstraints.HORIZONTAL;</b>
<b class="nc">&nbsp;        panText.add(txtSearch, gbc);</b>
&nbsp;
<b class="nc">&nbsp;        panSearchOptions = new JPanel();</b>
<b class="nc">&nbsp;        panSearchOptions.setLayout(new BoxLayout(panSearchOptions, BoxLayout.Y_AXIS));</b>
&nbsp;
<b class="nc">&nbsp;        panSearch.setLayout(new GridBagLayout());</b>
<b class="nc">&nbsp;        gbc.gridx = gbc.gridy = 0;</b>
<b class="nc">&nbsp;        gbc.insets = new Insets(0, 0, 0, 0);</b>
<b class="nc">&nbsp;        gbc.anchor = GridBagConstraints.NORTHWEST;</b>
<b class="nc">&nbsp;        gbc.fill = GridBagConstraints.HORIZONTAL;</b>
<b class="nc">&nbsp;        gbc.weightx = 0.7;</b>
<b class="nc">&nbsp;        panSearch.add(panText, gbc);</b>
<b class="nc">&nbsp;        gbc.gridy++;</b>
<b class="nc">&nbsp;        gbc.weighty = 0.7;</b>
&nbsp;
<b class="nc">&nbsp;        gbc.fill = GridBagConstraints.BOTH;</b>
<b class="nc">&nbsp;        panSearch.add(panSearchOptions, gbc);</b>
&nbsp;
<b class="nc">&nbsp;        panOptions.addTab(Messages.getString(&quot;GameOptionsDialog.Search&quot;), scrOptions);</b>
&nbsp;    }
&nbsp;
&nbsp;    private void addOption(JPanel groupPanel, IOption option) {
<b class="nc">&nbsp;        if (option == null) {</b>
&nbsp;            return;
&nbsp;        }
<b class="nc">&nbsp;        DialogOptionComponent optionComp = new DialogOptionComponent(this, option, true, true);</b>
&nbsp;
<b class="nc">&nbsp;        groupPanel.add(optionComp);</b>
<b class="nc">&nbsp;        maxOptionWidth = Math.max(maxOptionWidth, optionComp.getPreferredSize().width);</b>
&nbsp;
<b class="nc">&nbsp;        if (OptionsConstants.INIT_INF_DEPLOY_EVEN.equals(option.getName())) { // $NON-NLS-1$</b>
<b class="nc">&nbsp;            if ((options.getOption(OptionsConstants.RPG_INDIVIDUAL_INITIATIVE)).booleanValue() // $NON-NLS-1$</b>
<b class="nc">&nbsp;                    || !(options.getOption(OptionsConstants.INIT_INF_MOVE_EVEN)).booleanValue() // $NON-NLS-1$</b>
&nbsp;                    || !editable) {
<b class="nc">&nbsp;                optionComp.setEditable(false);</b>
&nbsp;            }
<b class="nc">&nbsp;        } else if (OptionsConstants.INIT_INF_MOVE_MULTI.equals(option.getName())) { // $NON-NLS-1$</b>
<b class="nc">&nbsp;            if ((options.getOption(OptionsConstants.RPG_INDIVIDUAL_INITIATIVE)).booleanValue() // $NON-NLS-1$</b>
<b class="nc">&nbsp;                    || (options.getOption(OptionsConstants.INIT_INF_MOVE_EVEN)).booleanValue() // $NON-NLS-1$</b>
<b class="nc">&nbsp;                    || (options.getOption(OptionsConstants.INIT_INF_MOVE_LATER)).booleanValue() // $NON-NLS-1$</b>
&nbsp;                    || !editable) {
<b class="nc">&nbsp;                optionComp.setEditable(false);</b>
&nbsp;            }
<b class="nc">&nbsp;        } else if (OptionsConstants.INIT_INF_MOVE_EVEN.equals(option.getName())) { // $NON-NLS-1$</b>
<b class="nc">&nbsp;            if ((options.getOption(OptionsConstants.RPG_INDIVIDUAL_INITIATIVE)).booleanValue() // $NON-NLS-1$</b>
<b class="nc">&nbsp;                    || (options.getOption(OptionsConstants.INIT_INF_MOVE_MULTI)).booleanValue() // $NON-NLS-1$</b>
<b class="nc">&nbsp;                    || (options.getOption(OptionsConstants.INIT_INF_MOVE_LATER)).booleanValue() // $NON-NLS-1$</b>
&nbsp;                    || !editable) {
<b class="nc">&nbsp;                optionComp.setEditable(false);</b>
&nbsp;            }
<b class="nc">&nbsp;        } else if (OptionsConstants.INIT_INF_MOVE_LATER.equals(option.getName())) { // $NON-NLS-1$</b>
<b class="nc">&nbsp;            if ((options.getOption(OptionsConstants.RPG_INDIVIDUAL_INITIATIVE)).booleanValue() // $NON-NLS-1$</b>
<b class="nc">&nbsp;                    || (options.getOption(OptionsConstants.INIT_INF_MOVE_EVEN)).booleanValue() // $NON-NLS-1$</b>
<b class="nc">&nbsp;                    || (options.getOption(OptionsConstants.INIT_INF_MOVE_MULTI)).booleanValue() // $NON-NLS-1$</b>
&nbsp;                    || !editable) {
<b class="nc">&nbsp;                optionComp.setEditable(false);</b>
&nbsp;            }
<b class="nc">&nbsp;        } else if (OptionsConstants.INIT_PROTOS_MOVE_EVEN.equals(option.getName())) { // $NON-NLS-1$</b>
<b class="nc">&nbsp;            if ((options.getOption(OptionsConstants.RPG_INDIVIDUAL_INITIATIVE)).booleanValue() // $NON-NLS-1$</b>
<b class="nc">&nbsp;                    || !(options.getOption(OptionsConstants.INIT_PROTOS_MOVE_EVEN)).booleanValue() // $NON-NLS-1$</b>
&nbsp;                    || !editable) {
<b class="nc">&nbsp;                optionComp.setEditable(false);</b>
&nbsp;            }
<b class="nc">&nbsp;        } else if (OptionsConstants.INIT_PROTOS_MOVE_MULTI.equals(option.getName())) { // $NON-NLS-1$</b>
<b class="nc">&nbsp;            if ((options.getOption(OptionsConstants.RPG_INDIVIDUAL_INITIATIVE)).booleanValue() // $NON-NLS-1$</b>
<b class="nc">&nbsp;                    || (options.getOption(OptionsConstants.INIT_PROTOS_MOVE_EVEN)).booleanValue() // $NON-NLS-1$</b>
<b class="nc">&nbsp;                    || (options.getOption(OptionsConstants.INIT_PROTOS_MOVE_LATER)).booleanValue() // $NON-NLS-1$</b>
&nbsp;                    || !editable) {
<b class="nc">&nbsp;                optionComp.setEditable(false);</b>
&nbsp;            }
<b class="nc">&nbsp;        } else if (OptionsConstants.INIT_PROTOS_MOVE_EVEN.equals(option.getName())) { // $NON-NLS-1$</b>
<b class="nc">&nbsp;            if ((options.getOption(OptionsConstants.RPG_INDIVIDUAL_INITIATIVE)).booleanValue() // $NON-NLS-1$</b>
<b class="nc">&nbsp;                    || (options.getOption(OptionsConstants.INIT_PROTOS_MOVE_MULTI)).booleanValue() // $NON-NLS-1$</b>
<b class="nc">&nbsp;                    || (options.getOption(OptionsConstants.INIT_PROTOS_MOVE_LATER)).booleanValue() // $NON-NLS-1$</b>
&nbsp;                    || !editable) {
<b class="nc">&nbsp;                optionComp.setEditable(false);</b>
&nbsp;            }
<b class="nc">&nbsp;        } else if (OptionsConstants.INIT_PROTOS_MOVE_LATER.equals(option.getName())) { // $NON-NLS-1$</b>
<b class="nc">&nbsp;            if ((options.getOption(OptionsConstants.RPG_INDIVIDUAL_INITIATIVE)).booleanValue() // $NON-NLS-1$</b>
<b class="nc">&nbsp;                    || (options.getOption(OptionsConstants.INIT_PROTOS_MOVE_EVEN)).booleanValue() // $NON-NLS-1$</b>
<b class="nc">&nbsp;                    || (options.getOption(OptionsConstants.INIT_PROTOS_MOVE_MULTI)).booleanValue() // $NON-NLS-1$</b>
&nbsp;                    || !editable) {
<b class="nc">&nbsp;                optionComp.setEditable(false);</b>
&nbsp;            }
<b class="nc">&nbsp;        } else if (option.getName().equals(OptionsConstants.ADVGRNDMOV_TACOPS_FALLING_EXPANDED)) { // $NON-NLS-1$</b>
<b class="nc">&nbsp;            if (!(options.getOption(OptionsConstants.ADVGRNDMOV_TACOPS_HULL_DOWN)).booleanValue() // $NON-NLS-1$</b>
&nbsp;                    || !editable) {
<b class="nc">&nbsp;                optionComp.setEditable(false);</b>
&nbsp;            }
<b class="nc">&nbsp;        } else if (option.getName().equals(OptionsConstants.ADVCOMBAT_TACOPS_LOS1)) { // $NON-NLS-1$</b>
<b class="nc">&nbsp;            if ((options.getOption(OptionsConstants.ADVCOMBAT_TACOPS_DEAD_ZONES)).booleanValue() // $NON-NLS-1$</b>
&nbsp;                    || !editable) {
<b class="nc">&nbsp;                optionComp.setEditable(false);</b>
&nbsp;            }
<b class="nc">&nbsp;        } else if (option.getName().equals(OptionsConstants.ADVCOMBAT_TACOPS_LOS_RANGE)) { // $NON-NLS-1$</b>
<b class="nc">&nbsp;            if (!options.getOption(OptionsConstants.ADVCOMBAT_TACOPS_RANGE).booleanValue() // $NON-NLS-1$</b>
&nbsp;                    || !editable) {
<b class="nc">&nbsp;                optionComp.setEditable(false);</b>
&nbsp;            }
<b class="nc">&nbsp;        } else if (option.getName().equals(OptionsConstants.ADVCOMBAT_TACOPS_DEAD_ZONES)) { // $NON-NLS-1$</b>
<b class="nc">&nbsp;            if ((options.getOption(OptionsConstants.ADVCOMBAT_TACOPS_LOS1)).booleanValue() // $NON-NLS-1$</b>
&nbsp;                    || !editable) {
<b class="nc">&nbsp;                optionComp.setEditable(false);</b>
&nbsp;            }
<b class="nc">&nbsp;        } else if (option.getName().equals(OptionsConstants.ADVCOMBAT_KIND_RAPID_AC)) {</b>
<b class="nc">&nbsp;            if ((options.getOption(OptionsConstants.ADVCOMBAT_TACOPS_RAPID_AC)).booleanValue()) {</b>
<b class="nc">&nbsp;                optionComp.setEditable(editable);</b>
&nbsp;            } else {
<b class="nc">&nbsp;                optionComp.setEditable(false);</b>
&nbsp;            }
<b class="nc">&nbsp;        } else if (option.getName().equals(OptionsConstants.ADVCOMBAT_VEHICLES_THRESHOLD_DIVISOR)) {</b>
<b class="nc">&nbsp;            if ((options.getOption(OptionsConstants.ADVCOMBAT_VEHICLES_THRESHOLD)).booleanValue()) {</b>
<b class="nc">&nbsp;                optionComp.setEditable(editable);</b>
&nbsp;            } else {
<b class="nc">&nbsp;                optionComp.setEditable(false);</b>
&nbsp;            }
<b class="nc">&nbsp;        } else if (option.getName().equals(OptionsConstants.ADVCOMBAT_VEHICLES_THRESHOLD_VARIABLE)) {</b>
<b class="nc">&nbsp;            if ((options.getOption(OptionsConstants.ADVCOMBAT_VEHICLES_THRESHOLD)).booleanValue()) {</b>
<b class="nc">&nbsp;                optionComp.setEditable(editable);</b>
&nbsp;            } else {
<b class="nc">&nbsp;                optionComp.setEditable(false);</b>
&nbsp;            }
<b class="nc">&nbsp;        } else if (option.getName().equals(OptionsConstants.ADVAERORULES_STRATOPS_BEARINGS_ONLY_VELOCITY)) {</b>
<b class="nc">&nbsp;            if (option.intValue() &lt; CapitalMissileBayWeapon.CAPITAL_MISSILE_MIN_VELOCITY) {</b>
&nbsp;                //Set to the minimum velocity if under
<b class="nc">&nbsp;                option.setValue(CapitalMissileBayWeapon.CAPITAL_MISSILE_MIN_VELOCITY);</b>
<b class="nc">&nbsp;            } else if (option.intValue() &gt; CapitalMissileBayWeapon.CAPITAL_MISSILE_MAX_VELOCITY) {</b>
&nbsp;                //Set to the maximum velocity if over
<b class="nc">&nbsp;                option.setValue(CapitalMissileBayWeapon.CAPITAL_MISSILE_MAX_VELOCITY);</b>
&nbsp;            }
<b class="nc">&nbsp;        } else if (option.getName().equals(OptionsConstants.RPG_BEGIN_SHUTDOWN)) {</b>
<b class="nc">&nbsp;            if ((options.getOption(OptionsConstants.RPG_MANUAL_SHUTDOWN)).booleanValue()) {</b>
<b class="nc">&nbsp;                optionComp.setEditable(editable);</b>
&nbsp;            } else {
<b class="nc">&nbsp;                optionComp.setEditable(false);</b>
&nbsp;            }
<b class="nc">&nbsp;        } else if (option.getName().equals(OptionsConstants.ADVANCED_ALTERNATE_MASC_ENHANCED)) {</b>
<b class="nc">&nbsp;            if ((options.getOption(OptionsConstants.ADVANCED_ALTERNATE_MASC)).booleanValue()) {</b>
<b class="nc">&nbsp;                optionComp.setEditable(editable);</b>
&nbsp;            } else {
<b class="nc">&nbsp;                optionComp.setEditable(false);</b>
&nbsp;            }
<b class="nc">&nbsp;        } else if (option.getName().equals(&quot;techlevel&quot;)) {</b>
<b class="nc">&nbsp;            for (String tlName : TechConstants.T_SIMPLE_NAMES) {</b>
<b class="nc">&nbsp;                optionComp.addValue(tlName);</b>
&nbsp;            }
<b class="nc">&nbsp;            optionComp.setSelected(option.stringValue());</b>
<b class="nc">&nbsp;            optionComp.setEditable(editable);</b>
<b class="nc">&nbsp;        } else if (option.getName().equals(OptionsConstants.ADVGRNDMOV_MEK_LANCE_MOVEMENT)) {</b>
&nbsp;            // Disable if individual init is on
<b class="nc">&nbsp;            if (!options.getOption(OptionsConstants.RPG_INDIVIDUAL_INITIATIVE).booleanValue()) {</b>
<b class="nc">&nbsp;                optionComp.setEditable(editable);</b>
&nbsp;            } else {
<b class="nc">&nbsp;                optionComp.setEditable(false);</b>
&nbsp;            }
<b class="nc">&nbsp;        } else if (option.getName().equals(OptionsConstants.ADVGRNDMOV_VEHICLE_LANCE_MOVEMENT)) {</b>
&nbsp;            // Disable if individual init is on
<b class="nc">&nbsp;            if (!options.getOption(OptionsConstants.RPG_INDIVIDUAL_INITIATIVE).booleanValue()) {</b>
<b class="nc">&nbsp;                optionComp.setEditable(editable);</b>
&nbsp;            } else {
<b class="nc">&nbsp;                optionComp.setEditable(false);</b>
&nbsp;            }
<b class="nc">&nbsp;        } else if (option.getName().equals(OptionsConstants.RPG_INDIVIDUAL_INITIATIVE)) {</b>
&nbsp;            // Disable if any lance movement is on
<b class="nc">&nbsp;            if (!options.getOption(OptionsConstants.ADVGRNDMOV_VEHICLE_LANCE_MOVEMENT).booleanValue() </b>
<b class="nc">&nbsp;                    &amp;&amp; !options.getOption(OptionsConstants.ADVGRNDMOV_MEK_LANCE_MOVEMENT).booleanValue()) {</b>
<b class="nc">&nbsp;                optionComp.setEditable(editable);</b>
&nbsp;            } else {
<b class="nc">&nbsp;                optionComp.setEditable(false);</b>
&nbsp;            }
&nbsp;        } else {
<b class="nc">&nbsp;            optionComp.setEditable(editable);</b>
&nbsp;        }
<b class="nc">&nbsp;        List&lt;DialogOptionComponent&gt; comps = optionComps.get(option.getName());</b>
<b class="nc">&nbsp;        if (comps == null) {</b>
<b class="nc">&nbsp;            comps = new ArrayList&lt;DialogOptionComponent&gt;();</b>
<b class="nc">&nbsp;            optionComps.put(option.getName(), comps);</b>
&nbsp;        }
<b class="nc">&nbsp;        comps.add(optionComp);</b>
&nbsp;    }
&nbsp;
&nbsp;    // Gets called when one of the option checkboxes is clicked.
&nbsp;    // Arguments are the GameOption object and the true/false
&nbsp;    // state of the checkbox.
&nbsp;    public void optionClicked(DialogOptionComponent clickedComp, IOption option, boolean state) {
&nbsp;
&nbsp;        // Ensure that any other DialogOptionComponents with the same IOption
&nbsp;        // have the same value
<b class="nc">&nbsp;        List&lt;DialogOptionComponent&gt; comps = optionComps.get(option.getName());</b>
<b class="nc">&nbsp;        for (DialogOptionComponent comp : comps) {</b>
<b class="nc">&nbsp;            if (!comp.equals(clickedComp)) {</b>
<b class="nc">&nbsp;                comp.setValue(clickedComp.getValue());</b>
&nbsp;            }
<b class="nc">&nbsp;        }</b>
&nbsp;
<b class="nc">&nbsp;        if (OptionsConstants.INIT_INF_MOVE_EVEN.equals(option.getName())) { // $NON-NLS-1$</b>
<b class="nc">&nbsp;            comps = optionComps.get(OptionsConstants.INIT_INF_DEPLOY_EVEN); // $NON-NLS-1$</b>
<b class="nc">&nbsp;            for (DialogOptionComponent comp_i : comps) {</b>
<b class="nc">&nbsp;                comp_i.setEditable(state);</b>
<b class="nc">&nbsp;                comp_i.setSelected(false);</b>
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;            comps = optionComps.get(OptionsConstants.INIT_INF_MOVE_MULTI); // $NON-NLS-1$</b>
<b class="nc">&nbsp;            for (DialogOptionComponent comp_i : comps) {</b>
<b class="nc">&nbsp;                comp_i.setEditable(!state);</b>
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;            comps = optionComps.get(OptionsConstants.INIT_INF_MOVE_LATER); // $NON-NLS-1$</b>
<b class="nc">&nbsp;            for (DialogOptionComponent comp_i : comps) {</b>
<b class="nc">&nbsp;                comp_i.setEditable(!state);</b>
<b class="nc">&nbsp;            }</b>
&nbsp;        }
<b class="nc">&nbsp;        if (OptionsConstants.INIT_INF_MOVE_MULTI.equals(option.getName())) { // $NON-NLS-1$</b>
<b class="nc">&nbsp;            comps = optionComps.get(OptionsConstants.INIT_INF_MOVE_EVEN); // $NON-NLS-1$</b>
<b class="nc">&nbsp;            for (DialogOptionComponent comp_i : comps) {</b>
<b class="nc">&nbsp;                comp_i.setEditable(!state);</b>
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;            comps = optionComps.get(OptionsConstants.INIT_INF_MOVE_LATER); // $NON-NLS-1$</b>
<b class="nc">&nbsp;            for (DialogOptionComponent comp_i : comps) {</b>
<b class="nc">&nbsp;                comp_i.setEditable(!state);</b>
<b class="nc">&nbsp;            }</b>
&nbsp;        }
<b class="nc">&nbsp;        if (OptionsConstants.INIT_INF_MOVE_LATER.equals(option.getName())) { // $NON-NLS-1$</b>
<b class="nc">&nbsp;            comps = optionComps.get(OptionsConstants.INIT_INF_MOVE_EVEN); // $NON-NLS-1$</b>
<b class="nc">&nbsp;            for (DialogOptionComponent comp_i : comps) {</b>
<b class="nc">&nbsp;                comp_i.setEditable(!state);</b>
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;            comps = optionComps.get(OptionsConstants.INIT_INF_MOVE_MULTI); // $NON-NLS-1$</b>
<b class="nc">&nbsp;            for (DialogOptionComponent comp_i : comps) {</b>
<b class="nc">&nbsp;                comp_i.setEditable(!state);</b>
<b class="nc">&nbsp;            }</b>
&nbsp;        }
<b class="nc">&nbsp;        if (OptionsConstants.INIT_PROTOS_MOVE_EVEN.equals(option.getName())) { // $NON-NLS-1$</b>
<b class="nc">&nbsp;            comps = optionComps.get(OptionsConstants.INIT_PROTOS_MOVE_EVEN); // $NON-NLS-1$</b>
<b class="nc">&nbsp;            for (DialogOptionComponent comp_i : comps) {</b>
<b class="nc">&nbsp;                comp_i.setEditable(state);</b>
<b class="nc">&nbsp;                comp_i.setSelected(false);</b>
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;            comps = optionComps.get(OptionsConstants.INIT_PROTOS_MOVE_MULTI); // $NON-NLS-1$</b>
<b class="nc">&nbsp;            for (DialogOptionComponent comp_i : comps) {</b>
<b class="nc">&nbsp;                comp_i.setEditable(!state);</b>
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;            comps = optionComps.get(OptionsConstants.INIT_PROTOS_MOVE_LATER); // $NON-NLS-1$</b>
<b class="nc">&nbsp;            for (DialogOptionComponent comp_i : comps) {</b>
<b class="nc">&nbsp;                comp_i.setEditable(!state);</b>
<b class="nc">&nbsp;            }</b>
&nbsp;        }
<b class="nc">&nbsp;        if (OptionsConstants.INIT_PROTOS_MOVE_MULTI.equals(option.getName())) { // $NON-NLS-1$</b>
<b class="nc">&nbsp;            comps = optionComps.get(OptionsConstants.INIT_PROTOS_MOVE_EVEN); // $NON-NLS-1$</b>
<b class="nc">&nbsp;            for (DialogOptionComponent comp_i : comps) {</b>
<b class="nc">&nbsp;                comp_i.setEditable(!state);</b>
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;            comps = optionComps.get(OptionsConstants.INIT_PROTOS_MOVE_LATER); // $NON-NLS-1$</b>
<b class="nc">&nbsp;            for (DialogOptionComponent comp_i : comps) {</b>
<b class="nc">&nbsp;                comp_i.setEditable(!state);</b>
<b class="nc">&nbsp;            }</b>
&nbsp;        }
<b class="nc">&nbsp;        if (OptionsConstants.INIT_PROTOS_MOVE_LATER.equals(option.getName())) { // $NON-NLS-1$</b>
<b class="nc">&nbsp;            comps = optionComps.get(OptionsConstants.INIT_PROTOS_MOVE_EVEN); // $NON-NLS-1$</b>
<b class="nc">&nbsp;            for (DialogOptionComponent comp_i : comps) {</b>
<b class="nc">&nbsp;                comp_i.setEditable(!state);</b>
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;            comps = optionComps.get(OptionsConstants.INIT_PROTOS_MOVE_MULTI); // $NON-NLS-1$</b>
<b class="nc">&nbsp;            for (DialogOptionComponent comp_i : comps) {</b>
<b class="nc">&nbsp;                comp_i.setEditable(!state);</b>
<b class="nc">&nbsp;            }</b>
&nbsp;        }
<b class="nc">&nbsp;        if (option.getName().equals(OptionsConstants.RPG_INDIVIDUAL_INITIATIVE)) {</b>
<b class="nc">&nbsp;            comps = optionComps.get(OptionsConstants.INIT_PROTOS_MOVE_EVEN); // $NON-NLS-1$</b>
<b class="nc">&nbsp;            for (DialogOptionComponent comp_i : comps) {</b>
<b class="nc">&nbsp;                comp_i.setEditable(false);</b>
<b class="nc">&nbsp;                comp_i.setSelected(false);</b>
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;            comps = optionComps.get(OptionsConstants.INIT_PROTOS_MOVE_EVEN); // $NON-NLS-1$</b>
<b class="nc">&nbsp;            for (DialogOptionComponent comp_i : comps) {</b>
<b class="nc">&nbsp;                comp_i.setEditable(!state);</b>
<b class="nc">&nbsp;                comp_i.setSelected(false);</b>
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;            comps = optionComps.get(OptionsConstants.INIT_PROTOS_MOVE_MULTI); // $NON-NLS-1$</b>
<b class="nc">&nbsp;            for (DialogOptionComponent comp_i : comps) {</b>
<b class="nc">&nbsp;                comp_i.setEditable(!state);</b>
<b class="nc">&nbsp;                comp_i.setSelected(false);</b>
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;            comps = optionComps.get(OptionsConstants.INIT_PROTOS_MOVE_LATER); // $NON-NLS-1$</b>
<b class="nc">&nbsp;            for (DialogOptionComponent comp_i : comps) {</b>
<b class="nc">&nbsp;                comp_i.setEditable(!state);</b>
<b class="nc">&nbsp;                comp_i.setSelected(false);</b>
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;            comps = optionComps.get(OptionsConstants.INIT_INF_DEPLOY_EVEN); // $NON-NLS-1$</b>
<b class="nc">&nbsp;            for (DialogOptionComponent comp_i : comps) {</b>
<b class="nc">&nbsp;                comp_i.setEditable(false);</b>
<b class="nc">&nbsp;                comp_i.setSelected(false);</b>
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;            comps = optionComps.get(OptionsConstants.INIT_INF_MOVE_EVEN); // $NON-NLS-1$</b>
<b class="nc">&nbsp;            for (DialogOptionComponent comp_i : comps) {</b>
<b class="nc">&nbsp;                comp_i.setEditable(!state);</b>
<b class="nc">&nbsp;                comp_i.setSelected(false);</b>
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;            comps = optionComps.get(OptionsConstants.INIT_INF_MOVE_MULTI); // $NON-NLS-1$</b>
<b class="nc">&nbsp;            for (DialogOptionComponent comp_i : comps) {</b>
<b class="nc">&nbsp;                comp_i.setEditable(!state);</b>
<b class="nc">&nbsp;                comp_i.setSelected(false);</b>
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;            comps = optionComps.get(OptionsConstants.INIT_INF_MOVE_LATER); // $NON-NLS-1$</b>
<b class="nc">&nbsp;            for (DialogOptionComponent comp_i : comps) {</b>
<b class="nc">&nbsp;                comp_i.setEditable(!state);</b>
<b class="nc">&nbsp;                comp_i.setSelected(false);</b>
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;            comps = optionComps.get(OptionsConstants.ADVGRNDMOV_MEK_LANCE_MOVEMENT);</b>
<b class="nc">&nbsp;            for (DialogOptionComponent comp_i : comps) {</b>
<b class="nc">&nbsp;                comp_i.setEditable(!state);</b>
<b class="nc">&nbsp;                comp_i.setSelected(false);</b>
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;            comps = optionComps.get(OptionsConstants.ADVGRNDMOV_VEHICLE_LANCE_MOVEMENT);</b>
<b class="nc">&nbsp;            for (DialogOptionComponent comp_i : comps) {</b>
<b class="nc">&nbsp;                comp_i.setEditable(!state);</b>
<b class="nc">&nbsp;                comp_i.setSelected(false);</b>
<b class="nc">&nbsp;            }</b>
&nbsp;        }
<b class="nc">&nbsp;        if (option.getName().equals(OptionsConstants.ADVGRNDMOV_VEHICLE_LANCE_MOVEMENT)</b>
<b class="nc">&nbsp;                || option.getName().equals(OptionsConstants.ADVGRNDMOV_MEK_LANCE_MOVEMENT)) {</b>
<b class="nc">&nbsp;            comps = optionComps.get(OptionsConstants.RPG_INDIVIDUAL_INITIATIVE);</b>
<b class="nc">&nbsp;            for (DialogOptionComponent comp_i : comps) {</b>
<b class="nc">&nbsp;                comp_i.setEditable(!state);</b>
<b class="nc">&nbsp;                comp_i.setSelected(false);</b>
<b class="nc">&nbsp;            }</b>
&nbsp;        }
<b class="nc">&nbsp;        if (&quot;vacuum&quot;.equals(option.getName())) { //$NON-NLS-1$</b>
<b class="nc">&nbsp;            comps = optionComps.get(&quot;fire&quot;); //$NON-NLS-1$</b>
<b class="nc">&nbsp;            for (DialogOptionComponent comp_i : comps) {</b>
<b class="nc">&nbsp;                comp_i.setEditable(!state);</b>
<b class="nc">&nbsp;                comp_i.setSelected(false);</b>
<b class="nc">&nbsp;            }</b>
&nbsp;        }
<b class="nc">&nbsp;        if (OptionsConstants.ADVGRNDMOV_TACOPS_HULL_DOWN.equals(option.getName())) { // $NON-NLS-1$</b>
<b class="nc">&nbsp;            comps = optionComps.get(OptionsConstants.ADVGRNDMOV_TACOPS_FALLING_EXPANDED); // $NON-NLS-1$</b>
<b class="nc">&nbsp;            for (DialogOptionComponent comp_i : comps) {</b>
<b class="nc">&nbsp;                comp_i.setEditable(state);</b>
<b class="nc">&nbsp;                comp_i.setSelected(false);</b>
<b class="nc">&nbsp;            }</b>
&nbsp;        }
<b class="nc">&nbsp;        if (OptionsConstants.ADVCOMBAT_TACOPS_DEAD_ZONES.equals(option.getName())) { // $NON-NLS-1$</b>
<b class="nc">&nbsp;            comps = optionComps.get(OptionsConstants.ADVCOMBAT_TACOPS_LOS1); // $NON-NLS-1$</b>
<b class="nc">&nbsp;            for (DialogOptionComponent comp_i : comps) {</b>
<b class="nc">&nbsp;                comp_i.setEditable(!state);</b>
<b class="nc">&nbsp;                comp_i.setSelected(false);</b>
<b class="nc">&nbsp;            }</b>
&nbsp;        }
<b class="nc">&nbsp;        if (OptionsConstants.ADVCOMBAT_TACOPS_RANGE.equals(option.getName())) {</b>
<b class="nc">&nbsp;            comps = optionComps.get(OptionsConstants.ADVCOMBAT_TACOPS_LOS_RANGE);</b>
<b class="nc">&nbsp;            for (DialogOptionComponent comp_i : comps) {</b>
<b class="nc">&nbsp;                comp_i.setEditable(state);</b>
<b class="nc">&nbsp;                comp_i.setSelected(false);</b>
<b class="nc">&nbsp;            }</b>
&nbsp;        }
<b class="nc">&nbsp;        if (OptionsConstants.ADVCOMBAT_TACOPS_LOS1.equals(option.getName())) { // $NON-NLS-1$</b>
<b class="nc">&nbsp;            comps = optionComps.get(OptionsConstants.ADVCOMBAT_TACOPS_DEAD_ZONES); // $NON-NLS-1$</b>
<b class="nc">&nbsp;            for (DialogOptionComponent comp_i : comps) {</b>
<b class="nc">&nbsp;                comp_i.setEditable(!state);</b>
<b class="nc">&nbsp;                comp_i.setSelected(false);</b>
<b class="nc">&nbsp;            }</b>
&nbsp;        }
<b class="nc">&nbsp;        if (option.getName().equals(OptionsConstants.ADVCOMBAT_TACOPS_RAPID_AC)) {</b>
<b class="nc">&nbsp;            comps = optionComps.get(OptionsConstants.ADVCOMBAT_KIND_RAPID_AC); // $NON-NLS-1$</b>
<b class="nc">&nbsp;            for (DialogOptionComponent comp_i : comps) {</b>
<b class="nc">&nbsp;                comp_i.setEditable(state);</b>
<b class="nc">&nbsp;                comp_i.setSelected(false);</b>
<b class="nc">&nbsp;            }</b>
&nbsp;        }
<b class="nc">&nbsp;        if (option.getName().equals(OptionsConstants.ADVCOMBAT_VEHICLES_THRESHOLD)) {</b>
<b class="nc">&nbsp;            comps = optionComps.get(OptionsConstants.ADVCOMBAT_VEHICLES_THRESHOLD_VARIABLE); // $NON-NLS-1$</b>
<b class="nc">&nbsp;            for (DialogOptionComponent comp_i : comps) {</b>
<b class="nc">&nbsp;                comp_i.setEditable(state);</b>
<b class="nc">&nbsp;                comp_i.setSelected(false);</b>
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;            comps = optionComps.get(OptionsConstants.ADVCOMBAT_VEHICLES_THRESHOLD_DIVISOR); // $NON-NLS-1$</b>
<b class="nc">&nbsp;            for (DialogOptionComponent comp_i : comps) {</b>
<b class="nc">&nbsp;                comp_i.setEditable(state);</b>
<b class="nc">&nbsp;                comp_i.resetToDefault();</b>
<b class="nc">&nbsp;            }</b>
&nbsp;        }
<b class="nc">&nbsp;        if (option.getName().equals(OptionsConstants.RPG_MANUAL_SHUTDOWN)) {</b>
<b class="nc">&nbsp;            comps = optionComps.get(OptionsConstants.RPG_BEGIN_SHUTDOWN); //$NON-NLS-1$</b>
<b class="nc">&nbsp;            for (DialogOptionComponent comp_i : comps) {</b>
<b class="nc">&nbsp;                comp_i.setEditable(state);</b>
<b class="nc">&nbsp;                comp_i.setSelected(false);</b>
<b class="nc">&nbsp;            }</b>
&nbsp;        }
<b class="nc">&nbsp;        if (option.getName().equals(OptionsConstants.ADVANCED_ALTERNATE_MASC)) {</b>
<b class="nc">&nbsp;            comps = optionComps.get(OptionsConstants.ADVANCED_ALTERNATE_MASC_ENHANCED); // $NON-NLS-1$</b>
<b class="nc">&nbsp;            for (DialogOptionComponent comp_i : comps) {</b>
<b class="nc">&nbsp;                comp_i.setEditable(state);</b>
<b class="nc">&nbsp;                comp_i.setSelected(false);</b>
<b class="nc">&nbsp;            }</b>
&nbsp;        }
<b class="nc">&nbsp;        if (option.getName().equals(OptionsConstants.ADVANCED_BA_GRAB_BARS)) {</b>
<b class="nc">&nbsp;            if (client != null) {</b>
<b class="nc">&nbsp;                for (Entity ent : client.getClient().getGame().getEntitiesVector()) {</b>
<b class="nc">&nbsp;                    if (ent instanceof Mech) {</b>
<b class="nc">&nbsp;                        ((Mech) ent).setBAGrabBars();</b>
&nbsp;                    }
<b class="nc">&nbsp;                    if (ent instanceof Tank) {</b>
<b class="nc">&nbsp;                        ((Tank) ent).setBAGrabBars();</b>
&nbsp;                    }
<b class="nc">&nbsp;                }</b>
&nbsp;            }
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void setupButtons() {
<b class="nc">&nbsp;        butOkay.addActionListener(this);</b>
<b class="nc">&nbsp;        butCancel.addActionListener(this);</b>
<b class="nc">&nbsp;        butDefaults.addActionListener(this);</b>
<b class="nc">&nbsp;        butSave.addActionListener(this);</b>
<b class="nc">&nbsp;        butLoad.addActionListener(this);</b>
&nbsp;
<b class="nc">&nbsp;        panButtons.add(butOkay);</b>
<b class="nc">&nbsp;        panButtons.add(butCancel);</b>
<b class="nc">&nbsp;        panButtons.add(butDefaults);</b>
<b class="nc">&nbsp;        panButtons.add(butSave);</b>
<b class="nc">&nbsp;        panButtons.add(butLoad);</b>
&nbsp;    }
&nbsp;
&nbsp;    private void setupPassword() {
<b class="nc">&nbsp;        panPassword.setLayout(new BorderLayout());</b>
<b class="nc">&nbsp;	labPass.setLabelFor(texPass);</b>
<b class="nc">&nbsp;        panPassword.add(labPass, BorderLayout.WEST);</b>
<b class="nc">&nbsp;        panPassword.add(texPass, BorderLayout.CENTER);</b>
&nbsp;    }
&nbsp;
&nbsp;    public void actionPerformed(ActionEvent e) {
<b class="nc">&nbsp;        if (e.getSource().equals(butOkay)) {</b>
<b class="nc">&nbsp;            cancelled = false;</b>
<b class="nc">&nbsp;            if (client != null) {</b>
<b class="nc">&nbsp;                send();</b>
&nbsp;            }
<b class="nc">&nbsp;            if (performSave) {</b>
<b class="nc">&nbsp;                doSave();</b>
&nbsp;            }
<b class="nc">&nbsp;        } else if (e.getSource().equals(butDefaults)) {</b>
<b class="nc">&nbsp;            resetToDefaults();</b>
&nbsp;            return;
<b class="nc">&nbsp;        } else if (e.getSource().equals(butSave)) {</b>
<b class="nc">&nbsp;            File gameOptsFile = selectGameOptionsFile(true);</b>
<b class="nc">&nbsp;            if (gameOptsFile != null) {</b>
<b class="nc">&nbsp;                GameOptions.saveOptions(getOptions(), gameOptsFile.getAbsolutePath());</b>
&nbsp;            }
&nbsp;            return;
<b class="nc">&nbsp;        } else if (e.getSource().equals(butLoad)) {</b>
<b class="nc">&nbsp;            File gameOptsFile = selectGameOptionsFile(false);</b>
<b class="nc">&nbsp;            if (gameOptsFile != null) {</b>
<b class="nc">&nbsp;                options.loadOptions(gameOptsFile, false);</b>
<b class="nc">&nbsp;                ArrayList&lt;IOption&gt; changed = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;                for (List&lt;DialogOptionComponent&gt; comps : optionComps.values()) {</b>
&nbsp;                    // Each option in the list should have the same value, so
&nbsp;                    // picking the first is fine
<b class="nc">&nbsp;                    if (comps.size() &gt; 0) {</b>
<b class="nc">&nbsp;                        DialogOptionComponent comp = comps.get(0);</b>
<b class="nc">&nbsp;                        if (comp.hasChanged()) {</b>
<b class="nc">&nbsp;                            changed.add(comp.getOption());</b>
&nbsp;                        }
&nbsp;                    }
<b class="nc">&nbsp;                }</b>
<b class="nc">&nbsp;                refreshOptions();</b>
&nbsp;                // We need to ensure that the IOption for the component doesn&#39;t
&nbsp;                // match, otherwise send() won&#39;t send updates to the server
<b class="nc">&nbsp;                for (IOption opt : changed) {</b>
<b class="nc">&nbsp;                    String name = opt.getName();</b>
<b class="nc">&nbsp;                    List&lt;DialogOptionComponent&gt; comps = optionComps.get(name);</b>
<b class="nc">&nbsp;                    if (comps.size() &gt; 0) {</b>
<b class="nc">&nbsp;                        comps.get(0).setOptionChanged(true);</b>
&nbsp;                    }
<b class="nc">&nbsp;                }</b>
&nbsp;            }
&nbsp;            return;
<b class="nc">&nbsp;        } else if (e.getSource().equals(butCancel)) {</b>
<b class="nc">&nbsp;            cancelled = true;</b>
&nbsp;        }
<b class="nc">&nbsp;        setVisible(false);</b>
&nbsp;    }
&nbsp;
&nbsp;    private File selectGameOptionsFile(boolean saveDialog) {
<b class="nc">&nbsp;        JFileChooser fc = new JFileChooser(&quot;mmconf&quot;); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        fc.setLocation(getLocation().x + 150, getLocation().y + 100);</b>
&nbsp;        // fc.setDialogTitle(Messages.getString(
&nbsp;        // &quot;GameOptionsDialog.FileChooser.title&quot;)); //$NON-NLS-1$
<b class="nc">&nbsp;        fc.setFileFilter(new FileFilter() {</b>
&nbsp;            @Override
&nbsp;            public boolean accept(File dir) {
<b class="nc">&nbsp;                if (dir.isDirectory()) {</b>
<b class="nc">&nbsp;                    return true;</b>
<b class="nc">&nbsp;                } else if (dir.getName().endsWith(&quot;.xml&quot;)) {</b>
&nbsp;                    try {
<b class="nc">&nbsp;                        DocumentBuilder builder = MegaMekXmlUtil.newSafeDocumentBuilder();</b>
<b class="nc">&nbsp;                        Document doc = builder.parse(dir);</b>
<b class="nc">&nbsp;                        NodeList listOfComponents = doc.getElementsByTagName(&quot;options&quot;);</b>
<b class="nc">&nbsp;                        if (listOfComponents.getLength() &gt; 0) {</b>
<b class="nc">&nbsp;                            return true;</b>
&nbsp;                        } else {
<b class="nc">&nbsp;                            return false;</b>
&nbsp;                        }
<b class="nc">&nbsp;                    } catch (Exception e) {</b>
<b class="nc">&nbsp;                        return false;</b>
&nbsp;                    }
&nbsp;                } else {
<b class="nc">&nbsp;                    return false;</b>
&nbsp;                }
&nbsp;            }
&nbsp;
&nbsp;            @Override
&nbsp;            public String getDescription() {
<b class="nc">&nbsp;                return &quot;GameOptions&quot;; //$NON-NLS-1$</b>
&nbsp;            }
&nbsp;        });
&nbsp;        int returnVal;
<b class="nc">&nbsp;        if (saveDialog) {</b>
<b class="nc">&nbsp;            returnVal = fc.showSaveDialog(this);</b>
&nbsp;        } else {
<b class="nc">&nbsp;            returnVal = fc.showOpenDialog(this);</b>
&nbsp;        }
<b class="nc">&nbsp;        if ((returnVal != JFileChooser.APPROVE_OPTION) || (fc.getSelectedFile() == null)) {</b>
<b class="nc">&nbsp;            return null;</b>
&nbsp;        }
<b class="nc">&nbsp;        File result = fc.getSelectedFile();</b>
<b class="nc">&nbsp;        if (!result.getName().endsWith(&quot;.xml&quot;)) {</b>
<b class="nc">&nbsp;            result = new File(result + &quot;.xml&quot;);</b>
&nbsp;        }
<b class="nc">&nbsp;        return result;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Update the dialog so that it is editable or view-only.
&nbsp;     *
&nbsp;     * @param editable
&nbsp;     *            - &lt;code&gt;true&lt;/code&gt; if the contents of the dialog are
&nbsp;     *            editable, &lt;code&gt;false&lt;/code&gt; if they are view-only.
&nbsp;     */
&nbsp;    public void setEditable(boolean editable) {
&nbsp;
&nbsp;        // Set enabled state of all of the option components in the dialog.
<b class="nc">&nbsp;        for (List&lt;DialogOptionComponent&gt; comps : optionComps.values()) {</b>
<b class="nc">&nbsp;            for (DialogOptionComponent comp : comps) {</b>
<b class="nc">&nbsp;                comp.setEditable(editable);</b>
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;        }</b>
&nbsp;
&nbsp;        // If the panel is editable, the player can commit or reset.
<b class="nc">&nbsp;        texPass.setEnabled(editable);</b>
<b class="nc">&nbsp;        butOkay.setEnabled(editable);</b>
<b class="nc">&nbsp;        butDefaults.setEnabled(editable);</b>
&nbsp;
&nbsp;        // Update our data element.
<b class="nc">&nbsp;        this.editable = editable;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Determine whether the dialog is editable or view-only.
&nbsp;     *
&nbsp;     * @return &lt;code&gt;true&lt;/code&gt; if the contents of the dialog are editable,
&nbsp;     *         &lt;code&gt;false&lt;/code&gt; if they are view-only.
&nbsp;     */
&nbsp;    public boolean isEditable() {
<b class="nc">&nbsp;        return editable;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Determine whether the dialog was cancelled.
&nbsp;     *
&nbsp;     * @return &lt;code&gt;true&lt;/code&gt; if the dialog was cancelled, &lt;code&gt;false&lt;/code&gt;
&nbsp;     *         if it was not
&nbsp;     */
&nbsp;    public boolean wasCancelled() {
<b class="nc">&nbsp;        return cancelled;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    protected void processWindowEvent(WindowEvent e) {
<b class="nc">&nbsp;        super.processWindowEvent(e);</b>
<b class="nc">&nbsp;        if (e.getID() == WindowEvent.WINDOW_DEACTIVATED) {</b>
<b class="nc">&nbsp;            GUIPreferences guip = GUIPreferences.getInstance();</b>
<b class="nc">&nbsp;            guip.setGameOptionsSizeHeight(getSize().height);</b>
<b class="nc">&nbsp;            guip.setGameOptionsSizeWidth(getSize().width);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2023-05-16 16:28</div>
</div>
</body>
</html>
