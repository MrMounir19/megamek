


<!DOCTYPE html>
<html id="htmlId">
<head>
  <title>Coverage Report > ForceGenerationOptionsPanel</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">megamek.client.ui.swing</a>
</div>

<h1>Coverage Summary for Class: ForceGenerationOptionsPanel (megamek.client.ui.swing)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">ForceGenerationOptionsPanel</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/20)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/258)
  </span>
</td>
</tr>
  <tr>
    <td class="name">ForceGenerationOptionsPanel$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">ForceGenerationOptionsPanel$2</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">ForceGenerationOptionsPanel$3</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">ForceGenerationOptionsPanel$FormationTypesCard</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/10)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/207)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">ForceGenerationOptionsPanel$FormationUnitTypeOptions</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/7)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/26)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">ForceGenerationOptionsPanel$RATGenUnitTypeCard</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/11)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/194)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">ForceGenerationOptionsPanel$RATGenUnitTypeOptions</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/6)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/21)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">ForceGenerationOptionsPanel$UnitTypeOptions</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">ForceGenerationOptionsPanel$Use</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/65)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/721)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;/*
&nbsp; * MegaMek -
&nbsp; * Copyright (C) 2016, 2020 - The MegaMek Team. All rights reserved.
&nbsp; *
&nbsp; *  This program is free software; you can redistribute it and/or modify it
&nbsp; *  under the terms of the GNU General Public License as published by the Free
&nbsp; *  Software Foundation; either version 2 of the License, or (at your option)
&nbsp; *  any later version.
&nbsp; *
&nbsp; *  This program is distributed in the hope that it will be useful, but
&nbsp; *  WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
&nbsp; *  or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License
&nbsp; *  for more details.
&nbsp; */
&nbsp;package megamek.client.ui.swing;
&nbsp;
&nbsp;import java.awt.BorderLayout;
&nbsp;import java.awt.CardLayout;
&nbsp;import java.awt.Component;
&nbsp;import java.awt.GridBagConstraints;
&nbsp;import java.awt.GridBagLayout;
&nbsp;import java.awt.Insets;
&nbsp;import java.awt.event.ActionEvent;
&nbsp;import java.awt.event.ActionListener;
&nbsp;import java.awt.event.FocusEvent;
&nbsp;import java.awt.event.FocusListener;
&nbsp;import java.util.*;
&nbsp;import java.util.stream.Collectors;
&nbsp;import java.util.stream.IntStream;
&nbsp;
&nbsp;import javax.swing.AbstractButton;
&nbsp;import javax.swing.BorderFactory;
&nbsp;import javax.swing.ButtonGroup;
&nbsp;import javax.swing.DefaultListCellRenderer;
&nbsp;import javax.swing.JButton;
&nbsp;import javax.swing.JCheckBox;
&nbsp;import javax.swing.JComboBox;
&nbsp;import javax.swing.JLabel;
&nbsp;import javax.swing.JList;
&nbsp;import javax.swing.JPanel;
&nbsp;import javax.swing.JRadioButton;
&nbsp;import javax.swing.JTextArea;
&nbsp;import javax.swing.JTextField;
&nbsp;import javax.swing.SwingConstants;
&nbsp;
&nbsp;import megamek.client.ratgenerator.FactionRecord;
&nbsp;import megamek.client.ratgenerator.FormationType;
&nbsp;import megamek.client.ratgenerator.MissionRole;
&nbsp;import megamek.client.ratgenerator.ModelRecord;
&nbsp;import megamek.client.ratgenerator.RATGenerator;
&nbsp;import megamek.client.ratgenerator.UnitTable;
&nbsp;import megamek.client.ratgenerator.UnitTable.Parameters;
&nbsp;import megamek.client.ui.Messages;
&nbsp;import megamek.common.EntityMovementMode;
&nbsp;import megamek.common.EntityWeightClass;
&nbsp;import megamek.common.MechSummary;
&nbsp;import megamek.common.UnitType;
&nbsp;
&nbsp;/**
&nbsp; * Panel that allows choice of year, faction, rating, unit type
&nbsp; *
&nbsp; * @author Neoancient
&nbsp; */
<b class="nc">&nbsp;class ForceGenerationOptionsPanel extends JPanel implements ActionListener, FocusListener {</b>
&nbsp;    //region Variable Declarations
&nbsp;    private static final long serialVersionUID = -3462304612643343012L;
&nbsp;
<b class="nc">&nbsp;    public enum Use {</b>
<b class="nc">&nbsp;        RAT_GENERATOR, FORMATION_BUILDER //, FORCE_GENERATOR</b>
&nbsp;    }
&nbsp;
<b class="nc">&nbsp;    private JTextField txtNumUnits = new JTextField(3);</b>
<b class="nc">&nbsp;    private JTextField txtYear = new JTextField(4);</b>
<b class="nc">&nbsp;    private JComboBox&lt;FactionRecord&gt; cbFaction = new JComboBox&lt;&gt;();</b>
<b class="nc">&nbsp;    private JComboBox&lt;FactionRecord&gt; cbSubfaction = new JComboBox&lt;&gt;();</b>
<b class="nc">&nbsp;    private JCheckBox chkShowMinor = new JCheckBox(</b>
<b class="nc">&nbsp;            Messages.getString(&quot;RandomArmyDialog.ShowMinorFactions&quot;));</b>
<b class="nc">&nbsp;    private JComboBox&lt;String&gt; cbUnitType = new JComboBox&lt;&gt;();</b>
<b class="nc">&nbsp;    private JComboBox&lt;String&gt; cbRating = new JComboBox&lt;&gt;();</b>
&nbsp;
&nbsp;    private UnitTypeOptions panUnitTypeOptions;
&nbsp;
&nbsp;    private int ratGenYear;
&nbsp;
<b class="nc">&nbsp;    private static final int[] UNIT_TYPES = {</b>
&nbsp;        UnitType.MEK, UnitType.TANK, UnitType.BATTLE_ARMOR, UnitType.INFANTRY, UnitType.PROTOMEK,
&nbsp;        UnitType.VTOL, UnitType.NAVAL, UnitType.CONV_FIGHTER, UnitType.AERO, UnitType.SMALL_CRAFT,
&nbsp;        UnitType.DROPSHIP, UnitType.JUMPSHIP, UnitType.WARSHIP
&nbsp;    };
&nbsp;    private static final int EARLIEST_YEAR = 2398;
&nbsp;    private static final int LATEST_YEAR = 3150;
&nbsp;    //endregion Variable Declarations
&nbsp;
&nbsp;    //region Constructors
<b class="nc">&nbsp;    public ForceGenerationOptionsPanel(Use use) {</b>
<b class="nc">&nbsp;        setLayout(new GridBagLayout());</b>
&nbsp;        
<b class="nc">&nbsp;        GridBagConstraints c = new GridBagConstraints();</b>
<b class="nc">&nbsp;        c.gridx = 0;</b>
<b class="nc">&nbsp;        c.gridy = 0;</b>
<b class="nc">&nbsp;        c.gridwidth = 1;</b>
<b class="nc">&nbsp;        c.fill = GridBagConstraints.NONE;</b>
<b class="nc">&nbsp;        c.anchor = GridBagConstraints.WEST;</b>
<b class="nc">&nbsp;        c.weightx = 0.0;</b>
<b class="nc">&nbsp;        c.weighty = 0.0;</b>
<b class="nc">&nbsp;        add(new JLabel(Messages.getString(&quot;RandomArmyDialog.Year&quot;)), c);</b>
&nbsp;
<b class="nc">&nbsp;        c = new GridBagConstraints();</b>
<b class="nc">&nbsp;        c.gridx = 1;</b>
<b class="nc">&nbsp;        c.gridy = 0;</b>
<b class="nc">&nbsp;        c.gridwidth = 1;</b>
<b class="nc">&nbsp;        c.fill = GridBagConstraints.HORIZONTAL;</b>
<b class="nc">&nbsp;        c.anchor = GridBagConstraints.WEST;</b>
<b class="nc">&nbsp;        c.weightx = 0.0;</b>
<b class="nc">&nbsp;        c.weighty = 0.0;</b>
<b class="nc">&nbsp;        add(txtYear, c);</b>
<b class="nc">&nbsp;        txtYear.setText(String.valueOf(ratGenYear));</b>
<b class="nc">&nbsp;        txtYear.addFocusListener(this);</b>
&nbsp;
<b class="nc">&nbsp;        c = new GridBagConstraints();</b>
<b class="nc">&nbsp;        c.gridx = 2;</b>
<b class="nc">&nbsp;        c.gridy = 0;</b>
<b class="nc">&nbsp;        c.gridwidth = 1;</b>
<b class="nc">&nbsp;        c.fill = GridBagConstraints.NONE;</b>
<b class="nc">&nbsp;        c.anchor = GridBagConstraints.WEST;</b>
<b class="nc">&nbsp;        c.weightx = 0.0;</b>
<b class="nc">&nbsp;        c.weighty = 0.0;</b>
<b class="nc">&nbsp;        add(new JLabel(Messages.getString(&quot;RandomArmyDialog.Unit&quot;)), c);</b>
&nbsp;
<b class="nc">&nbsp;        txtNumUnits.setText(&quot;4&quot;);</b>
&nbsp;
<b class="nc">&nbsp;        c = new GridBagConstraints();</b>
<b class="nc">&nbsp;        c.gridx = 3;</b>
<b class="nc">&nbsp;        c.gridy = 0;</b>
<b class="nc">&nbsp;        c.gridwidth = 1;</b>
<b class="nc">&nbsp;        c.fill = GridBagConstraints.HORIZONTAL;</b>
<b class="nc">&nbsp;        c.anchor = GridBagConstraints.WEST;</b>
<b class="nc">&nbsp;        c.weightx = 0.0;</b>
<b class="nc">&nbsp;        c.weighty = 0.0;</b>
<b class="nc">&nbsp;        add(txtNumUnits, c);</b>
&nbsp;
<b class="nc">&nbsp;        c = new GridBagConstraints();</b>
<b class="nc">&nbsp;        c.gridx = 0;</b>
<b class="nc">&nbsp;        c.gridy = 1;</b>
<b class="nc">&nbsp;        c.gridwidth = 1;</b>
<b class="nc">&nbsp;        c.fill = GridBagConstraints.NONE;</b>
<b class="nc">&nbsp;        c.anchor = GridBagConstraints.WEST;</b>
<b class="nc">&nbsp;        c.weightx = 0.0;</b>
<b class="nc">&nbsp;        c.weighty = 0.0;</b>
<b class="nc">&nbsp;        add(new JLabel(Messages.getString(&quot;RandomArmyDialog.Faction&quot;)), c);</b>
&nbsp;
<b class="nc">&nbsp;        c = new GridBagConstraints();</b>
<b class="nc">&nbsp;        c.gridx = 1;</b>
<b class="nc">&nbsp;        c.gridy = 1;</b>
<b class="nc">&nbsp;        c.gridwidth = 1;</b>
<b class="nc">&nbsp;        c.fill = GridBagConstraints.HORIZONTAL;</b>
<b class="nc">&nbsp;        c.anchor = GridBagConstraints.WEST;</b>
<b class="nc">&nbsp;        c.weightx = 0.0;</b>
<b class="nc">&nbsp;        c.weighty = 0.0;</b>
<b class="nc">&nbsp;        add(cbFaction, c);</b>
<b class="nc">&nbsp;        cbFaction.setRenderer(factionCbRenderer);</b>
<b class="nc">&nbsp;        cbFaction.addActionListener(this);</b>
&nbsp;
<b class="nc">&nbsp;        c = new GridBagConstraints();</b>
<b class="nc">&nbsp;        c.gridx = 0;</b>
<b class="nc">&nbsp;        c.gridy = 2;</b>
<b class="nc">&nbsp;        c.gridwidth = 1;</b>
<b class="nc">&nbsp;        c.fill = GridBagConstraints.NONE;</b>
<b class="nc">&nbsp;        c.anchor = GridBagConstraints.WEST;</b>
<b class="nc">&nbsp;        c.weightx = 0.0;</b>
<b class="nc">&nbsp;        c.weighty = 0.0;</b>
<b class="nc">&nbsp;        add(new JLabel(Messages.getString(&quot;RandomArmyDialog.Command&quot;)), c);</b>
&nbsp;
<b class="nc">&nbsp;        c = new GridBagConstraints();</b>
<b class="nc">&nbsp;        c.gridx = 1;</b>
<b class="nc">&nbsp;        c.gridy = 2;</b>
<b class="nc">&nbsp;        c.gridwidth = 1;</b>
<b class="nc">&nbsp;        c.fill = GridBagConstraints.HORIZONTAL;</b>
<b class="nc">&nbsp;        c.anchor = GridBagConstraints.WEST;</b>
<b class="nc">&nbsp;        c.weightx = 0.0;</b>
<b class="nc">&nbsp;        c.weighty = 0.0;</b>
<b class="nc">&nbsp;        add(cbSubfaction, c);</b>
<b class="nc">&nbsp;        cbSubfaction.setRenderer(factionCbRenderer);</b>
<b class="nc">&nbsp;        cbSubfaction.addActionListener(this);</b>
&nbsp;
<b class="nc">&nbsp;        c = new GridBagConstraints();</b>
<b class="nc">&nbsp;        c.gridx = 2;</b>
<b class="nc">&nbsp;        c.gridy = 1;</b>
<b class="nc">&nbsp;        c.gridwidth = 1;</b>
<b class="nc">&nbsp;        c.fill = GridBagConstraints.HORIZONTAL;</b>
<b class="nc">&nbsp;        c.anchor = GridBagConstraints.WEST;</b>
<b class="nc">&nbsp;        c.weightx = 0.0;</b>
<b class="nc">&nbsp;        c.weighty = 0.0;</b>
<b class="nc">&nbsp;        add(chkShowMinor, c);</b>
<b class="nc">&nbsp;        chkShowMinor.addActionListener(this);</b>
&nbsp;
<b class="nc">&nbsp;        c = new GridBagConstraints();</b>
<b class="nc">&nbsp;        c.gridx = 0;</b>
<b class="nc">&nbsp;        c.gridy = 3;</b>
<b class="nc">&nbsp;        c.gridwidth = 1;</b>
<b class="nc">&nbsp;        c.fill = GridBagConstraints.NONE;</b>
<b class="nc">&nbsp;        c.anchor = GridBagConstraints.WEST;</b>
<b class="nc">&nbsp;        c.weightx = 0.0;</b>
<b class="nc">&nbsp;        c.weighty = 0.0;</b>
<b class="nc">&nbsp;        add(new JLabel(Messages.getString(&quot;RandomArmyDialog.UnitType&quot;)), c);</b>
&nbsp;
<b class="nc">&nbsp;        boolean restrictUnitType = use == Use.FORMATION_BUILDER;</b>
&nbsp;        
<b class="nc">&nbsp;        for (int unitType : UNIT_TYPES) {</b>
<b class="nc">&nbsp;            if ((unitType &lt; UnitType.JUMPSHIP) || !restrictUnitType) {</b>
<b class="nc">&nbsp;                cbUnitType.addItem(UnitType.getTypeName(unitType));</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        cbUnitType.setSelectedItem(0);</b>
<b class="nc">&nbsp;        cbUnitType.addActionListener(this);</b>
&nbsp;
<b class="nc">&nbsp;        c = new GridBagConstraints();</b>
<b class="nc">&nbsp;        c.gridx = 1;</b>
<b class="nc">&nbsp;        c.gridy = 3;</b>
<b class="nc">&nbsp;        c.gridwidth = 1;</b>
<b class="nc">&nbsp;        c.fill = GridBagConstraints.NONE;</b>
<b class="nc">&nbsp;        c.anchor = GridBagConstraints.WEST;</b>
<b class="nc">&nbsp;        c.weightx = 0.0;</b>
<b class="nc">&nbsp;        c.weighty = 0.0;</b>
<b class="nc">&nbsp;        add(cbUnitType, c);</b>
&nbsp;
<b class="nc">&nbsp;        c = new GridBagConstraints();</b>
<b class="nc">&nbsp;        c.gridx = 2;</b>
<b class="nc">&nbsp;        c.gridy = 3;</b>
<b class="nc">&nbsp;        c.gridwidth = 1;</b>
<b class="nc">&nbsp;        c.fill = GridBagConstraints.NONE;</b>
<b class="nc">&nbsp;        c.anchor = GridBagConstraints.WEST;</b>
<b class="nc">&nbsp;        c.weightx = 0.0;</b>
<b class="nc">&nbsp;        c.weighty = 0.0;</b>
<b class="nc">&nbsp;        add(new JLabel(Messages.getString(&quot;RandomArmyDialog.Rating&quot;)), c);</b>
&nbsp;
<b class="nc">&nbsp;        c = new GridBagConstraints();</b>
<b class="nc">&nbsp;        c.gridx = 3;</b>
<b class="nc">&nbsp;        c.gridy = 3;</b>
<b class="nc">&nbsp;        c.gridwidth = 1;</b>
<b class="nc">&nbsp;        c.fill = GridBagConstraints.HORIZONTAL;</b>
<b class="nc">&nbsp;        c.anchor = GridBagConstraints.WEST;</b>
<b class="nc">&nbsp;        c.weightx = 0.0;</b>
<b class="nc">&nbsp;        c.weighty = 0.0;</b>
<b class="nc">&nbsp;        add(cbRating, c);</b>
&nbsp;
<b class="nc">&nbsp;        switch (use) {</b>
&nbsp;            case RAT_GENERATOR:
<b class="nc">&nbsp;                panUnitTypeOptions = new RATGenUnitTypeOptions();</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            case FORMATION_BUILDER:
<b class="nc">&nbsp;                panUnitTypeOptions = new FormationUnitTypeOptions();</b>
&nbsp;                break;
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        c = new GridBagConstraints();</b>
<b class="nc">&nbsp;        c.gridx = 0;</b>
<b class="nc">&nbsp;        c.gridy = 4;</b>
<b class="nc">&nbsp;        c.gridwidth = GridBagConstraints.REMAINDER;</b>
<b class="nc">&nbsp;        c.fill = GridBagConstraints.HORIZONTAL;</b>
<b class="nc">&nbsp;        c.anchor = GridBagConstraints.WEST;</b>
<b class="nc">&nbsp;        c.weightx = 0.0;</b>
<b class="nc">&nbsp;        c.weighty = 0.5;</b>
<b class="nc">&nbsp;        add(panUnitTypeOptions, c);</b>
&nbsp;
<b class="nc">&nbsp;        if (!RATGenerator.getInstance().isInitialized()) {</b>
<b class="nc">&nbsp;            RATGenerator.getInstance().registerListener(this);</b>
&nbsp;        }
<b class="nc">&nbsp;        if (RATGenerator.getInstance().isInitialized()) {</b>
<b class="nc">&nbsp;            updateFactionChoice();</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (panUnitTypeOptions != null) {</b>
<b class="nc">&nbsp;            panUnitTypeOptions.optionsChanged();</b>
&nbsp;        }
&nbsp;    }
&nbsp;    //endregion Constructors
&nbsp;
&nbsp;    public int getNumUnits() {
<b class="nc">&nbsp;        return Integer.parseInt(txtNumUnits.getText());</b>
&nbsp;    }
&nbsp;
&nbsp;    public int getYear() {
<b class="nc">&nbsp;        return Integer.parseInt(txtYear.getText());</b>
&nbsp;    }
&nbsp;
&nbsp;    public FactionRecord getFaction() {
<b class="nc">&nbsp;        if (cbSubfaction.getSelectedItem() == null) {</b>
<b class="nc">&nbsp;            return (FactionRecord) cbFaction.getSelectedItem();</b>
&nbsp;        } else {
<b class="nc">&nbsp;            return (FactionRecord) cbSubfaction.getSelectedItem();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    public Integer getUnitType() {
<b class="nc">&nbsp;        String unitType = (String) cbUnitType.getSelectedItem();</b>
<b class="nc">&nbsp;        return ModelRecord.parseUnitType((unitType == null) ? &quot;&quot; : unitType);</b>
&nbsp;    }
&nbsp;
&nbsp;    public String getRating() {
<b class="nc">&nbsp;        return (String) cbRating.getSelectedItem();</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setYear(int year) {
<b class="nc">&nbsp;        ratGenYear = year;</b>
<b class="nc">&nbsp;        txtYear.setText(String.valueOf(year));</b>
<b class="nc">&nbsp;        if (RATGenerator.getInstance().isInitialized()) {</b>
<b class="nc">&nbsp;            updateFactionChoice();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    public Integer getIntegerOption(String key) {
<b class="nc">&nbsp;        return (panUnitTypeOptions == null) ? null : panUnitTypeOptions.getIntegerVal(key);</b>
&nbsp;    }
&nbsp;
&nbsp;    public Boolean getBooleanOption(String key) {
<b class="nc">&nbsp;        return (panUnitTypeOptions == null) ? null : panUnitTypeOptions.getBooleanVal(key);</b>
&nbsp;    }
&nbsp;
&nbsp;    public String getStringOption(String key) {
<b class="nc">&nbsp;        return (panUnitTypeOptions == null) ? null : panUnitTypeOptions.getStringVal(key);</b>
&nbsp;    }
&nbsp;
&nbsp;    public List&lt;?&gt; getListOption(String key) {
<b class="nc">&nbsp;        return (panUnitTypeOptions == null) ? new ArrayList&lt;&gt;() : panUnitTypeOptions.getListVal(key);</b>
&nbsp;    }
&nbsp;
&nbsp;    public void updateFactionChoice() {
<b class="nc">&nbsp;        FactionRecord old = (FactionRecord)cbFaction.getSelectedItem();</b>
<b class="nc">&nbsp;        cbFaction.removeActionListener(this);</b>
<b class="nc">&nbsp;        cbFaction.removeAllItems();</b>
<b class="nc">&nbsp;        List&lt;FactionRecord&gt; recs = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        for (FactionRecord fRec : RATGenerator.getInstance().getFactionList()) {</b>
<b class="nc">&nbsp;            if ((!fRec.isMinor() || chkShowMinor.isSelected())</b>
<b class="nc">&nbsp;                    &amp;&amp; !fRec.getKey().contains(&quot;.&quot;) &amp;&amp; fRec.isActiveInYear(ratGenYear)) {</b>
<b class="nc">&nbsp;                recs.add(fRec);</b>
&nbsp;            }
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;        recs.sort(factionSorter);</b>
<b class="nc">&nbsp;        for (FactionRecord fRec : recs) {</b>
<b class="nc">&nbsp;            cbFaction.addItem(fRec);</b>
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;        cbFaction.setSelectedItem(old);</b>
<b class="nc">&nbsp;        if (cbFaction.getSelectedItem() == null) {</b>
<b class="nc">&nbsp;            cbFaction.setSelectedItem(RATGenerator.getInstance().getFaction(&quot;IS&quot;));</b>
&nbsp;        }
<b class="nc">&nbsp;        updateSubfactionChoice();</b>
<b class="nc">&nbsp;        cbFaction.addActionListener(this);</b>
&nbsp;    }
&nbsp;
&nbsp;    public void updateSubfactionChoice() {
<b class="nc">&nbsp;        FactionRecord old = (FactionRecord)cbSubfaction.getSelectedItem();</b>
<b class="nc">&nbsp;        cbSubfaction.removeActionListener(this);</b>
<b class="nc">&nbsp;        cbSubfaction.removeAllItems();</b>
<b class="nc">&nbsp;        FactionRecord selectedFaction = (FactionRecord)cbFaction.getSelectedItem();</b>
<b class="nc">&nbsp;        if (selectedFaction != null) {</b>
<b class="nc">&nbsp;            List&lt;FactionRecord&gt; recs = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;            for (FactionRecord fRec : RATGenerator.getInstance().getFactionList()) {</b>
<b class="nc">&nbsp;                if (fRec.getKey().startsWith(selectedFaction.getKey() + &quot;.&quot;)</b>
<b class="nc">&nbsp;                        &amp;&amp; fRec.isActiveInYear(ratGenYear)) {</b>
<b class="nc">&nbsp;                    recs.add(fRec);</b>
&nbsp;                }
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;            recs.sort(factionSorter);</b>
<b class="nc">&nbsp;            cbSubfaction.addItem(null); //No specific subcommand.</b>
<b class="nc">&nbsp;            for (FactionRecord fRec : recs) {</b>
<b class="nc">&nbsp;                cbSubfaction.addItem(fRec);</b>
<b class="nc">&nbsp;            }</b>
&nbsp;        }
<b class="nc">&nbsp;        cbSubfaction.setSelectedItem(old);</b>
<b class="nc">&nbsp;        updateRatingChoice();</b>
<b class="nc">&nbsp;        cbSubfaction.addActionListener(this);</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * When faction or subfaction is changed, refresh ratings combo box with appropriate
&nbsp;     * values for selected faction.
&nbsp;     */
&nbsp;    public void updateRatingChoice() {
<b class="nc">&nbsp;        int current = cbRating.getSelectedIndex();</b>
<b class="nc">&nbsp;        cbRating.removeAllItems();</b>
<b class="nc">&nbsp;        FactionRecord fRec = (FactionRecord) cbSubfaction.getSelectedItem();</b>
<b class="nc">&nbsp;        if (fRec == null) {</b>
&nbsp;            // Subfaction is &quot;general&quot;
<b class="nc">&nbsp;            fRec = (FactionRecord) cbFaction.getSelectedItem();</b>
&nbsp;        }
<b class="nc">&nbsp;        if (fRec == null) {</b>
<b class="nc">&nbsp;            fRec = RATGenerator.getInstance().getFaction(&quot;IS&quot;);</b>
&nbsp;        }
<b class="nc">&nbsp;        List&lt;String&gt; ratingLevels = fRec.getRatingLevels();</b>
&nbsp;
<b class="nc">&nbsp;        if (ratingLevels.isEmpty()) {</b>
&nbsp;            // Get rating levels from parent faction(s)
<b class="nc">&nbsp;            ratingLevels = fRec.getRatingLevelSystem();</b>
&nbsp;        }
<b class="nc">&nbsp;        if (ratingLevels.size() &gt; 1) {</b>
<b class="nc">&nbsp;            for (int i = ratingLevels.size() - 1; i &gt;= 0; i--) {</b>
<b class="nc">&nbsp;                cbRating.addItem(ratingLevels.get(i));</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        if (current &lt; 0 &amp;&amp; cbRating.getItemCount() &gt; 0) {</b>
<b class="nc">&nbsp;            cbRating.setSelectedIndex(0);</b>
&nbsp;        } else {
<b class="nc">&nbsp;            cbRating.setSelectedIndex(Math.min(current, cbRating.getItemCount() - 1));</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public void actionPerformed(ActionEvent ev) {
<b class="nc">&nbsp;        if (ev.getSource().equals(cbFaction)) {</b>
<b class="nc">&nbsp;            updateSubfactionChoice();</b>
<b class="nc">&nbsp;        } else if (ev.getSource().equals(cbSubfaction)) {</b>
<b class="nc">&nbsp;            updateRatingChoice();</b>
<b class="nc">&nbsp;        } else if (ev.getSource().equals(chkShowMinor)) {</b>
<b class="nc">&nbsp;            updateFactionChoice();</b>
<b class="nc">&nbsp;        } else if (ev.getSource().equals(cbUnitType)) {</b>
<b class="nc">&nbsp;            if (panUnitTypeOptions != null) {</b>
<b class="nc">&nbsp;                panUnitTypeOptions.optionsChanged();</b>
&nbsp;            }
<b class="nc">&nbsp;        } else if (ev.getActionCommand().equals(&quot;ratGenInitialized&quot;)) {</b>
<b class="nc">&nbsp;            updateFactionChoice();</b>
<b class="nc">&nbsp;            RATGenerator.getInstance().removeListener(this);</b>
<b class="nc">&nbsp;            RATGenerator.getInstance().loadYear(ratGenYear);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public void focusGained(FocusEvent e) {
&nbsp;        //ignored
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    @Override
&nbsp;    public void focusLost(FocusEvent e) {
<b class="nc">&nbsp;        if (e.getSource().equals(txtYear)) {</b>
&nbsp;            try {
<b class="nc">&nbsp;                ratGenYear = Integer.parseInt(txtYear.getText());</b>
<b class="nc">&nbsp;                if (ratGenYear &lt; EARLIEST_YEAR) {</b>
<b class="nc">&nbsp;                    ratGenYear = EARLIEST_YEAR;</b>
<b class="nc">&nbsp;                } else if (ratGenYear &gt; LATEST_YEAR) {</b>
<b class="nc">&nbsp;                    ratGenYear = LATEST_YEAR;</b>
&nbsp;                }
<b class="nc">&nbsp;            } catch (NumberFormatException ex) {</b>
&nbsp;                //ignore and restore to previous value
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;            setYear(ratGenYear);</b>
<b class="nc">&nbsp;            RATGenerator.getInstance().loadYear(ratGenYear);</b>
&nbsp;        }
&nbsp;    }
&nbsp;    
&nbsp;    public void updateGeneratedUnits(List&lt;MechSummary&gt; list) {
<b class="nc">&nbsp;        panUnitTypeOptions.updateGeneratedUnits(list);</b>
&nbsp;    }
&nbsp;
<b class="nc">&nbsp;    private DefaultListCellRenderer factionCbRenderer = new DefaultListCellRenderer() {</b>
&nbsp;        private static final long serialVersionUID = -333065979253244440L;
&nbsp;
&nbsp;        @Override
&nbsp;        public Component getListCellRendererComponent(JList&lt;?&gt; list, Object value, int index,
&nbsp;                                                      boolean isSelected, boolean cellHasFocus) {
<b class="nc">&nbsp;            if (value == null) {</b>
<b class="nc">&nbsp;                setText(&quot;General&quot;);</b>
&nbsp;            } else {
<b class="nc">&nbsp;                setText(((FactionRecord) value).getName(ratGenYear));</b>
&nbsp;            }
<b class="nc">&nbsp;            return this;</b>
&nbsp;        }
&nbsp;    };
&nbsp;    
<b class="nc">&nbsp;    private Comparator&lt;FactionRecord&gt; factionSorter = new Comparator&lt;FactionRecord&gt;() {</b>
&nbsp;        @Override
&nbsp;        public int compare(FactionRecord o1, FactionRecord o2) {
<b class="nc">&nbsp;            return o1.getName(ratGenYear).compareTo(o2.getName(ratGenYear));</b>
&nbsp;        }
&nbsp;    };
&nbsp;
&nbsp;    /**
&nbsp;     * Additional options that are conditional on the selected unit type can be added
&nbsp;     */
<b class="nc">&nbsp;    abstract static class UnitTypeOptions extends JPanel {</b>
&nbsp;        private static final long serialVersionUID = -7141802206126462796L;
&nbsp;
&nbsp;        abstract public void optionsChanged();
&nbsp;        
&nbsp;        public Integer getIntegerVal(String key) {
<b class="nc">&nbsp;            return null;</b>
&nbsp;        }
&nbsp;        
&nbsp;        public Boolean getBooleanVal(String key) {
<b class="nc">&nbsp;            return null;</b>
&nbsp;        }
&nbsp;        
&nbsp;        public String getStringVal(String key) {
<b class="nc">&nbsp;            return null;</b>
&nbsp;        }
&nbsp;        
&nbsp;        public List&lt;?&gt; getListVal(String key) {
<b class="nc">&nbsp;            return new ArrayList&lt;&gt;();</b>
&nbsp;        }
&nbsp;        
&nbsp;        public abstract void updateGeneratedUnits(List&lt;MechSummary&gt; list);
&nbsp;    }
&nbsp;    
&nbsp;    public class RATGenUnitTypeOptions extends UnitTypeOptions {
&nbsp;        private static final long serialVersionUID = 6536972747395725718L;
&nbsp;
<b class="nc">&nbsp;        private Map&lt;String, RATGenUnitTypeCard&gt; cardMap = new HashMap&lt;&gt;();</b>
&nbsp;        
<b class="nc">&nbsp;        public RATGenUnitTypeOptions() {</b>
<b class="nc">&nbsp;            setLayout(new CardLayout());</b>
<b class="nc">&nbsp;            for (int i = 0; i &lt; cbUnitType.getItemCount(); i++) {</b>
<b class="nc">&nbsp;                int ut = ModelRecord.parseUnitType(cbUnitType.getItemAt(i));</b>
<b class="nc">&nbsp;                RATGenUnitTypeCard card = new RATGenUnitTypeCard(ut);</b>
<b class="nc">&nbsp;                cardMap.put(cbUnitType.getItemAt(i), card);</b>
<b class="nc">&nbsp;                add(card, cbUnitType.getItemAt(i));</b>
&nbsp;            }
&nbsp;        }
&nbsp;        
&nbsp;        public void optionsChanged() {
<b class="nc">&nbsp;            ((CardLayout) getLayout()).show(this, (String) cbUnitType.getSelectedItem());</b>
&nbsp;        }
&nbsp;        
&nbsp;        private RATGenUnitTypeCard currentCard() {
<b class="nc">&nbsp;            String selectedCard = (String) cbUnitType.getSelectedItem();</b>
<b class="nc">&nbsp;            return cardMap.get(selectedCard);</b>
&nbsp;        }
&nbsp;        
&nbsp;        @Override
&nbsp;        public Integer getIntegerVal(String key) {
<b class="nc">&nbsp;            switch (key) {</b>
&nbsp;                case &quot;networkMask&quot;:
<b class="nc">&nbsp;                    return currentCard().getNetworkMask();</b>
&nbsp;                case &quot;roleStrictness&quot;:
<b class="nc">&nbsp;                    return currentCard().getRoleStrictness();</b>
&nbsp;                default:
<b class="nc">&nbsp;                    return null;</b>
&nbsp;            }
&nbsp;        }
&nbsp;        
&nbsp;        @Override
&nbsp;        public List&lt;?&gt; getListVal(String key) {
<b class="nc">&nbsp;            switch(key) {</b>
&nbsp;                case &quot;weightClasses&quot;:
<b class="nc">&nbsp;                    return currentCard().getSelectedWeights();</b>
&nbsp;                case &quot;motiveTypes&quot;:
<b class="nc">&nbsp;                    return currentCard().getMotiveTypes();</b>
&nbsp;                case &quot;roles&quot;:
<b class="nc">&nbsp;                    return currentCard().getSelectedRoles();</b>
&nbsp;                default:
<b class="nc">&nbsp;                    return new ArrayList&lt;&gt;();</b>
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;        public void updateGeneratedUnits(List&lt;MechSummary&gt; list) {
&nbsp;
<b class="nc">&nbsp;        }</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Options that vary according to unit type
&nbsp;     */
&nbsp;    private static class RATGenUnitTypeCard extends JPanel {
&nbsp;        private static final long serialVersionUID = -3961143911841133921L;
&nbsp;
<b class="nc">&nbsp;        private JComboBox&lt;String&gt; cbWeightClass = new JComboBox&lt;&gt;();</b>
<b class="nc">&nbsp;        private List&lt;JCheckBox&gt; weightChecks = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        private JComboBox&lt;String&gt; cbRoleStrictness = new JComboBox&lt;&gt;();</b>
<b class="nc">&nbsp;        private List&lt;JCheckBox&gt; roleChecks = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        private ButtonGroup networkButtons = new ButtonGroup();</b>
<b class="nc">&nbsp;        private List&lt;JCheckBox&gt; subtypeChecks = new ArrayList&lt;&gt;();</b>
&nbsp;        
<b class="nc">&nbsp;        public RATGenUnitTypeCard(int unitType) {</b>
<b class="nc">&nbsp;            setLayout(new BorderLayout());</b>
&nbsp;
<b class="nc">&nbsp;            JPanel panWeightClass = new JPanel(new GridBagLayout());</b>
<b class="nc">&nbsp;            panWeightClass.setBorder(BorderFactory.createTitledBorder(Messages</b>
<b class="nc">&nbsp;                    .getString(&quot;RandomArmyDialog.WeightClass&quot;)));</b>
<b class="nc">&nbsp;            add(panWeightClass, BorderLayout.WEST);</b>
&nbsp;            
<b class="nc">&nbsp;            JPanel panRoles = new JPanel(new GridBagLayout());</b>
<b class="nc">&nbsp;            panRoles.setBorder(BorderFactory.createTitledBorder(Messages</b>
<b class="nc">&nbsp;                    .getString(&quot;RandomArmyDialog.MissionRole&quot;)));</b>
&nbsp;            
<b class="nc">&nbsp;            JPanel panStrictness = new JPanel();</b>
<b class="nc">&nbsp;            panStrictness.add(new JLabel(Messages.getString(&quot;RandomArmyDialog.Strictness&quot;)));</b>
<b class="nc">&nbsp;            cbRoleStrictness.setToolTipText(Messages.getString(&quot;RandomArmyDialog.Strictness.tooltip&quot;));</b>
<b class="nc">&nbsp;            cbRoleStrictness.addItem(Messages.getString(&quot;RandomArmyDialog.Low&quot;));</b>
<b class="nc">&nbsp;            cbRoleStrictness.addItem(Messages.getString(&quot;RandomArmyDialog.Medium&quot;));</b>
<b class="nc">&nbsp;            cbRoleStrictness.addItem(Messages.getString(&quot;RandomArmyDialog.High&quot;));</b>
<b class="nc">&nbsp;            cbRoleStrictness.setSelectedIndex(1);</b>
<b class="nc">&nbsp;            panStrictness.add(cbRoleStrictness);</b>
&nbsp;            
<b class="nc">&nbsp;            GridBagConstraints c = new GridBagConstraints();</b>
<b class="nc">&nbsp;            c.gridx = 0;</b>
<b class="nc">&nbsp;            c.gridy = 0;</b>
<b class="nc">&nbsp;            c.gridwidth = GridBagConstraints.REMAINDER;</b>
<b class="nc">&nbsp;            c.fill = GridBagConstraints.NONE;</b>
<b class="nc">&nbsp;            c.anchor = GridBagConstraints.NORTHWEST;</b>
<b class="nc">&nbsp;            c.weightx = 0.0;</b>
<b class="nc">&nbsp;            c.weighty = 0.0;</b>
<b class="nc">&nbsp;            panRoles.add(panStrictness, c);</b>
&nbsp;            
<b class="nc">&nbsp;            add(panRoles, BorderLayout.CENTER);</b>
&nbsp;
<b class="nc">&nbsp;            JPanel panNetwork = new JPanel(new GridBagLayout());</b>
<b class="nc">&nbsp;            panNetwork.setBorder(BorderFactory.createTitledBorder(Messages</b>
<b class="nc">&nbsp;                    .getString(&quot;RandomArmyDialog.Network&quot;)));</b>
<b class="nc">&nbsp;            add(panNetwork, BorderLayout.EAST);</b>
&nbsp;            
<b class="nc">&nbsp;            JPanel panMotive = new JPanel();</b>
<b class="nc">&nbsp;            add(panMotive, BorderLayout.NORTH);</b>
&nbsp;            
<b class="nc">&nbsp;            switch(unitType) {</b>
&nbsp;                case UnitType.MEK:
<b class="nc">&nbsp;                    addWeightClasses(panWeightClass, EntityWeightClass.WEIGHT_ULTRA_LIGHT,</b>
&nbsp;                            EntityWeightClass.WEIGHT_COLOSSAL, false);
<b class="nc">&nbsp;                    break;</b>
&nbsp;                case UnitType.NAVAL:
&nbsp;                case UnitType.TANK:
<b class="nc">&nbsp;                    addWeightClasses(panWeightClass, EntityWeightClass.WEIGHT_LIGHT,</b>
&nbsp;                            EntityWeightClass.WEIGHT_ASSAULT, false);
<b class="nc">&nbsp;                    break;</b>
&nbsp;                case UnitType.PROTOMEK:
<b class="nc">&nbsp;                    addWeightClasses(panWeightClass, EntityWeightClass.WEIGHT_LIGHT,</b>
&nbsp;                            EntityWeightClass.WEIGHT_ASSAULT, true);
<b class="nc">&nbsp;                    break;</b>
&nbsp;                case UnitType.BATTLE_ARMOR:
<b class="nc">&nbsp;                    addWeightClasses(panWeightClass, EntityWeightClass.WEIGHT_ULTRA_LIGHT,</b>
&nbsp;                            EntityWeightClass.WEIGHT_ASSAULT, true);
<b class="nc">&nbsp;                    break;</b>
&nbsp;                case UnitType.AERO:
<b class="nc">&nbsp;                    addWeightClasses(panWeightClass, EntityWeightClass.WEIGHT_LIGHT,</b>
&nbsp;                            EntityWeightClass.WEIGHT_HEAVY, false);
<b class="nc">&nbsp;                    break;</b>
&nbsp;                case UnitType.DROPSHIP:
<b class="nc">&nbsp;                    addWeightClasses(panWeightClass, EntityWeightClass.WEIGHT_SMALL_DROP,</b>
&nbsp;                            EntityWeightClass.WEIGHT_LARGE_DROP, true);
<b class="nc">&nbsp;                    break;</b>
&nbsp;                case UnitType.WARSHIP:
<b class="nc">&nbsp;                    addWeightClasses(panWeightClass, EntityWeightClass.WEIGHT_SMALL_WAR,</b>
&nbsp;                            EntityWeightClass.WEIGHT_LARGE_WAR, true);
<b class="nc">&nbsp;                    break;</b>
&nbsp;                default:
<b class="nc">&nbsp;                    panWeightClass.setVisible(false);</b>
&nbsp;            }
&nbsp;            
<b class="nc">&nbsp;            for (MissionRole role : MissionRole.values()) {</b>
<b class="nc">&nbsp;                if (role.fitsUnitType(unitType)) {</b>
<b class="nc">&nbsp;                    JCheckBox chk = new JCheckBox(Messages.getString(&quot;MissionRole.&quot;</b>
<b class="nc">&nbsp;                            + role.toString()));</b>
<b class="nc">&nbsp;                    chk.setToolTipText(Messages.getString(&quot;MissionRole.&quot;</b>
<b class="nc">&nbsp;                            + role.toString() + &quot;.tooltip&quot;));</b>
<b class="nc">&nbsp;                    chk.setName(role.toString());</b>
<b class="nc">&nbsp;                    roleChecks.add(chk);</b>
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            roleChecks.sort(Comparator.comparing(AbstractButton::getText));</b>
<b class="nc">&nbsp;            c = new GridBagConstraints();</b>
<b class="nc">&nbsp;            c.gridwidth = 1;</b>
<b class="nc">&nbsp;            c.fill = GridBagConstraints.NONE;</b>
<b class="nc">&nbsp;            c.anchor = GridBagConstraints.NORTHWEST;</b>
<b class="nc">&nbsp;            c.weightx = 0.0;</b>
<b class="nc">&nbsp;            c.weighty = 0.0;</b>
<b class="nc">&nbsp;            for (int i = 0; i &lt; roleChecks.size(); i++) {</b>
<b class="nc">&nbsp;                c.gridx = i % 3;</b>
<b class="nc">&nbsp;                c.gridy = i / 3 + 1;</b>
<b class="nc">&nbsp;                if (c.gridx == 2) {</b>
<b class="nc">&nbsp;                    c.weightx = 1.0;</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    c.weightx = 0.0;</b>
&nbsp;                }
<b class="nc">&nbsp;                if (i == roleChecks.size() - 1) {</b>
<b class="nc">&nbsp;                    c.weighty = 1.0;</b>
&nbsp;                }
<b class="nc">&nbsp;                panRoles.add(roleChecks.get(i), c);</b>
&nbsp;            }
&nbsp;            
<b class="nc">&nbsp;            c = new GridBagConstraints();</b>
<b class="nc">&nbsp;            c.gridx = 0;</b>
<b class="nc">&nbsp;            c.gridy = 0;</b>
<b class="nc">&nbsp;            c.gridwidth = 1;</b>
<b class="nc">&nbsp;            c.fill = GridBagConstraints.NONE;</b>
<b class="nc">&nbsp;            c.anchor = GridBagConstraints.NORTHWEST;</b>
<b class="nc">&nbsp;            c.weightx = 0.0;</b>
<b class="nc">&nbsp;            c.weighty = 0.0;</b>
&nbsp;
<b class="nc">&nbsp;            switch (unitType) {</b>
&nbsp;                case UnitType.MEK:
&nbsp;                case UnitType.TANK:
&nbsp;                case UnitType.VTOL:
&nbsp;                case UnitType.NAVAL:
&nbsp;                case UnitType.CONV_FIGHTER:
&nbsp;                case UnitType.AERO:
<b class="nc">&nbsp;                    addNetworkButton(panNetwork, c, networkButtons, Messages.getString(&quot;RandomArmyDialog.NoNetwork&quot;),</b>
&nbsp;                            ModelRecord.NETWORK_NONE);
<b class="nc">&nbsp;                    addNetworkButton(panNetwork, c, networkButtons, Messages.getString(&quot;RandomArmyDialog.C3S&quot;),</b>
&nbsp;                            ModelRecord.NETWORK_C3_SLAVE);
<b class="nc">&nbsp;                    addNetworkButton(panNetwork, c, networkButtons, Messages.getString(&quot;RandomArmyDialog.C3M&quot;),</b>
&nbsp;                            ModelRecord.NETWORK_C3_MASTER);
<b class="nc">&nbsp;                    addNetworkButton(panNetwork, c, networkButtons, Messages.getString(&quot;RandomArmyDialog.C3I&quot;),</b>
&nbsp;                            ModelRecord.NETWORK_C3I);
<b class="nc">&nbsp;                    addNetworkButton(panNetwork, c, networkButtons, Messages.getString(&quot;RandomArmyDialog.C3SB&quot;),</b>
&nbsp;                            ModelRecord.NETWORK_BOOSTED_SLAVE);
<b class="nc">&nbsp;                    addNetworkButton(panNetwork, c, networkButtons, Messages.getString(&quot;RandomArmyDialog.C3MB&quot;),</b>
&nbsp;                            ModelRecord.NETWORK_BOOSTED_MASTER);
<b class="nc">&nbsp;                    addNetworkButton(panNetwork, c, networkButtons, Messages.getString(&quot;RandomArmyDialog.C3CC&quot;),</b>
&nbsp;                            ModelRecord.NETWORK_COMPANY_COMMAND);
<b class="nc">&nbsp;                    addNetworkButton(panNetwork, c, networkButtons, Messages.getString(&quot;RandomArmyDialog.C3CCB&quot;),</b>
&nbsp;                            ModelRecord.NETWORK_COMPANY_COMMAND|ModelRecord.NETWORK_BOOSTED);
<b class="nc">&nbsp;                    c.weighty = 1.0;</b>
<b class="nc">&nbsp;                    addNetworkButton(panNetwork, c, networkButtons, Messages.getString(&quot;RandomArmyDialog.Nova&quot;),</b>
&nbsp;                            ModelRecord.NETWORK_NOVA);
<b class="nc">&nbsp;                    break;</b>
&nbsp;                case UnitType.BATTLE_ARMOR:
<b class="nc">&nbsp;                    addNetworkButton(panNetwork, c, networkButtons, Messages.getString(&quot;RandomArmyDialog.NoNetwork&quot;),</b>
&nbsp;                            ModelRecord.NETWORK_NONE);
<b class="nc">&nbsp;                    addNetworkButton(panNetwork, c, networkButtons, Messages.getString(&quot;RandomArmyDialog.C3BA&quot;),</b>
&nbsp;                            ModelRecord.NETWORK_BA_C3);
<b class="nc">&nbsp;                    addNetworkButton(panNetwork, c, networkButtons, Messages.getString(&quot;RandomArmyDialog.C3BAB&quot;),</b>
&nbsp;                            ModelRecord.NETWORK_BOOSTED_SLAVE);
<b class="nc">&nbsp;                    c.weighty = 1.0;</b>
<b class="nc">&nbsp;                    addNetworkButton(panNetwork, c, networkButtons, Messages.getString(&quot;RandomArmyDialog.C3I&quot;),</b>
&nbsp;                            ModelRecord.NETWORK_C3I);
<b class="nc">&nbsp;                    break;</b>
&nbsp;                case UnitType.DROPSHIP:
&nbsp;                case UnitType.JUMPSHIP:
&nbsp;                case UnitType.WARSHIP:
&nbsp;                case UnitType.SPACE_STATION:
<b class="nc">&nbsp;                    addNetworkButton(panNetwork, c, networkButtons, Messages.getString(&quot;RandomArmyDialog.NoNetwork&quot;),</b>
&nbsp;                            ModelRecord.NETWORK_NONE);
<b class="nc">&nbsp;                    c.weighty = 1.0;</b>
<b class="nc">&nbsp;                    addNetworkButton(panNetwork, c, networkButtons, Messages.getString(&quot;RandomArmyDialog.C3N&quot;),</b>
&nbsp;                            ModelRecord.NETWORK_NAVAL_C3);
&nbsp;                    break;
&nbsp;            }
&nbsp;            
<b class="nc">&nbsp;            switch (unitType) {</b>
&nbsp;                case UnitType.TANK:
<b class="nc">&nbsp;                    panMotive.add(createSubtypeCheck(&quot;hover&quot;, true));</b>
<b class="nc">&nbsp;                    panMotive.add(createSubtypeCheck(&quot;tracked&quot;, true));</b>
<b class="nc">&nbsp;                    panMotive.add(createSubtypeCheck(&quot;wheeled&quot;, true));</b>
<b class="nc">&nbsp;                    panMotive.add(createSubtypeCheck(&quot;wige&quot;, true));</b>
<b class="nc">&nbsp;                    panMotive.add(createSubtypeCheck(&quot;vtol&quot;, false));</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                case UnitType.INFANTRY:
<b class="nc">&nbsp;                    panMotive.add(createSubtypeCheck(&quot;leg&quot;, true));</b>
<b class="nc">&nbsp;                    panMotive.add(createSubtypeCheck(&quot;jump&quot;, true));</b>
<b class="nc">&nbsp;                    panMotive.add(createSubtypeCheck(&quot;motorized&quot;, true));</b>
<b class="nc">&nbsp;                    panMotive.add(createSubtypeCheck(Messages.getString(&quot;RandomArmyDialog.Mech.hover&quot;),</b>
&nbsp;                            &quot;hover&quot;, true));
<b class="nc">&nbsp;                    panMotive.add(createSubtypeCheck(Messages.getString(&quot;RandomArmyDialog.Mech.tracked&quot;),</b>
&nbsp;                            &quot;tracked&quot;, true));
<b class="nc">&nbsp;                    panMotive.add(createSubtypeCheck(Messages.getString(&quot;RandomArmyDialog.Mech.wheeled&quot;),</b>
&nbsp;                            &quot;wheeled&quot;, true));
<b class="nc">&nbsp;                    break;</b>
&nbsp;                case UnitType.BATTLE_ARMOR:
<b class="nc">&nbsp;                    panMotive.add(createSubtypeCheck(&quot;leg&quot;, true));</b>
<b class="nc">&nbsp;                    panMotive.add(createSubtypeCheck(&quot;jump&quot;, true));</b>
<b class="nc">&nbsp;                    panMotive.add(createSubtypeCheck(&quot;umu&quot;, true));</b>
<b class="nc">&nbsp;                    panMotive.add(createSubtypeCheck(&quot;vtol&quot;, true));</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                case UnitType.NAVAL:
<b class="nc">&nbsp;                    panMotive.add(createSubtypeCheck(&quot;naval&quot;, true));</b>
<b class="nc">&nbsp;                    panMotive.add(createSubtypeCheck(&quot;hydrofoil&quot;, true));</b>
<b class="nc">&nbsp;                    panMotive.add(createSubtypeCheck(&quot;submarine&quot;, true));</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                case UnitType.DROPSHIP:
<b class="nc">&nbsp;                    panMotive.add(createSubtypeCheck(&quot;aerodyne&quot;, true));</b>
<b class="nc">&nbsp;                    panMotive.add(createSubtypeCheck(&quot;spheroid&quot;, true));</b>
&nbsp;                    break;
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;        private void addWeightClasses(JPanel panel, int start, int end, boolean all) {
<b class="nc">&nbsp;            cbWeightClass.addItem(Messages.getString(&quot;RandomArmyDialog.Mixed&quot;));</b>
<b class="nc">&nbsp;            GridBagConstraints c = new GridBagConstraints();</b>
<b class="nc">&nbsp;            c.gridx = 1;</b>
<b class="nc">&nbsp;            c.gridy = 0;</b>
<b class="nc">&nbsp;            c.gridwidth = 1;</b>
<b class="nc">&nbsp;            c.fill = GridBagConstraints.NONE;</b>
<b class="nc">&nbsp;            c.anchor = GridBagConstraints.NORTHWEST;</b>
<b class="nc">&nbsp;            c.weightx = 0.0;</b>
<b class="nc">&nbsp;            c.weighty = 0.0;</b>
<b class="nc">&nbsp;            panel.add(cbWeightClass);</b>
&nbsp;            
<b class="nc">&nbsp;            c.gridx = 0;</b>
<b class="nc">&nbsp;            c.gridwidth = 2;</b>
<b class="nc">&nbsp;            for (int i = start; i &lt;= end; i++) {</b>
<b class="nc">&nbsp;                String name = Messages.getString(&quot;RandomArmyDialog.weight_class_&quot; + i);</b>
<b class="nc">&nbsp;                cbWeightClass.addItem(name);</b>
<b class="nc">&nbsp;                JCheckBox chk = new JCheckBox(name);</b>
<b class="nc">&nbsp;                chk.setName(String.valueOf(i));</b>
<b class="nc">&nbsp;                chk.setSelected(all);</b>
<b class="nc">&nbsp;                weightChecks.add(chk);</b>
<b class="nc">&nbsp;                c.gridy++;</b>
<b class="nc">&nbsp;                if (i == end) {</b>
<b class="nc">&nbsp;                    c.weightx = 1.0;</b>
<b class="nc">&nbsp;                    c.weighty = 1.0;</b>
&nbsp;                }
<b class="nc">&nbsp;                panel.add(chk, c);</b>
&nbsp;            }
<b class="nc">&nbsp;            cbWeightClass.addActionListener(e -&gt; {</b>
<b class="nc">&nbsp;                for (JCheckBox chk : weightChecks) {</b>
<b class="nc">&nbsp;                    chk.setEnabled(cbWeightClass.getSelectedIndex() == 0);</b>
<b class="nc">&nbsp;                }</b>
&nbsp;            });
<b class="nc">&nbsp;            if (all) {</b>
<b class="nc">&nbsp;                cbWeightClass.setSelectedIndex(0);</b>
<b class="nc">&nbsp;            } else if (start &gt; EntityWeightClass.WEIGHT_ULTRA_LIGHT) {</b>
<b class="nc">&nbsp;                cbWeightClass.setSelectedIndex(1);</b>
&nbsp;            } else {
<b class="nc">&nbsp;                cbWeightClass.setSelectedIndex(2);</b>
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;        private void addNetworkButton(JPanel panel, GridBagConstraints constraints, ButtonGroup group,
&nbsp;                                      String text, int mask) {
<b class="nc">&nbsp;            JRadioButton btn = new JRadioButton(text);</b>
<b class="nc">&nbsp;            btn.setActionCommand(String.valueOf(mask));</b>
<b class="nc">&nbsp;            btn.setSelected(mask == ModelRecord.NETWORK_NONE);</b>
<b class="nc">&nbsp;            panel.add(btn, constraints);</b>
<b class="nc">&nbsp;            group.add(btn);</b>
<b class="nc">&nbsp;            constraints.gridy++;</b>
&nbsp;        }
&nbsp;
&nbsp;        private JCheckBox createSubtypeCheck(String name, boolean select) {
<b class="nc">&nbsp;            return createSubtypeCheck(Messages.getString(&quot;RandomArmyDialog.Motive.&quot; + name),</b>
&nbsp;                    name, select);
&nbsp;        }
&nbsp;
&nbsp;        private JCheckBox createSubtypeCheck(String text, String name, boolean select) {
<b class="nc">&nbsp;            JCheckBox chk = new JCheckBox(text);</b>
<b class="nc">&nbsp;            chk.setName(name);</b>
<b class="nc">&nbsp;            chk.setSelected(select);</b>
<b class="nc">&nbsp;            subtypeChecks.add(chk);</b>
<b class="nc">&nbsp;            return chk;</b>
&nbsp;        }
&nbsp;
&nbsp;        public List&lt;Integer&gt; getSelectedWeights() {
<b class="nc">&nbsp;            if (cbWeightClass.getSelectedIndex() &gt; 0) {</b>
<b class="nc">&nbsp;                List&lt;Integer&gt; retVal = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;                retVal.add(Integer.parseInt(weightChecks</b>
<b class="nc">&nbsp;                        .get(cbWeightClass.getSelectedIndex() - 1).getName()));</b>
<b class="nc">&nbsp;                return retVal;</b>
&nbsp;            }
<b class="nc">&nbsp;            return weightChecks.stream().filter(AbstractButton::isSelected)</b>
<b class="nc">&nbsp;                    .map(chk -&gt; Integer.parseInt(chk.getName())).collect(Collectors.toList());</b>
&nbsp;        }
&nbsp;
&nbsp;        public List&lt;MissionRole&gt; getSelectedRoles() {
<b class="nc">&nbsp;            return roleChecks.stream().filter(AbstractButton::isSelected)</b>
<b class="nc">&nbsp;                    .map(chk -&gt; MissionRole.parseRole(chk.getName()))</b>
<b class="nc">&nbsp;                        .filter(Objects::nonNull).collect(Collectors.toList());</b>
&nbsp;        }
&nbsp;
&nbsp;        public int getRoleStrictness() {
<b class="nc">&nbsp;            return cbRoleStrictness.getSelectedIndex() + 1;</b>
&nbsp;        }
&nbsp;
&nbsp;        public int getNetworkMask() {
<b class="nc">&nbsp;            if (networkButtons.getSelection() != null) {</b>
<b class="nc">&nbsp;                return Integer.parseInt(networkButtons.getSelection().getActionCommand());</b>
&nbsp;            }
<b class="nc">&nbsp;            return ModelRecord.NETWORK_NONE;</b>
&nbsp;        }
&nbsp;
&nbsp;        public List&lt;EntityMovementMode&gt; getMotiveTypes() {
<b class="nc">&nbsp;            return subtypeChecks.stream().filter(AbstractButton::isSelected)</b>
<b class="nc">&nbsp;                    .map(chk -&gt; EntityMovementMode.getMode(chk.getName())).collect(Collectors.toList());</b>
&nbsp;        }
&nbsp;    }
&nbsp;    
&nbsp;    private class FormationUnitTypeOptions extends UnitTypeOptions {
&nbsp;        private static final long serialVersionUID = -6448946137013919069L;
&nbsp;
&nbsp;        FormationTypesCard groundCard;
&nbsp;        FormationTypesCard airCard;
&nbsp;        
<b class="nc">&nbsp;        public FormationUnitTypeOptions() {</b>
<b class="nc">&nbsp;            setLayout(new CardLayout());</b>
&nbsp;            
<b class="nc">&nbsp;            groundCard = new FormationTypesCard(true);</b>
<b class="nc">&nbsp;            airCard = new FormationTypesCard(false);</b>
<b class="nc">&nbsp;            add(groundCard, &quot;Ground&quot;);</b>
<b class="nc">&nbsp;            add(airCard, &quot;Air&quot;);</b>
&nbsp;        }
&nbsp;        
&nbsp;        public void optionsChanged() {
<b class="nc">&nbsp;            if (getUnitType() != null) {</b>
<b class="nc">&nbsp;                ((CardLayout) getLayout()).show(this, (getUnitType() &lt; UnitType.CONV_FIGHTER)</b>
<b class="nc">&nbsp;                        ? &quot;Ground&quot; : &quot;Air&quot;);</b>
&nbsp;            }
<b class="nc">&nbsp;            currentCard().updateUnitType(getUnitType());</b>
&nbsp;        }
&nbsp;        
&nbsp;        private FormationTypesCard currentCard() {
<b class="nc">&nbsp;            if ((getUnitType() != null) &amp;&amp; (getUnitType() &gt;= UnitType.CONV_FIGHTER)) {</b>
<b class="nc">&nbsp;                return airCard;</b>
&nbsp;            } else {
<b class="nc">&nbsp;                return groundCard;</b>
&nbsp;            }
&nbsp;        }
&nbsp;        
&nbsp;        @Override
&nbsp;        public Integer getIntegerVal(String key) {
<b class="nc">&nbsp;            switch (key) {</b>
&nbsp;                case &quot;numOtherUnits&quot;:
<b class="nc">&nbsp;                    return currentCard().numOtherUnits();</b>
&nbsp;                case &quot;otherUnitType&quot;:
<b class="nc">&nbsp;                    return currentCard().getOtherUnitType();</b>
&nbsp;                case &quot;network&quot;:
<b class="nc">&nbsp;                    return currentCard().getNetwork();</b>
&nbsp;                default:
<b class="nc">&nbsp;                    return null;</b>
&nbsp;            }
&nbsp;        }
&nbsp;        
&nbsp;        @Override
&nbsp;        public Boolean getBooleanVal(String key) {
<b class="nc">&nbsp;            switch (key) {</b>
&nbsp;                case &quot;mechBA&quot;:
<b class="nc">&nbsp;                    return currentCard().mechBA();</b>
&nbsp;                case &quot;airLance&quot;:
<b class="nc">&nbsp;                    return currentCard().airLance();</b>
&nbsp;                default:
<b class="nc">&nbsp;                    return null;</b>
&nbsp;            }
&nbsp;        }
&nbsp;        
&nbsp;        @Override
&nbsp;        public String getStringVal(String key) {
<b class="nc">&nbsp;            if (&quot;formationType&quot;.equals(key)) {</b>
<b class="nc">&nbsp;                return currentCard().getFormation();</b>
&nbsp;            } else {
<b class="nc">&nbsp;                return null;</b>
&nbsp;            }
&nbsp;        }
&nbsp;        
&nbsp;        @Override
&nbsp;        public void updateGeneratedUnits(List&lt;MechSummary&gt; list) {
<b class="nc">&nbsp;            currentCard().setGeneratedUnits(list);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private class FormationTypesCard extends JPanel {
&nbsp;
&nbsp;        private static final long serialVersionUID = 1439149790457737700L;
&nbsp;
<b class="nc">&nbsp;        private JRadioButton bSimpleFormation = new JRadioButton(Messages.getString(&quot;RandomArmyDialog.simpleFormation&quot;));</b>
<b class="nc">&nbsp;        private JRadioButton bMechBA = new JRadioButton(Messages.getString(&quot;RandomArmyDialog.mechBA&quot;));</b>
<b class="nc">&nbsp;        private JRadioButton bAirLance = new JRadioButton(Messages.getString(&quot;RandomArmyDialog.airLance&quot;));</b>
<b class="nc">&nbsp;        private JRadioButton bOtherUnitType = new JRadioButton(Messages.getString(&quot;RandomArmyDialog.otherUnitType&quot;));</b>
<b class="nc">&nbsp;        private JComboBox&lt;String&gt; cbOtherUnitType = new JComboBox&lt;&gt;();</b>
<b class="nc">&nbsp;        private JTextField tNumUnits = new JTextField(&quot;0&quot;);</b>
<b class="nc">&nbsp;        private ButtonGroup formationBtnGroup = new ButtonGroup();</b>
<b class="nc">&nbsp;        private JComboBox&lt;String&gt; cbNetwork = new JComboBox&lt;&gt;();</b>
<b class="nc">&nbsp;        private Map&lt;String, Integer&gt; networkOptions = new LinkedHashMap&lt;&gt;();</b>
<b class="nc">&nbsp;        private JTextArea txtNoFormation = new JTextArea();</b>
<b class="nc">&nbsp;        private List&lt;MechSummary&gt; generatedUnits = null;</b>
&nbsp;        
<b class="nc">&nbsp;        public FormationTypesCard(boolean groundUnit) {</b>
<b class="nc">&nbsp;            setLayout(new GridBagLayout());</b>
&nbsp;            
<b class="nc">&nbsp;            JPanel panFormations = new JPanel(new GridBagLayout());</b>
<b class="nc">&nbsp;            JPanel panOtherOptions = new JPanel(new GridBagLayout());</b>
&nbsp;            
<b class="nc">&nbsp;            GridBagConstraints c = new GridBagConstraints();</b>
<b class="nc">&nbsp;            c.gridx = 0;</b>
<b class="nc">&nbsp;            c.gridy = 0;</b>
<b class="nc">&nbsp;            c.anchor = GridBagConstraints.NORTHWEST;</b>
<b class="nc">&nbsp;            c.weightx = 0.5;</b>
<b class="nc">&nbsp;            c.weighty = 1.0;</b>
<b class="nc">&nbsp;            add(panFormations, c);</b>
&nbsp;            
<b class="nc">&nbsp;            c.gridx = 1;</b>
<b class="nc">&nbsp;            c.gridy = 0;</b>
<b class="nc">&nbsp;            c.anchor = GridBagConstraints.NORTHWEST;</b>
<b class="nc">&nbsp;            c.weightx = 0.5;</b>
<b class="nc">&nbsp;            c.weighty = 0.0;</b>
<b class="nc">&nbsp;            add(panOtherOptions, c);</b>
&nbsp;            
&nbsp;            // Sort main types alphabetically, and subtypes alphabetically within the main.
<b class="nc">&nbsp;            List&lt;FormationType&gt; formations = FormationType.getAllFormations().stream()</b>
<b class="nc">&nbsp;                    .filter(ft -&gt; ft.isGround() == groundUnit).collect(Collectors.toList());</b>
<b class="nc">&nbsp;            Map&lt;String,Set&lt;String&gt;&gt; formationGroups = formations.stream()</b>
<b class="nc">&nbsp;                    .collect(Collectors.groupingBy(FormationType::getCategory, TreeMap::new,</b>
<b class="nc">&nbsp;                            Collectors.mapping(FormationType::getName,</b>
<b class="nc">&nbsp;                                    Collectors.toCollection(TreeSet::new))));</b>
&nbsp;                
<b class="nc">&nbsp;            int rows = (formations.size() + 1) / 2;</b>
&nbsp;
<b class="nc">&nbsp;            c = new GridBagConstraints();</b>
<b class="nc">&nbsp;            c.gridx = 2;</b>
<b class="nc">&nbsp;            c.gridy = 0;</b>
<b class="nc">&nbsp;            c.gridwidth = 1;</b>
<b class="nc">&nbsp;            c.anchor = GridBagConstraints.WEST;</b>
<b class="nc">&nbsp;            c.fill = GridBagConstraints.NONE;</b>
<b class="nc">&nbsp;            c.weightx = 0.0;</b>
<b class="nc">&nbsp;            c.weighty = 1.0;</b>
&nbsp;            
<b class="nc">&nbsp;            Insets mainInsets = new Insets(0, 10, 0, 10);</b>
<b class="nc">&nbsp;            Insets subInsets = new Insets(0, 30, 0, 10);</b>
<b class="nc">&nbsp;            for (String group : formationGroups.keySet()) {</b>
<b class="nc">&nbsp;                c.insets = mainInsets;</b>
<b class="nc">&nbsp;                if (formationGroups.get(group).contains(group)) {</b>
<b class="nc">&nbsp;                    JRadioButton btn = new JRadioButton(FormationType.getFormationType(group).getNameWithFaction());</b>
<b class="nc">&nbsp;                    if (formationBtnGroup.getButtonCount() == 0) {</b>
<b class="nc">&nbsp;                        btn.setSelected(true);</b>
&nbsp;                    }
<b class="nc">&nbsp;                    btn.setActionCommand(group);</b>
<b class="nc">&nbsp;                    panFormations.add(btn, c);</b>
<b class="nc">&nbsp;                    formationBtnGroup.add(btn);</b>
<b class="nc">&nbsp;                    formationGroups.get(group).remove(group);</b>
<b class="nc">&nbsp;                } else {</b>
<b class="nc">&nbsp;                    JLabel lbl = new JLabel(FormationType.getFormationType(group).getNameWithFaction(),</b>
&nbsp;                            SwingConstants.LEFT);
<b class="nc">&nbsp;                    panFormations.add(lbl, c);</b>
&nbsp;                }
<b class="nc">&nbsp;                c.gridy++;</b>
<b class="nc">&nbsp;                c.insets = subInsets;</b>
<b class="nc">&nbsp;                for (String form : formationGroups.get(group)) {</b>
<b class="nc">&nbsp;                    JRadioButton btn = new JRadioButton(FormationType.getFormationType(form).getNameWithFaction());</b>
<b class="nc">&nbsp;                    if (formationBtnGroup.getButtonCount() == 0) {</b>
<b class="nc">&nbsp;                        btn.setSelected(true);</b>
&nbsp;                    }
<b class="nc">&nbsp;                    btn.setActionCommand(form);</b>
<b class="nc">&nbsp;                    panFormations.add(btn, c);</b>
<b class="nc">&nbsp;                    formationBtnGroup.add(btn);</b>
<b class="nc">&nbsp;                    c.gridy++;</b>
<b class="nc">&nbsp;                }</b>
<b class="nc">&nbsp;                if (c.gridy &gt;= rows) {</b>
<b class="nc">&nbsp;                    c.gridx++;</b>
<b class="nc">&nbsp;                    c.gridy = 0;</b>
&nbsp;                }
<b class="nc">&nbsp;            }</b>
&nbsp;            
<b class="nc">&nbsp;            ButtonGroup btnGroup = new ButtonGroup();            </b>
<b class="nc">&nbsp;            c.gridx = 0;</b>
<b class="nc">&nbsp;            c.gridy = 0;</b>
<b class="nc">&nbsp;            c.anchor = GridBagConstraints.NORTHWEST;</b>
<b class="nc">&nbsp;            c.gridwidth = 2;</b>
<b class="nc">&nbsp;            c.fill = GridBagConstraints.NONE;</b>
<b class="nc">&nbsp;            c.weightx = 0.0;</b>
<b class="nc">&nbsp;            c.weighty = 0.0;</b>
<b class="nc">&nbsp;            panOtherOptions.add(bSimpleFormation, c);</b>
<b class="nc">&nbsp;            bSimpleFormation.addItemListener(ev -&gt; tNumUnits.setEnabled(!bSimpleFormation.isSelected()));</b>
<b class="nc">&nbsp;            btnGroup.add(bSimpleFormation);</b>
&nbsp;            
<b class="nc">&nbsp;            c.gridx = 0;</b>
<b class="nc">&nbsp;            c.gridy++;</b>
<b class="nc">&nbsp;            c.anchor = GridBagConstraints.NORTHWEST;</b>
<b class="nc">&nbsp;            c.gridwidth = 2;</b>
<b class="nc">&nbsp;            c.fill = GridBagConstraints.NONE;</b>
<b class="nc">&nbsp;            c.weightx = 0.0;</b>
<b class="nc">&nbsp;            c.weighty = 0.0;</b>
<b class="nc">&nbsp;            panOtherOptions.add(bMechBA, c);</b>
<b class="nc">&nbsp;            btnGroup.add(bMechBA);</b>
&nbsp;
<b class="nc">&nbsp;            c.gridy++;</b>
<b class="nc">&nbsp;            c.gridwidth = 2;</b>
<b class="nc">&nbsp;            panOtherOptions.add(bAirLance, c);</b>
<b class="nc">&nbsp;            btnGroup.add(bAirLance);</b>
&nbsp;
<b class="nc">&nbsp;            c.gridy++;</b>
<b class="nc">&nbsp;            c.gridwidth = 2;</b>
<b class="nc">&nbsp;            panOtherOptions.add(bOtherUnitType, c);</b>
<b class="nc">&nbsp;            btnGroup.add(bOtherUnitType);</b>
<b class="nc">&nbsp;            bOtherUnitType.addItemListener(ev -&gt; cbOtherUnitType.setEnabled(bOtherUnitType.isSelected()));</b>
&nbsp;
<b class="nc">&nbsp;            c.gridx = 0;</b>
<b class="nc">&nbsp;            c.gridy++;</b>
<b class="nc">&nbsp;            c.gridwidth = 2;</b>
<b class="nc">&nbsp;            panOtherOptions.add(cbOtherUnitType, c);</b>
<b class="nc">&nbsp;            cbOtherUnitType.setEnabled(false);</b>
<b class="nc">&nbsp;            for (int i = 0; i &lt; UnitType.JUMPSHIP; i++) {</b>
<b class="nc">&nbsp;                if (i != UnitType.GUN_EMPLACEMENT) {</b>
<b class="nc">&nbsp;                    cbOtherUnitType.addItem(UnitType.getTypeName(i));</b>
&nbsp;                }
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            c.gridx = 0;</b>
<b class="nc">&nbsp;            c.gridy++;</b>
<b class="nc">&nbsp;            c.gridwidth = 1;</b>
<b class="nc">&nbsp;            panOtherOptions.add(new JLabel(Messages.getString(&quot;RandomArmyDialog.additionalUnits&quot;)), c);</b>
<b class="nc">&nbsp;            c.gridx = 1;</b>
<b class="nc">&nbsp;            c.gridwidth = 1;</b>
<b class="nc">&nbsp;            panOtherOptions.add(tNumUnits, c);</b>
&nbsp;
<b class="nc">&nbsp;            bSimpleFormation.setSelected(true);</b>
&nbsp;
<b class="nc">&nbsp;            if (groundUnit) {</b>
<b class="nc">&nbsp;                c.gridx = 0;</b>
<b class="nc">&nbsp;                c.gridy++;</b>
<b class="nc">&nbsp;                c.gridwidth = 1;</b>
<b class="nc">&nbsp;                panOtherOptions.add(new JLabel(Messages.getString(&quot;ForceGenerationOptions.Network&quot;)), c);</b>
&nbsp;
<b class="nc">&nbsp;                networkOptions.put(Messages.getString(&quot;ForceGenerationOptions.Optional&quot;),</b>
<b class="nc">&nbsp;                        ModelRecord.NETWORK_NONE);</b>
<b class="nc">&nbsp;                networkOptions.put(Messages.getString(&quot;ForceGenerationOptions.C3Lance&quot;),</b>
<b class="nc">&nbsp;                        ModelRecord.NETWORK_C3_MASTER);</b>
<b class="nc">&nbsp;                networkOptions.put(Messages.getString(&quot;ForceGenerationOptions.C3Command&quot;),</b>
<b class="nc">&nbsp;                        ModelRecord.NETWORK_C3_MASTER | ModelRecord.NETWORK_COMPANY_COMMAND);</b>
<b class="nc">&nbsp;                networkOptions.put(Messages.getString(&quot;ForceGenerationOptions.C3i&quot;),</b>
<b class="nc">&nbsp;                        ModelRecord.NETWORK_C3I);</b>
<b class="nc">&nbsp;                networkOptions.put(Messages.getString(&quot;ForceGenerationOptions.C3BLance&quot;),</b>
<b class="nc">&nbsp;                        ModelRecord.NETWORK_BOOSTED_MASTER);</b>
<b class="nc">&nbsp;                networkOptions.put(Messages.getString(&quot;ForceGenerationOptions.C3BCommand&quot;),</b>
<b class="nc">&nbsp;                        ModelRecord.NETWORK_BOOSTED_MASTER | ModelRecord.NETWORK_COMPANY_COMMAND);</b>
<b class="nc">&nbsp;                networkOptions.put(Messages.getString(&quot;ForceGenerationOptions.Nova&quot;),</b>
<b class="nc">&nbsp;                        ModelRecord.NETWORK_NOVA);</b>
<b class="nc">&nbsp;                networkOptions.keySet().forEach(cbNetwork::addItem);</b>
<b class="nc">&nbsp;                c.gridx = 0;</b>
<b class="nc">&nbsp;                c.gridy++;</b>
<b class="nc">&nbsp;                c.gridwidth = GridBagConstraints.REMAINDER;</b>
<b class="nc">&nbsp;                panOtherOptions.add(cbNetwork, c);</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            c.gridx = 0;</b>
<b class="nc">&nbsp;            c.gridy++;</b>
<b class="nc">&nbsp;            c.gridwidth = GridBagConstraints.REMAINDER;</b>
<b class="nc">&nbsp;            JButton btn = new JButton(Messages.getString(&quot;ForceGenerationOptions.formationAnalysis&quot;));</b>
<b class="nc">&nbsp;            panOtherOptions.add(btn, c);</b>
<b class="nc">&nbsp;            btn.addActionListener(ev -&gt; showAnalysis());</b>
&nbsp;
<b class="nc">&nbsp;            c.gridy++;</b>
<b class="nc">&nbsp;            txtNoFormation.setText(Messages.getString(&quot;ForceGenerationOptions.noFormation&quot;));</b>
<b class="nc">&nbsp;            txtNoFormation.setLineWrap(true);</b>
<b class="nc">&nbsp;            txtNoFormation.setWrapStyleWord(true);</b>
<b class="nc">&nbsp;            txtNoFormation.setVisible(false);</b>
<b class="nc">&nbsp;            panOtherOptions.add(txtNoFormation, c);</b>
&nbsp;        }
&nbsp;
&nbsp;        public String getFormation() {
<b class="nc">&nbsp;            if (formationBtnGroup.getSelection() != null) {</b>
<b class="nc">&nbsp;                return formationBtnGroup.getSelection().getActionCommand();</b>
&nbsp;            }
<b class="nc">&nbsp;            return null;</b>
&nbsp;        }
&nbsp;
&nbsp;        public boolean mechBA() {
<b class="nc">&nbsp;            return bMechBA.isSelected();</b>
&nbsp;        }
&nbsp;
&nbsp;        public boolean airLance() {
<b class="nc">&nbsp;            return bAirLance.isSelected();</b>
&nbsp;        }
&nbsp;
&nbsp;        public int numOtherUnits() {
&nbsp;            try {
<b class="nc">&nbsp;                return Integer.parseInt(tNumUnits.getText());</b>
<b class="nc">&nbsp;            } catch (NumberFormatException ex) {</b>
<b class="nc">&nbsp;                tNumUnits.setText(&quot;0&quot;);</b>
<b class="nc">&nbsp;                return 0;</b>
&nbsp;            }
&nbsp;        }
&nbsp;        
&nbsp;        public int getOtherUnitType() {
<b class="nc">&nbsp;            String otherUnitType = (String) cbOtherUnitType.getSelectedItem();</b>
<b class="nc">&nbsp;            if (!bOtherUnitType.isSelected() || (otherUnitType == null)) {</b>
<b class="nc">&nbsp;                otherUnitType = &quot;&quot;;</b>
&nbsp;            }
<b class="nc">&nbsp;            return ModelRecord.parseUnitType(otherUnitType);</b>
&nbsp;        }
&nbsp;        
&nbsp;        public void updateUnitType(int ut) {
<b class="nc">&nbsp;            boolean selectionDisabled = false;</b>
<b class="nc">&nbsp;            for (Enumeration&lt;AbstractButton&gt; e = formationBtnGroup.getElements(); e.hasMoreElements();) {</b>
<b class="nc">&nbsp;                final AbstractButton btn = e.nextElement();</b>
<b class="nc">&nbsp;                FormationType ft = FormationType.getFormationType(btn.getActionCommand());</b>
<b class="nc">&nbsp;                if (ft != null) {</b>
<b class="nc">&nbsp;                    btn.setEnabled(ft.isAllowedUnitType(ut));</b>
<b class="nc">&nbsp;                    if (btn.isSelected() &amp;&amp; !btn.isEnabled()) {</b>
<b class="nc">&nbsp;                        selectionDisabled = true;</b>
&nbsp;                    }
&nbsp;                }
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;            if (selectionDisabled) {</b>
<b class="nc">&nbsp;                for (Enumeration&lt;AbstractButton&gt; e = formationBtnGroup.getElements(); e.hasMoreElements();) {</b>
<b class="nc">&nbsp;                    final AbstractButton btn = e.nextElement();</b>
<b class="nc">&nbsp;                    if (btn.isEnabled()) {</b>
<b class="nc">&nbsp;                        btn.setSelected(true);</b>
&nbsp;                        return;
&nbsp;                    }
<b class="nc">&nbsp;                }</b>
&nbsp;                //We shouldn&#39;t reach this point, but if we do the previous selection doesn&#39;t change.
&nbsp;            }
&nbsp;        }
&nbsp;        
&nbsp;        public int getNetwork() {
<b class="nc">&nbsp;            String networkOption = (String) cbNetwork.getSelectedItem();</b>
<b class="nc">&nbsp;            return (networkOptions.get(networkOption) != null) ? networkOptions.get((networkOption))</b>
<b class="nc">&nbsp;                    : ModelRecord.NETWORK_NONE;</b>
&nbsp;        }
&nbsp;        
&nbsp;        private void showAnalysis() {
<b class="nc">&nbsp;            List&lt;UnitTable.Parameters&gt; params = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;            FormationType ft = FormationType.getFormationType(getFormation());</b>
<b class="nc">&nbsp;            Parameters p = new UnitTable.Parameters(getFaction(),</b>
<b class="nc">&nbsp;                    getUnitType(), ratGenYear, (String)cbRating.getSelectedItem(),</b>
<b class="nc">&nbsp;                    IntStream.rangeClosed(ft.getMinWeightClass(), ft.getMaxWeightClass())</b>
<b class="nc">&nbsp;                    .boxed().collect(Collectors.toList()),</b>
<b class="nc">&nbsp;                    ModelRecord.NETWORK_NONE, EnumSet.noneOf(EntityMovementMode.class),</b>
<b class="nc">&nbsp;                    ft.getMissionRoles(),</b>
<b class="nc">&nbsp;                    2, getFaction());</b>
<b class="nc">&nbsp;            params.add(p);</b>
<b class="nc">&nbsp;            int numUnits = getNumUnits();</b>
<b class="nc">&nbsp;            if (getOtherUnitType() &gt;= 0) {</b>
<b class="nc">&nbsp;                p = p.copy();</b>
<b class="nc">&nbsp;                p.setUnitType(getOtherUnitType());</b>
<b class="nc">&nbsp;                params.add(p);</b>
<b class="nc">&nbsp;                numUnits += numOtherUnits();</b>
&nbsp;            }
<b class="nc">&nbsp;            AnalyzeFormationDialog afd = new AnalyzeFormationDialog(null,</b>
&nbsp;                    generatedUnits,
<b class="nc">&nbsp;                    FormationType.getFormationType(getFormation()),</b>
<b class="nc">&nbsp;                    params, numUnits, getNetwork());</b>
<b class="nc">&nbsp;            afd.setVisible(true);</b>
&nbsp;        }
&nbsp;        
&nbsp;        public void setGeneratedUnits(List&lt;MechSummary&gt; list) {
<b class="nc">&nbsp;            generatedUnits = list;</b>
<b class="nc">&nbsp;            txtNoFormation.setVisible(list == null || list.isEmpty());</b>
&nbsp;        }
&nbsp;    }    
&nbsp;}
&nbsp;
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2023-05-16 16:28</div>
</div>
</body>
</html>
