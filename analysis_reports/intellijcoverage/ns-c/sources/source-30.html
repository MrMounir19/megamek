


<!DOCTYPE html>
<html id="htmlId">
<head>
  <title>Coverage Report > MapMenu</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">megamek.client.ui.swing</a>
</div>

<h1>Coverage Summary for Class: MapMenu (megamek.client.ui.swing)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">MapMenu</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/58)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/745)
  </span>
</td>
</tr>
  <tr>
    <td class="name">MapMenu$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/6)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MapMenu$10</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MapMenu$11</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MapMenu$12</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MapMenu$13</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MapMenu$14</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MapMenu$15</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MapMenu$16</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MapMenu$17</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MapMenu$18</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MapMenu$19</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MapMenu$2</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/8)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MapMenu$20</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MapMenu$21</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MapMenu$22</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MapMenu$23</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MapMenu$24</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MapMenu$25</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MapMenu$26</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/7)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MapMenu$27</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MapMenu$28</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/24)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MapMenu$29</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/7)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MapMenu$3</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MapMenu$30</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MapMenu$31</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MapMenu$32</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MapMenu$33</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MapMenu$34</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/10)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MapMenu$35</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/13)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MapMenu$36</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MapMenu$37</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MapMenu$38</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/9)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MapMenu$39</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MapMenu$4</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MapMenu$40</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MapMenu$41</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MapMenu$42</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MapMenu$43</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MapMenu$44</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MapMenu$45</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MapMenu$46</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MapMenu$47</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MapMenu$48</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/7)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MapMenu$5</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/16)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MapMenu$6</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/8)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MapMenu$7</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MapMenu$8</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/7)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MapMenu$9</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/154)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1031)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;/*
&nbsp; * MegaMek - Copyright (C) 2005 Ben Mazur (bmazur@sev.org)
&nbsp; *
&nbsp; *  This program is free software; you can redistribute it and/or modify it
&nbsp; *  under the terms of the GNU General Public License as published by the Free
&nbsp; *  Software Foundation; either version 2 of the License, or (at your option)
&nbsp; *  any later version.
&nbsp; *
&nbsp; *  This program is distributed in the hope that it will be useful, but
&nbsp; *  WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
&nbsp; *  or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License
&nbsp; *  for more details.
&nbsp; */
&nbsp;
&nbsp;package megamek.client.ui.swing;
&nbsp;
&nbsp;import java.awt.Component;
&nbsp;import java.awt.event.ActionEvent;
&nbsp;import java.awt.event.ActionListener;
&nbsp;import java.awt.event.InputEvent;
&nbsp;import java.math.BigInteger;
&nbsp;import java.util.ArrayList;
&nbsp;import java.util.Collection;
&nbsp;import java.util.Collections;
&nbsp;import java.util.HashMap;
&nbsp;import java.util.StringTokenizer;
&nbsp;import java.util.Vector;
&nbsp;
&nbsp;import javax.swing.JMenu;
&nbsp;import javax.swing.JMenuItem;
&nbsp;import javax.swing.JPopupMenu;
&nbsp;import javax.swing.UIManager;
&nbsp;
&nbsp;import megamek.client.Client;
&nbsp;import megamek.client.ui.Messages;
&nbsp;import megamek.client.ui.swing.boardview.BoardView1;
&nbsp;import megamek.client.event.BoardViewEvent;
&nbsp;import megamek.common.AmmoType;
&nbsp;import megamek.common.BipedMech;
&nbsp;import megamek.common.Building;
&nbsp;import megamek.common.Building.DemolitionCharge;
&nbsp;import megamek.common.BuildingTarget;
&nbsp;import megamek.common.Coords;
&nbsp;import megamek.common.Entity;
&nbsp;import megamek.common.EntityMovementType;
&nbsp;import megamek.common.EquipmentMode;
&nbsp;import megamek.common.HexTarget;
&nbsp;import megamek.common.IBoard;
&nbsp;import megamek.common.IGame;
&nbsp;import megamek.common.IHex;
&nbsp;import megamek.common.IPlayer;
&nbsp;import megamek.common.LandAirMech;
&nbsp;import megamek.common.Mech;
&nbsp;import megamek.common.MinefieldTarget;
&nbsp;import megamek.common.MiscType;
&nbsp;import megamek.common.Mounted;
&nbsp;import megamek.common.QuadVee;
&nbsp;import megamek.common.SpecialHexDisplay;
&nbsp;import megamek.common.Tank;
&nbsp;import megamek.common.TargetRoll;
&nbsp;import megamek.common.Targetable;
&nbsp;import megamek.common.Terrains;
&nbsp;import megamek.common.ToHitData;
&nbsp;import megamek.common.WeaponComparatorDamage;
&nbsp;import megamek.common.WeaponType;
&nbsp;import megamek.common.actions.BAVibroClawAttackAction;
&nbsp;import megamek.common.actions.BreakGrappleAttackAction;
&nbsp;import megamek.common.actions.GrappleAttackAction;
&nbsp;import megamek.common.actions.WeaponAttackAction;
&nbsp;import megamek.common.options.OptionsConstants;
&nbsp;import megamek.common.weapons.other.CLFireExtinguisher;
&nbsp;import megamek.common.weapons.other.ISFireExtinguisher;
&nbsp;
&nbsp;/**
&nbsp; * Context menu for the board.
&nbsp; */
<b class="nc">&nbsp;public class MapMenu extends JPopupMenu {</b>
&nbsp;
&nbsp;    /**
&nbsp;     *
&nbsp;     */
&nbsp;    private static final long serialVersionUID = 2879345079968414986L;
&nbsp;
&nbsp;    private Coords coords;
&nbsp;    IGame game;
&nbsp;    Component currentPanel;
&nbsp;    private IBoard board;
&nbsp;    Client client;
&nbsp;    ClientGUI gui;
&nbsp;    Entity selectedEntity;
&nbsp;    Entity myEntity;
<b class="nc">&nbsp;    Targetable myTarget = null;</b>
<b class="nc">&nbsp;    private boolean hasMenu = false;</b>
&nbsp;
<b class="nc">&nbsp;    public MapMenu(Coords coords, Client client, Component panel, ClientGUI gui) {</b>
<b class="nc">&nbsp;        this.coords = coords;</b>
<b class="nc">&nbsp;        game = client.getGame();</b>
<b class="nc">&nbsp;        currentPanel = panel;</b>
<b class="nc">&nbsp;        board = client.getBoard();</b>
<b class="nc">&nbsp;        this.client = client;</b>
<b class="nc">&nbsp;        this.gui = gui;</b>
<b class="nc">&nbsp;        selectedEntity = myEntity = game.getEntity(gui.getSelectedEntityNum());</b>
&nbsp;
<b class="nc">&nbsp;        hasMenu = createMenu();</b>
&nbsp;        // make popups not consume mouse events outside them
&nbsp;        // so board dragging can start correctly when this menu is open
<b class="nc">&nbsp;        UIManager.put(&quot;PopupMenu.consumeEventOnClose&quot;, false);</b>
&nbsp;    }
&nbsp;
&nbsp;    private boolean canSelectEntities() {
<b class="nc">&nbsp;        return client.isMyTurn()</b>
&nbsp;               &amp;&amp; ((currentPanel instanceof FiringDisplay)
&nbsp;                   || (currentPanel instanceof PhysicalDisplay)
&nbsp;                   || (currentPanel instanceof MovementDisplay)
&nbsp;                   || (currentPanel instanceof TargetingPhaseDisplay));
&nbsp;    }
&nbsp;
&nbsp;    private boolean canTargetEntities() {
<b class="nc">&nbsp;        return client.isMyTurn()</b>
&nbsp;               &amp;&amp; ((currentPanel instanceof FiringDisplay)
&nbsp;                   || (currentPanel instanceof PhysicalDisplay)
&nbsp;                   || (currentPanel instanceof TargetingPhaseDisplay));
&nbsp;    }
&nbsp;
&nbsp;    private boolean createMenu() {
<b class="nc">&nbsp;        removeAll();</b>
<b class="nc">&nbsp;        int itemCount = 0;</b>
<b class="nc">&nbsp;        JMenu menu = createSelectMenu();</b>
<b class="nc">&nbsp;        if (menu.getItemCount() &gt; 0) {</b>
<b class="nc">&nbsp;            this.add(menu);</b>
<b class="nc">&nbsp;            itemCount++;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        menu = createViewMenu();</b>
<b class="nc">&nbsp;        if (menu.getItemCount() &gt; 0) {</b>
<b class="nc">&nbsp;            this.add(menu);</b>
<b class="nc">&nbsp;            itemCount++;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (client.isMyTurn() &amp;&amp; (myEntity != null)) {</b>
<b class="nc">&nbsp;            selectTarget();</b>
&nbsp;
<b class="nc">&nbsp;            menu = createTargetMenu();</b>
<b class="nc">&nbsp;            if (menu.getItemCount() &gt; 0) {</b>
<b class="nc">&nbsp;                this.add(menu);</b>
<b class="nc">&nbsp;                itemCount++;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (currentPanel instanceof MovementDisplay) {</b>
<b class="nc">&nbsp;                menu = createMovementMenu(myEntity.getPosition().equals(coords));</b>
&nbsp;
<b class="nc">&nbsp;                if (itemCount &gt; 0) {</b>
<b class="nc">&nbsp;                    addSeparator();</b>
<b class="nc">&nbsp;                    itemCount++;</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                if (menu.getItemCount() &gt; 0) {</b>
<b class="nc">&nbsp;                    this.add(menu);</b>
<b class="nc">&nbsp;                    itemCount++;</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                menu = createTurnMenu();</b>
&nbsp;
<b class="nc">&nbsp;                if (menu.getItemCount() &gt; 0) {</b>
<b class="nc">&nbsp;                    this.add(menu);</b>
<b class="nc">&nbsp;                    itemCount++;</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                menu = createStandMenu();</b>
&nbsp;
<b class="nc">&nbsp;                if (menu.getItemCount() &gt; 0) {</b>
<b class="nc">&nbsp;                    this.add(menu);</b>
<b class="nc">&nbsp;                    itemCount++;</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                menu = createConvertMenu();</b>
&nbsp;
<b class="nc">&nbsp;                if (menu.getItemCount() &gt; 0) {</b>
<b class="nc">&nbsp;                    this.add(menu);</b>
<b class="nc">&nbsp;                    itemCount++;</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                menu = createPhysicalMenu(true);</b>
&nbsp;
<b class="nc">&nbsp;                if (menu.getItemCount() &gt; 0) {</b>
<b class="nc">&nbsp;                    addSeparator();</b>
<b class="nc">&nbsp;                    this.add(menu);</b>
<b class="nc">&nbsp;                    itemCount++;</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;            } else if (currentPanel instanceof TargetingPhaseDisplay) {</b>
&nbsp;                
<b class="nc">&nbsp;                if (itemCount &gt; 0) {</b>
<b class="nc">&nbsp;                    addSeparator();</b>
<b class="nc">&nbsp;                    itemCount++;</b>
&nbsp;                }
&nbsp;                    
<b class="nc">&nbsp;                menu = createTorsoTwistMenu();</b>
<b class="nc">&nbsp;                if (menu.getItemCount() &gt; 0) {</b>
<b class="nc">&nbsp;                    this.add(menu);</b>
<b class="nc">&nbsp;                    itemCount++;</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                menu = createRotateTurretMenu();</b>
<b class="nc">&nbsp;                if (menu.getItemCount() &gt; 0) {</b>
<b class="nc">&nbsp;                    this.add(menu);</b>
<b class="nc">&nbsp;                    itemCount++;</b>
&nbsp;                }
&nbsp;                
<b class="nc">&nbsp;            } else if ((currentPanel instanceof FiringDisplay)) {</b>
&nbsp;
<b class="nc">&nbsp;                if (itemCount &gt; 0) {</b>
<b class="nc">&nbsp;                    addSeparator();</b>
<b class="nc">&nbsp;                    itemCount++;</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                menu = createWeaponsFireMenu();</b>
<b class="nc">&nbsp;                if (menu.getItemCount() &gt; 0) {</b>
<b class="nc">&nbsp;                    this.add(menu);</b>
<b class="nc">&nbsp;                    itemCount++;</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                menu = createModeMenu();</b>
<b class="nc">&nbsp;                if (menu.getItemCount() &gt; 0) {</b>
<b class="nc">&nbsp;                    this.add(menu);</b>
<b class="nc">&nbsp;                    itemCount++;</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                menu = createTorsoTwistMenu();</b>
<b class="nc">&nbsp;                if (menu.getItemCount() &gt; 0) {</b>
<b class="nc">&nbsp;                    this.add(menu);</b>
<b class="nc">&nbsp;                    itemCount++;</b>
&nbsp;                }
&nbsp;                
<b class="nc">&nbsp;                menu = createRotateTurretMenu();</b>
<b class="nc">&nbsp;                if (menu.getItemCount() &gt; 0) {</b>
<b class="nc">&nbsp;                    this.add(menu);</b>
<b class="nc">&nbsp;                    itemCount++;</b>
&nbsp;                }
&nbsp;                
<b class="nc">&nbsp;            } else if ((currentPanel instanceof PhysicalDisplay)) {</b>
<b class="nc">&nbsp;                menu = createPhysicalMenu(false);</b>
&nbsp;
<b class="nc">&nbsp;                if (menu.getItemCount() &gt; 0) {</b>
<b class="nc">&nbsp;                    addSeparator();</b>
<b class="nc">&nbsp;                    this.add(menu);</b>
<b class="nc">&nbsp;                    itemCount++;</b>
&nbsp;                }
&nbsp;
&nbsp;            }
&nbsp;
&nbsp;            // Traitor Command
<b class="nc">&nbsp;            JMenuItem item = new JMenuItem(</b>
<b class="nc">&nbsp;                    Messages.getString(&quot;MovementDisplay.Traitor&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;            item.setActionCommand(MovementDisplay.MoveCommand.MOVE_TRAITOR</b>
<b class="nc">&nbsp;                                          .getCmd());</b>
<b class="nc">&nbsp;            item.addActionListener(new ActionListener() {</b>
&nbsp;                public void actionPerformed(ActionEvent e) {
&nbsp;                    try {
<b class="nc">&nbsp;                        if (currentPanel instanceof MovementDisplay) {</b>
<b class="nc">&nbsp;                            ((MovementDisplay) currentPanel).actionPerformed(e);</b>
&nbsp;                        }
<b class="nc">&nbsp;                    } catch (Exception ex) {</b>
<b class="nc">&nbsp;                        ex.printStackTrace();</b>
<b class="nc">&nbsp;                    }</b>
&nbsp;                }
&nbsp;            });
<b class="nc">&nbsp;            this.add(item);</b>
&nbsp;        }
&nbsp;        
<b class="nc">&nbsp;        menu = touchOffExplosivesMenu();</b>
<b class="nc">&nbsp;        if (menu.getItemCount() &gt; 0) {</b>
<b class="nc">&nbsp;            this.add(menu);</b>
<b class="nc">&nbsp;            itemCount++;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        menu = createSpecialHexDisplayMenu();</b>
<b class="nc">&nbsp;        if (menu.getItemCount() &gt; 0) {</b>
<b class="nc">&nbsp;            this.add(menu);</b>
<b class="nc">&nbsp;            itemCount++;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return itemCount &gt; 0;</b>
&nbsp;    }
&nbsp;
&nbsp;    private JMenuItem TargetMenuItem(Targetable t) {
<b class="nc">&nbsp;        JMenuItem item = new JMenuItem(</b>
<b class="nc">&nbsp;                Messages.getString(&quot;ClientGUI.targetMenuItem&quot;)</b>
<b class="nc">&nbsp;                + t.getDisplayName());</b>
&nbsp;
<b class="nc">&nbsp;        String targetCode = &quot;&quot;;</b>
&nbsp;
<b class="nc">&nbsp;        if (t instanceof Entity) {</b>
<b class="nc">&nbsp;            targetCode = &quot;E|&quot; + ((Entity) t).getId();</b>
<b class="nc">&nbsp;        } else if (t instanceof BuildingTarget) {</b>
<b class="nc">&nbsp;            targetCode = &quot;B|&quot; + t.getPosition().getX() + &quot;|&quot; + t.getPosition().getY() + &quot;|&quot; + t.getTargetType();</b>
<b class="nc">&nbsp;        } else if (t instanceof MinefieldTarget) {</b>
<b class="nc">&nbsp;            targetCode = &quot;M|&quot; + t.getPosition().getX() + &quot;|&quot; + t.getPosition().getY();</b>
&nbsp;        } else {
<b class="nc">&nbsp;            targetCode = &quot;H|&quot; + t.getPosition().getX() + &quot;|&quot; + t.getPosition().getY() + &quot;|&quot; + t.getTargetType();</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        item.setActionCommand(targetCode);</b>
<b class="nc">&nbsp;        item.addActionListener(new ActionListener() {</b>
&nbsp;
&nbsp;            public void actionPerformed(ActionEvent e) {
<b class="nc">&nbsp;                myTarget = decodeTargetInfo(e.getActionCommand());</b>
<b class="nc">&nbsp;                if (currentPanel instanceof FiringDisplay) {</b>
<b class="nc">&nbsp;                    ((FiringDisplay) currentPanel).target(myTarget);</b>
<b class="nc">&nbsp;                } else if (currentPanel instanceof PhysicalDisplay) {</b>
<b class="nc">&nbsp;                    ((PhysicalDisplay) currentPanel).target(myTarget);</b>
<b class="nc">&nbsp;                } else if (currentPanel instanceof TargetingPhaseDisplay) {</b>
<b class="nc">&nbsp;                    ((TargetingPhaseDisplay) currentPanel).target(myTarget);</b>
&nbsp;                }
&nbsp;            }
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        return item;</b>
&nbsp;    }
&nbsp;
&nbsp;    private JMenuItem createChargeMenuItem() {
<b class="nc">&nbsp;        JMenuItem item = new JMenuItem(</b>
<b class="nc">&nbsp;                Messages.getString(&quot;MovementDisplay.butCharge&quot;));</b>
&nbsp;
<b class="nc">&nbsp;        if (!client.getGame().getEntities(coords).hasNext()) {</b>
<b class="nc">&nbsp;            return null;</b>
&nbsp;        }
<b class="nc">&nbsp;        item.setActionCommand(MovementDisplay.MoveCommand.MOVE_CHARGE.getCmd());</b>
<b class="nc">&nbsp;        item.addActionListener(new ActionListener() {</b>
&nbsp;
&nbsp;            public void actionPerformed(ActionEvent e) {
<b class="nc">&nbsp;                plotCourse(e);</b>
&nbsp;            }
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        return item;</b>
&nbsp;    }
&nbsp;
&nbsp;    private JMenuItem createDFAJMenuItem() {
<b class="nc">&nbsp;        JMenuItem item = new JMenuItem(</b>
<b class="nc">&nbsp;                Messages.getString(&quot;MovementDisplay.butDfa&quot;));</b>
&nbsp;
<b class="nc">&nbsp;        if (!client.getGame().getEntities(coords).hasNext()) {</b>
<b class="nc">&nbsp;            return null;</b>
&nbsp;        }
<b class="nc">&nbsp;        item.setActionCommand(MovementDisplay.MoveCommand.MOVE_DFA.getCmd());</b>
<b class="nc">&nbsp;        item.addActionListener(new ActionListener() {</b>
&nbsp;
&nbsp;            public void actionPerformed(ActionEvent e) {
<b class="nc">&nbsp;                plotCourse(e);</b>
&nbsp;            }
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        return item;</b>
&nbsp;    }
&nbsp;
&nbsp;    private JMenuItem selectJMenuItem(Entity en) {
<b class="nc">&nbsp;        JMenuItem item = new JMenuItem(</b>
<b class="nc">&nbsp;                Messages.getString(&quot;ClientGUI.selectMenuItem&quot;)</b>
<b class="nc">&nbsp;                + en.getDisplayName());</b>
&nbsp;
<b class="nc">&nbsp;        item.setActionCommand(Integer.toString(en.getId()));</b>
<b class="nc">&nbsp;        item.addActionListener(new ActionListener() {</b>
&nbsp;            public void actionPerformed(ActionEvent e) {
&nbsp;                try {
<b class="nc">&nbsp;                    Entity entity = game.getEntity(Integer.parseInt(e</b>
<b class="nc">&nbsp;                            .getActionCommand()));</b>
<b class="nc">&nbsp;                    selectedEntity = entity;</b>
<b class="nc">&nbsp;                    if (currentPanel instanceof MovementDisplay) {</b>
<b class="nc">&nbsp;                        ((MovementDisplay) currentPanel)</b>
<b class="nc">&nbsp;                                .selectEntity(selectedEntity.getId());</b>
<b class="nc">&nbsp;                    } else if (currentPanel instanceof FiringDisplay) {</b>
<b class="nc">&nbsp;                        ((FiringDisplay) currentPanel)</b>
<b class="nc">&nbsp;                                .selectEntity(selectedEntity.getId());</b>
<b class="nc">&nbsp;                    } else if (currentPanel instanceof PhysicalDisplay) {</b>
<b class="nc">&nbsp;                        ((PhysicalDisplay) currentPanel)</b>
<b class="nc">&nbsp;                                .selectEntity(selectedEntity.getId());</b>
&nbsp;                    }
<b class="nc">&nbsp;                } catch (Exception ex) {</b>
<b class="nc">&nbsp;                    ex.printStackTrace();</b>
<b class="nc">&nbsp;                }</b>
&nbsp;            }
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        return item;</b>
&nbsp;    }
&nbsp;
&nbsp;    private JMenuItem viewJMenuItem(Entity en) {
<b class="nc">&nbsp;        JMenuItem item = new JMenuItem(</b>
<b class="nc">&nbsp;                Messages.getString(&quot;ClientGUI.viewMenuItem&quot;)</b>
<b class="nc">&nbsp;                + en.getDisplayName());</b>
&nbsp;
<b class="nc">&nbsp;        item.setActionCommand(Integer.toString(en.getId()));</b>
<b class="nc">&nbsp;        item.addActionListener(new ActionListener() {</b>
&nbsp;            public void actionPerformed(ActionEvent e) {
&nbsp;                try {
<b class="nc">&nbsp;                    selectedEntity = game.getEntity(Integer.parseInt(e</b>
<b class="nc">&nbsp;                            .getActionCommand()));</b>
<b class="nc">&nbsp;                    gui.setDisplayVisible(true);</b>
<b class="nc">&nbsp;                    gui.mechD.displayEntity(selectedEntity);</b>
<b class="nc">&nbsp;                } catch (Exception ex) {</b>
<b class="nc">&nbsp;                    ex.printStackTrace();</b>
<b class="nc">&nbsp;                }</b>
&nbsp;            }
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        return item;</b>
&nbsp;    }
&nbsp;
&nbsp;    private JMenu touchOffExplosivesMenu() {
<b class="nc">&nbsp;        JMenu menu = new JMenu(&quot;Touch off explosives&quot;);</b>
&nbsp;
<b class="nc">&nbsp;        Building bldg = client.getBoard().getBuildingAt(coords);</b>
<b class="nc">&nbsp;        if ((bldg != null)) {</b>
<b class="nc">&nbsp;            for (final DemolitionCharge charge : bldg.getDemolitionCharges()) {</b>
<b class="nc">&nbsp;                if (charge.playerId == client.getLocalPlayer().getId()</b>
<b class="nc">&nbsp;                        &amp;&amp; coords.equals(charge.pos)) {</b>
<b class="nc">&nbsp;                    JMenuItem item = new JMenuItem(charge.damage + &quot; Damage&quot;);</b>
<b class="nc">&nbsp;                    item.addActionListener(new ActionListener() {</b>
&nbsp;                        public void actionPerformed(ActionEvent e) {
<b class="nc">&nbsp;                            client.sendExplodeBuilding(charge);</b>
&nbsp;                        }
&nbsp;                    });
<b class="nc">&nbsp;                    menu.add(item);</b>
&nbsp;                }
<b class="nc">&nbsp;            }</b>
&nbsp;        }
<b class="nc">&nbsp;        return menu;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Create various menus related to &lt;code&gt;SpecialHexDisplay&lt;/code&gt;.
&nbsp;     *
&nbsp;     * @return
&nbsp;     */
&nbsp;    private JMenu createSpecialHexDisplayMenu() {
<b class="nc">&nbsp;        JMenu menu = new JMenu(&quot;Special Hex Display&quot;);</b>
&nbsp;
<b class="nc">&nbsp;        final Collection&lt;SpecialHexDisplay&gt; shdList = game.getBoard()</b>
<b class="nc">&nbsp;                .getSpecialHexDisplay(coords);</b>
&nbsp;
<b class="nc">&nbsp;        SpecialHexDisplay note = null;</b>
<b class="nc">&nbsp;        if (shdList != null) {</b>
<b class="nc">&nbsp;            for (SpecialHexDisplay shd : shdList) {</b>
<b class="nc">&nbsp;                if (shd.getType() == SpecialHexDisplay.Type.PLAYER_NOTE</b>
<b class="nc">&nbsp;                    &amp;&amp; shd.getOwner().equals(client.getLocalPlayer())) {</b>
<b class="nc">&nbsp;                    note = shd;</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                }
<b class="nc">&nbsp;            }</b>
&nbsp;        }
&nbsp;
&nbsp;
&nbsp;        final SpecialHexDisplay finalNote;
<b class="nc">&nbsp;        if (note == null) {</b>
<b class="nc">&nbsp;            finalNote = new SpecialHexDisplay(</b>
&nbsp;                    SpecialHexDisplay.Type.PLAYER_NOTE,
<b class="nc">&nbsp;                    SpecialHexDisplay.NO_ROUND, client.getLocalPlayer(), &quot;&quot;);</b>
&nbsp;        } else {
<b class="nc">&nbsp;            finalNote = note;</b>
&nbsp;        }
<b class="nc">&nbsp;        JMenuItem item = new JMenuItem(Messages.getString(&quot;NoteDialog.action&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        item.addActionListener(new ActionListener() {</b>
&nbsp;            public void actionPerformed(ActionEvent e) {
<b class="nc">&nbsp;                NoteDialog nd = new NoteDialog(gui.frame, finalNote);</b>
<b class="nc">&nbsp;                gui.bv.setShouldIgnoreKeys(true);</b>
<b class="nc">&nbsp;                nd.setVisible(true);</b>
<b class="nc">&nbsp;                gui.bv.setShouldIgnoreKeys(false);</b>
<b class="nc">&nbsp;                if (nd.isAccepted()) {</b>
<b class="nc">&nbsp;                    client.sendSpecialHexDisplayAppend(coords, finalNote);</b>
&nbsp;                }
&nbsp;            }
&nbsp;        });
<b class="nc">&nbsp;        menu.add(item);</b>
&nbsp;
<b class="nc">&nbsp;        if (note != null) {</b>
<b class="nc">&nbsp;            item = new JMenuItem(Messages.getString(&quot;NoteDialog.delete&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;            item.addActionListener(new ActionListener() {</b>
&nbsp;                public void actionPerformed(ActionEvent e) {
<b class="nc">&nbsp;                    client.sendSpecialHexDisplayDelete(coords, finalNote);</b>
&nbsp;                }
&nbsp;            });
&nbsp;        }
<b class="nc">&nbsp;        menu.add(item);</b>
&nbsp;
<b class="nc">&nbsp;        return menu;</b>
&nbsp;    }
&nbsp;
&nbsp;    private JMenu createSelectMenu() {
<b class="nc">&nbsp;        JMenu menu = new JMenu(&quot;Select&quot;);</b>
&nbsp;        // add select options
<b class="nc">&nbsp;        if (canSelectEntities()) {</b>
<b class="nc">&nbsp;            for (Entity entity : client.getGame().getEntitiesVector(coords,</b>
<b class="nc">&nbsp;                    canTargetEntities())) {</b>
<b class="nc">&nbsp;                if (client.getMyTurn().isValidEntity(entity, client.getGame())) {</b>
<b class="nc">&nbsp;                    menu.add(selectJMenuItem(entity));</b>
&nbsp;                }
<b class="nc">&nbsp;            }</b>
&nbsp;        }
<b class="nc">&nbsp;        return menu;</b>
&nbsp;    }
&nbsp;
&nbsp;    private JMenu createViewMenu() {
<b class="nc">&nbsp;        JMenu menu = new JMenu(&quot;View&quot;);</b>
<b class="nc">&nbsp;        IGame game = client.getGame();</b>
&nbsp;                
<b class="nc">&nbsp;        IPlayer localPlayer = client.getLocalPlayer();</b>
&nbsp;        
<b class="nc">&nbsp;        for (Entity entity : game.getEntitiesVector(coords, true)) {</b>
&nbsp;            // Only add the unit if it&#39;s actually visible
&nbsp;            //  With double blind on, the game may unseen units
<b class="nc">&nbsp;            if (!entity.isSensorReturn(localPlayer)</b>
<b class="nc">&nbsp;                    &amp;&amp; entity.hasSeenEntity(localPlayer)) {</b>
<b class="nc">&nbsp;                menu.add(viewJMenuItem(entity));</b>
&nbsp;            }
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;        return menu;</b>
&nbsp;    }
&nbsp;
&nbsp;    private JMenu createMovementMenu(boolean entityInHex) {
<b class="nc">&nbsp;        JMenu menu = new JMenu(&quot;Movement&quot;);</b>
&nbsp;
<b class="nc">&nbsp;        if (myEntity == null) {</b>
<b class="nc">&nbsp;            return menu;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (entityInHex) {</b>
<b class="nc">&nbsp;            JMenuItem item = new JMenuItem(</b>
<b class="nc">&nbsp;                    Messages.getString(&quot;MovementDisplay.MoveEnvelope&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;            item.setActionCommand(MovementDisplay.MoveCommand.MOVE_ENVELOPE</b>
<b class="nc">&nbsp;                                          .getCmd());</b>
<b class="nc">&nbsp;            item.addActionListener(new ActionListener() {</b>
&nbsp;                public void actionPerformed(ActionEvent e) {
&nbsp;                    try {
<b class="nc">&nbsp;                        ((MovementDisplay) currentPanel).actionPerformed(e);</b>
<b class="nc">&nbsp;                    } catch (Exception ex) {</b>
<b class="nc">&nbsp;                        ex.printStackTrace();</b>
<b class="nc">&nbsp;                    }</b>
&nbsp;                }
&nbsp;            });
<b class="nc">&nbsp;            menu.add(item);</b>
&nbsp;
&nbsp;
<b class="nc">&nbsp;            item = new JMenuItem(Messages.getString(&quot;MovementDisplay.butWalk&quot;));</b>
&nbsp;
<b class="nc">&nbsp;            item.setActionCommand(MovementDisplay.MoveCommand.MOVE_WALK.getCmd());</b>
<b class="nc">&nbsp;            item.addActionListener(new ActionListener() {</b>
&nbsp;                public void actionPerformed(ActionEvent e) {
&nbsp;                    try {
<b class="nc">&nbsp;                        ((MovementDisplay) currentPanel).actionPerformed(e);</b>
<b class="nc">&nbsp;                    } catch (Exception ex) {</b>
<b class="nc">&nbsp;                        ex.printStackTrace();</b>
<b class="nc">&nbsp;                    }</b>
&nbsp;                }
&nbsp;            });
<b class="nc">&nbsp;            menu.add(item);</b>
&nbsp;
<b class="nc">&nbsp;            item = new JMenuItem(Messages.getString(&quot;MovementDisplay.butBackup&quot;));</b>
&nbsp;
<b class="nc">&nbsp;            item.setActionCommand(MovementDisplay.MoveCommand.MOVE_BACK_UP.getCmd());</b>
<b class="nc">&nbsp;            item.addActionListener(new ActionListener() {</b>
&nbsp;                public void actionPerformed(ActionEvent e) {
&nbsp;                    try {
<b class="nc">&nbsp;                        ((MovementDisplay) currentPanel).actionPerformed(e);</b>
<b class="nc">&nbsp;                    } catch (Exception ex) {</b>
<b class="nc">&nbsp;                        ex.printStackTrace();</b>
<b class="nc">&nbsp;                    }</b>
&nbsp;                }
&nbsp;            });
&nbsp;
<b class="nc">&nbsp;            menu.add(item);</b>
&nbsp;
<b class="nc">&nbsp;            if (myEntity.getJumpMP() &gt; 0) {</b>
<b class="nc">&nbsp;                item = new JMenuItem(</b>
<b class="nc">&nbsp;                        Messages.getString(&quot;CommonMenuBar.moveJump&quot;));</b>
&nbsp;
<b class="nc">&nbsp;                item.setActionCommand(MovementDisplay.MoveCommand.MOVE_JUMP</b>
<b class="nc">&nbsp;                                              .getCmd());</b>
<b class="nc">&nbsp;                item.addActionListener(new ActionListener() {</b>
&nbsp;                    public void actionPerformed(ActionEvent e) {
&nbsp;                        try {
<b class="nc">&nbsp;                            ((MovementDisplay) currentPanel).actionPerformed(e);</b>
<b class="nc">&nbsp;                        } catch (Exception ex) {</b>
<b class="nc">&nbsp;                            ex.printStackTrace();</b>
<b class="nc">&nbsp;                        }</b>
&nbsp;                    }
&nbsp;                });
<b class="nc">&nbsp;                menu.add(item);</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (game.getOptions().booleanOption(OptionsConstants.ADVGRNDMOV_TACOPS_EVADE)) {</b>
<b class="nc">&nbsp;                item = new JMenuItem(</b>
<b class="nc">&nbsp;                        Messages.getString(&quot;MovementDisplay.butEvade&quot;));</b>
&nbsp;
<b class="nc">&nbsp;                item.setActionCommand(MovementDisplay.MoveCommand.MOVE_EVADE</b>
<b class="nc">&nbsp;                                              .getCmd());</b>
<b class="nc">&nbsp;                item.addActionListener(new ActionListener() {</b>
&nbsp;                    public void actionPerformed(ActionEvent e) {
&nbsp;                        try {
<b class="nc">&nbsp;                            ((MovementDisplay) currentPanel).actionPerformed(e);</b>
<b class="nc">&nbsp;                        } catch (Exception ex) {</b>
<b class="nc">&nbsp;                            ex.printStackTrace();</b>
<b class="nc">&nbsp;                        }</b>
&nbsp;                    }
&nbsp;                });
<b class="nc">&nbsp;                menu.add(item);</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (game.getOptions().booleanOption(OptionsConstants.ADVGRNDMOV_VEHICLE_ADVANCED_MANEUVERS)) {</b>
<b class="nc">&nbsp;                item = new JMenuItem(</b>
<b class="nc">&nbsp;                        Messages.getString(&quot;MovementDisplay.butEvade&quot;));</b>
&nbsp;
<b class="nc">&nbsp;                item.setActionCommand(MovementDisplay.MoveCommand.MOVE_BOOTLEGGER</b>
<b class="nc">&nbsp;                                              .getCmd());</b>
<b class="nc">&nbsp;                item.addActionListener(new ActionListener() {</b>
&nbsp;                    public void actionPerformed(ActionEvent e) {
&nbsp;                        try {
<b class="nc">&nbsp;                            ((MovementDisplay) currentPanel).actionPerformed(e);</b>
<b class="nc">&nbsp;                        } catch (Exception ex) {</b>
<b class="nc">&nbsp;                            ex.printStackTrace();</b>
<b class="nc">&nbsp;                        }</b>
&nbsp;                    }
&nbsp;                });
<b class="nc">&nbsp;                menu.add(item);</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (game.getPlanetaryConditions().isRecklessConditions()</b>
<b class="nc">&nbsp;                &amp;&amp; !game.getBoard().inSpace()</b>
<b class="nc">&nbsp;                &amp;&amp; !game.getOptions().booleanOption(OptionsConstants.ADVGRNDMOV_NO_NIGHT_MOVE_PEN)) {</b>
<b class="nc">&nbsp;                item = new JMenuItem(</b>
<b class="nc">&nbsp;                        Messages.getString(&quot;MovementDisplay.butReckless&quot;));</b>
&nbsp;
<b class="nc">&nbsp;                item.setActionCommand(MovementDisplay.MoveCommand.MOVE_RECKLESS</b>
<b class="nc">&nbsp;                                              .getCmd());</b>
<b class="nc">&nbsp;                item.addActionListener(new ActionListener() {</b>
&nbsp;                    public void actionPerformed(ActionEvent e) {
&nbsp;                        try {
<b class="nc">&nbsp;                            ((MovementDisplay) currentPanel).actionPerformed(e);</b>
<b class="nc">&nbsp;                        } catch (Exception ex) {</b>
<b class="nc">&nbsp;                            ex.printStackTrace();</b>
<b class="nc">&nbsp;                        }</b>
&nbsp;                    }
&nbsp;                });
<b class="nc">&nbsp;                menu.add(item);</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;        } else {</b>
&nbsp;
<b class="nc">&nbsp;            JMenuItem item = new JMenuItem(</b>
<b class="nc">&nbsp;                    Messages.getString(&quot;MovementDisplay.butWalk&quot;));</b>
&nbsp;
<b class="nc">&nbsp;            item.setActionCommand(MovementDisplay.MoveCommand.MOVE_WALK</b>
<b class="nc">&nbsp;                                          .getCmd());</b>
<b class="nc">&nbsp;            item.addActionListener(new ActionListener() {</b>
&nbsp;                public void actionPerformed(ActionEvent e) {
&nbsp;                    try {
<b class="nc">&nbsp;                        plotCourse(e);</b>
<b class="nc">&nbsp;                    } catch (Exception ex) {</b>
<b class="nc">&nbsp;                        ex.printStackTrace();</b>
<b class="nc">&nbsp;                    }</b>
&nbsp;                }
&nbsp;            });
&nbsp;
<b class="nc">&nbsp;            menu.add(item);</b>
&nbsp;
<b class="nc">&nbsp;            item = new JMenuItem(</b>
<b class="nc">&nbsp;                    Messages.getString(&quot;MovementDisplay.butBackup&quot;));</b>
&nbsp;
<b class="nc">&nbsp;            item.setActionCommand(MovementDisplay.MoveCommand.MOVE_BACK_UP</b>
<b class="nc">&nbsp;                                          .getCmd());</b>
<b class="nc">&nbsp;            item.addActionListener(new ActionListener() {</b>
&nbsp;                public void actionPerformed(ActionEvent e) {
&nbsp;                    try {
<b class="nc">&nbsp;                        plotCourse(e);</b>
<b class="nc">&nbsp;                    } catch (Exception ex) {</b>
<b class="nc">&nbsp;                        ex.printStackTrace();</b>
<b class="nc">&nbsp;                    }</b>
&nbsp;                }
&nbsp;            });
&nbsp;
<b class="nc">&nbsp;            menu.add(item);</b>
&nbsp;
<b class="nc">&nbsp;            if (myEntity.getJumpMP() &gt; 0) {</b>
<b class="nc">&nbsp;                item = new JMenuItem(</b>
<b class="nc">&nbsp;                        Messages.getString(&quot;CommonMenuBar.moveJump&quot;));</b>
&nbsp;
<b class="nc">&nbsp;                item.setActionCommand(MovementDisplay.MoveCommand.MOVE_JUMP</b>
<b class="nc">&nbsp;                                              .getCmd());</b>
<b class="nc">&nbsp;                item.addActionListener(new ActionListener() {</b>
&nbsp;                    public void actionPerformed(ActionEvent e) {
&nbsp;                        try {
<b class="nc">&nbsp;                            plotCourse(e);</b>
<b class="nc">&nbsp;                        } catch (Exception ex) {</b>
<b class="nc">&nbsp;                            ex.printStackTrace();</b>
<b class="nc">&nbsp;                        }</b>
&nbsp;                    }
&nbsp;                });
<b class="nc">&nbsp;                menu.add(item);</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            item = new JMenuItem(</b>
<b class="nc">&nbsp;                    Messages.getString(&quot;MovementDisplay.moveLongestRun&quot;)); //$NON-NLS-1$</b>
&nbsp;
<b class="nc">&nbsp;            item.setActionCommand(MovementDisplay.MoveCommand.MOVE_LONGEST_RUN</b>
<b class="nc">&nbsp;                                          .getCmd());</b>
<b class="nc">&nbsp;            item.addActionListener(new ActionListener() {</b>
&nbsp;                public void actionPerformed(ActionEvent e) {
&nbsp;                    try {
<b class="nc">&nbsp;                        plotCourse(e);</b>
<b class="nc">&nbsp;                    } catch (Exception ex) {</b>
<b class="nc">&nbsp;                        ex.printStackTrace();</b>
<b class="nc">&nbsp;                    }</b>
&nbsp;                }
&nbsp;            });
&nbsp;
<b class="nc">&nbsp;            menu.add(item);</b>
&nbsp;
<b class="nc">&nbsp;            item = new JMenuItem(</b>
<b class="nc">&nbsp;                    Messages.getString(&quot;MovementDisplay.moveLongestWalk&quot;)); //$NON-NLS-1$</b>
&nbsp;
<b class="nc">&nbsp;            item.setActionCommand(MovementDisplay.MoveCommand.MOVE_LONGEST_WALK</b>
<b class="nc">&nbsp;                                          .getCmd());</b>
<b class="nc">&nbsp;            item.addActionListener(new ActionListener() {</b>
&nbsp;                public void actionPerformed(ActionEvent e) {
&nbsp;                    try {
<b class="nc">&nbsp;                        plotCourse(e);</b>
<b class="nc">&nbsp;                    } catch (Exception ex) {</b>
<b class="nc">&nbsp;                        ex.printStackTrace();</b>
<b class="nc">&nbsp;                    }</b>
&nbsp;                }
&nbsp;            });
&nbsp;
<b class="nc">&nbsp;            menu.add(item);</b>
&nbsp;
<b class="nc">&nbsp;            if (game.getOptions().booleanOption(OptionsConstants.ADVGRNDMOV_TACOPS_EVADE)) {</b>
<b class="nc">&nbsp;                item = new JMenuItem(</b>
<b class="nc">&nbsp;                        Messages.getString(&quot;MovementDisplay.butEvade&quot;));</b>
&nbsp;
<b class="nc">&nbsp;                item.setActionCommand(MovementDisplay.MoveCommand.MOVE_EVADE</b>
<b class="nc">&nbsp;                                              .getCmd());</b>
<b class="nc">&nbsp;                item.addActionListener(new ActionListener() {</b>
&nbsp;                    public void actionPerformed(ActionEvent e) {
&nbsp;                        try {
<b class="nc">&nbsp;                            plotCourse(e);</b>
<b class="nc">&nbsp;                        } catch (Exception ex) {</b>
<b class="nc">&nbsp;                            ex.printStackTrace();</b>
<b class="nc">&nbsp;                        }</b>
&nbsp;                    }
&nbsp;                });
<b class="nc">&nbsp;                menu.add(item);</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (game.getPlanetaryConditions().isRecklessConditions()</b>
<b class="nc">&nbsp;                &amp;&amp; !game.getBoard().inSpace()</b>
<b class="nc">&nbsp;                &amp;&amp; !game.getOptions().booleanOption(OptionsConstants.ADVGRNDMOV_NO_NIGHT_MOVE_PEN)) {</b>
<b class="nc">&nbsp;                item = new JMenuItem(</b>
<b class="nc">&nbsp;                        Messages.getString(&quot;MovementDisplay.butReckless&quot;));</b>
&nbsp;
<b class="nc">&nbsp;                item.setActionCommand(MovementDisplay.MoveCommand.MOVE_RECKLESS</b>
<b class="nc">&nbsp;                                              .getCmd());</b>
<b class="nc">&nbsp;                item.addActionListener(new ActionListener() {</b>
&nbsp;                    public void actionPerformed(ActionEvent e) {
&nbsp;                        try {
<b class="nc">&nbsp;                            plotCourse(e);</b>
<b class="nc">&nbsp;                        } catch (Exception ex) {</b>
<b class="nc">&nbsp;                            ex.printStackTrace();</b>
<b class="nc">&nbsp;                        }</b>
&nbsp;                    }
&nbsp;                });
<b class="nc">&nbsp;                menu.add(item);</b>
&nbsp;            }
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return menu;</b>
&nbsp;    }
&nbsp;
&nbsp;    private JMenu createTurnMenu() {
<b class="nc">&nbsp;        JMenu menu = new JMenu(Messages.getString(&quot;MovementDisplay.butTurn&quot;));</b>
&nbsp;
<b class="nc">&nbsp;        JMenuItem item = new JMenuItem(</b>
<b class="nc">&nbsp;                Messages.getString(&quot;MovementDisplay.butTurnRight&quot;));</b>
&nbsp;
<b class="nc">&nbsp;        item.setActionCommand(MovementDisplay.MoveCommand.MOVE_TURN_RIGHT</b>
<b class="nc">&nbsp;                                      .getCmd());</b>
<b class="nc">&nbsp;        item.addActionListener(new ActionListener() {</b>
&nbsp;            public void actionPerformed(ActionEvent e) {
&nbsp;                try {
<b class="nc">&nbsp;                    ((MovementDisplay) currentPanel).actionPerformed(e);</b>
<b class="nc">&nbsp;                } catch (Exception ex) {</b>
<b class="nc">&nbsp;                    ex.printStackTrace();</b>
<b class="nc">&nbsp;                }</b>
&nbsp;            }
&nbsp;        });
<b class="nc">&nbsp;        menu.add(item);</b>
&nbsp;
<b class="nc">&nbsp;        item = new JMenuItem(Messages.getString(&quot;MovementDisplay.butTurnLeft&quot;));</b>
&nbsp;
<b class="nc">&nbsp;        item.setActionCommand(MovementDisplay.MoveCommand.MOVE_TURN_LEFT</b>
<b class="nc">&nbsp;                                      .getCmd());</b>
<b class="nc">&nbsp;        item.addActionListener(new ActionListener() {</b>
&nbsp;            public void actionPerformed(ActionEvent e) {
&nbsp;                try {
<b class="nc">&nbsp;                    ((MovementDisplay) currentPanel).actionPerformed(e);</b>
<b class="nc">&nbsp;                } catch (Exception ex) {</b>
<b class="nc">&nbsp;                    ex.printStackTrace();</b>
<b class="nc">&nbsp;                }</b>
&nbsp;            }
&nbsp;        });
<b class="nc">&nbsp;        menu.add(item);</b>
&nbsp;
<b class="nc">&nbsp;        item = new JMenuItem(&quot;About Face&quot;);</b>
&nbsp;
<b class="nc">&nbsp;        item.setActionCommand(MovementDisplay.MoveCommand.MOVE_TURN_RIGHT</b>
<b class="nc">&nbsp;                                      .getCmd());</b>
<b class="nc">&nbsp;        item.addActionListener(new ActionListener() {</b>
&nbsp;            public void actionPerformed(ActionEvent e) {
&nbsp;                try {
<b class="nc">&nbsp;                    ((MovementDisplay) currentPanel).actionPerformed(e);</b>
<b class="nc">&nbsp;                    ((MovementDisplay) currentPanel).actionPerformed(e);</b>
<b class="nc">&nbsp;                    ((MovementDisplay) currentPanel).actionPerformed(e);</b>
<b class="nc">&nbsp;                } catch (Exception ex) {</b>
<b class="nc">&nbsp;                    ex.printStackTrace();</b>
<b class="nc">&nbsp;                }</b>
&nbsp;            }
&nbsp;        });
<b class="nc">&nbsp;        menu.add(item);</b>
&nbsp;
<b class="nc">&nbsp;        return menu;</b>
&nbsp;    }
&nbsp;
&nbsp;    private JMenu createWeaponsFireMenu() {
<b class="nc">&nbsp;        JMenu menu = new JMenu(&quot;Weapons&quot;);</b>
&nbsp;
&nbsp;        // Hidden entities are not allowed to shoot without being revealed
&nbsp;        // so let&#39;s not give them the option
<b class="nc">&nbsp;        if (myEntity.isHidden()) {</b>
<b class="nc">&nbsp;            return menu;</b>
&nbsp;        }
&nbsp;        
<b class="nc">&nbsp;        menu.add(createFireJMenuItem());</b>
<b class="nc">&nbsp;        menu.add(createSkipJMenuItem());</b>
<b class="nc">&nbsp;        menu.add(createAlphaStrikeJMenuItem());</b>
&nbsp;
<b class="nc">&nbsp;        if (myEntity.canFlipArms()) {</b>
<b class="nc">&nbsp;            menu.add(createFlipArmsJMenuItem());</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return menu;</b>
&nbsp;    }
&nbsp;
&nbsp;    private JMenuItem createSkipJMenuItem() {
<b class="nc">&nbsp;        JMenuItem item = new JMenuItem(&quot;Skip&quot;);</b>
<b class="nc">&nbsp;        item.addActionListener(new ActionListener() {</b>
&nbsp;            public void actionPerformed(ActionEvent e) {
&nbsp;                try {
<b class="nc">&nbsp;                    ((FiringDisplay) currentPanel).nextWeapon();</b>
<b class="nc">&nbsp;                } catch (Exception ex) {</b>
<b class="nc">&nbsp;                    ex.printStackTrace();</b>
<b class="nc">&nbsp;                }</b>
&nbsp;            }
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        return item;</b>
&nbsp;    }
&nbsp;
&nbsp;    private JMenuItem createAlphaStrikeJMenuItem() {
<b class="nc">&nbsp;        JMenuItem item = new JMenuItem(&quot;Alpha Strike&quot;);</b>
<b class="nc">&nbsp;        item.addActionListener(new ActionListener() {</b>
&nbsp;            public void actionPerformed(ActionEvent e) {
&nbsp;                try {
<b class="nc">&nbsp;                    FiringDisplay panel = (FiringDisplay) currentPanel;</b>
&nbsp;                    // Get all weapons
<b class="nc">&nbsp;                    ArrayList&lt;Mounted&gt; weapons = myEntity.getWeaponList();</b>
&nbsp;                    // We will need to map a Mounted to it&#39;s weapon number
<b class="nc">&nbsp;                    HashMap&lt;Mounted, Integer&gt; weapToId = </b>
&nbsp;                            new HashMap&lt;Mounted, Integer&gt;();
<b class="nc">&nbsp;                    for (Mounted weapon : weapons) {</b>
<b class="nc">&nbsp;                        weapToId.put(weapon, myEntity.getEquipmentNum(weapon));</b>
<b class="nc">&nbsp;                    }</b>
&nbsp;                    // Sort weapons from high damage to low
<b class="nc">&nbsp;                    Collections.sort(weapons, new WeaponComparatorDamage(false));</b>
&nbsp;                    
<b class="nc">&nbsp;                    Targetable target = panel.getTarget();</b>
<b class="nc">&nbsp;                    for (Mounted weapon : weapons) {</b>
&nbsp;                        // If the weapon has been used at all this turn, ignore
<b class="nc">&nbsp;                        if (weapon.usedInPhase() != IGame.Phase.PHASE_UNKNOWN) {</b>
<b class="nc">&nbsp;                            continue;</b>
&nbsp;                        }
<b class="nc">&nbsp;                        int weaponNum = weapToId.get(weapon);</b>
&nbsp;                        // Used to determine if attack is valid
<b class="nc">&nbsp;                        WeaponAttackAction waa = new WeaponAttackAction(</b>
<b class="nc">&nbsp;                                myEntity.getId(), target.getTargetType(),</b>
<b class="nc">&nbsp;                                target.getTargetId(), weaponNum);</b>
&nbsp;                        // Only fire weapons that have a chance to hit
<b class="nc">&nbsp;                        int toHitVal = waa.toHit(game).getValue(); </b>
<b class="nc">&nbsp;                        if ((toHitVal != TargetRoll.IMPOSSIBLE)</b>
&nbsp;                                &amp;&amp; (toHitVal &lt;= 12)) {
<b class="nc">&nbsp;                            gui.mechD.wPan.selectWeapon(weaponNum);</b>
<b class="nc">&nbsp;                            panel.fire();</b>
&nbsp;                        }
<b class="nc">&nbsp;                    }</b>
<b class="nc">&nbsp;                } catch (Exception ex) {</b>
<b class="nc">&nbsp;                    ex.printStackTrace();</b>
<b class="nc">&nbsp;                }</b>
&nbsp;            }
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        return item;</b>
&nbsp;    }
&nbsp;
&nbsp;    private JMenuItem createFlipArmsJMenuItem() {
<b class="nc">&nbsp;        JMenuItem item = new JMenuItem(&quot;Flip Arms&quot;);</b>
&nbsp;
<b class="nc">&nbsp;        item.setActionCommand(Integer.toString(myEntity.getId()));</b>
<b class="nc">&nbsp;        item.addActionListener(new ActionListener() {</b>
&nbsp;            public void actionPerformed(ActionEvent e) {
&nbsp;                try {
<b class="nc">&nbsp;                    FiringDisplay display = (FiringDisplay) currentPanel;</b>
&nbsp;
<b class="nc">&nbsp;                    int id = Integer.parseInt(e.getActionCommand());</b>
<b class="nc">&nbsp;                    display.updateFlipArms(!game.getEntity(id).getArmsFlipped());</b>
<b class="nc">&nbsp;                } catch (Exception ex) {</b>
<b class="nc">&nbsp;                    ex.printStackTrace();</b>
<b class="nc">&nbsp;                }</b>
&nbsp;            }
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        return item;</b>
&nbsp;    }
&nbsp;
&nbsp;    private JMenuItem createFireJMenuItem() {
<b class="nc">&nbsp;        JMenuItem item = new JMenuItem(&quot;Fire&quot;);</b>
&nbsp;
<b class="nc">&nbsp;        item.addActionListener(new ActionListener() {</b>
&nbsp;            public void actionPerformed(ActionEvent e) {
&nbsp;                try {
<b class="nc">&nbsp;                    ((FiringDisplay) currentPanel).fire();</b>
<b class="nc">&nbsp;                } catch (Exception ex) {</b>
<b class="nc">&nbsp;                    ex.printStackTrace();</b>
<b class="nc">&nbsp;                }</b>
&nbsp;            }
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        return item;</b>
&nbsp;    }
&nbsp;
&nbsp;    private JMenu createPhysicalMenu(boolean isMovementPhase) {
<b class="nc">&nbsp;        JMenu menu = new JMenu(&quot;Physicals&quot;);</b>
&nbsp;
<b class="nc">&nbsp;        if (isMovementPhase) {</b>
<b class="nc">&nbsp;            if (myEntity.canCharge()) {</b>
&nbsp;
<b class="nc">&nbsp;                JMenuItem item = createChargeMenuItem();</b>
&nbsp;
<b class="nc">&nbsp;                if (item != null) {</b>
<b class="nc">&nbsp;                    menu.add(item);</b>
&nbsp;                }
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (myEntity.canDFA()) {</b>
<b class="nc">&nbsp;                JMenuItem item = createDFAJMenuItem();</b>
&nbsp;
<b class="nc">&nbsp;                if (item != null) {</b>
<b class="nc">&nbsp;                    menu.add(item);</b>
&nbsp;                }
<b class="nc">&nbsp;            }</b>
&nbsp;        } else {
&nbsp;
<b class="nc">&nbsp;            JMenuItem item = null;</b>
&nbsp;
<b class="nc">&nbsp;            if (!myEntity.isHullDown() &amp;&amp; !myEntity.isProne()</b>
<b class="nc">&nbsp;                &amp;&amp; !myEntity.hasHipCrit()) {</b>
<b class="nc">&nbsp;                item = createKickJMenuItem();</b>
&nbsp;
<b class="nc">&nbsp;                if (item != null) {</b>
<b class="nc">&nbsp;                    menu.add(item);</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                item = createTripJMenuItem();</b>
&nbsp;
<b class="nc">&nbsp;                if (item != null) {</b>
<b class="nc">&nbsp;                    menu.add(item);</b>
&nbsp;                }
&nbsp;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if ((myEntity instanceof BipedMech)</b>
<b class="nc">&nbsp;                &amp;&amp; (!myEntity.isLocationBad(Mech.LOC_LARM) || !myEntity</b>
<b class="nc">&nbsp;                    .isLocationBad(Mech.LOC_RARM))) {</b>
<b class="nc">&nbsp;                item = createPunchJMenuItem();</b>
&nbsp;
<b class="nc">&nbsp;                if (item != null) {</b>
<b class="nc">&nbsp;                    menu.add(item);</b>
&nbsp;                }
&nbsp;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if ((myEntity instanceof BipedMech)</b>
<b class="nc">&nbsp;                &amp;&amp; !myEntity.isLocationBad(Mech.LOC_LARM)</b>
<b class="nc">&nbsp;                &amp;&amp; !myEntity.isLocationBad(Mech.LOC_RARM)) {</b>
<b class="nc">&nbsp;                item = createPushJMenuItem();</b>
&nbsp;
<b class="nc">&nbsp;                if (item != null) {</b>
<b class="nc">&nbsp;                    menu.add(item);</b>
&nbsp;                }
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (myEntity.getJumpMP() &gt; 0) {</b>
<b class="nc">&nbsp;                item = createJumpJetAttackJMenuItem();</b>
&nbsp;
<b class="nc">&nbsp;                if (item != null) {</b>
<b class="nc">&nbsp;                    menu.add(item);</b>
&nbsp;                }
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (myEntity.isProne()) {</b>
<b class="nc">&nbsp;                item = createThrashJMenuItem();</b>
&nbsp;
<b class="nc">&nbsp;                if (item != null) {</b>
<b class="nc">&nbsp;                    menu.add(item);</b>
&nbsp;                }
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            item = createDodgeJMenuItem();</b>
&nbsp;
<b class="nc">&nbsp;            if (item != null) {</b>
<b class="nc">&nbsp;                menu.add(item);</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (myEntity.getClubs().size() &gt; 0) {</b>
&nbsp;
<b class="nc">&nbsp;                JMenu clubMenu = createClubMenu();</b>
&nbsp;
<b class="nc">&nbsp;                if (clubMenu.getItemCount() &gt; 0) {</b>
<b class="nc">&nbsp;                    menu.add(clubMenu);</b>
&nbsp;                }
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            ToHitData grap = GrappleAttackAction.toHit(client.getGame(),</b>
<b class="nc">&nbsp;                                                       myEntity.getId(), myTarget);</b>
<b class="nc">&nbsp;            ToHitData bgrap = BreakGrappleAttackAction.toHit(client.getGame(),</b>
<b class="nc">&nbsp;                                                             myEntity.getId(), myTarget);</b>
<b class="nc">&nbsp;            if ((grap.getValue() != TargetRoll.IMPOSSIBLE)</b>
<b class="nc">&nbsp;                || (bgrap.getValue() != TargetRoll.IMPOSSIBLE)) {</b>
&nbsp;
<b class="nc">&nbsp;                item = createGrappleJMenuItem();</b>
&nbsp;
<b class="nc">&nbsp;                if (item != null) {</b>
<b class="nc">&nbsp;                    menu.add(item);</b>
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            if (myTarget != null) {</b>
<b class="nc">&nbsp;                ToHitData vibro = BAVibroClawAttackAction.toHit(</b>
<b class="nc">&nbsp;                        client.getGame(), myEntity.getId(), myTarget);</b>
<b class="nc">&nbsp;                if (vibro.getValue() != TargetRoll.IMPOSSIBLE) {</b>
<b class="nc">&nbsp;                    item = createVibroClawMenuItem();</b>
<b class="nc">&nbsp;                    if (item != null) {</b>
<b class="nc">&nbsp;                        menu.add(item);</b>
&nbsp;                    }
&nbsp;                }
&nbsp;            }
&nbsp;
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return menu;</b>
&nbsp;    }
&nbsp;
&nbsp;    private JMenu createStandMenu() {
<b class="nc">&nbsp;        JMenu menu = new JMenu();</b>
&nbsp;
<b class="nc">&nbsp;        if (selectedEntity.isProne()) {</b>
<b class="nc">&nbsp;            menu.setText(&quot;Stand&quot;);</b>
<b class="nc">&nbsp;            menu.add(createStandJMenuItem(false));</b>
&nbsp;
<b class="nc">&nbsp;            if (game.getOptions().booleanOption(OptionsConstants.ADVGRNDMOV_TACOPS_CAREFUL_STAND)</b>
<b class="nc">&nbsp;                &amp;&amp; (myEntity.getWalkMP() &gt; 2)</b>
&nbsp;                &amp;&amp; (myEntity.moved == EntityMovementType.MOVE_NONE)) {
<b class="nc">&nbsp;                menu.add(createStandJMenuItem(true));</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (game.getOptions().booleanOption(OptionsConstants.ADVGRNDMOV_TACOPS_HULL_DOWN)) {</b>
<b class="nc">&nbsp;                menu.add(createHullDownJMenuItem());</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;        } else if (selectedEntity.isHullDown()) {</b>
<b class="nc">&nbsp;            menu.setText(&quot;Stand&quot;);</b>
<b class="nc">&nbsp;            menu.add(createStandJMenuItem(false));</b>
&nbsp;
<b class="nc">&nbsp;            if (game.getOptions().booleanOption(OptionsConstants.ADVGRNDMOV_TACOPS_CAREFUL_STAND)) {</b>
<b class="nc">&nbsp;                menu.add(createStandJMenuItem(true));</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            menu.add(createProneJMenuItem());</b>
&nbsp;        } else {
<b class="nc">&nbsp;            menu.setText(&quot;Prone&quot;);</b>
<b class="nc">&nbsp;            menu.add(createProneJMenuItem());</b>
&nbsp;
<b class="nc">&nbsp;            if (game.getOptions().booleanOption(OptionsConstants.ADVGRNDMOV_TACOPS_HULL_DOWN)) {</b>
<b class="nc">&nbsp;                menu.add(createHullDownJMenuItem());</b>
&nbsp;            }
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return menu;</b>
&nbsp;    }
&nbsp;
&nbsp;    private JMenuItem createStandJMenuItem(boolean carefulStand) {
<b class="nc">&nbsp;        JMenuItem item = new JMenuItem(</b>
<b class="nc">&nbsp;                Messages.getString(&quot;MovementDisplay.butUp&quot;));</b>
&nbsp;
<b class="nc">&nbsp;        if (carefulStand) {</b>
<b class="nc">&nbsp;            item.setText(&quot;Careful Stand&quot;);</b>
<b class="nc">&nbsp;            item.setActionCommand(MovementDisplay.MoveCommand.MOVE_CAREFUL_STAND</b>
<b class="nc">&nbsp;                                          .getCmd());</b>
&nbsp;        } else {
<b class="nc">&nbsp;            item.setActionCommand(MovementDisplay.MoveCommand.MOVE_GET_UP</b>
<b class="nc">&nbsp;                                          .getCmd());</b>
&nbsp;        }
<b class="nc">&nbsp;        item.addActionListener(new ActionListener() {</b>
&nbsp;            public void actionPerformed(ActionEvent e) {
&nbsp;                try {
<b class="nc">&nbsp;                    ((MovementDisplay) currentPanel).actionPerformed(e);</b>
<b class="nc">&nbsp;                } catch (Exception ex) {</b>
<b class="nc">&nbsp;                    ex.printStackTrace();</b>
<b class="nc">&nbsp;                }</b>
&nbsp;            }
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        return item;</b>
&nbsp;    }
&nbsp;
&nbsp;    private JMenuItem createHullDownJMenuItem() {
<b class="nc">&nbsp;        JMenuItem item = new JMenuItem(</b>
<b class="nc">&nbsp;                Messages.getString(&quot;MovementDisplay.butHullDown&quot;));</b>
&nbsp;
<b class="nc">&nbsp;        item.setActionCommand(MovementDisplay.MoveCommand.MOVE_HULL_DOWN</b>
<b class="nc">&nbsp;                                      .getCmd());</b>
<b class="nc">&nbsp;        item.addActionListener(new ActionListener() {</b>
&nbsp;            public void actionPerformed(ActionEvent e) {
&nbsp;                try {
<b class="nc">&nbsp;                    ((MovementDisplay) currentPanel).actionPerformed(e);</b>
<b class="nc">&nbsp;                } catch (Exception ex) {</b>
<b class="nc">&nbsp;                    ex.printStackTrace();</b>
<b class="nc">&nbsp;                }</b>
&nbsp;            }
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        return item;</b>
&nbsp;    }
&nbsp;
&nbsp;    private JMenuItem createProneJMenuItem() {
<b class="nc">&nbsp;        JMenuItem item = new JMenuItem(</b>
<b class="nc">&nbsp;                Messages.getString(&quot;MovementDisplay.butDown&quot;));</b>
&nbsp;
<b class="nc">&nbsp;        item.setActionCommand(MovementDisplay.MoveCommand.MOVE_GO_PRONE</b>
<b class="nc">&nbsp;                                      .getCmd());</b>
<b class="nc">&nbsp;        item.addActionListener(new ActionListener() {</b>
&nbsp;            public void actionPerformed(ActionEvent e) {
&nbsp;                try {
<b class="nc">&nbsp;                    ((MovementDisplay) currentPanel).actionPerformed(e);</b>
<b class="nc">&nbsp;                } catch (Exception ex) {</b>
<b class="nc">&nbsp;                    ex.printStackTrace();</b>
<b class="nc">&nbsp;                }</b>
&nbsp;            }
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        return item;</b>
&nbsp;    }
&nbsp;
&nbsp;    private JMenu createConvertMenu() {
<b class="nc">&nbsp;        JMenu menu = new JMenu(Messages.getString(&quot;MovementDisplay.moveModeConvert&quot;));</b>
&nbsp;        
<b class="nc">&nbsp;        if (myEntity instanceof Mech &amp;&amp; ((Mech)myEntity).hasTracks()) {</b>
<b class="nc">&nbsp;            menu.add(createConvertMenuItem(&quot;MovementDisplay.moveModeLeg&quot;,</b>
&nbsp;                    MovementDisplay.MoveCommand.MOVE_MODE_LEG, false));
<b class="nc">&nbsp;            menu.add(createConvertMenuItem(&quot;MovementDisplay.moveModeTrack&quot;,</b>
&nbsp;                    MovementDisplay.MoveCommand.MOVE_MODE_VEE, false));
<b class="nc">&nbsp;        } else if (myEntity instanceof QuadVee) {</b>
<b class="nc">&nbsp;            menu.add(createConvertMenuItem(&quot;MovementDisplay.moveModeMech&quot;,</b>
&nbsp;                    MovementDisplay.MoveCommand.MOVE_MODE_LEG,
<b class="nc">&nbsp;                    myEntity.getConversionMode() == QuadVee.CONV_MODE_MECH));</b>
<b class="nc">&nbsp;            menu.add(createConvertMenuItem(&quot;MovementDisplay.moveModeVee&quot;,</b>
&nbsp;                    MovementDisplay.MoveCommand.MOVE_MODE_VEE,
<b class="nc">&nbsp;                    myEntity.getConversionMode() == QuadVee.CONV_MODE_VEHICLE));            </b>
<b class="nc">&nbsp;        } else if (myEntity instanceof LandAirMech) {</b>
<b class="nc">&nbsp;            int currentMode = myEntity.getConversionMode();</b>
<b class="nc">&nbsp;            JMenuItem item = createConvertMenuItem(&quot;MovementDisplay.moveModeMech&quot;,</b>
&nbsp;                    MovementDisplay.MoveCommand.MOVE_MODE_LEG,
&nbsp;                    currentMode == LandAirMech.CONV_MODE_MECH);
<b class="nc">&nbsp;            item.setEnabled(currentMode == LandAirMech.CONV_MODE_MECH</b>
<b class="nc">&nbsp;                    || ((LandAirMech)myEntity).canConvertTo(currentMode,</b>
&nbsp;                            LandAirMech.CONV_MODE_MECH));
<b class="nc">&nbsp;            menu.add(item);</b>
<b class="nc">&nbsp;            if (((LandAirMech)myEntity).getLAMType() == LandAirMech.LAM_STANDARD) {</b>
<b class="nc">&nbsp;                item = createConvertMenuItem(&quot;MovementDisplay.moveModeAirmech&quot;,</b>
&nbsp;                        MovementDisplay.MoveCommand.MOVE_MODE_VEE,
&nbsp;                        currentMode == LandAirMech.CONV_MODE_AIRMECH);
<b class="nc">&nbsp;                item.setEnabled(currentMode == LandAirMech.CONV_MODE_AIRMECH</b>
<b class="nc">&nbsp;                        || ((LandAirMech)myEntity).canConvertTo(currentMode,</b>
&nbsp;                                LandAirMech.CONV_MODE_AIRMECH));
<b class="nc">&nbsp;                menu.add(item);</b>
&nbsp;            }
<b class="nc">&nbsp;            item = createConvertMenuItem(&quot;MovementDisplay.moveModeFighter&quot;,</b>
&nbsp;                    MovementDisplay.MoveCommand.MOVE_MODE_AIR,
&nbsp;                    currentMode == LandAirMech.CONV_MODE_FIGHTER);
<b class="nc">&nbsp;            item.setEnabled(currentMode == LandAirMech.CONV_MODE_FIGHTER</b>
<b class="nc">&nbsp;                    || ((LandAirMech)myEntity).canConvertTo(currentMode,</b>
&nbsp;                            LandAirMech.CONV_MODE_FIGHTER));
<b class="nc">&nbsp;            menu.add(item);</b>
&nbsp;        }
<b class="nc">&nbsp;        return menu;</b>
&nbsp;    }
&nbsp;    
&nbsp;    private JMenuItem createConvertMenuItem(String resourceKey, MovementDisplay.MoveCommand cmd,
&nbsp;            boolean isCurrent) {
<b class="nc">&nbsp;        String text = Messages.getString(resourceKey);</b>
<b class="nc">&nbsp;        if (isCurrent) {</b>
<b class="nc">&nbsp;            text = &quot;No Conversion&quot;;</b>
&nbsp;        }
<b class="nc">&nbsp;        JMenuItem item = new JMenuItem(text);</b>
<b class="nc">&nbsp;        item.setActionCommand(cmd.getCmd());</b>
<b class="nc">&nbsp;        item.addActionListener(e -&gt; {</b>
&nbsp;            try {
<b class="nc">&nbsp;                ((MovementDisplay) currentPanel).actionPerformed(e);</b>
<b class="nc">&nbsp;            } catch (Exception ex) {</b>
<b class="nc">&nbsp;                ex.printStackTrace();</b>
<b class="nc">&nbsp;            }</b>
&nbsp;        });
<b class="nc">&nbsp;        return item;</b>
&nbsp;    }
&nbsp;
&nbsp;    private JMenu createTargetMenu() {
<b class="nc">&nbsp;        JMenu menu = new JMenu(&quot;Target&quot;);</b>
&nbsp;
&nbsp;        // If we can&#39;t target entities, nothing to do
<b class="nc">&nbsp;        if (!canTargetEntities()) {</b>
<b class="nc">&nbsp;            return menu;</b>
&nbsp;        }
&nbsp;
&nbsp;        // VTOLs/AirMechs making strafing or bombing attacks already declared the target hex(es)
&nbsp;        // in the movement phase and cannot change them.
<b class="nc">&nbsp;        if (myEntity.isMakingVTOLGroundAttack()) {</b>
<b class="nc">&nbsp;            menu.setEnabled(false);</b>
<b class="nc">&nbsp;            return menu;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        final boolean isFiringDisplay = (currentPanel instanceof FiringDisplay);</b>
<b class="nc">&nbsp;        final boolean isTargetingDisplay = (currentPanel instanceof TargetingPhaseDisplay);</b>
<b class="nc">&nbsp;        final boolean canStartFires = client.getGame().getOptions()</b>
<b class="nc">&nbsp;                .booleanOption(OptionsConstants.ADVCOMBAT_TACOPS_START_FIRE); //$NON-NLS-1$</b>
&nbsp;        
<b class="nc">&nbsp;        IPlayer localPlayer = client.getLocalPlayer();</b>
&nbsp;        
&nbsp;        // Add menu item to target each entity in the coords
<b class="nc">&nbsp;        for (Entity entity : client.getGame().getEntitiesVector(coords)) {</b>
&nbsp;            // Only add the unit if it&#39;s actually visible
&nbsp;            //  With double blind on, the game may have unseen units
<b class="nc">&nbsp;            if (!entity.isSensorReturn(localPlayer)</b>
<b class="nc">&nbsp;                    &amp;&amp; entity.hasSeenEntity(localPlayer)</b>
<b class="nc">&nbsp;                    &amp;&amp; !entity.isHidden()) {</b>
<b class="nc">&nbsp;                menu.add(TargetMenuItem(entity));</b>
&nbsp;            }
<b class="nc">&nbsp;        }</b>
&nbsp;
<b class="nc">&nbsp;        IHex h = board.getHex(coords);</b>
&nbsp;        // If the hex is null, we&#39;re done here
<b class="nc">&nbsp;        if (h == null) {</b>
<b class="nc">&nbsp;            return menu;</b>
&nbsp;        }
&nbsp;
&nbsp;        // Clearing hexes and igniting hexes
<b class="nc">&nbsp;        if (isFiringDisplay &amp;&amp; !board.inSpace() &amp;&amp; !board.inAtmosphere()) {</b>
<b class="nc">&nbsp;            menu.add(TargetMenuItem(new HexTarget(coords, board, Targetable.TYPE_HEX_CLEAR)));</b>
<b class="nc">&nbsp;            if (canStartFires</b>
<b class="nc">&nbsp;                &amp;&amp; (h.containsTerrain(Terrains.WOODS)</b>
<b class="nc">&nbsp;                    || h.containsTerrain(Terrains.JUNGLE)</b>
<b class="nc">&nbsp;                    || h.containsTerrain(Terrains.FIELDS)</b>
<b class="nc">&nbsp;                    || hasMunitionType(AmmoType.M_INFERNO)</b>
<b class="nc">&nbsp;                    || hasMunitionType(AmmoType.M_INFERNO_IV)</b>
<b class="nc">&nbsp;                    || hasMunitionType(AmmoType.M_THUNDER_INFERNO))) {</b>
<b class="nc">&nbsp;                menu.add(TargetMenuItem(new HexTarget(coords, board, Targetable.TYPE_HEX_IGNITE)));</b>
&nbsp;            }
&nbsp;            // Targeting fuel tanks
&nbsp;        }
<b class="nc">&nbsp;        if (h.containsTerrain(Terrains.FUEL_TANK)) {</b>
<b class="nc">&nbsp;            menu.add(TargetMenuItem(new BuildingTarget(coords, board, false)));</b>
<b class="nc">&nbsp;            if (canStartFires) {</b>
<b class="nc">&nbsp;                menu.add(TargetMenuItem(new BuildingTarget(coords, board, true)));</b>
&nbsp;            }
&nbsp;            // Targeting buildings or bridges
&nbsp;        }
<b class="nc">&nbsp;        if ((h.containsTerrain(Terrains.BUILDING)</b>
<b class="nc">&nbsp;             || h.containsTerrain(Terrains.BRIDGE))) {</b>
<b class="nc">&nbsp;            menu.add(TargetMenuItem(new BuildingTarget(coords, board, false)));</b>
<b class="nc">&nbsp;            if (canStartFires) {</b>
<b class="nc">&nbsp;                menu.add(TargetMenuItem(new BuildingTarget(coords, board, true)));</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        if (isFiringDisplay) {</b>
<b class="nc">&nbsp;            if (board.inSpace() &amp;&amp; hasAmmoType(AmmoType.T_SCREEN_LAUNCHER)) {</b>
<b class="nc">&nbsp;                menu.add(TargetMenuItem(new HexTarget(coords, board, Targetable.TYPE_HEX_SCREEN)));</b>
&nbsp;            } else {
<b class="nc">&nbsp;                if ((hasAmmoType(AmmoType.T_LRM)</b>
<b class="nc">&nbsp;                        || hasAmmoType(AmmoType.T_LRM_IMP)</b>
<b class="nc">&nbsp;                        || hasAmmoType(AmmoType.T_MML))</b>
<b class="nc">&nbsp;                    &amp;&amp; (hasMunitionType(AmmoType.M_FASCAM)</b>
<b class="nc">&nbsp;                        || hasMunitionType(AmmoType.M_THUNDER)</b>
<b class="nc">&nbsp;                        || hasMunitionType(AmmoType.M_THUNDER_ACTIVE)</b>
<b class="nc">&nbsp;                        || hasMunitionType(AmmoType.M_THUNDER_AUGMENTED)</b>
<b class="nc">&nbsp;                        || hasMunitionType(AmmoType.M_THUNDER_INFERNO)</b>
<b class="nc">&nbsp;                        || hasMunitionType(AmmoType.M_THUNDER_VIBRABOMB))) {</b>
<b class="nc">&nbsp;                    menu.add(TargetMenuItem(new HexTarget(coords, board, Targetable.TYPE_MINEFIELD_DELIVER)));</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                if (hasMunitionType(AmmoType.M_FLARE)) {</b>
<b class="nc">&nbsp;                    menu.add(TargetMenuItem(new HexTarget(coords, board, Targetable.TYPE_FLARE_DELIVER)));</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                if (hasAmmoType(AmmoType.T_BA_MICRO_BOMB)) {</b>
<b class="nc">&nbsp;                    menu.add(TargetMenuItem(new HexTarget(coords, board, Targetable.TYPE_HEX_BOMB)));</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                if (hasWeaponFlag(WeaponType.F_DIVE_BOMB)</b>
<b class="nc">&nbsp;                    || hasWeaponFlag(WeaponType.F_ALT_BOMB)) {</b>
<b class="nc">&nbsp;                    menu.add(TargetMenuItem(new HexTarget(coords, board, Targetable.TYPE_HEX_AERO_BOMB)));</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                if (hasAmmoType(AmmoType.T_ARROW_IV)</b>
<b class="nc">&nbsp;                        || hasAmmoType(AmmoType.T_SNIPER)</b>
<b class="nc">&nbsp;                        || hasAmmoType(AmmoType.T_CRUISE_MISSILE)</b>
<b class="nc">&nbsp;                        || hasAmmoType(AmmoType.T_ALAMO)</b>
<b class="nc">&nbsp;                        || hasAmmoType(AmmoType.T_KILLER_WHALE)</b>
<b class="nc">&nbsp;                        || hasAmmoType(AmmoType.T_LONG_TOM)</b>
<b class="nc">&nbsp;                        || hasAmmoType(AmmoType.T_THUMPER)</b>
<b class="nc">&nbsp;                        || hasAmmoType(AmmoType.T_BA_TUBE)) {</b>
<b class="nc">&nbsp;                    menu.add(TargetMenuItem(new HexTarget(coords, board, Targetable.TYPE_HEX_ARTILLERY)));</b>
&nbsp;                }
<b class="nc">&nbsp;                if (canStartFires &amp;&amp; hasFireExtinguisher()</b>
<b class="nc">&nbsp;                    &amp;&amp; h.containsTerrain(Terrains.FIRE)) {</b>
<b class="nc">&nbsp;                    menu.add(TargetMenuItem(new HexTarget(coords, board, Targetable.TYPE_HEX_EXTINGUISH)));</b>
&nbsp;                }
&nbsp;            }
&nbsp;        }
&nbsp;        // Check for Mine Clearance
<b class="nc">&nbsp;        if (isFiringDisplay || isTargetingDisplay) {</b>
<b class="nc">&nbsp;            if (client.getGame().containsMinefield(coords)) {</b>
<b class="nc">&nbsp;                menu.add(TargetMenuItem(new MinefieldTarget(coords, board)));</b>
&nbsp;            }
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (isTargetingDisplay</b>
<b class="nc">&nbsp;            &amp;&amp; !board.inSpace()</b>
<b class="nc">&nbsp;            &amp;&amp; !board.inAtmosphere()</b>
<b class="nc">&nbsp;            &amp;&amp; (hasAmmoType(AmmoType.T_ARROW_IV)</b>
<b class="nc">&nbsp;                || hasAmmoType(AmmoType.T_SNIPER)</b>
<b class="nc">&nbsp;                || hasAmmoType(AmmoType.T_CRUISE_MISSILE)</b>
<b class="nc">&nbsp;                || hasAmmoType(AmmoType.T_ALAMO)</b>
<b class="nc">&nbsp;                || hasAmmoType(AmmoType.T_KILLER_WHALE)</b>
<b class="nc">&nbsp;                || hasAmmoType(AmmoType.T_LONG_TOM)</b>
<b class="nc">&nbsp;                || hasAmmoType(AmmoType.T_THUMPER)</b>
<b class="nc">&nbsp;                || hasAmmoType(AmmoType.T_BA_TUBE))) {</b>
<b class="nc">&nbsp;            menu.add(TargetMenuItem(new HexTarget(coords, board, Targetable.TYPE_HEX_ARTILLERY)));</b>
&nbsp;        }
&nbsp;        // Check for adding TAG targeting buildings and hexes
<b class="nc">&nbsp;        if (isTargetingDisplay &amp;&amp; myEntity.hasTAG() &amp;&amp; !board.inSpace()) {</b>
<b class="nc">&nbsp;            menu.add(TargetMenuItem(new HexTarget(coords, board, Targetable.TYPE_HEX_TAG)));</b>
<b class="nc">&nbsp;            if (h.containsTerrain(Terrains.FUEL_TANK)</b>
<b class="nc">&nbsp;                || h.containsTerrain(Terrains.BUILDING)</b>
<b class="nc">&nbsp;                || h.containsTerrain(Terrains.BRIDGE)) {</b>
<b class="nc">&nbsp;                menu.add(TargetMenuItem(new BuildingTarget(coords, board, Targetable.TYPE_BLDG_TAG)));</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        return menu;</b>
&nbsp;    }
&nbsp;
&nbsp;    void plotCourse(ActionEvent e) {
<b class="nc">&nbsp;        ((MovementDisplay) currentPanel).actionPerformed(e);</b>
&nbsp;
&nbsp;        // Cursor over the hex.
<b class="nc">&nbsp;        ((BoardView1) gui.bv).mouseAction(coords, BoardViewEvent.BOARD_HEX_CURSOR, InputEvent.BUTTON1_MASK);</b>
&nbsp;        // Click
<b class="nc">&nbsp;        ((BoardView1) gui.bv).mouseAction(coords, BoardViewEvent.BOARD_HEX_CLICKED, InputEvent.BUTTON1_MASK);</b>
&nbsp;    }
&nbsp;
&nbsp;    Targetable decodeTargetInfo(String info) {
&nbsp;
<b class="nc">&nbsp;        StringTokenizer target = new StringTokenizer(info, &quot;|&quot;);</b>
<b class="nc">&nbsp;        String type = target.nextToken();</b>
&nbsp;
<b class="nc">&nbsp;        if (type.equalsIgnoreCase(&quot;E&quot;)) {</b>
<b class="nc">&nbsp;            return game.getEntity(Integer.parseInt(target.nextToken()));</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        Coords targetCoords = new Coords(Integer.parseInt(target.nextToken()),</b>
<b class="nc">&nbsp;                                         Integer.parseInt(target.nextToken()));</b>
&nbsp;
<b class="nc">&nbsp;        if (type.equals(&quot;B&quot;)) {</b>
<b class="nc">&nbsp;            return new BuildingTarget(targetCoords, board,</b>
<b class="nc">&nbsp;                                      Integer.parseInt(target.nextToken()));</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (type.equals(&quot;M&quot;)) {</b>
<b class="nc">&nbsp;            return new MinefieldTarget(targetCoords, board);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return new HexTarget(targetCoords, board, Integer.parseInt(target</b>
<b class="nc">&nbsp;                                                                           .nextToken()));</b>
&nbsp;    }
&nbsp;
&nbsp;    private boolean hasAmmoType(int ammoType) {
&nbsp;
<b class="nc">&nbsp;        if (myEntity.getAmmo().size() &lt; 1) {</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        for (Mounted ammo : myEntity.getAmmo()) {</b>
<b class="nc">&nbsp;            if (((AmmoType) ammo.getType()).getAmmoType() == ammoType) {</b>
<b class="nc">&nbsp;                return true;</b>
&nbsp;            }
<b class="nc">&nbsp;        }</b>
&nbsp;
<b class="nc">&nbsp;        return false;</b>
&nbsp;    }
&nbsp;
&nbsp;    private boolean hasWeaponFlag(BigInteger weaponFlag) {
&nbsp;
<b class="nc">&nbsp;        if (myEntity.getWeaponList().size() &lt; 1) {</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        for (Mounted wpn : myEntity.getWeaponList()) {</b>
<b class="nc">&nbsp;            if (((WeaponType) wpn.getType()).hasFlag(weaponFlag)) {</b>
<b class="nc">&nbsp;                return true;</b>
&nbsp;            }
<b class="nc">&nbsp;        }</b>
&nbsp;
<b class="nc">&nbsp;        return false;</b>
&nbsp;    }
&nbsp;
&nbsp;    private boolean hasMunitionType(long munition) {
&nbsp;
<b class="nc">&nbsp;        if (myEntity.getAmmo().size() &lt; 1) {</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        for (Mounted ammo : myEntity.getAmmo()) {</b>
<b class="nc">&nbsp;            if (((AmmoType) ammo.getType()).getMunitionType() == munition) {</b>
<b class="nc">&nbsp;                return true;</b>
&nbsp;            }
<b class="nc">&nbsp;        }</b>
&nbsp;
<b class="nc">&nbsp;        return false;</b>
&nbsp;    }
&nbsp;
&nbsp;    private boolean hasFireExtinguisher() {
&nbsp;
<b class="nc">&nbsp;        if (myEntity.getWeaponList().size() &lt; 1) {</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        for (Mounted weapon : myEntity.getWeaponList()) {</b>
<b class="nc">&nbsp;            if (((WeaponType) weapon.getType() instanceof ISFireExtinguisher)</b>
<b class="nc">&nbsp;                || ((WeaponType) weapon.getType() instanceof CLFireExtinguisher)) {</b>
<b class="nc">&nbsp;                return true;</b>
&nbsp;            }
<b class="nc">&nbsp;        }</b>
&nbsp;
<b class="nc">&nbsp;        return false;</b>
&nbsp;
&nbsp;    }
&nbsp;
&nbsp;    private JMenuItem createTorsoTwistJMenuItem(int direction) {
<b class="nc">&nbsp;        JMenuItem item = new JMenuItem();</b>
&nbsp;
<b class="nc">&nbsp;        if (direction == 1) {</b>
<b class="nc">&nbsp;            item.setText(&quot;Right&quot;);</b>
&nbsp;        } else {
<b class="nc">&nbsp;            item.setText(&quot;Left&quot;);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        item.setActionCommand(Integer.toString(direction));</b>
<b class="nc">&nbsp;        item.addActionListener(new ActionListener() {</b>
&nbsp;            public void actionPerformed(ActionEvent e) {
&nbsp;                try {
<b class="nc">&nbsp;                    int twistDir = Integer.parseInt(e.getActionCommand());</b>
<b class="nc">&nbsp;                    if (currentPanel instanceof FiringDisplay) {</b>
<b class="nc">&nbsp;                        ((FiringDisplay) currentPanel).torsoTwist(twistDir);</b>
<b class="nc">&nbsp;                    } else if (currentPanel instanceof TargetingPhaseDisplay) {</b>
<b class="nc">&nbsp;                        ((TargetingPhaseDisplay) currentPanel)</b>
<b class="nc">&nbsp;                                .torsoTwist(twistDir);</b>
&nbsp;                    }
<b class="nc">&nbsp;                } catch (Exception ex) {</b>
<b class="nc">&nbsp;                    ex.printStackTrace();</b>
<b class="nc">&nbsp;                }</b>
&nbsp;            }
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        return item;</b>
&nbsp;    }
&nbsp;
&nbsp;    private JMenuItem createTorsoTwistJMenuItem(Coords twistCoords) {
<b class="nc">&nbsp;        JMenuItem item = new JMenuItem(&quot;Twist&quot;);</b>
&nbsp;
<b class="nc">&nbsp;        item.setActionCommand(twistCoords.getX() + &quot;|&quot; + twistCoords.getY());</b>
<b class="nc">&nbsp;        item.addActionListener(new ActionListener() {</b>
&nbsp;            public void actionPerformed(ActionEvent e) {
&nbsp;                try {
<b class="nc">&nbsp;                    StringTokenizer result = new StringTokenizer(e</b>
<b class="nc">&nbsp;                                                                         .getActionCommand(), &quot;|&quot;);</b>
<b class="nc">&nbsp;                    Coords coord = new Coords(Integer.parseInt(result</b>
<b class="nc">&nbsp;                                                                       .nextToken()), Integer.parseInt(result.nextToken()));</b>
<b class="nc">&nbsp;                    if (currentPanel instanceof FiringDisplay) {</b>
<b class="nc">&nbsp;                        ((FiringDisplay) currentPanel).torsoTwist(coord);</b>
<b class="nc">&nbsp;                    } else if (currentPanel instanceof TargetingPhaseDisplay) {</b>
<b class="nc">&nbsp;                        ((TargetingPhaseDisplay) currentPanel)</b>
<b class="nc">&nbsp;                                .torsoTwist(coord);</b>
&nbsp;                    }
<b class="nc">&nbsp;                } catch (Exception ex) {</b>
<b class="nc">&nbsp;                    ex.printStackTrace();</b>
<b class="nc">&nbsp;                }</b>
&nbsp;            }
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        return item;</b>
&nbsp;    }
&nbsp;
&nbsp;    private JMenuItem createRotateTurretJMenuItem(final Mech mech,
&nbsp;                                                  final Mounted turret) {
&nbsp;        String turretString;
<b class="nc">&nbsp;        if (turret.getType().hasFlag(MiscType.F_SHOULDER_TURRET)) {</b>
<b class="nc">&nbsp;            turretString = &quot;Rotate Shoulder Turret (&quot;</b>
<b class="nc">&nbsp;                           + mech.getLocationAbbr(turret.getLocation()) + &quot;)&quot;;</b>
<b class="nc">&nbsp;        } else if (turret.getType().hasFlag(MiscType.F_HEAD_TURRET)) {</b>
<b class="nc">&nbsp;            turretString = &quot;Rotate Head Turret&quot;;</b>
&nbsp;        } else {
<b class="nc">&nbsp;            turretString = &quot;Rotate Quad Turret&quot;;</b>
&nbsp;        }
<b class="nc">&nbsp;        JMenuItem item = new JMenuItem(turretString);</b>
<b class="nc">&nbsp;        item.addActionListener(new ActionListener() {</b>
&nbsp;            public void actionPerformed(ActionEvent ae) {
<b class="nc">&nbsp;                TurretFacingDialog tfe = new TurretFacingDialog(gui.frame,</b>
&nbsp;                                                                mech, turret, gui);
<b class="nc">&nbsp;                tfe.setVisible(true);</b>
&nbsp;            }
&nbsp;        });
<b class="nc">&nbsp;        return item;</b>
&nbsp;    }
&nbsp;
&nbsp;    private JMenuItem createRotateDualTurretJMenuItem(final Tank tank) {
&nbsp;        String turretString;
<b class="nc">&nbsp;        turretString = &quot;Rotate Front Turret&quot;;</b>
<b class="nc">&nbsp;        JMenuItem item = new JMenuItem(turretString);</b>
<b class="nc">&nbsp;        item.addActionListener(new ActionListener() {</b>
&nbsp;            public void actionPerformed(ActionEvent ae) {
<b class="nc">&nbsp;                TurretFacingDialog tfe = new TurretFacingDialog(gui.frame,</b>
&nbsp;                                                                tank, gui);
<b class="nc">&nbsp;                tfe.setVisible(true);</b>
&nbsp;            }
&nbsp;        });
<b class="nc">&nbsp;        return item;</b>
&nbsp;    }
&nbsp;
&nbsp;    private JMenu createTorsoTwistMenu() {
<b class="nc">&nbsp;        JMenu menu = new JMenu();</b>
&nbsp;
<b class="nc">&nbsp;        if (myEntity instanceof BipedMech) {</b>
<b class="nc">&nbsp;            menu.setText(&quot;Torso Twist&quot;);</b>
<b class="nc">&nbsp;            if (coords.equals(myEntity.getPosition())) {</b>
<b class="nc">&nbsp;                menu.add(createTorsoTwistJMenuItem(1));</b>
<b class="nc">&nbsp;                menu.add(createTorsoTwistJMenuItem(0));</b>
&nbsp;            } else {
<b class="nc">&nbsp;                menu.add(createTorsoTwistJMenuItem(coords));</b>
&nbsp;            }
<b class="nc">&nbsp;        } else if ((myEntity instanceof Tank)</b>
<b class="nc">&nbsp;                   &amp;&amp; (((Tank) myEntity).getInternal(((Tank) myEntity)</b>
<b class="nc">&nbsp;                                                             .getLocTurret()) &gt; -1)) {</b>
<b class="nc">&nbsp;            menu.setText(&quot;Turret Twist&quot;);</b>
<b class="nc">&nbsp;            if (coords.equals(myEntity.getPosition())) {</b>
<b class="nc">&nbsp;                menu.add(createTorsoTwistJMenuItem(1));</b>
<b class="nc">&nbsp;                menu.add(createTorsoTwistJMenuItem(0));</b>
&nbsp;            } else {
<b class="nc">&nbsp;                menu.add(createTorsoTwistJMenuItem(coords));</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        if ((myEntity instanceof Tank) &amp;&amp; !((Tank) myEntity).hasNoDualTurret()) {</b>
<b class="nc">&nbsp;            menu.add(createRotateDualTurretJMenuItem((Tank) myEntity));</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return menu;</b>
&nbsp;    }
&nbsp;
&nbsp;    private JMenu createRotateTurretMenu() {
<b class="nc">&nbsp;        JMenu menu = new JMenu();</b>
<b class="nc">&nbsp;        menu.setText(&quot;Turret Rotation&quot;);</b>
<b class="nc">&nbsp;        if (myEntity instanceof Mech) {</b>
<b class="nc">&nbsp;            for (Mounted mount : myEntity.getMisc()) {</b>
<b class="nc">&nbsp;                if (mount.getType().hasFlag(MiscType.F_SHOULDER_TURRET)</b>
<b class="nc">&nbsp;                    || mount.getType().hasFlag(MiscType.F_HEAD_TURRET)</b>
<b class="nc">&nbsp;                    || mount.getType().hasFlag(MiscType.F_QUAD_TURRET)) {</b>
<b class="nc">&nbsp;                    menu.add(createRotateTurretJMenuItem((Mech) myEntity, mount));</b>
&nbsp;                }
<b class="nc">&nbsp;            }</b>
&nbsp;        }
<b class="nc">&nbsp;        return menu;</b>
&nbsp;    }
&nbsp;
&nbsp;    private void selectTarget() {
<b class="nc">&nbsp;        Vector&lt;Entity&gt; list = new Vector&lt;Entity&gt;();</b>
&nbsp;
<b class="nc">&nbsp;        IPlayer localPlayer = client.getLocalPlayer();</b>
<b class="nc">&nbsp;        boolean friendlyFire = (game.getOptions()</b>
<b class="nc">&nbsp;                .booleanOption(OptionsConstants.BASE_FRIENDLY_FIRE));</b>
&nbsp;
<b class="nc">&nbsp;        for (Entity en : game.getEntitiesVector(coords)) {</b>
&nbsp;            // Only add the unit if it&#39;s actually visible
&nbsp;            //  With double blind on, the game may have unseen units
<b class="nc">&nbsp;            if ((en.isEnemyOf(myEntity) || friendlyFire) &amp;&amp; !en.equals(myEntity)</b>
<b class="nc">&nbsp;                    &amp;&amp; !en.isSensorReturn(localPlayer)</b>
<b class="nc">&nbsp;                    &amp;&amp; en.hasSeenEntity(localPlayer)</b>
<b class="nc">&nbsp;                    &amp;&amp; !en.isHidden()) {</b>
<b class="nc">&nbsp;                list.add(en);</b>
&nbsp;            }
<b class="nc">&nbsp;        }</b>
&nbsp;
<b class="nc">&nbsp;        if (list.size() == 1) {</b>
<b class="nc">&nbsp;            myTarget = selectedEntity = list.firstElement();</b>
&nbsp;
&nbsp;            // gui.bv.centerOnHex(myTarget.getPosition());
&nbsp;            // gui.getBoardView().select(myTarget.getPosition());
&nbsp;
<b class="nc">&nbsp;            if (currentPanel instanceof FiringDisplay) {</b>
<b class="nc">&nbsp;                FiringDisplay panel = (FiringDisplay) currentPanel;</b>
<b class="nc">&nbsp;                panel.target(myTarget);</b>
<b class="nc">&nbsp;            } else if (currentPanel instanceof PhysicalDisplay) {</b>
<b class="nc">&nbsp;                ((PhysicalDisplay) currentPanel).target(myTarget);</b>
<b class="nc">&nbsp;            } else if (currentPanel instanceof TargetingPhaseDisplay) {</b>
<b class="nc">&nbsp;                ((TargetingPhaseDisplay) currentPanel).target(myTarget);</b>
&nbsp;            }
&nbsp;
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private JMenu createModeMenu() {
<b class="nc">&nbsp;        JMenu menu = new JMenu(&quot;Modes&quot;);</b>
&nbsp;
<b class="nc">&nbsp;        int weaponNum = gui.mechD.wPan.getSelectedWeaponNum();</b>
<b class="nc">&nbsp;        Mounted mounted = myEntity.getEquipment(weaponNum);</b>
&nbsp;
<b class="nc">&nbsp;        if ((mounted != null) &amp;&amp; mounted.getType().hasModes()) {</b>
<b class="nc">&nbsp;            for (int pos = 0; pos &lt; mounted.getType().getModesCount(); pos++) {</b>
<b class="nc">&nbsp;                menu.add(createModeJMenuItem(mounted, pos));</b>
&nbsp;            }
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return menu;</b>
&nbsp;    }
&nbsp;
&nbsp;    private JMenuItem createModeJMenuItem(Mounted mounted, int position) {
<b class="nc">&nbsp;        JMenuItem item = new JMenuItem();</b>
&nbsp;
<b class="nc">&nbsp;        EquipmentMode mode = mounted.getType().getMode(position);</b>
&nbsp;
<b class="nc">&nbsp;        if (mode.equals(mounted.curMode())) {</b>
<b class="nc">&nbsp;            item.setText(&quot;* &quot; + mode.getDisplayableName());</b>
&nbsp;        } else {
<b class="nc">&nbsp;            item.setText(mode.getDisplayableName());</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        item.setActionCommand(Integer.toString(position));</b>
<b class="nc">&nbsp;        item.addActionListener(new ActionListener() {</b>
&nbsp;            public void actionPerformed(ActionEvent e) {
&nbsp;                try {
<b class="nc">&nbsp;                    int modePosition = Integer.parseInt(e.getActionCommand());</b>
<b class="nc">&nbsp;                    int weaponNum = gui.mechD.wPan.getSelectedWeaponNum();</b>
<b class="nc">&nbsp;                    Mounted equip = myEntity.getEquipment(weaponNum);</b>
<b class="nc">&nbsp;                    equip.setMode(modePosition);</b>
<b class="nc">&nbsp;                    client.sendModeChange(myEntity.getId(), weaponNum,</b>
&nbsp;                                          modePosition);
<b class="nc">&nbsp;                } catch (Exception ex) {</b>
<b class="nc">&nbsp;                    ex.printStackTrace();</b>
<b class="nc">&nbsp;                }</b>
&nbsp;            }
&nbsp;        });
<b class="nc">&nbsp;        return item;</b>
&nbsp;
&nbsp;    }
&nbsp;
&nbsp;    private JMenuItem createPunchJMenuItem() {
<b class="nc">&nbsp;        JMenuItem item = new JMenuItem(&quot;Punch&quot;);</b>
&nbsp;
<b class="nc">&nbsp;        item.addActionListener(new ActionListener() {</b>
&nbsp;            public void actionPerformed(ActionEvent e) {
&nbsp;                try {
<b class="nc">&nbsp;                    ((PhysicalDisplay) currentPanel).punch();</b>
<b class="nc">&nbsp;                } catch (Exception ex) {</b>
<b class="nc">&nbsp;                    ex.printStackTrace();</b>
<b class="nc">&nbsp;                }</b>
&nbsp;            }
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        return item;</b>
&nbsp;    }
&nbsp;
&nbsp;    private JMenuItem createKickJMenuItem() {
<b class="nc">&nbsp;        JMenuItem item = new JMenuItem(&quot;Kick&quot;);</b>
&nbsp;
<b class="nc">&nbsp;        item.addActionListener(new ActionListener() {</b>
&nbsp;            public void actionPerformed(ActionEvent e) {
&nbsp;                try {
<b class="nc">&nbsp;                    ((PhysicalDisplay) currentPanel).kick();</b>
<b class="nc">&nbsp;                } catch (Exception ex) {</b>
<b class="nc">&nbsp;                    ex.printStackTrace();</b>
<b class="nc">&nbsp;                }</b>
&nbsp;            }
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        return item;</b>
&nbsp;    }
&nbsp;
&nbsp;    private JMenuItem createPushJMenuItem() {
<b class="nc">&nbsp;        JMenuItem item = new JMenuItem(&quot;Push&quot;);</b>
&nbsp;
<b class="nc">&nbsp;        item.addActionListener(new ActionListener() {</b>
&nbsp;            public void actionPerformed(ActionEvent e) {
&nbsp;                try {
<b class="nc">&nbsp;                    ((PhysicalDisplay) currentPanel).push();</b>
<b class="nc">&nbsp;                } catch (Exception ex) {</b>
<b class="nc">&nbsp;                    ex.printStackTrace();</b>
<b class="nc">&nbsp;                }</b>
&nbsp;            }
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        return item;</b>
&nbsp;    }
&nbsp;
&nbsp;    private JMenuItem createVibroClawMenuItem() {
<b class="nc">&nbsp;        JMenuItem item = new JMenuItem(&quot;Vibro Claw Attack&quot;);</b>
&nbsp;
<b class="nc">&nbsp;        item.addActionListener(new ActionListener() {</b>
&nbsp;            public void actionPerformed(ActionEvent e) {
&nbsp;                try {
<b class="nc">&nbsp;                    ((PhysicalDisplay) currentPanel).vibroclawatt();</b>
<b class="nc">&nbsp;                } catch (Exception ex) {</b>
<b class="nc">&nbsp;                    ex.printStackTrace();</b>
<b class="nc">&nbsp;                }</b>
&nbsp;            }
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        return item;</b>
&nbsp;    }
&nbsp;
&nbsp;    private JMenuItem createJumpJetAttackJMenuItem() {
<b class="nc">&nbsp;        JMenuItem item = new JMenuItem(&quot;Jump Jet Attack&quot;);</b>
&nbsp;
<b class="nc">&nbsp;        item.addActionListener(new ActionListener() {</b>
&nbsp;            public void actionPerformed(ActionEvent e) {
&nbsp;                try {
<b class="nc">&nbsp;                    ((PhysicalDisplay) currentPanel).jumpjetatt();</b>
<b class="nc">&nbsp;                } catch (Exception ex) {</b>
<b class="nc">&nbsp;                    ex.printStackTrace();</b>
<b class="nc">&nbsp;                }</b>
&nbsp;            }
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        return item;</b>
&nbsp;    }
&nbsp;
&nbsp;    private JMenuItem createThrashJMenuItem() {
<b class="nc">&nbsp;        JMenuItem item = new JMenuItem(&quot;Thrash&quot;);</b>
&nbsp;
<b class="nc">&nbsp;        item.addActionListener(new ActionListener() {</b>
&nbsp;            public void actionPerformed(ActionEvent e) {
&nbsp;                try {
<b class="nc">&nbsp;                    ((PhysicalDisplay) currentPanel).thrash();</b>
<b class="nc">&nbsp;                } catch (Exception ex) {</b>
<b class="nc">&nbsp;                    ex.printStackTrace();</b>
<b class="nc">&nbsp;                }</b>
&nbsp;            }
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        return item;</b>
&nbsp;    }
&nbsp;
&nbsp;    private JMenuItem createGrappleJMenuItem() {
<b class="nc">&nbsp;        JMenuItem item = new JMenuItem(&quot;Grapple&quot;);</b>
&nbsp;
<b class="nc">&nbsp;        item.addActionListener(new ActionListener() {</b>
&nbsp;            public void actionPerformed(ActionEvent e) {
&nbsp;                try {
<b class="nc">&nbsp;                    ((PhysicalDisplay) currentPanel).doGrapple();</b>
<b class="nc">&nbsp;                } catch (Exception ex) {</b>
<b class="nc">&nbsp;                    ex.printStackTrace();</b>
<b class="nc">&nbsp;                }</b>
&nbsp;            }
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        return item;</b>
&nbsp;    }
&nbsp;
&nbsp;    private JMenuItem createTripJMenuItem() {
<b class="nc">&nbsp;        JMenuItem item = new JMenuItem(&quot;Trip&quot;);</b>
&nbsp;
<b class="nc">&nbsp;        item.addActionListener(new ActionListener() {</b>
&nbsp;            public void actionPerformed(ActionEvent e) {
&nbsp;                try {
<b class="nc">&nbsp;                    ((PhysicalDisplay) currentPanel).trip();</b>
<b class="nc">&nbsp;                } catch (Exception ex) {</b>
<b class="nc">&nbsp;                    ex.printStackTrace();</b>
<b class="nc">&nbsp;                }</b>
&nbsp;            }
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        return item;</b>
&nbsp;    }
&nbsp;
&nbsp;    private JMenuItem createDodgeJMenuItem() {
<b class="nc">&nbsp;        JMenuItem item = new JMenuItem(&quot;Dodge&quot;);</b>
&nbsp;
<b class="nc">&nbsp;        item.addActionListener(new ActionListener() {</b>
&nbsp;            public void actionPerformed(ActionEvent e) {
&nbsp;                try {
<b class="nc">&nbsp;                    ((PhysicalDisplay) currentPanel).dodge();</b>
<b class="nc">&nbsp;                } catch (Exception ex) {</b>
<b class="nc">&nbsp;                    ex.printStackTrace();</b>
<b class="nc">&nbsp;                }</b>
&nbsp;            }
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        return item;</b>
&nbsp;    }
&nbsp;
&nbsp;    private JMenu createClubMenu() {
<b class="nc">&nbsp;        JMenu menu = new JMenu(&quot;Weapon&quot;);</b>
&nbsp;
<b class="nc">&nbsp;        for (int pos = 0; pos &lt; myEntity.getClubs().size(); pos++) {</b>
<b class="nc">&nbsp;            Mounted club = myEntity.getClubs().get(pos);</b>
<b class="nc">&nbsp;            if (!club.isDestroyed()) {</b>
<b class="nc">&nbsp;                menu.add(createClubJMenuItem(club.getName(), pos));</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        return menu;</b>
&nbsp;    }
&nbsp;
&nbsp;    private JMenuItem createClubJMenuItem(String clubName, int clubNumber) {
<b class="nc">&nbsp;        JMenuItem item = new JMenuItem(clubName);</b>
&nbsp;
<b class="nc">&nbsp;        item.setActionCommand(Integer.toString(clubNumber));</b>
<b class="nc">&nbsp;        item.addActionListener(new ActionListener() {</b>
&nbsp;            public void actionPerformed(ActionEvent e) {
&nbsp;                try {
<b class="nc">&nbsp;                    Mounted club = myEntity.getClubs().get(</b>
<b class="nc">&nbsp;                            Integer.parseInt(e.getActionCommand()));</b>
<b class="nc">&nbsp;                    ((PhysicalDisplay) currentPanel).club(club);</b>
<b class="nc">&nbsp;                } catch (Exception ex) {</b>
<b class="nc">&nbsp;                    ex.printStackTrace();</b>
<b class="nc">&nbsp;                }</b>
&nbsp;            }
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        return item;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public void show(Component comp, int x, int y) {
<b class="nc">&nbsp;        if (client.isMyTurn() &amp;&amp; (myEntity != null)) {</b>
<b class="nc">&nbsp;            selectTarget();</b>
&nbsp;        }
<b class="nc">&nbsp;        super.show(comp, x, y);</b>
&nbsp;    }
&nbsp;
&nbsp;    public boolean getHasMenu() {
<b class="nc">&nbsp;        return hasMenu;</b>
&nbsp;    }
&nbsp;
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2023-05-16 16:28</div>
</div>
</body>
</html>
