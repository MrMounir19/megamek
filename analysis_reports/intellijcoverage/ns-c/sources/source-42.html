


<!DOCTYPE html>
<html id="htmlId">
<head>
  <title>Coverage Report > RandomArmyDialog</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">megamek.client.ui.swing</a>
</div>

<h1>Coverage Summary for Class: RandomArmyDialog (megamek.client.ui.swing)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">RandomArmyDialog</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/22)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/662)
  </span>
</td>
</tr>
  <tr>
    <td class="name">RandomArmyDialog$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">RandomArmyDialog$RATTableModel</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/9)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/26)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">RandomArmyDialog$UnitTableModel</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/12)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/27)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/45)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/718)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;/*
&nbsp; * MegaMek -
&nbsp; * Copyright (C) 2006 Ben Mazur (bmazur@sev.org)
&nbsp; *
&nbsp; *  This program is free software; you can redistribute it and/or modify it
&nbsp; *  under the terms of the GNU General Public License as published by the Free
&nbsp; *  Software Foundation; either version 2 of the License, or (at your option)
&nbsp; *  any later version.
&nbsp; *
&nbsp; *  This program is distributed in the hope that it will be useful, but
&nbsp; *  WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
&nbsp; *  or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License
&nbsp; *  for more details.
&nbsp; */
&nbsp;package megamek.client.ui.swing;
&nbsp;
&nbsp;import java.awt.BorderLayout;
&nbsp;import java.awt.CardLayout;
&nbsp;import java.awt.Cursor;
&nbsp;import java.awt.Dimension;
&nbsp;import java.awt.FlowLayout;
&nbsp;import java.awt.GridBagConstraints;
&nbsp;import java.awt.GridBagLayout;
&nbsp;import java.awt.Insets;
&nbsp;import java.awt.event.ActionEvent;
&nbsp;import java.awt.event.ActionListener;
&nbsp;import java.awt.event.WindowEvent;
&nbsp;import java.awt.event.WindowListener;
&nbsp;import java.util.ArrayList;
&nbsp;import java.util.Enumeration;
&nbsp;import java.util.Iterator;
&nbsp;import java.util.List;
&nbsp;
&nbsp;import javax.swing.BorderFactory;
&nbsp;import javax.swing.JButton;
&nbsp;import javax.swing.JCheckBox;
&nbsp;import javax.swing.JComboBox;
&nbsp;import javax.swing.JDialog;
&nbsp;import javax.swing.JLabel;
&nbsp;import javax.swing.JPanel;
&nbsp;import javax.swing.JScrollPane;
&nbsp;import javax.swing.JSplitPane;
&nbsp;import javax.swing.JTabbedPane;
&nbsp;import javax.swing.JTable;
&nbsp;import javax.swing.JTextField;
&nbsp;import javax.swing.JTree;
&nbsp;import javax.swing.ListSelectionModel;
&nbsp;import javax.swing.SwingConstants;
&nbsp;import javax.swing.event.TreeSelectionEvent;
&nbsp;import javax.swing.event.TreeSelectionListener;
&nbsp;import javax.swing.table.AbstractTableModel;
&nbsp;import javax.swing.table.DefaultTableCellRenderer;
&nbsp;import javax.swing.tree.DefaultMutableTreeNode;
&nbsp;import javax.swing.tree.DefaultTreeModel;
&nbsp;import javax.swing.tree.TreeNode;
&nbsp;import javax.swing.tree.TreePath;
&nbsp;import javax.swing.tree.TreeSelectionModel;
&nbsp;
&nbsp;import megamek.client.Client;
&nbsp;import megamek.client.generator.RandomGenderGenerator;
&nbsp;import megamek.client.generator.RandomNameGenerator;
&nbsp;import megamek.client.generator.RandomUnitGenerator;
&nbsp;import megamek.client.ratgenerator.FactionRecord;
&nbsp;import megamek.client.ratgenerator.FormationType;
&nbsp;import megamek.client.ratgenerator.MissionRole;
&nbsp;import megamek.client.ratgenerator.ModelRecord;
&nbsp;import megamek.client.ratgenerator.UnitTable;
&nbsp;import megamek.client.ui.Messages;
&nbsp;import megamek.common.Entity;
&nbsp;import megamek.common.EntityMovementMode;
&nbsp;import megamek.common.IGame.Phase;
&nbsp;import megamek.common.IPlayer;
&nbsp;import megamek.common.enums.Gender;
&nbsp;import megamek.common.event.GameListener;
&nbsp;import megamek.common.event.GameListenerAdapter;
&nbsp;import megamek.common.event.GameSettingsChangeEvent;
&nbsp;import megamek.common.LAMPilot;
&nbsp;import megamek.common.MechFileParser;
&nbsp;import megamek.common.MechSearchFilter;
&nbsp;import megamek.common.MechSummary;
&nbsp;import megamek.common.TechConstants;
&nbsp;import megamek.common.UnitType;
&nbsp;import megamek.common.loaders.EntityLoadingException;
&nbsp;import megamek.common.options.OptionsConstants;
&nbsp;import megamek.common.preference.IClientPreferences;
&nbsp;import megamek.common.preference.PreferenceManager;
&nbsp;import megamek.common.util.RandomArmyCreator;
&nbsp;
<b class="nc">&nbsp;public class RandomArmyDialog extends JDialog implements ActionListener, WindowListener, TreeSelectionListener {</b>
&nbsp;    private static final long serialVersionUID = 4072453002423681675L;
&nbsp;    
&nbsp;    @SuppressWarnings(&quot;unused&quot;)
&nbsp;    private static final int TAB_BV_MATCHING       = 0;
&nbsp;    private static final int TAB_RAT               = 1;
&nbsp;    private static final int TAB_RAT_GENERATOR     = 2;
&nbsp;    private static final int TAB_FORMATION_BUILDER = 3;
&nbsp;    private static final int TAB_FORCE_GENERATOR   = 4;
&nbsp;    
&nbsp;    private static final String CARD_PREVIEW    = &quot;card_preview&quot;; //$NON-NLS-1$
&nbsp;    private static final String CARD_FORCE_TREE = &quot;card_force_tree&quot;; // $NON-NLS-1$
&nbsp;    
&nbsp;    private ClientGUI m_clientgui;
&nbsp;    private Client m_client;
&nbsp;    AdvancedSearchDialog asd;
&nbsp;
&nbsp;    private MechSearchFilter searchFilter;
&nbsp;
<b class="nc">&nbsp;    private JLabel m_labelPlayer = new JLabel(Messages</b>
<b class="nc">&nbsp;            .getString(&quot;RandomArmyDialog.Player&quot;), SwingConstants.RIGHT); //$NON-NLS-1$</b>
&nbsp;
<b class="nc">&nbsp;    private JComboBox&lt;String&gt; m_chPlayer = new JComboBox&lt;String&gt;();</b>
<b class="nc">&nbsp;    private JComboBox&lt;String&gt; m_chType = new JComboBox&lt;String&gt;();</b>
&nbsp;
<b class="nc">&nbsp;    private JTree m_treeRAT = new JTree();</b>
<b class="nc">&nbsp;    private JTabbedPane m_pMain = new JTabbedPane();</b>
<b class="nc">&nbsp;    private JPanel m_pRAT = new JPanel();</b>
<b class="nc">&nbsp;    private JPanel m_pRATGen = new JPanel();</b>
<b class="nc">&nbsp;    private JPanel m_pFormations = new JPanel();</b>
&nbsp;    private ForceGeneratorViewUi m_pForceGen;
&nbsp;    private ForceGenerationOptionsPanel m_pRATGenOptions;
<b class="nc">&nbsp;    private JPanel m_pUnitTypeOptions = new JPanel(new CardLayout());</b>
&nbsp;    private ForceGenerationOptionsPanel m_pFormationOptions;
<b class="nc">&nbsp;    private JPanel m_pParameters = new JPanel();</b>
<b class="nc">&nbsp;    private JPanel m_pPreview = new JPanel();</b>
<b class="nc">&nbsp;    private JPanel m_pButtons = new JPanel();</b>
<b class="nc">&nbsp;    private JPanel m_pAdvSearch = new JPanel();</b>
<b class="nc">&nbsp;    private JButton m_bOK = new JButton(Messages.getString(&quot;Okay&quot;));</b>
<b class="nc">&nbsp;    private JButton m_bCancel = new JButton(Messages.getString(&quot;Cancel&quot;));</b>
<b class="nc">&nbsp;    private JButton m_bRandomSkills = new JButton(Messages.getString(&quot;RandomSkillDialog.title&quot;));</b>
<b class="nc">&nbsp;    private JButton m_bAdvSearch = new JButton(Messages.getString(&quot;RandomArmyDialog.AdvancedSearch&quot;));</b>
<b class="nc">&nbsp;    private JButton m_bAdvSearchClear = new JButton(Messages.getString(&quot;RandomArmyDialog.AdvancedSearchClear&quot;));</b>
<b class="nc">&nbsp;    private JButton m_bGenerate = new JButton(Messages.getString(&quot;RandomArmyDialog.Generate&quot;));</b>
<b class="nc">&nbsp;    private JButton m_bAddToForce = new JButton(Messages.getString(&quot;RandomArmyDialog.AddToForce&quot;));</b>
&nbsp;
<b class="nc">&nbsp;    private CardLayout m_lRightCards = new CardLayout();</b>
<b class="nc">&nbsp;    private JPanel m_pRightPane = new JPanel(m_lRightCards);</b>
&nbsp;    private JSplitPane m_pSplit;
&nbsp;
<b class="nc">&nbsp;    private JButton m_bAddAll = new JButton(Messages.getString(&quot;RandomArmyDialog.AddAll&quot;));</b>
<b class="nc">&nbsp;    private JButton m_bAdd = new JButton(Messages.getString(&quot;RandomArmyDialog.AddSelected&quot;));</b>
<b class="nc">&nbsp;    private JButton m_bRoll = new JButton(Messages.getString(&quot;RandomArmyDialog.Roll&quot;));</b>
<b class="nc">&nbsp;    private JButton m_bClear = new JButton(Messages.getString(&quot;RandomArmyDialog.Clear&quot;));</b>
&nbsp;
&nbsp;    private JTable m_lArmy;
&nbsp;    private JTable m_lUnits;
&nbsp;    private JTable m_lRAT;
&nbsp;
&nbsp;    private UnitTableModel armyModel;
&nbsp;    private UnitTableModel unitsModel;
&nbsp;    private RATTableModel ratModel;
&nbsp;
<b class="nc">&nbsp;    private JLabel m_labBV = new JLabel(Messages</b>
<b class="nc">&nbsp;            .getString(&quot;RandomArmyDialog.BV&quot;));</b>
<b class="nc">&nbsp;    private JLabel m_labYear = new JLabel(Messages</b>
<b class="nc">&nbsp;            .getString(&quot;RandomArmyDialog.Year&quot;));</b>
<b class="nc">&nbsp;    private JLabel m_labMechs = new JLabel(Messages</b>
<b class="nc">&nbsp;            .getString(&quot;RandomArmyDialog.Mechs&quot;));</b>
<b class="nc">&nbsp;    private JLabel m_labVees = new JLabel(Messages</b>
<b class="nc">&nbsp;            .getString(&quot;RandomArmyDialog.Vees&quot;));</b>
<b class="nc">&nbsp;    private JLabel m_labBA = new JLabel(Messages</b>
<b class="nc">&nbsp;            .getString(&quot;RandomArmyDialog.BA&quot;));</b>
<b class="nc">&nbsp;    private JLabel m_labInfantry = new JLabel(Messages</b>
<b class="nc">&nbsp;            .getString(&quot;RandomArmyDialog.Infantry&quot;));</b>
<b class="nc">&nbsp;    private JLabel m_labTech = new JLabel(Messages</b>
<b class="nc">&nbsp;            .getString(&quot;RandomArmyDialog.Tech&quot;));</b>
<b class="nc">&nbsp;    private JLabel m_labUnits = new JLabel(Messages</b>
<b class="nc">&nbsp;            .getString(&quot;RandomArmyDialog.Unit&quot;));</b>
&nbsp;    private JLabel m_ratStatus;
&nbsp;
<b class="nc">&nbsp;    private JTextField m_tBVmin = new JTextField(6);</b>
<b class="nc">&nbsp;    private JTextField m_tBVmax = new JTextField(6);</b>
<b class="nc">&nbsp;    private JTextField m_tMinYear = new JTextField(4);</b>
<b class="nc">&nbsp;    private JTextField m_tMaxYear = new JTextField(4);</b>
<b class="nc">&nbsp;    private JTextField m_tMechs = new JTextField(3);</b>
<b class="nc">&nbsp;    private JTextField m_tVees = new JTextField(3);</b>
<b class="nc">&nbsp;    private JTextField m_tBA = new JTextField(3);</b>
<b class="nc">&nbsp;    private JTextField m_tInfantry = new JTextField(3);</b>
<b class="nc">&nbsp;    private JTextField m_tUnits = new JTextField(3);</b>
<b class="nc">&nbsp;    private JCheckBox m_chkPad = new JCheckBox(Messages</b>
<b class="nc">&nbsp;            .getString(&quot;RandomArmyDialog.Pad&quot;));</b>
<b class="nc">&nbsp;    private JCheckBox m_chkCanon = new JCheckBox(Messages</b>
<b class="nc">&nbsp;            .getString(&quot;RandomArmyDialog.Canon&quot;));</b>
&nbsp;    
&nbsp;    private RandomUnitGenerator rug;
&nbsp;    private UnitTable generatedRAT;
&nbsp;
&nbsp;    public RandomArmyDialog(ClientGUI cl) {
<b class="nc">&nbsp;        super(cl.frame, Messages.getString(&quot;RandomArmyDialog.title&quot;), true); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        m_clientgui = cl;</b>
<b class="nc">&nbsp;        m_client = cl.getClient();</b>
<b class="nc">&nbsp;        rug = RandomUnitGenerator.getInstance();</b>
<b class="nc">&nbsp;        rug.registerListener(this);</b>
<b class="nc">&nbsp;        if (rug.isInitialized()){</b>
<b class="nc">&nbsp;            m_ratStatus = new JLabel(Messages</b>
<b class="nc">&nbsp;                    .getString(&quot;RandomArmyDialog.ratStatusDoneLoading&quot;));            </b>
&nbsp;        } else {
<b class="nc">&nbsp;            m_ratStatus = new JLabel(Messages</b>
<b class="nc">&nbsp;                    .getString(&quot;RandomArmyDialog.ratStatusLoading&quot;));</b>
&nbsp;        }
<b class="nc">&nbsp;        updatePlayerChoice();</b>
<b class="nc">&nbsp;        asd = new AdvancedSearchDialog(m_clientgui.frame,</b>
<b class="nc">&nbsp;                m_client.getGame().getOptions().intOption(OptionsConstants.ALLOWED_YEAR));</b>
&nbsp;        
<b class="nc">&nbsp;        GUIPreferences guip = GUIPreferences.getInstance();</b>
&nbsp;        // set defaults
<b class="nc">&nbsp;        m_tMechs.setText(guip.getRATNumMechs());</b>
<b class="nc">&nbsp;        m_tBVmin.setText(guip.getRATBVMin());</b>
<b class="nc">&nbsp;        m_tBVmax.setText(guip.getRATBVMax());</b>
<b class="nc">&nbsp;        m_tVees.setText(guip.getRATNumVees());</b>
<b class="nc">&nbsp;        m_tBA.setText(guip.getRATNumBA());</b>
<b class="nc">&nbsp;        m_tMinYear.setText(guip.getRATYearMin());</b>
<b class="nc">&nbsp;        m_tMaxYear.setText(guip.getRATYearMax());</b>
<b class="nc">&nbsp;        m_tInfantry.setText(guip.getRATNumInf());</b>
<b class="nc">&nbsp;        m_chkPad.setSelected(guip.getRATPadBV());</b>
<b class="nc">&nbsp;        m_chkCanon.setSelected(m_client.getGame().getOptions().booleanOption(</b>
&nbsp;        OptionsConstants.ALLOWED_CANON_ONLY));
<b class="nc">&nbsp;        updateTechChoice();</b>
&nbsp;
&nbsp;        // construct the buttons panel
<b class="nc">&nbsp;        m_pButtons.setLayout(new FlowLayout(FlowLayout.CENTER));</b>
<b class="nc">&nbsp;        m_pButtons.add(m_bOK);</b>
<b class="nc">&nbsp;        m_bOK.addActionListener(this);</b>
<b class="nc">&nbsp;        m_pButtons.add(m_bCancel);</b>
<b class="nc">&nbsp;        m_bCancel.addActionListener(this);</b>
<b class="nc">&nbsp;        m_bRandomSkills.addActionListener(this);</b>
<b class="nc">&nbsp;        m_pButtons.add(m_labelPlayer);</b>
<b class="nc">&nbsp;        m_pButtons.add(m_chPlayer);</b>
<b class="nc">&nbsp;        m_pButtons.add(m_bRandomSkills);</b>
&nbsp;
&nbsp;        // construct the Adv Search Panel
<b class="nc">&nbsp;        m_pAdvSearch.setLayout(new FlowLayout(FlowLayout.LEADING));</b>
<b class="nc">&nbsp;        m_pAdvSearch.add(m_bAdvSearch);</b>
<b class="nc">&nbsp;        m_pAdvSearch.add(m_bAdvSearchClear);</b>
<b class="nc">&nbsp;        m_bAdvSearchClear.setEnabled(false);</b>
<b class="nc">&nbsp;        m_bAdvSearch.addActionListener(this);</b>
<b class="nc">&nbsp;        m_bAdvSearchClear.addActionListener(this);</b>
&nbsp;
&nbsp;        // construct the parameters panel
<b class="nc">&nbsp;        GridBagLayout layout = new GridBagLayout();</b>
<b class="nc">&nbsp;        m_pParameters.setLayout(layout);</b>
<b class="nc">&nbsp;        GridBagConstraints constraints = new GridBagConstraints();</b>
<b class="nc">&nbsp;        constraints.weightx = 0.0;</b>
<b class="nc">&nbsp;        constraints.weighty = 0.0;</b>
<b class="nc">&nbsp;        constraints.anchor = GridBagConstraints.WEST;</b>
<b class="nc">&nbsp;        layout.setConstraints(m_labTech, constraints);</b>
<b class="nc">&nbsp;        m_pParameters.add(m_labTech);</b>
<b class="nc">&nbsp;        constraints.gridwidth = GridBagConstraints.REMAINDER;</b>
<b class="nc">&nbsp;        constraints.weightx = 1.0;</b>
<b class="nc">&nbsp;        layout.setConstraints(m_chType, constraints);</b>
<b class="nc">&nbsp;        m_pParameters.add(m_chType);</b>
<b class="nc">&nbsp;        constraints.gridwidth = 1;</b>
<b class="nc">&nbsp;        constraints.weightx = 0.0;</b>
<b class="nc">&nbsp;        layout.setConstraints(m_labBV, constraints);</b>
<b class="nc">&nbsp;        m_pParameters.add(m_labBV);</b>
<b class="nc">&nbsp;        m_pParameters.add(m_tBVmin);</b>
<b class="nc">&nbsp;        JLabel dash = new JLabel(&quot;-&quot;);</b>
<b class="nc">&nbsp;        layout.setConstraints(dash, constraints);</b>
<b class="nc">&nbsp;        m_pParameters.add(dash);</b>
<b class="nc">&nbsp;        constraints.gridwidth = GridBagConstraints.REMAINDER;</b>
<b class="nc">&nbsp;        constraints.weightx = 1.0;</b>
<b class="nc">&nbsp;        layout.setConstraints(m_tBVmax, constraints);</b>
<b class="nc">&nbsp;        m_pParameters.add(m_tBVmax);</b>
<b class="nc">&nbsp;        constraints.gridwidth = 1;</b>
<b class="nc">&nbsp;        constraints.weightx = 0.0;</b>
<b class="nc">&nbsp;        layout.setConstraints(m_labMechs, constraints);</b>
<b class="nc">&nbsp;        m_pParameters.add(m_labMechs);</b>
<b class="nc">&nbsp;        constraints.gridwidth = GridBagConstraints.REMAINDER;</b>
<b class="nc">&nbsp;        constraints.weightx = 1.0;</b>
<b class="nc">&nbsp;        layout.setConstraints(m_tMechs, constraints);</b>
<b class="nc">&nbsp;        m_pParameters.add(m_tMechs);</b>
<b class="nc">&nbsp;        constraints.gridwidth = 1;</b>
<b class="nc">&nbsp;        constraints.weightx = 0.0;</b>
<b class="nc">&nbsp;        layout.setConstraints(m_labVees, constraints);</b>
<b class="nc">&nbsp;        m_pParameters.add(m_labVees);</b>
<b class="nc">&nbsp;        constraints.gridwidth = GridBagConstraints.REMAINDER;</b>
<b class="nc">&nbsp;        constraints.weightx = 1.0;</b>
<b class="nc">&nbsp;        layout.setConstraints(m_tVees, constraints);</b>
<b class="nc">&nbsp;        m_pParameters.add(m_tVees);</b>
<b class="nc">&nbsp;        constraints.gridwidth = 1;</b>
<b class="nc">&nbsp;        constraints.weightx = 0.0;</b>
<b class="nc">&nbsp;        layout.setConstraints(m_labBA, constraints);</b>
<b class="nc">&nbsp;        m_pParameters.add(m_labBA);</b>
<b class="nc">&nbsp;        constraints.gridwidth = GridBagConstraints.REMAINDER;</b>
<b class="nc">&nbsp;        constraints.weightx = 1.0;</b>
<b class="nc">&nbsp;        layout.setConstraints(m_tBA, constraints);</b>
<b class="nc">&nbsp;        m_pParameters.add(m_tBA);</b>
<b class="nc">&nbsp;        constraints.gridwidth = 1;</b>
<b class="nc">&nbsp;        constraints.weightx = 0.0;</b>
<b class="nc">&nbsp;        layout.setConstraints(m_labInfantry, constraints);</b>
<b class="nc">&nbsp;        m_pParameters.add(m_labInfantry);</b>
<b class="nc">&nbsp;        constraints.gridwidth = GridBagConstraints.REMAINDER;</b>
<b class="nc">&nbsp;        constraints.weightx = 1.0;</b>
<b class="nc">&nbsp;        layout.setConstraints(m_tInfantry, constraints);</b>
<b class="nc">&nbsp;        m_pParameters.add(m_tInfantry);</b>
<b class="nc">&nbsp;        constraints.gridwidth = 1;</b>
<b class="nc">&nbsp;        constraints.weightx = 0.0;</b>
<b class="nc">&nbsp;        layout.setConstraints(m_labYear, constraints);</b>
<b class="nc">&nbsp;        m_pParameters.add(m_labYear);</b>
<b class="nc">&nbsp;        layout.setConstraints(m_tMinYear, constraints);</b>
<b class="nc">&nbsp;        m_pParameters.add(m_tMinYear);</b>
<b class="nc">&nbsp;        dash = new JLabel(&quot;-&quot;);</b>
<b class="nc">&nbsp;        layout.setConstraints(dash, constraints);</b>
<b class="nc">&nbsp;        m_pParameters.add(dash);</b>
<b class="nc">&nbsp;        constraints.gridwidth = GridBagConstraints.REMAINDER;</b>
<b class="nc">&nbsp;        constraints.weightx = 1.0;</b>
<b class="nc">&nbsp;        layout.setConstraints(m_tMaxYear, constraints);</b>
<b class="nc">&nbsp;        m_pParameters.add(m_tMaxYear);</b>
<b class="nc">&nbsp;        layout.setConstraints(m_chkPad, constraints);</b>
<b class="nc">&nbsp;        m_pParameters.add(m_chkPad);</b>
<b class="nc">&nbsp;        layout.setConstraints(m_chkCanon, constraints);</b>
<b class="nc">&nbsp;        m_pParameters.add(m_chkCanon);</b>
<b class="nc">&nbsp;        constraints.anchor = GridBagConstraints.NORTHWEST;</b>
<b class="nc">&nbsp;        constraints.weighty = 1.0;</b>
<b class="nc">&nbsp;        layout.setConstraints(m_pAdvSearch, constraints);</b>
<b class="nc">&nbsp;        m_pParameters.add(m_pAdvSearch);</b>
&nbsp;
&nbsp;        //construct the RAT panel
<b class="nc">&nbsp;        m_pRAT.setLayout(new GridBagLayout());</b>
<b class="nc">&nbsp;        m_tUnits.setText(&quot;4&quot;);</b>
&nbsp;
<b class="nc">&nbsp;        GridBagConstraints c = new GridBagConstraints();</b>
<b class="nc">&nbsp;        c.gridx = 0;</b>
<b class="nc">&nbsp;        c.gridy = 0;</b>
<b class="nc">&nbsp;        c.gridwidth = 1;</b>
<b class="nc">&nbsp;        c.fill = GridBagConstraints.NONE;</b>
<b class="nc">&nbsp;        c.anchor = GridBagConstraints.WEST;</b>
<b class="nc">&nbsp;        c.weightx = 0.0;</b>
<b class="nc">&nbsp;        c.weighty = 0.0;</b>
<b class="nc">&nbsp;        m_pRAT.add(m_labUnits, c);</b>
&nbsp;
<b class="nc">&nbsp;        c = new GridBagConstraints();</b>
<b class="nc">&nbsp;        c.gridx = 1;</b>
<b class="nc">&nbsp;        c.gridy = 0;</b>
<b class="nc">&nbsp;        c.gridwidth = 1;</b>
<b class="nc">&nbsp;        c.fill = GridBagConstraints.NONE;</b>
<b class="nc">&nbsp;        c.anchor = GridBagConstraints.WEST;</b>
<b class="nc">&nbsp;        c.weightx = 0.0;</b>
<b class="nc">&nbsp;        c.weighty = 0.0;</b>
<b class="nc">&nbsp;        m_pRAT.add(m_tUnits, c);</b>
&nbsp;        
<b class="nc">&nbsp;        c = new GridBagConstraints();</b>
<b class="nc">&nbsp;        c.gridx = 2;</b>
<b class="nc">&nbsp;        c.gridy = 0;</b>
<b class="nc">&nbsp;        c.gridwidth = 1;</b>
<b class="nc">&nbsp;        c.fill = GridBagConstraints.NONE;</b>
<b class="nc">&nbsp;        c.anchor = GridBagConstraints.WEST;</b>
<b class="nc">&nbsp;        c.weightx = 0.0;</b>
<b class="nc">&nbsp;        c.weighty = 0.0;</b>
<b class="nc">&nbsp;        c.insets = new Insets(0,10,0,0);</b>
<b class="nc">&nbsp;        m_pRAT.add(m_ratStatus,c);</b>
&nbsp;
<b class="nc">&nbsp;        c = new GridBagConstraints();</b>
<b class="nc">&nbsp;        c.gridx = 0;</b>
<b class="nc">&nbsp;        c.gridy = 1;</b>
<b class="nc">&nbsp;        c.gridwidth = GridBagConstraints.REMAINDER;</b>
<b class="nc">&nbsp;        c.fill = GridBagConstraints.BOTH;</b>
<b class="nc">&nbsp;        c.anchor = GridBagConstraints.NORTHWEST;</b>
<b class="nc">&nbsp;        c.weightx = 1.0;</b>
<b class="nc">&nbsp;        c.weighty = 1.0;</b>
<b class="nc">&nbsp;        c.insets = new java.awt.Insets(5, 5, 5, 5);</b>
&nbsp;
&nbsp;
<b class="nc">&nbsp;        m_treeRAT.setRootVisible(false);</b>
<b class="nc">&nbsp;        m_treeRAT.getSelectionModel().setSelectionMode</b>
<b class="nc">&nbsp;        (TreeSelectionModel.SINGLE_TREE_SELECTION);</b>
<b class="nc">&nbsp;        m_treeRAT.addTreeSelectionListener(this);</b>
&nbsp;        //m_treeRAT.setPreferredSize(new Dimension(200, 100));
&nbsp;
<b class="nc">&nbsp;        JScrollPane treeViewRAT = new JScrollPane(m_treeRAT);</b>
<b class="nc">&nbsp;        treeViewRAT.setPreferredSize(new Dimension(300, 200));</b>
<b class="nc">&nbsp;        m_pRAT.add(treeViewRAT, c);</b>
&nbsp;
&nbsp;        //construct the RAT Generator panel
<b class="nc">&nbsp;        m_pRATGen.setLayout(new GridBagLayout());</b>
&nbsp;        //put the general options and the unit-specific options into a single panel so they scroll together.
<b class="nc">&nbsp;        JPanel pRATGenTop = new JPanel(new GridBagLayout());</b>
&nbsp;
<b class="nc">&nbsp;        c = new GridBagConstraints();</b>
<b class="nc">&nbsp;        c.gridx = 0;</b>
<b class="nc">&nbsp;        c.gridy = 0;</b>
<b class="nc">&nbsp;        c.gridwidth = GridBagConstraints.REMAINDER;</b>
<b class="nc">&nbsp;        c.fill = GridBagConstraints.BOTH;</b>
<b class="nc">&nbsp;        c.anchor = GridBagConstraints.WEST;</b>
<b class="nc">&nbsp;        c.weightx = 1.0;</b>
<b class="nc">&nbsp;        c.weighty = 0.5;</b>
<b class="nc">&nbsp;        m_pRATGen.add(new JScrollPane(pRATGenTop), c);</b>
&nbsp;        
<b class="nc">&nbsp;        m_pRATGenOptions = new ForceGenerationOptionsPanel(ForceGenerationOptionsPanel.Use.RAT_GENERATOR);</b>
<b class="nc">&nbsp;        m_pFormationOptions = new ForceGenerationOptionsPanel(ForceGenerationOptionsPanel.Use.FORMATION_BUILDER);</b>
&nbsp;        
<b class="nc">&nbsp;        c = new GridBagConstraints();</b>
<b class="nc">&nbsp;        c.gridx = 0;</b>
<b class="nc">&nbsp;        c.gridy = 0;</b>
<b class="nc">&nbsp;        c.gridwidth = 1;</b>
<b class="nc">&nbsp;        c.fill = GridBagConstraints.EAST;</b>
<b class="nc">&nbsp;        c.anchor = GridBagConstraints.WEST;</b>
<b class="nc">&nbsp;        c.weightx = 1.0;</b>
<b class="nc">&nbsp;        c.weighty = 0.0;</b>
<b class="nc">&nbsp;        pRATGenTop.add(m_pRATGenOptions, c);</b>
<b class="nc">&nbsp;        m_pRATGenOptions.setYear(m_clientgui.getClient().getGame().getOptions()</b>
<b class="nc">&nbsp;                .intOption(&quot;year&quot;));</b>
&nbsp;        
<b class="nc">&nbsp;        c = new GridBagConstraints();</b>
<b class="nc">&nbsp;        c.gridx = 0;</b>
<b class="nc">&nbsp;        c.gridy = 1;</b>
<b class="nc">&nbsp;        c.gridwidth = 1;</b>
<b class="nc">&nbsp;        c.fill = GridBagConstraints.EAST;</b>
<b class="nc">&nbsp;        c.anchor = GridBagConstraints.WEST;</b>
<b class="nc">&nbsp;        c.weightx = 1.0;</b>
<b class="nc">&nbsp;        c.weighty = 0.0;</b>
<b class="nc">&nbsp;        pRATGenTop.add(m_pUnitTypeOptions, c);</b>
&nbsp;
<b class="nc">&nbsp;        c = new GridBagConstraints();</b>
<b class="nc">&nbsp;        c.gridx = 0;</b>
<b class="nc">&nbsp;        c.gridy = 1;</b>
<b class="nc">&nbsp;        c.gridwidth = 1;</b>
<b class="nc">&nbsp;        c.fill = GridBagConstraints.NONE;</b>
<b class="nc">&nbsp;        c.anchor = GridBagConstraints.WEST;</b>
<b class="nc">&nbsp;        c.weightx = 0.0;</b>
<b class="nc">&nbsp;        c.weighty = 0.0;</b>
<b class="nc">&nbsp;        m_pRATGen.add(m_bGenerate, c);</b>
<b class="nc">&nbsp;        m_bGenerate.setToolTipText(Messages.getString(&quot;RandomArmyDialog.Generate.tooltip&quot;));</b>
<b class="nc">&nbsp;        m_bGenerate.addActionListener(this);</b>
&nbsp;        
<b class="nc">&nbsp;        c = new GridBagConstraints();</b>
<b class="nc">&nbsp;        c.gridx = 1;</b>
<b class="nc">&nbsp;        c.gridy = 1;</b>
<b class="nc">&nbsp;        c.gridwidth = 1;</b>
<b class="nc">&nbsp;        c.fill = GridBagConstraints.NONE;</b>
<b class="nc">&nbsp;        c.anchor = GridBagConstraints.EAST;</b>
<b class="nc">&nbsp;        c.weightx = 0.0;</b>
<b class="nc">&nbsp;        c.weighty = 0.0;</b>
<b class="nc">&nbsp;        m_pRATGen.add(m_bAddToForce, c);</b>
<b class="nc">&nbsp;        m_bAddToForce.setToolTipText(Messages.getString(&quot;RandomArmyDialog.AddToForce.tooltip&quot;));</b>
<b class="nc">&nbsp;        m_bAddToForce.addActionListener(this);</b>
&nbsp;        
<b class="nc">&nbsp;        ratModel = new RATTableModel();</b>
<b class="nc">&nbsp;        m_lRAT = new JTable();</b>
<b class="nc">&nbsp;        m_lRAT.setModel(ratModel);</b>
<b class="nc">&nbsp;        m_lRAT.setIntercellSpacing(new Dimension(5, 0));</b>
<b class="nc">&nbsp;        m_lRAT.setSelectionMode(ListSelectionModel.MULTIPLE_INTERVAL_SELECTION);</b>
<b class="nc">&nbsp;        for (int i = 0; i &lt; ratModel.getColumnCount(); i++) {</b>
<b class="nc">&nbsp;        	m_lRAT.getColumnModel().getColumn(i).setPreferredWidth(ratModel.getPreferredWidth(i));</b>
&nbsp;        }
<b class="nc">&nbsp;		DefaultTableCellRenderer rightRenderer = new DefaultTableCellRenderer();</b>
<b class="nc">&nbsp;		rightRenderer.setHorizontalAlignment(JLabel.RIGHT);</b>
<b class="nc">&nbsp;		m_lRAT.getColumnModel().getColumn(RATTableModel.COL_BV).setCellRenderer(rightRenderer);</b>
<b class="nc">&nbsp;        c = new GridBagConstraints();</b>
<b class="nc">&nbsp;        c.gridx = 0;</b>
<b class="nc">&nbsp;        c.gridy = 2;</b>
<b class="nc">&nbsp;        c.fill = GridBagConstraints.BOTH;</b>
<b class="nc">&nbsp;        c.gridwidth = GridBagConstraints.REMAINDER;</b>
<b class="nc">&nbsp;        c.anchor = GridBagConstraints.WEST;</b>
<b class="nc">&nbsp;        c.weightx = 1.0;</b>
<b class="nc">&nbsp;        c.weighty = 0.5;</b>
<b class="nc">&nbsp;        m_pRATGen.add(new JScrollPane(m_lRAT), c);</b>
&nbsp;
&nbsp;        // formation builder tab
<b class="nc">&nbsp;        m_pFormations.setLayout(new BorderLayout());</b>
&nbsp;
<b class="nc">&nbsp;        m_pFormations.add(new JScrollPane(m_pFormationOptions), BorderLayout.CENTER);</b>
<b class="nc">&nbsp;        m_pFormationOptions.setYear(m_clientgui.getClient().getGame().getOptions()</b>
<b class="nc">&nbsp;                .intOption(&quot;year&quot;));</b>
&nbsp;        
<b class="nc">&nbsp;        m_pForceGen = new ForceGeneratorViewUi(cl);</b>
&nbsp;
&nbsp;        // construct the preview panel
<b class="nc">&nbsp;        m_pPreview.setLayout(new GridBagLayout());</b>
<b class="nc">&nbsp;        unitsModel = new UnitTableModel();</b>
<b class="nc">&nbsp;        m_lUnits = new JTable();</b>
<b class="nc">&nbsp;        m_lUnits.setModel(unitsModel);</b>
<b class="nc">&nbsp;        m_lUnits.setIntercellSpacing(new Dimension(0, 0));</b>
<b class="nc">&nbsp;        m_lUnits.setSelectionMode(ListSelectionModel.MULTIPLE_INTERVAL_SELECTION);</b>
<b class="nc">&nbsp;        JScrollPane scroll = new JScrollPane(m_lUnits);</b>
<b class="nc">&nbsp;        scroll.setBorder(BorderFactory.createTitledBorder(Messages.getString(&quot;RandomArmyDialog.SelectedUnits&quot;)));</b>
<b class="nc">&nbsp;        c = new GridBagConstraints();</b>
<b class="nc">&nbsp;        c.gridx = 0;</b>
<b class="nc">&nbsp;        c.gridy = 0;</b>
<b class="nc">&nbsp;        c.gridwidth = 4;</b>
<b class="nc">&nbsp;        c.fill = GridBagConstraints.BOTH;</b>
<b class="nc">&nbsp;        c.anchor = GridBagConstraints.NORTHWEST;</b>
<b class="nc">&nbsp;        c.weightx = 1.0;</b>
<b class="nc">&nbsp;        c.weighty = 1.0;</b>
<b class="nc">&nbsp;        m_pPreview.add(scroll, c);</b>
<b class="nc">&nbsp;        c = new GridBagConstraints();</b>
<b class="nc">&nbsp;        c.gridx = 0;</b>
<b class="nc">&nbsp;        c.gridy = 1;</b>
<b class="nc">&nbsp;        c.gridwidth = 1;</b>
<b class="nc">&nbsp;        c.fill = GridBagConstraints.BOTH;</b>
<b class="nc">&nbsp;        c.anchor = GridBagConstraints.NORTHWEST;</b>
<b class="nc">&nbsp;        c.weightx = 0.0;</b>
<b class="nc">&nbsp;        c.weighty = 0.0;</b>
<b class="nc">&nbsp;        m_bRoll.addActionListener(this);</b>
<b class="nc">&nbsp;        m_pPreview.add(m_bRoll,c);</b>
<b class="nc">&nbsp;        c.gridx = 1;</b>
<b class="nc">&nbsp;        m_bAddAll.addActionListener(this);</b>
<b class="nc">&nbsp;        m_pPreview.add(m_bAddAll,c);</b>
<b class="nc">&nbsp;        c.gridx = 2;</b>
<b class="nc">&nbsp;        m_bAdd.addActionListener(this);</b>
<b class="nc">&nbsp;        m_pPreview.add(m_bAdd,c);</b>
<b class="nc">&nbsp;        c.gridx = 3;</b>
<b class="nc">&nbsp;        m_bClear.addActionListener(this);</b>
<b class="nc">&nbsp;        m_pPreview.add(m_bClear,c);</b>
<b class="nc">&nbsp;        armyModel = new UnitTableModel();</b>
<b class="nc">&nbsp;        m_lArmy = new JTable();</b>
<b class="nc">&nbsp;        m_lArmy.setModel(armyModel);</b>
<b class="nc">&nbsp;        m_lArmy.setIntercellSpacing(new Dimension(0, 0));</b>
<b class="nc">&nbsp;        m_lArmy.setSelectionMode(ListSelectionModel.MULTIPLE_INTERVAL_SELECTION);</b>
<b class="nc">&nbsp;        scroll = new JScrollPane(m_lArmy);</b>
<b class="nc">&nbsp;        scroll.setBorder(BorderFactory.createTitledBorder(Messages.getString(&quot;RandomArmyDialog.Army&quot;)));</b>
<b class="nc">&nbsp;        c = new GridBagConstraints();</b>
<b class="nc">&nbsp;        c.gridx = 0;</b>
<b class="nc">&nbsp;        c.gridy = 2;</b>
<b class="nc">&nbsp;        c.gridwidth = 4;</b>
<b class="nc">&nbsp;        c.fill = GridBagConstraints.BOTH;</b>
<b class="nc">&nbsp;        c.anchor = GridBagConstraints.NORTHWEST;</b>
<b class="nc">&nbsp;        c.weightx = 1.0;</b>
<b class="nc">&nbsp;        c.weighty = 1.0;</b>
<b class="nc">&nbsp;        m_pPreview.add(scroll, c);</b>
&nbsp;
<b class="nc">&nbsp;        m_pMain.addTab(Messages.getString(&quot;RandomArmyDialog.BVtab&quot;), m_pParameters);</b>
<b class="nc">&nbsp;        m_pMain.addTab(Messages.getString(&quot;RandomArmyDialog.RATtab&quot;), m_pRAT);</b>
<b class="nc">&nbsp;        m_pMain.addTab(Messages.getString(&quot;RandomArmyDialog.RATGentab&quot;), m_pRATGen);</b>
<b class="nc">&nbsp;        m_pMain.addTab(Messages.getString(&quot;RandomArmyDialog.Formationtab&quot;), m_pFormations);</b>
<b class="nc">&nbsp;        m_pMain.addTab(Messages.getString(&quot;RandomArmyDialog.Forcetab&quot;), m_pForceGen.getLeftPanel());</b>
<b class="nc">&nbsp;        m_pMain.addChangeListener(ev -&gt; {</b>
<b class="nc">&nbsp;            if (m_pMain.getSelectedIndex() == TAB_FORCE_GENERATOR) {</b>
<b class="nc">&nbsp;                m_lRightCards.show(m_pRightPane, CARD_FORCE_TREE);</b>
<b class="nc">&nbsp;                this.m_bRandomSkills.setEnabled(false);</b>
&nbsp;            } else {
<b class="nc">&nbsp;                m_lRightCards.show(m_pRightPane, CARD_PREVIEW);</b>
<b class="nc">&nbsp;                this.m_bRandomSkills.setEnabled(true);</b>
&nbsp;            }
&nbsp;        });
&nbsp;        
<b class="nc">&nbsp;        m_pRightPane.add(m_pPreview, CARD_PREVIEW);</b>
<b class="nc">&nbsp;        m_pRightPane.add(m_pForceGen.getRightPanel(), CARD_FORCE_TREE);</b>
&nbsp;        
<b class="nc">&nbsp;        m_pSplit = new javax.swing.JSplitPane(javax.swing.JSplitPane.HORIZONTAL_SPLIT,m_pMain, m_pRightPane);</b>
<b class="nc">&nbsp;        m_pSplit.setOneTouchExpandable(false);</b>
<b class="nc">&nbsp;        m_pSplit.setResizeWeight(0.5);</b>
&nbsp;
&nbsp;        // construct the main dialog
<b class="nc">&nbsp;        setLayout(new BorderLayout());</b>
<b class="nc">&nbsp;        this.setPreferredSize(new Dimension(800,500));</b>
<b class="nc">&nbsp;        add(m_pButtons, BorderLayout.SOUTH);</b>
<b class="nc">&nbsp;        add(m_pSplit, BorderLayout.CENTER);</b>
<b class="nc">&nbsp;        validate();</b>
<b class="nc">&nbsp;        pack();</b>
<b class="nc">&nbsp;        setLocationRelativeTo(cl.frame);</b>
&nbsp;        
<b class="nc">&nbsp;        m_client.getGame().addGameListener(gameListener);</b>
&nbsp;    }
&nbsp;
&nbsp;    public void valueChanged(TreeSelectionEvent ev) {
<b class="nc">&nbsp;        if (ev.getSource().equals(m_treeRAT)) {</b>
<b class="nc">&nbsp;            DefaultMutableTreeNode node = (DefaultMutableTreeNode)m_treeRAT.getLastSelectedPathComponent();</b>
<b class="nc">&nbsp;            if (node == null) {</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            Object nodeInfo = node.getUserObject();</b>
<b class="nc">&nbsp;            if (node.isLeaf()) {</b>
<b class="nc">&nbsp;                String ratName = (String)nodeInfo;</b>
<b class="nc">&nbsp;                rug.setChosenRAT(ratName);</b>
&nbsp;            }
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    public void actionPerformed(ActionEvent ev) {
<b class="nc">&nbsp;        if (ev.getSource().equals(m_bOK)) {</b>
<b class="nc">&nbsp;            if (m_pMain.getSelectedIndex() == TAB_FORCE_GENERATOR) {</b>
<b class="nc">&nbsp;                m_pForceGen.addChosenUnits((String) m_chPlayer.getSelectedItem());</b>
&nbsp;            } else {
<b class="nc">&nbsp;                ArrayList&lt;Entity&gt; entities = new ArrayList&lt;&gt;(</b>
<b class="nc">&nbsp;                        armyModel.getAllUnits().size());</b>
<b class="nc">&nbsp;                Client c = null;</b>
<b class="nc">&nbsp;                if (m_chPlayer.getSelectedIndex() &gt; 0) {</b>
<b class="nc">&nbsp;                    String name = (String) m_chPlayer.getSelectedItem();</b>
<b class="nc">&nbsp;                    c = m_clientgui.getBots().get(name);</b>
&nbsp;                }
<b class="nc">&nbsp;                if (c == null) {</b>
<b class="nc">&nbsp;                    c = m_client;</b>
&nbsp;                }
<b class="nc">&nbsp;                for (MechSummary ms : armyModel.getAllUnits()) {</b>
&nbsp;                    try {
<b class="nc">&nbsp;                        Entity e = new MechFileParser(ms.getSourceFile(), </b>
<b class="nc">&nbsp;                                ms.getEntryName()).getEntity();</b>
&nbsp;      
<b class="nc">&nbsp;                        autoSetSkillsAndName(e);</b>
<b class="nc">&nbsp;                        e.setOwner(c.getLocalPlayer());</b>
<b class="nc">&nbsp;                        if (c.getGame().getPhase() != Phase.PHASE_LOUNGE){</b>
<b class="nc">&nbsp;                            e.setDeployRound(c.getGame().getRoundCount()+1);</b>
<b class="nc">&nbsp;                            e.setGame(c.getGame());</b>
&nbsp;                            // Set these to true, otherwise units reinforced in
&nbsp;                            // the movement turn are considered selectable
<b class="nc">&nbsp;                            e.setDone(true);</b>
<b class="nc">&nbsp;                            e.setUnloaded(true);</b>
&nbsp;                        }
<b class="nc">&nbsp;                        entities.add(e);</b>
<b class="nc">&nbsp;                    } catch (EntityLoadingException ex) {</b>
<b class="nc">&nbsp;                        System.out.println(&quot;Unable to load mech: &quot; + //$NON-NLS-1$ </b>
<b class="nc">&nbsp;                                ms.getSourceFile() + &quot;: &quot; + ms.getEntryName() + //$NON-NLS-1$</b>
<b class="nc">&nbsp;                                &quot;: &quot; + ex.getMessage()); //$NON-NLS-1$ </b>
<b class="nc">&nbsp;                        ex.printStackTrace();</b>
&nbsp;                        return;
<b class="nc">&nbsp;                    }</b>
<b class="nc">&nbsp;                }</b>
<b class="nc">&nbsp;                c.sendAddEntity(entities);</b>
<b class="nc">&nbsp;                armyModel.clearData();</b>
<b class="nc">&nbsp;                unitsModel.clearData();</b>
&nbsp;            }
&nbsp;            
&nbsp;            // Save preferences
<b class="nc">&nbsp;            GUIPreferences guip = GUIPreferences.getInstance();</b>
<b class="nc">&nbsp;            guip.setRATBVMin(m_tBVmin.getText());</b>
<b class="nc">&nbsp;            guip.setRATBVMax(m_tBVmax.getText());</b>
<b class="nc">&nbsp;            guip.setRATNumMechs(m_tMechs.getText());</b>
<b class="nc">&nbsp;            guip.setRATNumVees(m_tVees.getText());</b>
<b class="nc">&nbsp;            guip.setRATNumBA(m_tBA.getText());</b>
<b class="nc">&nbsp;            guip.setRATNumInf(m_tInfantry.getText());</b>
<b class="nc">&nbsp;            guip.setRATYearMin(m_tMinYear.getText());</b>
<b class="nc">&nbsp;            guip.setRATYearMax(m_tMaxYear.getText());</b>
<b class="nc">&nbsp;            guip.setRATPadBV(m_chkPad.isSelected());</b>
<b class="nc">&nbsp;            guip.setRATTechLevel(m_chType.getSelectedIndex());</b>
<b class="nc">&nbsp;            if (m_treeRAT.getSelectionPath() != null) {</b>
<b class="nc">&nbsp;                guip.setRATSelectedRAT(m_treeRAT.getSelectionPath().toString());</b>
&nbsp;            } else {
<b class="nc">&nbsp;                guip.setRATSelectedRAT(&quot;&quot;);</b>
&nbsp;            }
&nbsp;            
<b class="nc">&nbsp;            setVisible(false);</b>
<b class="nc">&nbsp;        } else if (ev.getSource().equals(m_bClear)) {</b>
<b class="nc">&nbsp;            armyModel.clearData();</b>
<b class="nc">&nbsp;            unitsModel.clearData();</b>
<b class="nc">&nbsp;        } else if (ev.getSource().equals(m_bCancel)) {</b>
<b class="nc">&nbsp;             armyModel.clearData();</b>
<b class="nc">&nbsp;             unitsModel.clearData();</b>
<b class="nc">&nbsp;            setVisible(false);</b>
<b class="nc">&nbsp;        } else if (ev.getSource().equals(m_bAddAll)) {</b>
<b class="nc">&nbsp;            for (MechSummary m : unitsModel.getAllUnits()) {</b>
<b class="nc">&nbsp;                armyModel.addUnit(m);</b>
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;        } else if (ev.getSource().equals(m_bAdd)) {</b>
<b class="nc">&nbsp;            for(int sel : m_lUnits.getSelectedRows()) {</b>
<b class="nc">&nbsp;                MechSummary m = unitsModel.getUnitAt(sel);</b>
<b class="nc">&nbsp;                armyModel.addUnit(m);</b>
&nbsp;            }
<b class="nc">&nbsp;        } else if (ev.getSource().equals(m_bAdvSearch)){</b>
<b class="nc">&nbsp;            searchFilter=asd.showDialog();</b>
<b class="nc">&nbsp;            m_bAdvSearchClear.setEnabled(searchFilter!=null);</b>
<b class="nc">&nbsp;        } else if (ev.getSource().equals(m_bAdvSearchClear)){</b>
<b class="nc">&nbsp;            searchFilter=null;</b>
<b class="nc">&nbsp;            m_bAdvSearchClear.setEnabled(false);</b>
<b class="nc">&nbsp;        } else if (ev.getSource().equals(m_bRoll)) {</b>
<b class="nc">&nbsp;            setCursor(Cursor.getPredefinedCursor(Cursor.WAIT_CURSOR));</b>
&nbsp;            try {
<b class="nc">&nbsp;                if(m_pMain.getSelectedIndex() == TAB_RAT) {</b>
<b class="nc">&nbsp;                    int units = Integer.parseInt(m_tUnits.getText());</b>
<b class="nc">&nbsp;                    if(units &gt; 0) {</b>
<b class="nc">&nbsp;                        unitsModel.setData(RandomUnitGenerator.getInstance().generate(units));</b>
&nbsp;                    }
<b class="nc">&nbsp;                } else if (m_pMain.getSelectedIndex() == TAB_RAT_GENERATOR) {</b>
<b class="nc">&nbsp;                	int units = m_pRATGenOptions.getNumUnits();</b>
<b class="nc">&nbsp;                	if (units &gt; 0 &amp;&amp; generatedRAT != null &amp;&amp; generatedRAT.getNumEntries() &gt; 0) {</b>
<b class="nc">&nbsp;                		unitsModel.setData(generatedRAT.generateUnits(units));</b>
&nbsp;                	}
&nbsp;                	//generateUnits removes salvage entries that have no units meeting criteria
<b class="nc">&nbsp;                	ratModel.refreshData();</b>
<b class="nc">&nbsp;                } else if (m_pMain.getSelectedIndex() == TAB_FORMATION_BUILDER) {</b>
<b class="nc">&nbsp;                    ArrayList&lt;MechSummary&gt; unitList = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;                    FactionRecord fRec = m_pFormationOptions.getFaction();</b>
<b class="nc">&nbsp;                    FormationType ft = FormationType.getFormationType(m_pFormationOptions.getStringOption(&quot;formationType&quot;));</b>
<b class="nc">&nbsp;                    List&lt;UnitTable.Parameters&gt; params = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;                    params.add(new UnitTable.Parameters(fRec,</b>
<b class="nc">&nbsp;                            m_pFormationOptions.getUnitType(),</b>
<b class="nc">&nbsp;                            m_pFormationOptions.getYear(),</b>
<b class="nc">&nbsp;                            m_pFormationOptions.getRating(), null,</b>
&nbsp;                            ModelRecord.NETWORK_NONE,
<b class="nc">&nbsp;                            java.util.EnumSet.noneOf(EntityMovementMode.class),</b>
<b class="nc">&nbsp;                            java.util.EnumSet.noneOf(MissionRole.class), 0, fRec));</b>
<b class="nc">&nbsp;                    List&lt;Integer&gt; numUnits = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;                    numUnits.add(m_pFormationOptions.getNumUnits());</b>
&nbsp;                    
<b class="nc">&nbsp;                    if (m_pFormationOptions.getIntegerOption(&quot;numOtherUnits&quot;) &gt; 0) {</b>
<b class="nc">&nbsp;                        if (m_pFormationOptions.getIntegerOption(&quot;otherUnitType&quot;) &gt;= 0) {</b>
<b class="nc">&nbsp;                            params.add(new UnitTable.Parameters(fRec,</b>
<b class="nc">&nbsp;                                    m_pFormationOptions.getIntegerOption(&quot;otherUnitType&quot;),</b>
<b class="nc">&nbsp;                                    m_pFormationOptions.getYear(), m_pFormationOptions.getRating(), null,</b>
&nbsp;                                    ModelRecord.NETWORK_NONE,
<b class="nc">&nbsp;                                    java.util.EnumSet.noneOf(EntityMovementMode.class),</b>
<b class="nc">&nbsp;                                    java.util.EnumSet.noneOf(MissionRole.class), 0, fRec));</b>
<b class="nc">&nbsp;                            numUnits.add(m_pFormationOptions.getIntegerOption(&quot;numOtherUnits&quot;));</b>
<b class="nc">&nbsp;                        } else if (m_pFormationOptions.getBooleanOption(&quot;mechBA&quot;)) {</b>
&nbsp;                            // Make sure at least a number units equals to the number of BA points/squads are omni
<b class="nc">&nbsp;                            numUnits.set(0, Math.min(m_pFormationOptions.getIntegerOption(&quot;numOtherUnits&quot;),</b>
<b class="nc">&nbsp;                                    m_pFormationOptions.getNumUnits()));</b>
<b class="nc">&nbsp;                            if (m_pFormationOptions.getNumUnits() &gt; m_pFormationOptions.getIntegerOption(&quot;numOtherUnits&quot;)) {</b>
<b class="nc">&nbsp;                                params.add(params.get(0).copy());</b>
<b class="nc">&nbsp;                                numUnits.add(m_pFormationOptions.getNumUnits() - m_pFormationOptions.getIntegerOption(&quot;numOtherUnits&quot;));</b>
&nbsp;                            }
<b class="nc">&nbsp;                            params.get(0).getRoles().add(MissionRole.MECHANIZED_BA);</b>
&nbsp;                            //BA do not count for formation rules; add as a separate formation
&nbsp;                        }
&nbsp;                    }
&nbsp;                    
<b class="nc">&nbsp;                    if (ft != null) {</b>
<b class="nc">&nbsp;                        unitList.addAll(ft.generateFormation(params,</b>
<b class="nc">&nbsp;                                numUnits, m_pFormationOptions.getIntegerOption(&quot;network&quot;), false));</b>
<b class="nc">&nbsp;                        if (unitList.size() &gt; 0 &amp;&amp; m_pFormationOptions.getIntegerOption(&quot;numOtherUnits&quot;) &gt; 0) {</b>
<b class="nc">&nbsp;                            if (m_pFormationOptions.getBooleanOption(&quot;mechBA&quot;)) {</b>
&nbsp;                                /* Try to generate the BA portion using the same formation type as the
&nbsp;                                 * parent, otherwise generate randomly.
&nbsp;                                 */
<b class="nc">&nbsp;                                UnitTable.Parameters p = new UnitTable.Parameters(fRec, UnitType.BATTLE_ARMOR,</b>
<b class="nc">&nbsp;                                        m_pFormationOptions.getYear(), m_pFormationOptions.getRating(), null,</b>
&nbsp;                                        ModelRecord.NETWORK_NONE,
<b class="nc">&nbsp;                                        java.util.EnumSet.noneOf(EntityMovementMode.class),</b>
<b class="nc">&nbsp;                                        java.util.EnumSet.of(MissionRole.MECHANIZED_BA), 0, fRec);</b>
<b class="nc">&nbsp;                                List&lt;MechSummary&gt; ba = ft.generateFormation(p,</b>
<b class="nc">&nbsp;                                        m_pFormationOptions.getIntegerOption(&quot;numOtherUnits&quot;),</b>
&nbsp;                                        ModelRecord.NETWORK_NONE, true);
<b class="nc">&nbsp;                                if (ba.isEmpty()) {</b>
<b class="nc">&nbsp;                                    ba = UnitTable.findTable(p).generateUnits(m_pFormationOptions.getIntegerOption(&quot;numOtherUnits&quot;));</b>
&nbsp;                                }
<b class="nc">&nbsp;                                unitList.addAll(ba);</b>
<b class="nc">&nbsp;                            } else if (m_pFormationOptions.getBooleanOption(&quot;airLance&quot;)) {</b>
<b class="nc">&nbsp;                                UnitTable t = UnitTable.findTable(fRec, UnitType.AERO,</b>
<b class="nc">&nbsp;                                        m_pFormationOptions.getYear(), m_pFormationOptions.getRating(), null,</b>
&nbsp;                                        ModelRecord.NETWORK_NONE,
<b class="nc">&nbsp;                                        java.util.EnumSet.noneOf(EntityMovementMode.class),</b>
<b class="nc">&nbsp;                                        java.util.EnumSet.noneOf(MissionRole.class), 0, fRec);</b>
<b class="nc">&nbsp;                                MechSummary unit = t.generateUnit();</b>
<b class="nc">&nbsp;                                if (unit != null) {</b>
<b class="nc">&nbsp;                                    unitList.add(unit);</b>
<b class="nc">&nbsp;                                    MechSummary unit2 = t.generateUnit(ms -&gt; ms.getChassis().equals(unit.getChassis()));</b>
<b class="nc">&nbsp;                                    if (unit2 != null) {</b>
<b class="nc">&nbsp;                                        unitList.add(unit2);</b>
&nbsp;                                    } else {
<b class="nc">&nbsp;                                        unitList.add(unit);</b>
&nbsp;                                    }
&nbsp;                                }
<b class="nc">&nbsp;                            }</b>
&nbsp;                        }
&nbsp;                    } else {
<b class="nc">&nbsp;                        System.err.println(&quot;Could not find formation type &quot; + m_pFormationOptions.getStringOption(&quot;formationType&quot;));</b>
&nbsp;                    }                      
<b class="nc">&nbsp;                    unitsModel.setData(unitList);</b>
<b class="nc">&nbsp;                    m_pFormationOptions.updateGeneratedUnits(unitList);</b>
<b class="nc">&nbsp;                } else {</b>
<b class="nc">&nbsp;                    RandomArmyCreator.Parameters p = new RandomArmyCreator.Parameters();</b>
<b class="nc">&nbsp;                    p.advancedSearchFilter=searchFilter;</b>
<b class="nc">&nbsp;                    p.mechs = Integer.parseInt(m_tMechs.getText());</b>
<b class="nc">&nbsp;                    p.tanks = Integer.parseInt(m_tVees.getText());</b>
<b class="nc">&nbsp;                    p.ba = Integer.parseInt(m_tBA.getText());</b>
<b class="nc">&nbsp;                    p.infantry = Integer.parseInt(m_tInfantry.getText());</b>
<b class="nc">&nbsp;                    p.canon = m_chkCanon.isSelected();</b>
<b class="nc">&nbsp;                    p.maxBV = Integer.parseInt(m_tBVmax.getText());</b>
<b class="nc">&nbsp;                    p.minBV = Integer.parseInt(m_tBVmin.getText());</b>
<b class="nc">&nbsp;                    p.padWithInfantry = m_chkPad.isSelected();</b>
<b class="nc">&nbsp;                    p.tech = m_chType.getSelectedIndex();</b>
<b class="nc">&nbsp;                    p.minYear = Integer.parseInt(m_tMinYear.getText());</b>
<b class="nc">&nbsp;                    p.maxYear = Integer.parseInt(m_tMaxYear.getText());</b>
<b class="nc">&nbsp;                    unitsModel.setData(RandomArmyCreator.generateArmy(p));</b>
&nbsp;                }
<b class="nc">&nbsp;            } catch (NumberFormatException ignored) {</b>
&nbsp;            } finally {
<b class="nc">&nbsp;                setCursor(Cursor.getPredefinedCursor(Cursor.DEFAULT_CURSOR));</b>
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;        } else if (ev.getSource().equals(m_bGenerate)) {</b>
<b class="nc">&nbsp;        	generateRAT();</b>
<b class="nc">&nbsp;        } else if (ev.getSource().equals(m_bAddToForce)) {</b>
<b class="nc">&nbsp;            for (int sel : m_lRAT.getSelectedRows()) {</b>
<b class="nc">&nbsp;                MechSummary ms = generatedRAT.getMechSummary(sel);</b>
<b class="nc">&nbsp;                if (ms != null) {</b>
<b class="nc">&nbsp;                	armyModel.addUnit(ms);</b>
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;        } else if (ev.getSource().equals(rug)) {</b>
<b class="nc">&nbsp;            m_ratStatus.setText(Messages.getString(&quot;RandomArmyDialog.ratStatusDoneLoading&quot;));</b>
<b class="nc">&nbsp;            updateRATs();</b>
<b class="nc">&nbsp;        } else if (ev.getSource().equals(m_bRandomSkills)) {</b>
<b class="nc">&nbsp;            m_clientgui.getRandomSkillDialog().showDialog();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    public void windowActivated(WindowEvent arg0) {
&nbsp;        //ignored
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    public void windowClosed(WindowEvent arg0) {
&nbsp;        //ignored
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    public void windowClosing(WindowEvent arg0) {
<b class="nc">&nbsp;        setVisible(false);</b>
&nbsp;    }
&nbsp;
&nbsp;    public void windowDeactivated(WindowEvent arg0) {
&nbsp;        //ignored
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    public void windowDeiconified(WindowEvent arg0) {
&nbsp;        //ignored
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    public void windowIconified(WindowEvent arg0) {
&nbsp;        //ignored
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    public void windowOpened(WindowEvent arg0) {
&nbsp;        //ignored
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;	private void updatePlayerChoice() {
<b class="nc">&nbsp;        String lastChoice = (String) m_chPlayer.getSelectedItem();</b>
<b class="nc">&nbsp;        String clientName = m_clientgui.getClient().getName();</b>
<b class="nc">&nbsp;        m_chPlayer.removeAllItems();</b>
<b class="nc">&nbsp;        m_chPlayer.setEnabled(true);</b>
<b class="nc">&nbsp;        m_chPlayer.addItem(clientName);</b>
<b class="nc">&nbsp;        for (Client client : m_clientgui.getBots().values()) {</b>
<b class="nc">&nbsp;            IPlayer player = m_client.getGame().getPlayer(client.getLocalPlayerNumber());</b>
&nbsp;
<b class="nc">&nbsp;            if (!player.isObserver()) {</b>
<b class="nc">&nbsp;                m_chPlayer.addItem(client.getName());</b>
&nbsp;            }
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;        if (m_chPlayer.getItemCount() == 1) {</b>
<b class="nc">&nbsp;            m_chPlayer.setEnabled(false);</b>
&nbsp;        }
<b class="nc">&nbsp;        m_chPlayer.setSelectedItem(lastChoice);</b>
<b class="nc">&nbsp;        if (m_chPlayer.getSelectedIndex() &lt; 0) {</b>
<b class="nc">&nbsp;            m_chPlayer.setSelectedIndex(0);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void updateTechChoice() {
<b class="nc">&nbsp;        int gameTL = TechConstants.getSimpleLevel(m_client.getGame()</b>
<b class="nc">&nbsp;                .getOptions().stringOption(&quot;techlevel&quot;));</b>
&nbsp;        int maxTech;
<b class="nc">&nbsp;        switch (gameTL) {</b>
&nbsp;            case TechConstants.T_SIMPLE_INTRO:
<b class="nc">&nbsp;                maxTech = TechConstants.T_INTRO_BOXSET;</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            case TechConstants.T_SIMPLE_STANDARD:
<b class="nc">&nbsp;                maxTech = TechConstants.T_TW_ALL;</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            case TechConstants.T_SIMPLE_ADVANCED:
<b class="nc">&nbsp;                maxTech = TechConstants.T_CLAN_ADVANCED;</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            case TechConstants.T_SIMPLE_EXPERIMENTAL:
<b class="nc">&nbsp;                maxTech = TechConstants.T_CLAN_EXPERIMENTAL;</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            case TechConstants.T_SIMPLE_UNOFFICIAL:
<b class="nc">&nbsp;                maxTech = TechConstants.T_ALL;</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            default:
<b class="nc">&nbsp;                maxTech = TechConstants.T_TW_ALL;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        m_chType.removeAllItems();</b>
<b class="nc">&nbsp;        for (int i = 0; i &lt;= maxTech; i++) {</b>
<b class="nc">&nbsp;            m_chType.addItem(TechConstants.getLevelDisplayableName(i));</b>
&nbsp;        }
<b class="nc">&nbsp;        int savedSelection = GUIPreferences.getInstance().getRATTechLevel();</b>
<b class="nc">&nbsp;        savedSelection = Math.min(savedSelection, maxTech - 1);</b>
<b class="nc">&nbsp;        m_chType.setSelectedIndex(savedSelection);</b>
&nbsp;    }
&nbsp;
&nbsp;    private void updateRATs() {
<b class="nc">&nbsp;        Iterator&lt;String&gt; rats = rug.getRatList();</b>
<b class="nc">&nbsp;        if (null == rats) {</b>
&nbsp;            return;
&nbsp;        }  
&nbsp;        
<b class="nc">&nbsp;        RandomUnitGenerator.RatTreeNode ratTree = rug.getRatTree();</b>
<b class="nc">&nbsp;        DefaultMutableTreeNode root = new DefaultMutableTreeNode(ratTree.name);</b>
<b class="nc">&nbsp;        createRatTreeNodes(root, ratTree);</b>
<b class="nc">&nbsp;        m_treeRAT.setModel(new DefaultTreeModel(root));</b>
&nbsp;        
&nbsp;        String selectedRATPath = 
<b class="nc">&nbsp;                GUIPreferences.getInstance().getRATSelectedRAT();</b>
<b class="nc">&nbsp;        if (!selectedRATPath.equals(&quot;&quot;)) {</b>
<b class="nc">&nbsp;            String[] nodes = selectedRATPath.replace(&#39;[&#39;, &#39; &#39;)</b>
<b class="nc">&nbsp;                    .replace(&#39;]&#39;, &#39; &#39;).split(&quot;,&quot;);</b>
<b class="nc">&nbsp;            TreePath path = findPathByName(nodes);</b>
<b class="nc">&nbsp;            m_treeRAT.setSelectionPath(path);</b>
&nbsp;        }
&nbsp;    }
&nbsp;    
&nbsp;    private void updateRATYear() {
<b class="nc">&nbsp;        int gameYear = m_clientgui.getClient().getGame().getOptions().intOption(&quot;year&quot;);</b>
&nbsp;        
<b class="nc">&nbsp;        m_pRATGenOptions.setYear(gameYear);</b>
<b class="nc">&nbsp;        m_pFormationOptions.setYear(gameYear);</b>
<b class="nc">&nbsp;        m_pForceGen.setYear(gameYear);</b>
&nbsp;    }
&nbsp;
&nbsp;    private void createRatTreeNodes(DefaultMutableTreeNode parentNode, RandomUnitGenerator.RatTreeNode ratTreeNode) {
<b class="nc">&nbsp;        for (RandomUnitGenerator.RatTreeNode child : ratTreeNode.children) {</b>
<b class="nc">&nbsp;            DefaultMutableTreeNode newNode = new DefaultMutableTreeNode(child.name);</b>
<b class="nc">&nbsp;            if (child.children.size() &gt; 0) {</b>
<b class="nc">&nbsp;                createRatTreeNodes(newNode, child);</b>
&nbsp;            }
<b class="nc">&nbsp;            parentNode.add(newNode);</b>
<b class="nc">&nbsp;        }</b>
&nbsp;    }
&nbsp;    
&nbsp;    private TreePath findPathByName(String[] nodeNames) {
<b class="nc">&nbsp;        TreeNode root = (TreeNode)m_treeRAT.getModel().getRoot();</b>
<b class="nc">&nbsp;        return findNextNode(new TreePath(root), nodeNames, 0);</b>
&nbsp;    }
&nbsp;    
&nbsp;    private TreePath findNextNode(TreePath parent, String[] nodes, int depth) {
<b class="nc">&nbsp;        TreeNode node = (TreeNode)parent.getLastPathComponent();</b>
<b class="nc">&nbsp;        String currNode = node.toString();</b>
&nbsp;
&nbsp;        // If equal, go down the branch
<b class="nc">&nbsp;        if (currNode.equals(nodes[depth].trim())) {</b>
&nbsp;            // If at end, return match
<b class="nc">&nbsp;            if (depth == nodes.length-1) {</b>
<b class="nc">&nbsp;                return parent;</b>
&nbsp;            }
&nbsp;
&nbsp;            // Traverse children
<b class="nc">&nbsp;            if (node.getChildCount() &gt;= 0) {</b>
<b class="nc">&nbsp;                for (Enumeration&lt;?&gt; e = node.children(); e.hasMoreElements(); ) {</b>
<b class="nc">&nbsp;                    TreeNode n = (TreeNode)e.nextElement();</b>
<b class="nc">&nbsp;                    TreePath path = parent.pathByAddingChild(n);</b>
<b class="nc">&nbsp;                    TreePath result = findNextNode(path, nodes, depth + 1);</b>
&nbsp;                    // Found a match
<b class="nc">&nbsp;                    if (result != null) {</b>
<b class="nc">&nbsp;                        return result;</b>
&nbsp;                    }
<b class="nc">&nbsp;                }</b>
&nbsp;            }
&nbsp;        }
&nbsp;        // No match at this branch
<b class="nc">&nbsp;        return null;</b>
&nbsp;    }
&nbsp;    
&nbsp;    @SuppressWarnings(&quot;unchecked&quot;)
&nbsp;    private void generateRAT() {
<b class="nc">&nbsp;    	FactionRecord fRec = m_pRATGenOptions.getFaction();</b>
<b class="nc">&nbsp;    	if (fRec != null) {</b>
<b class="nc">&nbsp;			generatedRAT = UnitTable.findTable(fRec, m_pRATGenOptions.getUnitType(),</b>
<b class="nc">&nbsp;			        m_pRATGenOptions.getYear(), m_pRATGenOptions.getRating(),</b>
<b class="nc">&nbsp;			        (List&lt;Integer&gt;) m_pRATGenOptions.getListOption(&quot;weightClasses&quot;),</b>
<b class="nc">&nbsp;					m_pRATGenOptions.getIntegerOption(&quot;networkMask&quot;),</b>
<b class="nc">&nbsp;					(List&lt;EntityMovementMode&gt;) m_pRATGenOptions.getListOption(&quot;motiveTypes&quot;),</b>
<b class="nc">&nbsp;					(List&lt;MissionRole&gt;) m_pRATGenOptions.getListOption(&quot;roles&quot;),</b>
<b class="nc">&nbsp;					m_pRATGenOptions.getIntegerOption(&quot;roleStrictness&quot;));</b>
<b class="nc">&nbsp;			ratModel.refreshData();</b>
&nbsp;    	}
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public void setVisible(boolean show) {
<b class="nc">&nbsp;        if (show) {</b>
<b class="nc">&nbsp;            updatePlayerChoice();</b>
<b class="nc">&nbsp;            updateTechChoice();</b>
<b class="nc">&nbsp;            updateRATs();</b>
&nbsp;        }
<b class="nc">&nbsp;        super.setVisible(show);</b>
&nbsp;    }
&nbsp;
&nbsp;    private void autoSetSkillsAndName(Entity e) {
<b class="nc">&nbsp;        IClientPreferences cs = PreferenceManager.getClientPreferences();</b>
<b class="nc">&nbsp;        for (int i = 0; i &lt; e.getCrew().getSlotCount(); i++) {</b>
<b class="nc">&nbsp;            if (cs.useAverageSkills()) {</b>
<b class="nc">&nbsp;                int[] skills = m_client.getRandomSkillsGenerator().getRandomSkills(e, true);</b>
&nbsp;    
<b class="nc">&nbsp;                int gunnery = skills[0];</b>
<b class="nc">&nbsp;                int piloting = skills[1];</b>
&nbsp;    
<b class="nc">&nbsp;                e.getCrew().setGunnery(gunnery, i);</b>
<b class="nc">&nbsp;                e.getCrew().setPiloting(piloting, i);</b>
&nbsp;
<b class="nc">&nbsp;                if (e.getCrew() instanceof LAMPilot) {</b>
<b class="nc">&nbsp;                    skills = m_client.getRandomSkillsGenerator().getRandomSkills(e, true);</b>
<b class="nc">&nbsp;                    ((LAMPilot) e.getCrew()).setGunneryAero(skills[0]);</b>
<b class="nc">&nbsp;                    ((LAMPilot) e.getCrew()).setPilotingAero(skills[1]);</b>
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            e.getCrew().sortRandomSkills();</b>
<b class="nc">&nbsp;            if (cs.generateNames()) {</b>
<b class="nc">&nbsp;                Gender gender = RandomGenderGenerator.generate();</b>
<b class="nc">&nbsp;                e.getCrew().setGender(gender, i);</b>
<b class="nc">&nbsp;                e.getCrew().setName(RandomNameGenerator.getInstance().generate(gender, (String) m_chPlayer.getSelectedItem()), i);</b>
&nbsp;            }
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * This class now listens for game settings changes and updates the RAT year whenever
&nbsp;     * the game year changes. Well, whenever any game settings changes.
&nbsp;     */
<b class="nc">&nbsp;    private GameListener gameListener = new GameListenerAdapter() {</b>
&nbsp;        @Override
&nbsp;        public void gameSettingsChange(GameSettingsChangeEvent e) {
<b class="nc">&nbsp;            if(!e.isMapSettingsOnlyChange()) {</b>
<b class="nc">&nbsp;                updateRATYear();</b>
&nbsp;            }
&nbsp;        }
&nbsp;    };
&nbsp;    
&nbsp;    /**
&nbsp;     * A table model for displaying units
&nbsp;     */
&nbsp;    public static class UnitTableModel extends AbstractTableModel {
&nbsp;
&nbsp;        private static final long serialVersionUID = 4819661751806908535L;
&nbsp;
&nbsp;        private static final int COL_UNIT = 0;
&nbsp;        private static final int COL_BV = 1;
&nbsp;        private static final int COL_MOVE = 2;
&nbsp;        private static final int N_COL = 3;
&nbsp;
&nbsp;        private List&lt;MechSummary&gt; data;
&nbsp;
<b class="nc">&nbsp;        public UnitTableModel() {</b>
<b class="nc">&nbsp;            data = new ArrayList&lt;&gt;();</b>
&nbsp;        }
&nbsp;
&nbsp;        public int getRowCount() {
<b class="nc">&nbsp;            return data.size();</b>
&nbsp;        }
&nbsp;
&nbsp;        public void clearData() {
<b class="nc">&nbsp;            data = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;            fireTableDataChanged();</b>
&nbsp;        }
&nbsp;
&nbsp;        public int getColumnCount() {
<b class="nc">&nbsp;            return N_COL;</b>
&nbsp;        }
&nbsp;
&nbsp;        public void addUnit(MechSummary m) {
<b class="nc">&nbsp;            data.add(m);</b>
<b class="nc">&nbsp;            fireTableDataChanged();</b>
&nbsp;        }
&nbsp;
&nbsp;        public void setData(List&lt;MechSummary&gt; mechs) {
<b class="nc">&nbsp;            data = mechs;</b>
<b class="nc">&nbsp;            fireTableDataChanged();</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public String getColumnName(int column) {
<b class="nc">&nbsp;            switch (column) {</b>
&nbsp;                case (COL_UNIT):
<b class="nc">&nbsp;                    return Messages.getString(&quot;RandomArmyDialog.colUnit&quot;);</b>
&nbsp;                case (COL_MOVE):
<b class="nc">&nbsp;                    return Messages.getString(&quot;RandomArmyDialog.colMove&quot;);</b>
&nbsp;                case (COL_BV):
<b class="nc">&nbsp;                    return Messages.getString(&quot;RandomArmyDialog.colBV&quot;);</b>
&nbsp;            }
<b class="nc">&nbsp;            return &quot;??&quot;;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public Class&lt;?&gt; getColumnClass(int c) {
<b class="nc">&nbsp;            return getValueAt(0, c).getClass();</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public boolean isCellEditable(int row, int col) {
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;
&nbsp;        public Object getValueAt(int row, int col) {
<b class="nc">&nbsp;            MechSummary m = getUnitAt(row);</b>
<b class="nc">&nbsp;            String value = &quot;&quot;;</b>
<b class="nc">&nbsp;            if (col == COL_BV) {</b>
<b class="nc">&nbsp;                value += m.getBV();</b>
<b class="nc">&nbsp;            } else if (col == COL_MOVE) {</b>
<b class="nc">&nbsp;                value += m.getWalkMp() + &quot;/&quot; + m.getRunMp() + &quot;/&quot; + m.getJumpMp();</b>
&nbsp;            } else {
<b class="nc">&nbsp;                return m.getName();</b>
&nbsp;            }
<b class="nc">&nbsp;            return value;</b>
&nbsp;        }
&nbsp;
&nbsp;        public MechSummary getUnitAt(int row) {
<b class="nc">&nbsp;            return data.get(row);</b>
&nbsp;        }
&nbsp;
&nbsp;        public List&lt;MechSummary&gt; getAllUnits() {
<b class="nc">&nbsp;            return data;</b>
&nbsp;        }
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * A table model for displaying a generated RAT
&nbsp;     */
<b class="nc">&nbsp;    public class RATTableModel extends AbstractTableModel {</b>
&nbsp;
&nbsp;        /**
&nbsp;		 * 
&nbsp;		 */
&nbsp;		private static final long serialVersionUID = 7807207311532173654L;
&nbsp;		
&nbsp;		private static final int COL_WEIGHT = 0;
&nbsp;        private static final int COL_UNIT = 1;
&nbsp;        private static final int COL_BV = 2;
&nbsp;        private static final int N_COL = 3;
&nbsp;
&nbsp;        public int getRowCount() {
<b class="nc">&nbsp;        	if (generatedRAT == null) {</b>
<b class="nc">&nbsp;        		return 0;</b>
&nbsp;        	}
<b class="nc">&nbsp;            return generatedRAT.getNumEntries();</b>
&nbsp;        }
&nbsp;
&nbsp;        public void refreshData() {
<b class="nc">&nbsp;            fireTableDataChanged();</b>
&nbsp;        }
&nbsp;
&nbsp;        public int getColumnCount() {
<b class="nc">&nbsp;            return N_COL;</b>
&nbsp;        }
&nbsp;        
&nbsp;        public int getPreferredWidth(int col) {
<b class="nc">&nbsp;        	switch (col) {</b>
&nbsp;        	case COL_WEIGHT:
<b class="nc">&nbsp;        		return 12;</b>
&nbsp;        	case COL_UNIT:
<b class="nc">&nbsp;        		return 240;</b>
&nbsp;        	case COL_BV:
<b class="nc">&nbsp;        		return 18;</b>
&nbsp;        	}
<b class="nc">&nbsp;        	return 0;</b>
&nbsp;        }
&nbsp;        
&nbsp;        @Override
&nbsp;        public String getColumnName(int column) {
<b class="nc">&nbsp;            switch (column) {</b>
&nbsp;                case (COL_WEIGHT):
<b class="nc">&nbsp;                    return Messages.getString(&quot;RandomArmyDialog.colWeight&quot;);</b>
&nbsp;                case (COL_UNIT):
<b class="nc">&nbsp;                    return Messages.getString(&quot;RandomArmyDialog.colUnit&quot;);</b>
&nbsp;                case (COL_BV):
<b class="nc">&nbsp;                    return Messages.getString(&quot;RandomArmyDialog.colBV&quot;);</b>
&nbsp;            }
<b class="nc">&nbsp;            return &quot;??&quot;;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public Class&lt;?&gt; getColumnClass(int c) {
<b class="nc">&nbsp;            return getValueAt(0, c).getClass();</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public boolean isCellEditable(int row, int col) {
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;
&nbsp;        public Object getValueAt(int row, int col) {
<b class="nc">&nbsp;        	if (generatedRAT != null) {</b>
<b class="nc">&nbsp;		    	switch (col) {</b>
&nbsp;		    	case COL_WEIGHT:
<b class="nc">&nbsp;		    		return generatedRAT.getEntryWeight(row);</b>
&nbsp;		    	case COL_UNIT:
<b class="nc">&nbsp;		    		return generatedRAT.getEntryText(row);</b>
&nbsp;		    	case COL_BV:
<b class="nc">&nbsp;		    		int bv = generatedRAT.getBV(row);</b>
<b class="nc">&nbsp;		    		if (bv &gt; 0) {</b>
<b class="nc">&nbsp;		    			return String.valueOf(bv);</b>
&nbsp;		    		}
&nbsp;		    	}
&nbsp;        	}
<b class="nc">&nbsp;		   	return &quot;&quot;;</b>
&nbsp;        }
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2023-05-16 16:28</div>
</div>
</body>
</html>
