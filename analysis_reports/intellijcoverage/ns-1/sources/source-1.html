


<!DOCTYPE html>
<html id="htmlId">
<head>
  <title>Coverage Report > MegaMek</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">megamek</a>
</div>

<h1>Coverage Summary for Class: MegaMek (megamek)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">MegaMek</td>
<td class="coverageStat">
  <span class="percent">
    10.5%
  </span>
  <span class="absValue">
    (2/19)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    3.7%
  </span>
  <span class="absValue">
    (6/161)
  </span>
</td>
</tr>
  <tr>
    <td class="name">MegaMek$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MegaMek$CommandLineParser</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/18)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/233)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    5.1%
  </span>
  <span class="absValue">
    (2/39)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    1.5%
  </span>
  <span class="absValue">
    (6/398)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;/*
&nbsp; * MegaMek - Copyright (C) 2005, 2006 Ben Mazur (bmazur@sev.org)
&nbsp; * Copyright © 2013 Edward Cullen (eddy@obsessedcomputers.co.uk)
&nbsp; *
&nbsp; *  This program is free software; you can redistribute it and/or modify it
&nbsp; *  under the terms of the GNU General Public License as published by the Free
&nbsp; *  Software Foundation; either version 2 of the License, or (at your option)
&nbsp; *  any later version.
&nbsp; *
&nbsp; *  This program is distributed in the hope that it will be useful, but
&nbsp; *  WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
&nbsp; *  or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License
&nbsp; *  for more details.
&nbsp; */
&nbsp;package megamek;
&nbsp;
&nbsp;import java.io.*;
&nbsp;import java.security.DigestInputStream;
&nbsp;import java.security.MessageDigest;
&nbsp;import java.security.NoSuchAlgorithmException;
&nbsp;import java.text.NumberFormat;
&nbsp;import java.time.LocalDate;
&nbsp;import java.util.Date;
&nbsp;import java.util.Properties;
&nbsp;import java.util.Vector;
&nbsp;
&nbsp;import megamek.client.ui.IMegaMekGUI;
&nbsp;import megamek.client.ui.swing.ButtonOrderPreferences;
&nbsp;import megamek.common.Aero;
&nbsp;import megamek.common.AlphaStrikeElement;
&nbsp;import megamek.common.BattleArmor;
&nbsp;import megamek.common.BattleForceElement;
&nbsp;import megamek.common.Configuration;
&nbsp;import megamek.common.Entity;
&nbsp;import megamek.common.GunEmplacement;
&nbsp;import megamek.common.Mech;
&nbsp;import megamek.common.MechFileParser;
&nbsp;import megamek.common.MechSummary;
&nbsp;import megamek.common.MechSummaryCache;
&nbsp;import megamek.common.MechView;
&nbsp;import megamek.common.Tank;
&nbsp;import megamek.common.TechConstants;
&nbsp;import megamek.common.annotations.Nullable;
&nbsp;import megamek.common.logging.DefaultMmLogger;
&nbsp;import megamek.common.logging.LogConfig;
&nbsp;import megamek.common.logging.MMLogger;
&nbsp;import megamek.common.preference.PreferenceManager;
&nbsp;import megamek.common.util.AbstractCommandLineParser;
&nbsp;import megamek.common.util.fileUtils.MegaMekFile;
&nbsp;import megamek.common.verifier.EntityVerifier;
&nbsp;import megamek.common.verifier.TestAero;
&nbsp;import megamek.common.verifier.TestBattleArmor;
&nbsp;import megamek.common.verifier.TestEntity;
&nbsp;import megamek.common.verifier.TestMech;
&nbsp;import megamek.common.verifier.TestSupportVehicle;
&nbsp;import megamek.common.verifier.TestTank;
&nbsp;import megamek.server.DedicatedServer;
&nbsp;import megamek.utils.RATGeneratorEditor;
&nbsp;
&nbsp;/**
&nbsp; * @author mev This is the class where the execution of the megamek game starts.
&nbsp; */
<b class="fc">&nbsp;public class MegaMek {</b>
<b class="fc">&nbsp;    private static MMLogger logger = null;</b>
&nbsp;
<b class="fc">&nbsp;    public static String VERSION = &quot;0.48.0&quot;;</b>
<b class="fc">&nbsp;    public static long TIMESTAMP = new File(PreferenceManager.getClientPreferences().getLogDirectory()</b>
<b class="fc">&nbsp;            + File.separator + &quot;timestamp&quot;).lastModified();</b>
&nbsp;
<b class="fc">&nbsp;    private static final NumberFormat commafy = NumberFormat.getInstance();</b>
&nbsp;    private static final String INCORRECT_ARGUMENTS_MESSAGE = &quot;Incorrect arguments:&quot;;
&nbsp;    private static final String ARGUMENTS_DESCRIPTION_MESSAGE = &quot;Arguments syntax:\n\t MegaMek &quot;
&nbsp;            + &quot;[-log &lt;logfile&gt;] [(-gui &lt;guiname&gt;)|(-dedicated)|(-validate)|(-export)|(-eqdb)|&quot;
&nbsp;            + &quot;(-eqedb) (-oul)] [&lt;args&gt;]&quot;;
&nbsp;    private static final String UNKNOWN_GUI_MESSAGE = &quot;Unknown GUI:&quot;;
&nbsp;    private static final String GUI_CLASS_NOT_FOUND_MESSAGE = &quot;Couldn&#39;t find the GUI Class:&quot;;
&nbsp;    public static final String DEFAULT_LOG_FILE_NAME = &quot;megameklog.txt&quot;;
&nbsp;
&nbsp;    public static void main(String[] args) {
<b class="nc">&nbsp;        String logFileName = DEFAULT_LOG_FILE_NAME;</b>
<b class="nc">&nbsp;        CommandLineParser cp = new CommandLineParser(args);</b>
&nbsp;
&nbsp;        try {
<b class="nc">&nbsp;            cp.parse();</b>
<b class="nc">&nbsp;            String lf = cp.getLogFilename();</b>
<b class="nc">&nbsp;            if (lf != null) {</b>
<b class="nc">&nbsp;                if (lf.equals(&quot;none&quot;) || lf.equals(&quot;off&quot;)) {</b>
<b class="nc">&nbsp;                    logFileName = null;</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    logFileName = lf;</b>
&nbsp;                }
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            configureLogging(logFileName);</b>
&nbsp;
<b class="nc">&nbsp;            MegaMek.showInfo();</b>
&nbsp;
<b class="nc">&nbsp;            String[] restArgs = cp.getRestArgs();</b>
<b class="nc">&nbsp;            if (cp.dedicatedServer()) {</b>
<b class="nc">&nbsp;                MegaMek.startDedicatedServer(restArgs);</b>
<b class="nc">&nbsp;            } else if (cp.ratGenEditor()) {</b>
<b class="nc">&nbsp;                RATGeneratorEditor.main(restArgs);</b>
&nbsp;            } else {
&nbsp;                // Load button ordering
<b class="nc">&nbsp;                ButtonOrderPreferences.getInstance().setButtonPriorities();</b>
&nbsp;
<b class="nc">&nbsp;                String interfaceName = cp.getGuiName();</b>
<b class="nc">&nbsp;                if (interfaceName == null) {</b>
<b class="nc">&nbsp;                    interfaceName = PreferenceManager.getClientPreferences().getGUIName();</b>
&nbsp;                }
<b class="nc">&nbsp;                MegaMek.startGUI(interfaceName, restArgs);</b>
&nbsp;            }
<b class="nc">&nbsp;        } catch (CommandLineParser.ParseException e) {</b>
<b class="nc">&nbsp;            String message = INCORRECT_ARGUMENTS_MESSAGE + e.getMessage() + &#39;\n&#39;</b>
&nbsp;                    + ARGUMENTS_DESCRIPTION_MESSAGE;
<b class="nc">&nbsp;            getLogger().fatal(message);</b>
<b class="nc">&nbsp;            System.exit(1);</b>
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    private static void configureLegacyLogging(@Nullable final String logFileName) {
&nbsp;        // Redirect output to log files, unless turned off.
<b class="nc">&nbsp;        if (logFileName == null) {</b>
<b class="nc">&nbsp;            return;</b>
&nbsp;        }
<b class="nc">&nbsp;        MegaMek.redirectOutput(logFileName);</b>
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    private static void configureLog4j(@Nullable final String logFileName) {
<b class="nc">&nbsp;        if (null == logFileName) {</b>
<b class="nc">&nbsp;            LogConfig.getInstance().disableAll();</b>
<b class="nc">&nbsp;            return;</b>
&nbsp;        }
<b class="nc">&nbsp;        LogConfig.getInstance().enableSimplifiedLogging();</b>
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    /**
&nbsp;     * This needs to be done as we are currently using two different loggers.
&nbsp;     * Both loggers must be set to append in order to prevent them from over-
&nbsp;     * writing each other.  So, in order to get a clean log file each run,
&nbsp;     * the existing log file must be cleared.
&nbsp;     * &lt;p&gt;Alternatively, consider rolling the log file over instead.&lt;/p&gt;
&nbsp;     * If we ever manage to completely get rid of the legacy logger, we can
&nbsp;     * get rid of this method.
&nbsp;     *
&nbsp;     * @param logFileName The name of the log file to reset.
&nbsp;     */
&nbsp;    public static void resetLogFile(@Nullable final String logFileName) {
<b class="nc">&nbsp;        if (null == logFileName) {</b>
<b class="nc">&nbsp;            return;</b>
&nbsp;        }
<b class="nc">&nbsp;        File file = new File(logFileName);</b>
<b class="nc">&nbsp;        if (file.exists()) {</b>
<b class="nc">&nbsp;            try (PrintWriter writer = new PrintWriter(file)) {</b>
<b class="nc">&nbsp;                writer.print(&quot;&quot;);</b>
<b class="nc">&nbsp;            } catch (FileNotFoundException e) {</b>
<b class="nc">&nbsp;                getLogger().error(e);</b>
<b class="nc">&nbsp;            }</b>
&nbsp;        }
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    private static void configureLogging(@Nullable final String logFileName) {
<b class="nc">&nbsp;        final String qualifiedLogFilename = PreferenceManager.getClientPreferences().getLogDirectory()</b>
&nbsp;                + File.separator + logFileName;
<b class="nc">&nbsp;        resetLogFile(qualifiedLogFilename);</b>
<b class="nc">&nbsp;        configureLegacyLogging(logFileName);</b>
<b class="nc">&nbsp;        configureLog4j(logFileName);</b>
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    /**
&nbsp;     * @param logger The logger to be used.
&nbsp;     */
&nbsp;    public static void setLogger(final MMLogger logger) {
<b class="nc">&nbsp;        MegaMek.logger = logger;</b>
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    /**
&nbsp;     * @return The logger that will handle log file output.  Will return the
&nbsp;     * {@link DefaultMmLogger} if a different logger has not been set.
&nbsp;     */
&nbsp;    public static MMLogger getLogger() {
<b class="nc">&nbsp;        if (null == logger) {</b>
<b class="nc">&nbsp;            logger = DefaultMmLogger.getInstance();</b>
&nbsp;        }
<b class="nc">&nbsp;        return logger;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Calculates the SHA-256 hash of the MegaMek.jar file
&nbsp;     * Used primarily for purposes of checksum comparison when
&nbsp;     * connecting a new client.
&nbsp;     * @return String representing the SHA-256 hash
&nbsp;     */
&nbsp;    public static String getMegaMekSHA256() {
<b class="nc">&nbsp;        StringBuilder sb = new StringBuilder();</b>
<b class="nc">&nbsp;        byte[] buffer = new byte[8192];</b>
&nbsp;
&nbsp;        // Assume UNIX/Linux, which has the jar in the root folder
<b class="nc">&nbsp;        String filename = &quot;MegaMek.jar&quot;;</b>
&nbsp;        // If it isn&#39;t UNIX/Linux, maybe it&#39;s Windows where we&#39;ve stashed it in the lib folder
<b class="nc">&nbsp;        if (new File(&quot;lib/&quot; + filename).exists()) {</b>
<b class="nc">&nbsp;            filename = &quot;lib/&quot; + filename;</b>
&nbsp;            // And if it isn&#39;t either UNIX/Linux or Windows it&#39;s got to be Mac, where it&#39;s buried inside the app
<b class="nc">&nbsp;        } else if (new File(&quot;MegaMek.app/Contents/Resources/Java/&quot; + filename).exists()) {</b>
<b class="nc">&nbsp;            filename = &quot;MegaMek.app/Contents/Resources/Java/&quot; + filename;</b>
&nbsp;        }
&nbsp;
&nbsp;        MessageDigest md;
&nbsp;        // Calculate the digest for the given file.
&nbsp;        try {
<b class="nc">&nbsp;            md = MessageDigest.getInstance(&quot;SHA-256&quot;);</b>
<b class="nc">&nbsp;        } catch (NoSuchAlgorithmException e) {</b>
<b class="nc">&nbsp;            getLogger().error(e);</b>
<b class="nc">&nbsp;            return null;</b>
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;        try (InputStream is = new FileInputStream(filename);</b>
<b class="nc">&nbsp;             InputStream dis = new DigestInputStream(is, md)) {</b>
<b class="nc">&nbsp;            while (0 &lt; dis.read(buffer)) { }</b>
&nbsp;            // gets digest
<b class="nc">&nbsp;            byte[] digest = md.digest();</b>
&nbsp;            // convert the byte to hex format
<b class="nc">&nbsp;            for (byte d : digest) {</b>
<b class="nc">&nbsp;                sb.append(String.format(&quot;%02x&quot;, d));</b>
&nbsp;            }
<b class="nc">&nbsp;        } catch (IOException e) {</b>
<b class="nc">&nbsp;            getLogger().error(e);</b>
<b class="nc">&nbsp;            return null;</b>
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;        return sb.toString();</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * This function returns the memory used in the heap (heap memory - free
&nbsp;     * memory).
&nbsp;     *
&nbsp;     * @return memory used in kB
&nbsp;     */
&nbsp;    public static String getMemoryUsed() {
<b class="nc">&nbsp;        long heap = Runtime.getRuntime().totalMemory();</b>
<b class="nc">&nbsp;        long free = Runtime.getRuntime().freeMemory();</b>
<b class="nc">&nbsp;        return commafy.format((heap - free) / 1024) + &quot; kB&quot;;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * This function redirects the standard error and output streams to the
&nbsp;     * given File name.
&nbsp;     *
&nbsp;     * @param logFileName The file name to redirect to.
&nbsp;     */
&nbsp;    private static void redirectOutput(String logFileName) {
<b class="nc">&nbsp;        getLogger().info(&quot;Redirecting output to &quot; + logFileName);</b>
<b class="nc">&nbsp;        String sLogDir = PreferenceManager.getClientPreferences().getLogDirectory();</b>
<b class="nc">&nbsp;        File logDir = new File(sLogDir);</b>
<b class="nc">&nbsp;        if (!logDir.exists()) {</b>
<b class="nc">&nbsp;            if (!logDir.mkdir()) {</b>
<b class="nc">&nbsp;                getLogger().error(&quot;Error in creating directory ./logs. We know this is annoying, and apologise. &quot;</b>
&nbsp;                                + &quot;Please submit a bug report at https://github.com/MegaMek/megamek/issues &quot;
&nbsp;                                + &quot; and we will try to resolve your issue.&quot;);
&nbsp;            }
&nbsp;        }
&nbsp;        try {
<b class="nc">&nbsp;            PrintStream ps = new PrintStream(</b>
&nbsp;                    new BufferedOutputStream(new FileOutputStream(sLogDir
<b class="nc">&nbsp;                            + File.separator + logFileName, true) {</b>
&nbsp;                        @Override
&nbsp;                        public void flush() throws IOException {
<b class="nc">&nbsp;                            super.flush();</b>
<b class="nc">&nbsp;                            getFD().sync();</b>
<b class="nc">&nbsp;                        }</b>
&nbsp;                    }, 64));
<b class="nc">&nbsp;            System.setOut(ps);</b>
<b class="nc">&nbsp;            System.setErr(ps);</b>
<b class="nc">&nbsp;        } catch (Exception e) {</b>
<b class="nc">&nbsp;            getLogger().error(&quot;Unable to redirect output to &quot; + logFileName, e);</b>
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    /**
&nbsp;     * Starts a dedicated server with the arguments in args. See
&nbsp;     * {@link megamek.server.DedicatedServer#start(String[])} for more
&nbsp;     * information.
&nbsp;     *
&nbsp;     * @param args the arguments to the dedicated server.
&nbsp;     */
&nbsp;    private static void startDedicatedServer(String[] args) {
<b class="nc">&nbsp;        StringBuffer message = new StringBuffer(&quot;Starting Dedicated Server. &quot;);</b>
<b class="nc">&nbsp;        MegaMek.dumpArgs(message, args);</b>
<b class="nc">&nbsp;        getLogger().info(message.toString());</b>
<b class="nc">&nbsp;        DedicatedServer.start(args);</b>
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    /**
&nbsp;     * Attempts to start the GUI with the given name. If the GUI is unknown the
&nbsp;     * program will exit.
&nbsp;     *
&nbsp;     * @param guiName The name of the GUI, usually AWT or swing
&nbsp;     * @param args    The arguments to be passed onto the GUI.
&nbsp;     */
&nbsp;    private static void startGUI(String guiName, String[] args) {
<b class="nc">&nbsp;        if (null == guiName) {</b>
<b class="nc">&nbsp;            getLogger().error(&quot;guiName must be non-null&quot;);</b>
<b class="nc">&nbsp;            return;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (null == args) {</b>
<b class="nc">&nbsp;            getLogger().error(&quot;args must be non-null&quot;);</b>
<b class="nc">&nbsp;            return;</b>
&nbsp;        }
<b class="nc">&nbsp;        IMegaMekGUI mainGui = MegaMek.getGui(guiName);</b>
<b class="nc">&nbsp;        if (mainGui == null) {</b>
<b class="nc">&nbsp;            getLogger().fatal(UNKNOWN_GUI_MESSAGE + guiName);</b>
<b class="nc">&nbsp;            System.exit(1);</b>
&nbsp;        } else {
<b class="nc">&nbsp;            StringBuffer message = new StringBuffer(&quot;Starting GUI &quot;);</b>
<b class="nc">&nbsp;            message.append(guiName).append(&quot;. &quot;);</b>
<b class="nc">&nbsp;            MegaMek.dumpArgs(message, args);</b>
<b class="nc">&nbsp;            getLogger().info(message.toString());</b>
<b class="nc">&nbsp;            mainGui.start(args);</b>
&nbsp;        }
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    /**
&nbsp;     * Return the Interface to the GUI specified by the name in guiName.
&nbsp;     *
&nbsp;     * @param guiName the name of the GUI, will be passed on to
&nbsp;     *                {@link #getGUIClassName(String)}.
&nbsp;     * @return An that can start a GUI such as {@link IMegaMekGUI}.
&nbsp;     */
&nbsp;    @SuppressWarnings({ &quot;rawtypes&quot; })
&nbsp;    private static IMegaMekGUI getGui(String guiName) {
<b class="nc">&nbsp;        assert (guiName != null) : &quot;guiName must be non-null&quot;;</b>
<b class="nc">&nbsp;        String guiClassName = MegaMek.getGUIClassName(guiName);</b>
<b class="nc">&nbsp;        if (guiClassName != null) {</b>
&nbsp;            try {
<b class="nc">&nbsp;                Class guiClass = Class.forName(guiClassName);</b>
<b class="nc">&nbsp;                if (IMegaMekGUI.class.isAssignableFrom(guiClass)) {</b>
<b class="nc">&nbsp;                    return (IMegaMekGUI) guiClass.newInstance();</b>
&nbsp;                }
<b class="nc">&nbsp;            } catch (Exception e) {</b>
<b class="nc">&nbsp;                getLogger().info(GUI_CLASS_NOT_FOUND_MESSAGE + guiClassName);</b>
<b class="nc">&nbsp;            }</b>
&nbsp;        }
<b class="nc">&nbsp;        return null;</b>
&nbsp;    }
&nbsp;
&nbsp;    private static String getGUIClassName(String guiName) {
<b class="nc">&nbsp;        assert (guiName != null) : &quot;guiName must be non-null&quot;;</b>
<b class="nc">&nbsp;        Properties p = new Properties();</b>
<b class="nc">&nbsp;        String key = &quot;gui.&quot; + guiName;</b>
<b class="nc">&nbsp;        final String PROPERTIES_FILE = &quot;megamek/MegaMek.properties&quot;;</b>
<b class="nc">&nbsp;        try (InputStream is = MegaMek.class.getClassLoader().getResourceAsStream(PROPERTIES_FILE)) {</b>
<b class="nc">&nbsp;            if (is != null) {</b>
<b class="nc">&nbsp;                p.load(is);</b>
<b class="nc">&nbsp;                return p.getProperty(key);</b>
&nbsp;            }
<b class="nc">&nbsp;        } catch (IOException e) {</b>
<b class="nc">&nbsp;            getLogger().info(&quot;Property file load failed.&quot;);</b>
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;        return null;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * This function appends &#39;args: []&#39;, to the buffer, with a space separated
&nbsp;     * list of args[] elements between the brackets.
&nbsp;     *
&nbsp;     * @param buffer the buffer to append the list to.
&nbsp;     * @param args   the array of strings to copy into a space separated list.
&nbsp;     */
&nbsp;    private static void dumpArgs(StringBuffer buffer, String[] args) {
<b class="nc">&nbsp;        assert (buffer != null) : &quot;buffer must be non-null&quot;;</b>
<b class="nc">&nbsp;        assert (args != null) : &quot;args must be non-null&quot;;</b>
<b class="nc">&nbsp;        buffer.append(&quot;args: [&quot;);</b>
<b class="nc">&nbsp;        for (int i = 0, e = args.length; i &lt; e; i++) {</b>
<b class="nc">&nbsp;            if (i != 0) {</b>
<b class="nc">&nbsp;                buffer.append(&#39; &#39;);</b>
&nbsp;            }
<b class="nc">&nbsp;            buffer.append(args[i]);</b>
&nbsp;        }
<b class="nc">&nbsp;        buffer.append(&quot;]&quot;);</b>
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    /**
&nbsp;     * Prints some information about MegaMek. Used in log files to figure out the JVM and
&nbsp;     * version of MegaMek.
&nbsp;     */
&nbsp;    private static void showInfo() {
&nbsp;        // echo some useful stuff
<b class="nc">&nbsp;        String msg = &quot;Starting MegaMek v&quot; + VERSION + &quot; ...&quot; + &quot;\n\tCompiled on &quot; +</b>
<b class="nc">&nbsp;                new Date(TIMESTAMP).toString() + &quot;\n\tToday is &quot; + LocalDate.now().toString() +</b>
<b class="nc">&nbsp;                &quot;\n\tJava vendor &quot; + System.getProperty(&quot;java.vendor&quot;) + &quot;\n\tJava version &quot;</b>
<b class="nc">&nbsp;                + System.getProperty(&quot;java.version&quot;) + &quot;\n\tPlatform &quot; + System.getProperty(&quot;os.name&quot;)</b>
<b class="nc">&nbsp;                + &quot; &quot; + System.getProperty(&quot;os.version&quot;) + &quot; (&quot; + System.getProperty(&quot;os.arch&quot;) + &quot;)&quot;</b>
&nbsp;                + &quot;\n\tTotal memory available to MegaMek: &quot;
<b class="nc">&nbsp;                + MegaMek.commafy.format(Runtime.getRuntime().maxMemory() / 1024) + &quot; kB&quot;;</b>
<b class="nc">&nbsp;        getLogger().info(msg);</b>
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    /**
&nbsp;     * Returns the version of Megamek
&nbsp;     *
&nbsp;     * @return the version of Megamek as a string.
&nbsp;     */
&nbsp;    public static String getVersion() {
<b class="nc">&nbsp;        return VERSION;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * This class parses the options passed into to MegaMek from the command line.
&nbsp;     */
&nbsp;    private static class CommandLineParser extends AbstractCommandLineParser {
&nbsp;        private String logFilename;
&nbsp;        private String guiName;
<b class="nc">&nbsp;        private boolean dedicatedServer = false;</b>
<b class="nc">&nbsp;        private boolean ratGenEditor = false;</b>
<b class="nc">&nbsp;        private String[] restArgs = new String[0];</b>
&nbsp;
&nbsp;        // Options
&nbsp;        private static final String OPTION_DEDICATED = &quot;dedicated&quot;;
&nbsp;        private static final String OPTION_GUI = &quot;gui&quot;;
&nbsp;        private static final String OPTION_LOG = &quot;log&quot;;
&nbsp;        private static final String OPTION_EQUIPMENT_DB = &quot;eqdb&quot;;
&nbsp;        private static final String OPTION_EQUIPMENT_EXTENDED_DB = &quot;eqedb&quot;;
&nbsp;        private static final String OPTION_UNIT_VALIDATOR = &quot;validate&quot;;
&nbsp;        private static final String OPTION_UNIT_EXPORT = &quot;export&quot;;
&nbsp;        private static final String OPTION_OFFICAL_UNIT_LIST = &quot;oul&quot;;
&nbsp;        private static final String OPTION_UNIT_BATTLEFORCE_CONVERSION = &quot;bfc&quot;;
&nbsp;        private static final String OPTION_UNIT_ALPHASTRIKE_CONVERSION = &quot;asc&quot;;
&nbsp;        private static final String OPTION_DATADIR = &quot;data&quot;;
&nbsp;        private static final String OPTION_RATGEN_EDIT = &quot;editratgen&quot;;
&nbsp;
&nbsp;        CommandLineParser(String[] args) {
<b class="nc">&nbsp;            super(args);</b>
&nbsp;        }
&nbsp;
&nbsp;        /**
&nbsp;         * Returns &lt;code&gt;true&lt;/code&gt; if the dedicated server option was found
&nbsp;         *
&nbsp;         * @return true iff this is a dedicated server.
&nbsp;         */
&nbsp;        boolean dedicatedServer() {
<b class="nc">&nbsp;            return dedicatedServer;</b>
&nbsp;        }
&nbsp;
&nbsp;        /**
&nbsp;         * Flag that indicates the option for the RAT Generator editor
&nbsp;         * @return Whether the RAT Generator editor should be invoked
&nbsp;         */
&nbsp;        boolean ratGenEditor() {
<b class="nc">&nbsp;            return ratGenEditor;</b>
&nbsp;        }
&nbsp;
&nbsp;        /**
&nbsp;         * Returns the GUI Name option value or &lt;code&gt;null&lt;/code&gt; if it wasn&#39;t set
&nbsp;         *
&nbsp;         * @return GUI Name option value or &lt;code&gt;null&lt;/code&gt; if it wasn&#39;t set
&nbsp;         */
&nbsp;        String getGuiName() {
<b class="nc">&nbsp;            return guiName;</b>
&nbsp;        }
&nbsp;
&nbsp;        /**
&nbsp;         * Returns the log file name option value or &lt;code&gt;null&lt;/code&gt; if it wasn&#39;t set
&nbsp;         *
&nbsp;         * @return the log file name option value or &lt;code&gt;null&lt;/code&gt; if it wasn&#39;t set
&nbsp;         */
&nbsp;        String getLogFilename() {
<b class="nc">&nbsp;            return logFilename;</b>
&nbsp;        }
&nbsp;
&nbsp;        /**
&nbsp;         * Returns the the &lt;code&gt;array&lt;/code&gt; of the unprocessed arguments
&nbsp;         *
&nbsp;         * @return the the &lt;code&gt;array&lt;/code&gt; of the unprocessed arguments
&nbsp;         */
&nbsp;        String[] getRestArgs() {
<b class="nc">&nbsp;            return restArgs;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        protected void start() throws ParseException {
<b class="nc">&nbsp;            if (getToken() == TOK_OPTION) {</b>
<b class="nc">&nbsp;                final String tokenVal = getTokenValue();</b>
<b class="nc">&nbsp;                nextToken();</b>
<b class="nc">&nbsp;                switch (tokenVal) {</b>
&nbsp;                    case OPTION_LOG:
<b class="nc">&nbsp;                        parseLog();</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    case OPTION_EQUIPMENT_DB:
<b class="nc">&nbsp;                        processEquipmentDb();</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    case OPTION_EQUIPMENT_EXTENDED_DB:
<b class="nc">&nbsp;                        processExtendedEquipmentDb();</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    case OPTION_DATADIR:
<b class="nc">&nbsp;                        processDataDir();</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    case OPTION_UNIT_VALIDATOR:
<b class="nc">&nbsp;                        processUnitValidator();</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    case OPTION_UNIT_EXPORT:
<b class="nc">&nbsp;                        processUnitExporter();</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    case OPTION_OFFICAL_UNIT_LIST:
<b class="nc">&nbsp;                        processUnitExporter(true);</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    case OPTION_UNIT_BATTLEFORCE_CONVERSION:
<b class="nc">&nbsp;                        processUnitBattleForceConverter();</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    case OPTION_UNIT_ALPHASTRIKE_CONVERSION:
<b class="nc">&nbsp;                        processUnitAlphaStrikeConverter();</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    case OPTION_DEDICATED:
<b class="nc">&nbsp;                        dedicatedServer = true;</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    case OPTION_GUI:
<b class="nc">&nbsp;                        parseGUI();</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    case OPTION_RATGEN_EDIT:
<b class="nc">&nbsp;                        ratGenEditor = true;</b>
&nbsp;                        break;
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            processRestOfInput();</b>
<b class="nc">&nbsp;            if (getToken() != TOK_EOF) {</b>
<b class="nc">&nbsp;                throw new ParseException(&quot;unexpected input&quot;);</b>
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;        private void parseLog() throws ParseException {
<b class="nc">&nbsp;            if (getToken() == TOK_LITERAL) {</b>
<b class="nc">&nbsp;                logFilename = getTokenValue();</b>
<b class="nc">&nbsp;                nextToken();</b>
&nbsp;            } else {
<b class="nc">&nbsp;                throw new ParseException(&quot;log file name expected&quot;);</b>
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;        private void parseGUI() throws ParseException {
<b class="nc">&nbsp;            if (getToken() == TOK_LITERAL) {</b>
<b class="nc">&nbsp;                guiName = getTokenValue();</b>
<b class="nc">&nbsp;                nextToken();</b>
&nbsp;            } else {
<b class="nc">&nbsp;                throw new ParseException(&quot;GUI name expected&quot;);</b>
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;        private void processEquipmentDb() throws ParseException {
&nbsp;            String filename;
<b class="nc">&nbsp;            if (getToken() == TOK_LITERAL) {</b>
<b class="nc">&nbsp;                filename = getTokenValue();</b>
<b class="nc">&nbsp;                nextToken();</b>
<b class="nc">&nbsp;                megamek.common.EquipmentType.writeEquipmentDatabase(new File(filename));</b>
&nbsp;            } else {
<b class="nc">&nbsp;                throw new ParseException(&quot;file name expected&quot;);</b>
&nbsp;            }
<b class="nc">&nbsp;            System.exit(0);</b>
&nbsp;        }
&nbsp;
&nbsp;        private void processExtendedEquipmentDb() throws ParseException {
&nbsp;            String filename;
<b class="nc">&nbsp;            if (getToken() == TOK_LITERAL) {</b>
<b class="nc">&nbsp;                filename = getTokenValue();</b>
<b class="nc">&nbsp;                nextToken();</b>
<b class="nc">&nbsp;                megamek.common.EquipmentType.writeEquipmentExtendedDatabase(new File(filename));</b>
&nbsp;            } else {
<b class="nc">&nbsp;                throw new ParseException(&quot;file name expected&quot;);</b>
&nbsp;            }
<b class="nc">&nbsp;            System.exit(0);</b>
&nbsp;        }
&nbsp;
&nbsp;        private void processDataDir() throws ParseException {
&nbsp;            String dataDirName;
<b class="nc">&nbsp;            if (getToken() == TOK_LITERAL) {</b>
<b class="nc">&nbsp;                dataDirName = getTokenValue();</b>
<b class="nc">&nbsp;                nextToken();</b>
<b class="nc">&nbsp;                Configuration.setDataDir(new File(dataDirName));</b>
&nbsp;            } else {
<b class="nc">&nbsp;                throw new ParseException(&quot;directory name expected&quot;);</b>
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;        private void processUnitValidator() throws ParseException {
&nbsp;            String filename;
<b class="nc">&nbsp;            if (getToken() == TOK_LITERAL) {</b>
<b class="nc">&nbsp;                filename = getTokenValue();</b>
<b class="nc">&nbsp;                nextToken();</b>
<b class="nc">&nbsp;                MechSummary ms = MechSummaryCache.getInstance().getMech(filename);</b>
<b class="nc">&nbsp;                if (ms == null) {</b>
<b class="nc">&nbsp;                    MechSummary[] units = MechSummaryCache.getInstance().getAllMechs();</b>
<b class="nc">&nbsp;                    for (MechSummary unit : units) {</b>
<b class="nc">&nbsp;                        if (unit.getSourceFile().getName().equalsIgnoreCase(filename)) {</b>
<b class="nc">&nbsp;                            ms = unit;</b>
<b class="nc">&nbsp;                            break;</b>
&nbsp;                        }
&nbsp;                    }
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                if (ms == null) {</b>
<b class="nc">&nbsp;                    getLogger().error(new IOException(filename + &quot; not found.  Try using \&quot;chassis model\&quot; for input.&quot;));</b>
&nbsp;                } else {
&nbsp;                    try {
<b class="nc">&nbsp;                        Entity entity = new MechFileParser(ms.getSourceFile(),</b>
<b class="nc">&nbsp;                                ms.getEntryName()).getEntity();</b>
<b class="nc">&nbsp;                        getLogger().info(&quot;Validating Entity: &quot; + entity.getShortNameRaw());</b>
<b class="nc">&nbsp;                        EntityVerifier entityVerifier = EntityVerifier.getInstance(</b>
<b class="nc">&nbsp;                                new MegaMekFile(Configuration.unitsDir(),</b>
<b class="nc">&nbsp;                                        EntityVerifier.CONFIG_FILENAME).getFile());</b>
<b class="nc">&nbsp;                        MechView mechView = new MechView(entity, false);</b>
<b class="nc">&nbsp;                        StringBuffer sb = new StringBuffer(mechView.getMechReadout());</b>
<b class="nc">&nbsp;                        if ((entity instanceof Mech) || (entity instanceof Tank)</b>
&nbsp;                                || (entity instanceof Aero) || (entity instanceof BattleArmor)) {
<b class="nc">&nbsp;                            TestEntity testEntity = null;</b>
<b class="nc">&nbsp;                            if (entity instanceof Mech) {</b>
<b class="nc">&nbsp;                                testEntity = new TestMech((Mech) entity, entityVerifier.mechOption,</b>
&nbsp;                                        null);
<b class="nc">&nbsp;                            } else if ((entity instanceof Tank) &amp;&amp; !(entity instanceof GunEmplacement)) {</b>
<b class="nc">&nbsp;                                if (entity.isSupportVehicle()) {</b>
<b class="nc">&nbsp;                                    testEntity = new TestSupportVehicle(entity,</b>
&nbsp;                                            entityVerifier.tankOption, null);
&nbsp;                                } else {
<b class="nc">&nbsp;                                    testEntity = new TestTank((Tank) entity,</b>
&nbsp;                                            entityVerifier.tankOption, null);
&nbsp;                                }
<b class="nc">&nbsp;                            } else if ((entity.getEntityType() == Entity.ETYPE_AERO)</b>
<b class="nc">&nbsp;                                    &amp;&amp; (entity.getEntityType() != Entity.ETYPE_DROPSHIP)</b>
<b class="nc">&nbsp;                                    &amp;&amp; (entity.getEntityType() != Entity.ETYPE_SMALL_CRAFT)</b>
<b class="nc">&nbsp;                                    &amp;&amp; (entity.getEntityType() != Entity.ETYPE_FIGHTER_SQUADRON)</b>
<b class="nc">&nbsp;                                    &amp;&amp; (entity.getEntityType() != Entity.ETYPE_JUMPSHIP)</b>
<b class="nc">&nbsp;                                    &amp;&amp; (entity.getEntityType() != Entity.ETYPE_SPACE_STATION)) {</b>
<b class="nc">&nbsp;                                testEntity = new TestAero((Aero) entity,</b>
&nbsp;                                        entityVerifier.aeroOption, null);
<b class="nc">&nbsp;                            } else if (entity instanceof BattleArmor){</b>
<b class="nc">&nbsp;                                testEntity = new TestBattleArmor((BattleArmor) entity,</b>
&nbsp;                                        entityVerifier.baOption, null);
&nbsp;                            }
&nbsp;
<b class="nc">&nbsp;                            if (testEntity != null) {</b>
<b class="nc">&nbsp;                                testEntity.correctEntity(sb);</b>
&nbsp;                            }
&nbsp;                        }
<b class="nc">&nbsp;                        getLogger().info(sb.toString());</b>
<b class="nc">&nbsp;                    } catch (Exception ex) {</b>
<b class="nc">&nbsp;                        throw new ParseException(&quot;\&quot;chassis model\&quot; expected as input&quot;);</b>
<b class="nc">&nbsp;                    }</b>
&nbsp;                }
<b class="nc">&nbsp;            } else {</b>
<b class="nc">&nbsp;                throw new ParseException(&quot;\&quot;chassis model\&quot; expected as input&quot;);</b>
&nbsp;            }
<b class="nc">&nbsp;            System.exit(0);</b>
&nbsp;        }
&nbsp;
&nbsp;        private void processUnitBattleForceConverter() {
&nbsp;            String filename;
<b class="nc">&nbsp;            if (getToken() == TOK_LITERAL) {</b>
<b class="nc">&nbsp;                filename = getTokenValue();</b>
<b class="nc">&nbsp;                nextToken();</b>
&nbsp;
<b class="nc">&nbsp;                if (!new File(&quot;./docs&quot;).exists()) {</b>
<b class="nc">&nbsp;                    if (!new File(&quot;./docs&quot;).mkdir()) {</b>
<b class="nc">&nbsp;                        getLogger().error(</b>
&nbsp;                                &quot;Error in creating directory ./docs. We know this is annoying, and apologise. &quot;
&nbsp;                                        + &quot;Please submit a bug report at https://github.com/MegaMek/megamek/issues &quot;
&nbsp;                                        + &quot; and we will try to resolve your issue.&quot;);
&nbsp;                    }
&nbsp;                }
<b class="nc">&nbsp;                File file = new File(&quot;./docs/&quot; + filename);</b>
<b class="nc">&nbsp;                try (Writer w = new FileWriter(file); BufferedWriter fw = new BufferedWriter(w)) {</b>
<b class="nc">&nbsp;                    fw.write(&quot;Megamek Unit BattleForce Converter&quot;);</b>
<b class="nc">&nbsp;                    fw.newLine();</b>
<b class="nc">&nbsp;                    fw.write(&quot;This file can be regenerated with java -jar MegaMek.jar -bfc filename&quot;);</b>
<b class="nc">&nbsp;                    fw.newLine();</b>
<b class="nc">&nbsp;                    fw.write(&quot;Element\tSize\tMP\tArmor\tStructure\tS/M/L\tOV\tPoint Cost\tAbilities&quot;);</b>
<b class="nc">&nbsp;                    fw.newLine();</b>
&nbsp;
<b class="nc">&nbsp;                    MechSummary[] units = MechSummaryCache.getInstance().getAllMechs();</b>
<b class="nc">&nbsp;                    for (MechSummary unit : units) {</b>
<b class="nc">&nbsp;                        Entity entity = new MechFileParser(unit.getSourceFile(),</b>
<b class="nc">&nbsp;                                unit.getEntryName()).getEntity();</b>
&nbsp;
<b class="nc">&nbsp;                        BattleForceElement bfe = new BattleForceElement(entity);</b>
<b class="nc">&nbsp;                        bfe.writeCsv(fw);</b>
&nbsp;                    }
<b class="nc">&nbsp;                } catch (Exception e) {</b>
<b class="nc">&nbsp;                    getLogger().error(e);</b>
<b class="nc">&nbsp;                }</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            System.exit(0);</b>
&nbsp;        }
&nbsp;
&nbsp;        private void processUnitAlphaStrikeConverter() {
&nbsp;            String filename;
<b class="nc">&nbsp;            if (getToken() == TOK_LITERAL) {</b>
<b class="nc">&nbsp;                filename = getTokenValue();</b>
<b class="nc">&nbsp;                nextToken();</b>
&nbsp;
<b class="nc">&nbsp;                if (!new File(&quot;./docs&quot;).exists()) {</b>
<b class="nc">&nbsp;                    if (!new File(&quot;./docs&quot;).mkdir()) {</b>
<b class="nc">&nbsp;                        getLogger().error(</b>
&nbsp;                                &quot;Error in creating directory ./docs. We know this is annoying, and apologise. &quot;
&nbsp;                                        + &quot;Please submit a bug report at https://github.com/MegaMek/megamek/issues &quot;
&nbsp;                                        + &quot; and we will try to resolve your issue.&quot;);
&nbsp;                    }
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                File file = new File(&quot;./docs/&quot; + filename);</b>
<b class="nc">&nbsp;                try (Writer w = new FileWriter(file); BufferedWriter bw = new BufferedWriter(w)) {</b>
<b class="nc">&nbsp;                    bw.write(&quot;Megamek Unit AlphaStrike Converter&quot;);</b>
<b class="nc">&nbsp;                    bw.newLine();</b>
<b class="nc">&nbsp;                    bw.write(&quot;This file can be regenerated with java -jar MegaMek.jar -asc filename&quot;);</b>
<b class="nc">&nbsp;                    bw.newLine();</b>
<b class="nc">&nbsp;                    bw.write(&quot;Element\tType\tSize\tMP\tArmor\tStructure\tS/M/L\tOV\tPoint Cost\tAbilities&quot;);</b>
<b class="nc">&nbsp;                    bw.newLine();</b>
&nbsp;
<b class="nc">&nbsp;                    MechSummary[] units = MechSummaryCache.getInstance().getAllMechs();</b>
<b class="nc">&nbsp;                    for (MechSummary unit : units) {</b>
<b class="nc">&nbsp;                        Entity entity = new MechFileParser(unit.getSourceFile(),</b>
<b class="nc">&nbsp;                                unit.getEntryName()).getEntity();</b>
&nbsp;
<b class="nc">&nbsp;                        AlphaStrikeElement ase = new AlphaStrikeElement(entity);</b>
<b class="nc">&nbsp;                        ase.writeCsv(bw);</b>
&nbsp;                    }
<b class="nc">&nbsp;                } catch (Exception ex) {</b>
<b class="nc">&nbsp;                    getLogger().error(ex);</b>
<b class="nc">&nbsp;                }</b>
&nbsp;            }
<b class="nc">&nbsp;            System.exit(0);</b>
&nbsp;        }
&nbsp;
&nbsp;        private void processUnitExporter() {
<b class="nc">&nbsp;            processUnitExporter(false);</b>
&nbsp;        }
&nbsp;
&nbsp;        private void processUnitExporter(boolean officialUnitList) {
&nbsp;            String filename;
<b class="nc">&nbsp;            if ((getToken() == TOK_LITERAL) || officialUnitList) {</b>
<b class="nc">&nbsp;                if (officialUnitList) {</b>
<b class="nc">&nbsp;                    filename = MechFileParser.FILENAME_OFFICIAL_UNITS;</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    filename = getTokenValue();</b>
&nbsp;                }
<b class="nc">&nbsp;                nextToken();</b>
&nbsp;
<b class="nc">&nbsp;                if (!new File(&quot;./docs&quot;).exists()) {</b>
<b class="nc">&nbsp;                    if (!new File(&quot;./docs&quot;).mkdir()) {</b>
<b class="nc">&nbsp;                        getLogger().error(</b>
&nbsp;                                &quot;Error in creating directory ./docs. We know this is annoying, and apologise. &quot;
&nbsp;                                        + &quot;Please submit a bug report at https://github.com/MegaMek/megamek/issues &quot;
&nbsp;                                        + &quot; and we will try to resolve your issue.&quot;);
&nbsp;                    }
&nbsp;                }
<b class="nc">&nbsp;                File file = new File(&quot;./docs/&quot; + filename);</b>
<b class="nc">&nbsp;                try (Writer w = new FileWriter(file); BufferedWriter bw = new BufferedWriter(w)) {</b>
<b class="nc">&nbsp;                    if (officialUnitList) {</b>
<b class="nc">&nbsp;                        bw.write(&quot;Megamek Official Unit List&quot;);</b>
<b class="nc">&nbsp;                        bw.newLine();</b>
<b class="nc">&nbsp;                        bw.write(&quot;This file can be regenerated with java -jar MegaMek.jar -oul&quot;);</b>
<b class="nc">&nbsp;                        bw.newLine();</b>
<b class="nc">&nbsp;                        bw.write(&quot;Format is: Chassis Model|&quot;);</b>
&nbsp;                    } else {
<b class="nc">&nbsp;                        bw.write(&quot;Megamek Unit Database&quot;);</b>
<b class="nc">&nbsp;                        bw.newLine();</b>
<b class="nc">&nbsp;                        bw.write(&quot;This file can be regenerated with java -jar MegaMek.jar -export filename&quot;);</b>
<b class="nc">&nbsp;                        bw.newLine();</b>
<b class="nc">&nbsp;                        bw.write(&quot;Type,SubType,Name,Model,BV,Cost (Loaded), Cost (Unloaded),Year,TechLevel,Tonnage,Tech,Canon,Walk,Run,Jump&quot;);</b>
&nbsp;                    }
<b class="nc">&nbsp;                    bw.newLine();</b>
&nbsp;
<b class="nc">&nbsp;                    MechSummary[] units = MechSummaryCache.getInstance(officialUnitList).getAllMechs();</b>
<b class="nc">&nbsp;                    for (MechSummary unit : units) {</b>
<b class="nc">&nbsp;                        String unitType = unit.getUnitType();</b>
<b class="nc">&nbsp;                        if (unitType.equalsIgnoreCase(&quot;mek&quot;)) {</b>
<b class="nc">&nbsp;                            unitType = &quot;&#39;Mech&quot;;</b>
&nbsp;                        }
&nbsp;
<b class="nc">&nbsp;                        if (!officialUnitList) {</b>
<b class="nc">&nbsp;                            bw.write(unitType);</b>
<b class="nc">&nbsp;                            bw.write(&quot;,&quot;);</b>
<b class="nc">&nbsp;                            bw.write(unit.getUnitSubType());</b>
<b class="nc">&nbsp;                            bw.write(&quot;,&quot;);</b>
<b class="nc">&nbsp;                            bw.write(unit.getChassis());</b>
<b class="nc">&nbsp;                            bw.write(&quot;,&quot;);</b>
<b class="nc">&nbsp;                            bw.write(unit.getModel());</b>
<b class="nc">&nbsp;                            bw.write(&quot;,&quot;);</b>
<b class="nc">&nbsp;                            bw.write(Integer.toString(unit.getBV()));</b>
<b class="nc">&nbsp;                            bw.write(&quot;,&quot;);</b>
<b class="nc">&nbsp;                            bw.write(Long.toString(unit.getCost()));</b>
<b class="nc">&nbsp;                            bw.write(&quot;,&quot;);</b>
<b class="nc">&nbsp;                            bw.write(Long.toString(unit.getUnloadedCost()));</b>
<b class="nc">&nbsp;                            bw.write(&quot;,&quot;);</b>
<b class="nc">&nbsp;                            bw.write(Integer.toString(unit.getYear()));</b>
<b class="nc">&nbsp;                            bw.write(&quot;,&quot;);</b>
<b class="nc">&nbsp;                            bw.write(TechConstants.getLevelDisplayableName(unit.getType()));</b>
<b class="nc">&nbsp;                            bw.write(&quot;,&quot;);</b>
<b class="nc">&nbsp;                            bw.write(Double.toString(unit.getTons()));</b>
<b class="nc">&nbsp;                            bw.write(&quot;,&quot;);</b>
<b class="nc">&nbsp;                            if (unit.isClan()) {</b>
<b class="nc">&nbsp;                                bw.write(&quot;Clan,&quot;);</b>
&nbsp;                            } else {
<b class="nc">&nbsp;                                bw.write(&quot;IS,&quot;);</b>
&nbsp;                            }
<b class="nc">&nbsp;                            if (unit.isCanon()) {</b>
<b class="nc">&nbsp;                                bw.write(&quot;Canon,&quot;);</b>
&nbsp;                            } else {
<b class="nc">&nbsp;                                bw.write(&quot;Non-Canon,&quot;);</b>
&nbsp;                            }
<b class="nc">&nbsp;                            bw.write(Integer.toString(unit.getWalkMp()));</b>
<b class="nc">&nbsp;                            bw.write(&quot;,&quot;);</b>
<b class="nc">&nbsp;                            bw.write(Integer.toString(unit.getRunMp()));</b>
<b class="nc">&nbsp;                            bw.write(&quot;,&quot;);</b>
<b class="nc">&nbsp;                            bw.write(Integer.toString(unit.getJumpMp()));</b>
&nbsp;                        } else {
<b class="nc">&nbsp;                            bw.write(unit.getChassis()</b>
<b class="nc">&nbsp;                                    + (unit.getModel().equals(&quot;&quot;) ? &quot;|&quot; : &quot; &quot;</b>
<b class="nc">&nbsp;                                    + unit.getModel() + &quot;|&quot;));</b>
&nbsp;                        }
<b class="nc">&nbsp;                        bw.newLine();</b>
&nbsp;                    }
<b class="nc">&nbsp;                } catch (Exception ex) {</b>
<b class="nc">&nbsp;                    getLogger().error(ex);</b>
<b class="nc">&nbsp;                }</b>
&nbsp;            }
<b class="nc">&nbsp;            System.exit(0);</b>
&nbsp;        }
&nbsp;
&nbsp;        private void processRestOfInput() {
<b class="nc">&nbsp;            Vector&lt;String&gt; v = new Vector&lt;&gt;();</b>
<b class="nc">&nbsp;            while (getArgValue() != null) {</b>
<b class="nc">&nbsp;                v.addElement(getArgValue());</b>
<b class="nc">&nbsp;                nextArg();</b>
&nbsp;            }
<b class="nc">&nbsp;            setToken(TOK_EOF);</b>
<b class="nc">&nbsp;            setTokenValue(null);</b>
<b class="nc">&nbsp;            restArgs = v.toArray(new String[0]);</b>
&nbsp;        }
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2023-05-16 16:28</div>
</div>
</body>
</html>
