


<!DOCTYPE html>
<html id="htmlId">
<head>
  <title>Coverage Report > RATGeneratorEditor</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">megamek.utils</a>
</div>

<h1>Coverage Summary for Class: RATGeneratorEditor (megamek.utils)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">RATGeneratorEditor</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/26)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/386)
  </span>
</td>
</tr>
  <tr>
    <td class="name">RATGeneratorEditor$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">RATGeneratorEditor$2</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/8)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">RATGeneratorEditor$3</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/12)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">RATGeneratorEditor$FactionEditorTableModel</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/11)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/76)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">RATGeneratorEditor$FactionListTableModel</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/12)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/44)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">RATGeneratorEditor$MasterUnitListTableModel</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/10)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/46)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">RATGeneratorEditor$SalvageEditorTableModel</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/13)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/68)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">RATGeneratorEditor$UnitEditorTableModel</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/15)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/107)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">RATGeneratorEditor$UnitTypeComparator</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/97)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/756)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;/*
&nbsp; * MegaMek - Copyright (C) 2018 - The MegaMek Team
&nbsp; *
&nbsp; *  This program is free software; you can redistribute it and/or modify it
&nbsp; *  under the terms of the GNU General Public License as published by the Free
&nbsp; *  Software Foundation; either version 2 of the License, or (at your option)
&nbsp; *  any later version.
&nbsp; *
&nbsp; *  This program is distributed in the hope that it will be useful, but
&nbsp; *  WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
&nbsp; *  or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License
&nbsp; *  for more details.
&nbsp; */
&nbsp;
&nbsp;package megamek.utils;
&nbsp;
&nbsp;import java.awt.Dimension;
&nbsp;import java.awt.GridBagConstraints;
&nbsp;import java.awt.GridBagLayout;
&nbsp;import java.awt.Insets;
&nbsp;import java.io.File;
&nbsp;import java.util.ArrayList;
&nbsp;import java.util.Collection;
&nbsp;import java.util.Comparator;
&nbsp;import java.util.HashMap;
&nbsp;import java.util.List;
&nbsp;import java.util.Map;
&nbsp;import java.util.StringJoiner;
&nbsp;import java.util.stream.Collectors;
&nbsp;
&nbsp;import javax.swing.ButtonGroup;
&nbsp;import javax.swing.JButton;
&nbsp;import javax.swing.JCheckBox;
&nbsp;import javax.swing.JComboBox;
&nbsp;import javax.swing.JFileChooser;
&nbsp;import javax.swing.JFrame;
&nbsp;import javax.swing.JLabel;
&nbsp;import javax.swing.JOptionPane;
&nbsp;import javax.swing.JPanel;
&nbsp;import javax.swing.JRadioButton;
&nbsp;import javax.swing.JScrollPane;
&nbsp;import javax.swing.JTabbedPane;
&nbsp;import javax.swing.JTable;
&nbsp;import javax.swing.JTextField;
&nbsp;import javax.swing.ListSelectionModel;
&nbsp;import javax.swing.RowFilter;
&nbsp;import javax.swing.RowSorter;
&nbsp;import javax.swing.SortOrder;
&nbsp;import javax.swing.SwingUtilities;
&nbsp;import javax.swing.event.DocumentEvent;
&nbsp;import javax.swing.event.DocumentListener;
&nbsp;import javax.swing.table.DefaultTableModel;
&nbsp;import javax.swing.table.TableRowSorter;
&nbsp;
&nbsp;import megamek.MegaMek;
&nbsp;import megamek.client.ratgenerator.AbstractUnitRecord;
&nbsp;import megamek.client.ratgenerator.AvailabilityRating;
&nbsp;import megamek.client.ratgenerator.FactionRecord;
&nbsp;import megamek.client.ratgenerator.FactionRecord.TechCategory;
&nbsp;import megamek.client.ratgenerator.ModelRecord;
&nbsp;import megamek.client.ratgenerator.RATGenerator;
&nbsp;import megamek.common.Configuration;
&nbsp;import megamek.common.EntityMovementMode;
&nbsp;import megamek.common.UnitType;
&nbsp;
&nbsp;/**
&nbsp; * @author neoancient
&nbsp; *
&nbsp; */
<b class="nc">&nbsp;public class RATGeneratorEditor extends JFrame {</b>
&nbsp;
&nbsp;    private static final long serialVersionUID = 6544418066071039219L;
&nbsp;
<b class="nc">&nbsp;    private static final String[] MOVEMENT_TYPE_NAMES = {</b>
&nbsp;            &quot;Leg&quot;, &quot;Tracked&quot;, &quot;Wheeled&quot;, &quot;Hover&quot;, &quot;WiGE&quot;, &quot;VTOL&quot;,
&nbsp;            &quot;Naval&quot;, &quot;Underwater&quot;, &quot;Jump&quot;, &quot;Motorized&quot;, &quot;Atmospheric&quot;,
&nbsp;            &quot;Aerospace&quot;, &quot;Space&quot;, &quot;None&quot;
&nbsp;    };
&nbsp;
&nbsp;    private static RATGenerator rg;
&nbsp;    
&nbsp;    private static Integer[] ERAS;
&nbsp;
<b class="nc">&nbsp;    private final JComboBox&lt;String&gt; cbUnitType = new JComboBox&lt;&gt;();</b>
<b class="nc">&nbsp;    private final JComboBox&lt;String&gt; cbMovementType = new JComboBox&lt;&gt;();</b>
<b class="nc">&nbsp;    private final JRadioButton radioModel = new JRadioButton(&quot;Model&quot;);</b>
<b class="nc">&nbsp;    private final JRadioButton radioChassis = new JRadioButton(&quot;Chassis&quot;);</b>
&nbsp;
<b class="nc">&nbsp;    private final JTabbedPane panMain = new JTabbedPane();</b>
&nbsp;
<b class="nc">&nbsp;    private final JTextField txtSearch = new JTextField();</b>
<b class="nc">&nbsp;    private final JTable tblMasterUnitList = new JTable();</b>
&nbsp;    private MasterUnitListTableModel masterUnitListModel;
&nbsp;    private TableRowSorter&lt;MasterUnitListTableModel&gt; masterUnitListSorter;
&nbsp;
<b class="nc">&nbsp;    private final JTextField txtFaction = new JTextField();</b>
<b class="nc">&nbsp;    private final JTable tblUnitEditor = new JTable();</b>
<b class="nc">&nbsp;    private final UnitEditorTableModel unitEditorModel = new UnitEditorTableModel();</b>
&nbsp;
<b class="nc">&nbsp;    private final JTextField txtNewFaction = new JTextField();</b>
<b class="nc">&nbsp;    private final JCheckBox chkShowSubfactions = new JCheckBox();</b>
<b class="nc">&nbsp;    private final JCheckBox chkShowMinorFactions = new JCheckBox();</b>
<b class="nc">&nbsp;    private final JTable tblMasterFactionList = new JTable();</b>
&nbsp;    private FactionListTableModel masterFactionListModel;
&nbsp;    private TableRowSorter&lt;FactionListTableModel&gt; masterFactionListSorter;
<b class="nc">&nbsp;    private final JTable tblFactionEditor = new JTable();</b>
&nbsp;    private FactionEditorTableModel factionEditorModel;
<b class="nc">&nbsp;    private final JTextField txtSalvageFaction = new JTextField();</b>
<b class="nc">&nbsp;    private final JTable tblSalvageEditor = new JTable();</b>
&nbsp;    private SalvageEditorTableModel salvageEditorModel;
&nbsp;
<b class="nc">&nbsp;    private File lastDir = Configuration.forceGeneratorDir();</b>
&nbsp;
<b class="nc">&nbsp;    public RATGeneratorEditor() {</b>
<b class="nc">&nbsp;        rg = RATGenerator.getInstance();</b>
<b class="nc">&nbsp;        while (!rg.isInitialized()) {</b>
&nbsp;            try {
<b class="nc">&nbsp;                Thread.sleep(50);</b>
<b class="nc">&nbsp;            } catch (InterruptedException ex) {</b>
&nbsp;                // Do nothing
<b class="nc">&nbsp;            }</b>
&nbsp;        }
<b class="nc">&nbsp;        rg.getEraSet().forEach(e -&gt; rg.loadYear(e));</b>
<b class="nc">&nbsp;        ERAS = rg.getEraSet().toArray(new Integer[0]);</b>
<b class="nc">&nbsp;        rg.initRemainingUnits();</b>
&nbsp;
<b class="nc">&nbsp;        initUI();</b>
&nbsp;    }
&nbsp;
&nbsp;    public RATGeneratorEditor(File dir) {
<b class="nc">&nbsp;        this();</b>
<b class="nc">&nbsp;        if (dir.exists() &amp;&amp; dir.isDirectory()) {</b>
<b class="nc">&nbsp;            lastDir = dir;</b>
<b class="nc">&nbsp;            rg.reloadFromDir(lastDir);</b>
<b class="nc">&nbsp;            ERAS = rg.getEraSet().toArray(new Integer[0]);</b>
<b class="nc">&nbsp;            rg.initRemainingUnits();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void initUI() {
<b class="nc">&nbsp;        setTitle(&quot;Unit Selector Editor&quot;);</b>
<b class="nc">&nbsp;        setDefaultCloseOperation(EXIT_ON_CLOSE);</b>
&nbsp;
<b class="nc">&nbsp;        masterUnitListModel = new MasterUnitListTableModel(rg.getModelList());</b>
&nbsp;
<b class="nc">&nbsp;        setLayout(new GridBagLayout());</b>
&nbsp;
<b class="nc">&nbsp;        buildOptionPanel();</b>
&nbsp;
<b class="nc">&nbsp;        GridBagConstraints gbc = new GridBagConstraints();</b>
<b class="nc">&nbsp;        gbc.anchor = GridBagConstraints.NORTHWEST;</b>
<b class="nc">&nbsp;        gbc.fill = GridBagConstraints.NONE;</b>
<b class="nc">&nbsp;        gbc.gridwidth = 1;</b>
<b class="nc">&nbsp;        gbc.insets = new Insets(5, 5, 5, 5);</b>
&nbsp;
<b class="nc">&nbsp;        gbc.gridx = 0;</b>
<b class="nc">&nbsp;        gbc.gridy = 2;</b>
<b class="nc">&nbsp;        gbc.gridwidth = GridBagConstraints.REMAINDER;</b>
<b class="nc">&nbsp;        gbc.fill = GridBagConstraints.BOTH;</b>
<b class="nc">&nbsp;        add(panMain, gbc);</b>
&nbsp;
<b class="nc">&nbsp;        JPanel panButtons = new JPanel();</b>
<b class="nc">&nbsp;        gbc.gridx = 0;</b>
<b class="nc">&nbsp;        gbc.gridy = 3;</b>
<b class="nc">&nbsp;        gbc.gridwidth = GridBagConstraints.REMAINDER;</b>
<b class="nc">&nbsp;        add(panButtons, gbc);</b>
&nbsp;
<b class="nc">&nbsp;        JPanel panEditTab = createUnitPanel();</b>
<b class="nc">&nbsp;        gbc = new GridBagConstraints();</b>
<b class="nc">&nbsp;        gbc.anchor = GridBagConstraints.NORTHWEST;</b>
<b class="nc">&nbsp;        gbc.fill = GridBagConstraints.NONE;</b>
<b class="nc">&nbsp;        gbc.gridwidth = 1;</b>
<b class="nc">&nbsp;        gbc.insets = new Insets(5, 5, 5, 5);</b>
<b class="nc">&nbsp;        panMain.addTab(&quot;Edit&quot;, panEditTab);</b>
&nbsp;
<b class="nc">&nbsp;        JPanel panFactionEditorTab = createFactionTab();</b>
<b class="nc">&nbsp;        gbc = new GridBagConstraints();</b>
<b class="nc">&nbsp;        gbc.anchor = GridBagConstraints.NORTHWEST;</b>
<b class="nc">&nbsp;        gbc.fill = GridBagConstraints.NONE;</b>
<b class="nc">&nbsp;        gbc.gridwidth = 1;</b>
<b class="nc">&nbsp;        gbc.insets = new Insets(5, 5, 5, 5);</b>
<b class="nc">&nbsp;        panMain.addTab(&quot;Edit Factions&quot;, panFactionEditorTab);</b>
&nbsp;
<b class="nc">&nbsp;        JButton button = new JButton(&quot;Load&quot;);</b>
<b class="nc">&nbsp;        button.setToolTipText(&quot;Load data from alternate location&quot;);</b>
<b class="nc">&nbsp;        panButtons.add(button);</b>
<b class="nc">&nbsp;        button.addActionListener(ev -&gt; loadAltDir());</b>
&nbsp;
<b class="nc">&nbsp;        button = new JButton(&quot;Save&quot;);</b>
<b class="nc">&nbsp;        button.setToolTipText(&quot;Export data to a selected directory&quot;);</b>
<b class="nc">&nbsp;        panButtons.add(button);</b>
<b class="nc">&nbsp;        button.addActionListener(ev -&gt; saveValues());</b>
&nbsp;
<b class="nc">&nbsp;        pack();</b>
&nbsp;
&nbsp;    }
&nbsp;
&nbsp;    private void loadAltDir() {
<b class="nc">&nbsp;        JFileChooser chooser = new JFileChooser();</b>
<b class="nc">&nbsp;        chooser.setCurrentDirectory(lastDir);</b>
<b class="nc">&nbsp;        chooser.setFileSelectionMode(JFileChooser.DIRECTORIES_ONLY);</b>
<b class="nc">&nbsp;        chooser.setDialogTitle(&quot;Select load directory&quot;);</b>
<b class="nc">&nbsp;        if (chooser.showOpenDialog(this) == JFileChooser.APPROVE_OPTION) {</b>
<b class="nc">&nbsp;            lastDir = chooser.getSelectedFile();</b>
<b class="nc">&nbsp;            rg.reloadFromDir(lastDir);</b>
<b class="nc">&nbsp;            ERAS = rg.getEraSet().toArray(new Integer[0]);</b>
<b class="nc">&nbsp;            rg.initRemainingUnits();</b>
<b class="nc">&nbsp;            tblMasterUnitList.clearSelection();</b>
<b class="nc">&nbsp;            tblMasterFactionList.clearSelection();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void saveValues() {
<b class="nc">&nbsp;        JFileChooser chooser = new JFileChooser();</b>
<b class="nc">&nbsp;        chooser.setCurrentDirectory(lastDir);</b>
<b class="nc">&nbsp;        chooser.setFileSelectionMode(JFileChooser.DIRECTORIES_ONLY);</b>
<b class="nc">&nbsp;        chooser.setDialogTitle(&quot;Select save directory&quot;);</b>
<b class="nc">&nbsp;        chooser.setAcceptAllFileFilterUsed(false);</b>
<b class="nc">&nbsp;        if (chooser.showSaveDialog(this) == JFileChooser.APPROVE_OPTION) {</b>
<b class="nc">&nbsp;            lastDir = chooser.getSelectedFile();</b>
<b class="nc">&nbsp;            rg.exportRATGen(lastDir);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void buildOptionPanel() {
<b class="nc">&nbsp;        GridBagConstraints gbc = new GridBagConstraints();</b>
<b class="nc">&nbsp;        gbc.anchor = GridBagConstraints.NORTHWEST;</b>
<b class="nc">&nbsp;        gbc.fill = GridBagConstraints.NONE;</b>
<b class="nc">&nbsp;        gbc.gridwidth = 1;</b>
<b class="nc">&nbsp;        gbc.insets = new Insets(5, 5, 5, 5);</b>
&nbsp;
<b class="nc">&nbsp;        cbUnitType.addItem(&quot;All&quot;);</b>
<b class="nc">&nbsp;        for (int i = 0; i &lt; UnitType.SIZE; i++) {</b>
<b class="nc">&nbsp;            cbUnitType.addItem(UnitType.getTypeName(i));</b>
&nbsp;        }
<b class="nc">&nbsp;        gbc.gridx = 0;</b>
<b class="nc">&nbsp;        gbc.gridy = 0;</b>
<b class="nc">&nbsp;        add(new JLabel(&quot;Unit Type:&quot;), gbc);</b>
<b class="nc">&nbsp;        gbc.gridx = 1;</b>
<b class="nc">&nbsp;        gbc.gridy = 0;</b>
<b class="nc">&nbsp;        add(cbUnitType, gbc);</b>
<b class="nc">&nbsp;        cbUnitType.addActionListener(ev -&gt; filterMasterUnitList());</b>
&nbsp;
<b class="nc">&nbsp;        cbMovementType.addItem(&quot;All&quot;);</b>
<b class="nc">&nbsp;        for (String movementTypeName : MOVEMENT_TYPE_NAMES) {</b>
<b class="nc">&nbsp;            cbMovementType.addItem(movementTypeName);</b>
&nbsp;        }
<b class="nc">&nbsp;        gbc.gridx = 2;</b>
<b class="nc">&nbsp;        gbc.gridy = 0;</b>
<b class="nc">&nbsp;        add(new JLabel(&quot;Movement Type:&quot;), gbc);</b>
<b class="nc">&nbsp;        gbc.gridx = 3;</b>
<b class="nc">&nbsp;        gbc.gridy = 0;</b>
<b class="nc">&nbsp;        add(cbMovementType, gbc);</b>
<b class="nc">&nbsp;        cbMovementType.addActionListener(arg0 -&gt; filterMasterUnitList());</b>
&nbsp;
<b class="nc">&nbsp;        radioModel.setSelected(true);</b>
<b class="nc">&nbsp;        gbc.gridx = 4;</b>
<b class="nc">&nbsp;        gbc.gridy = 0;</b>
<b class="nc">&nbsp;        add(radioModel, gbc);</b>
<b class="nc">&nbsp;        radioModel.addActionListener(ev -&gt; {</b>
<b class="nc">&nbsp;            if (unitEditorModel.getMode() != UnitEditorTableModel.MODE_MODEL &amp;&amp;</b>
<b class="nc">&nbsp;                    tblMasterUnitList.getSelectedRow() &gt;= 0) {</b>
<b class="nc">&nbsp;                ModelRecord model = masterUnitListModel.getUnitRecord(tblMasterUnitList.convertRowIndexToModel(tblMasterUnitList.getSelectedRow()));</b>
<b class="nc">&nbsp;                unitEditorModel.setData(model, UnitEditorTableModel.MODE_MODEL);</b>
<b class="nc">&nbsp;            } else {</b>
<b class="nc">&nbsp;                unitEditorModel.clearData();</b>
&nbsp;            }
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        gbc.gridx = 5;</b>
<b class="nc">&nbsp;        gbc.gridy = 0;</b>
<b class="nc">&nbsp;        add(radioChassis, gbc);</b>
<b class="nc">&nbsp;        radioChassis.addActionListener(ev -&gt;  {</b>
<b class="nc">&nbsp;            if (unitEditorModel.getMode() != UnitEditorTableModel.MODE_CHASSIS &amp;&amp;</b>
<b class="nc">&nbsp;                    tblMasterUnitList.getSelectedRow() &gt;= 0) {</b>
<b class="nc">&nbsp;                ModelRecord model = masterUnitListModel.getUnitRecord(tblMasterUnitList.convertRowIndexToModel(tblMasterUnitList.getSelectedRow()));</b>
<b class="nc">&nbsp;                unitEditorModel.setData(model, UnitEditorTableModel.MODE_CHASSIS);</b>
<b class="nc">&nbsp;            } else {</b>
<b class="nc">&nbsp;                unitEditorModel.clearData();</b>
&nbsp;            }
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        ButtonGroup group = new ButtonGroup();</b>
<b class="nc">&nbsp;        group.add(radioModel);</b>
<b class="nc">&nbsp;        group.add(radioChassis);</b>
&nbsp;    }
&nbsp;
&nbsp;    private JPanel createUnitPanel() {
<b class="nc">&nbsp;        JPanel panEditTab = new JPanel(new GridBagLayout());</b>
&nbsp;
<b class="nc">&nbsp;        GridBagConstraints gbc = new GridBagConstraints();</b>
<b class="nc">&nbsp;        gbc.anchor = GridBagConstraints.NORTHWEST;</b>
<b class="nc">&nbsp;        gbc.fill = GridBagConstraints.NONE;</b>
<b class="nc">&nbsp;        gbc.gridwidth = 1;</b>
<b class="nc">&nbsp;        gbc.insets = new Insets(5, 5, 5, 5);</b>
&nbsp;
<b class="nc">&nbsp;        txtSearch.setMinimumSize(new Dimension(200, 25));</b>
<b class="nc">&nbsp;        txtSearch.setPreferredSize(new Dimension(200, 25));</b>
<b class="nc">&nbsp;        gbc.gridx = 0;</b>
<b class="nc">&nbsp;        gbc.gridy = 0;</b>
<b class="nc">&nbsp;        panEditTab.add(new JLabel(&quot;Search:&quot;), gbc);</b>
<b class="nc">&nbsp;        gbc.gridx = 1;</b>
<b class="nc">&nbsp;        gbc.gridy = 0;</b>
<b class="nc">&nbsp;        panEditTab.add(txtSearch, gbc);</b>
<b class="nc">&nbsp;        txtSearch.getDocument().addDocumentListener(new DocumentListener() {</b>
&nbsp;
&nbsp;            @Override
&nbsp;            public void changedUpdate(DocumentEvent arg0) {
<b class="nc">&nbsp;                filterMasterUnitList();</b>
&nbsp;            }
&nbsp;
&nbsp;            @Override
&nbsp;            public void insertUpdate(DocumentEvent arg0) {
<b class="nc">&nbsp;                filterMasterUnitList();</b>
&nbsp;            }
&nbsp;
&nbsp;            @Override
&nbsp;            public void removeUpdate(DocumentEvent arg0) {
<b class="nc">&nbsp;                filterMasterUnitList();</b>
&nbsp;            }
&nbsp;
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        tblMasterUnitList.setModel(masterUnitListModel);</b>
<b class="nc">&nbsp;        masterUnitListSorter =</b>
&nbsp;                new TableRowSorter&lt;&gt;(masterUnitListModel);
<b class="nc">&nbsp;        masterUnitListSorter.setComparator(MasterUnitListTableModel.COL_UNIT_TYPE, new UnitTypeComparator());</b>
<b class="nc">&nbsp;        List&lt;RowSorter.SortKey&gt; sortKeys = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        sortKeys.add(new RowSorter.SortKey(MasterUnitListTableModel.COL_UNIT_TYPE, SortOrder.ASCENDING));</b>
<b class="nc">&nbsp;        sortKeys.add(new RowSorter.SortKey(MasterUnitListTableModel.COL_CHASSIS, SortOrder.ASCENDING));</b>
<b class="nc">&nbsp;        sortKeys.add(new RowSorter.SortKey(MasterUnitListTableModel.COL_MODEL, SortOrder.ASCENDING));</b>
<b class="nc">&nbsp;        sortKeys.add(new RowSorter.SortKey(MasterUnitListTableModel.COL_YEAR, SortOrder.ASCENDING));</b>
<b class="nc">&nbsp;        masterUnitListSorter.setSortKeys(sortKeys);</b>
<b class="nc">&nbsp;        tblMasterUnitList.setRowSorter(masterUnitListSorter);</b>
<b class="nc">&nbsp;        tblMasterUnitList.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);</b>
<b class="nc">&nbsp;        tblMasterUnitList.getSelectionModel().addListSelectionListener(arg0 -&gt; {</b>
<b class="nc">&nbsp;            if (tblMasterUnitList.getSelectedRow() &gt;= 0) {</b>
<b class="nc">&nbsp;                ModelRecord rec = masterUnitListModel.</b>
<b class="nc">&nbsp;                        getUnitRecord(tblMasterUnitList.</b>
<b class="nc">&nbsp;                                convertRowIndexToModel(tblMasterUnitList.</b>
<b class="nc">&nbsp;                                        getSelectedRow()));</b>
<b class="nc">&nbsp;                unitEditorModel.setData(rec, radioModel.isSelected() ? UnitEditorTableModel.MODE_MODEL : UnitEditorTableModel.MODE_CHASSIS);</b>
<b class="nc">&nbsp;            } else {</b>
<b class="nc">&nbsp;                unitEditorModel.clearData();</b>
&nbsp;            }
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        JScrollPane scroll = new JScrollPane();</b>
<b class="nc">&nbsp;        scroll.setMinimumSize(new Dimension(600, 400));</b>
<b class="nc">&nbsp;        scroll.setPreferredSize(new Dimension(600, 400));</b>
<b class="nc">&nbsp;        scroll.setViewportView(tblMasterUnitList);</b>
<b class="nc">&nbsp;        gbc.gridx = 0;</b>
<b class="nc">&nbsp;        gbc.gridy = 1;</b>
<b class="nc">&nbsp;        gbc.gridwidth = 2;</b>
<b class="nc">&nbsp;        panEditTab.add(scroll, gbc);</b>
&nbsp;
<b class="nc">&nbsp;        txtFaction.setMinimumSize(new Dimension(60,25));</b>
<b class="nc">&nbsp;        txtFaction.setPreferredSize(new Dimension(60,25));</b>
<b class="nc">&nbsp;        gbc.gridx = 2;</b>
<b class="nc">&nbsp;        gbc.gridy = 0;</b>
<b class="nc">&nbsp;        gbc.gridwidth = 1;</b>
<b class="nc">&nbsp;        panEditTab.add(txtFaction, gbc);</b>
&nbsp;
<b class="nc">&nbsp;        JButton button = new JButton(&quot;Add Row&quot;);</b>
<b class="nc">&nbsp;        gbc.gridx = 3;</b>
<b class="nc">&nbsp;        gbc.gridy = 0;</b>
<b class="nc">&nbsp;        panEditTab.add(button, gbc);</b>
<b class="nc">&nbsp;        button.addActionListener(ev -&gt; {</b>
&nbsp;            
<b class="nc">&nbsp;            if(!unitEditorModel.addEntry(txtFaction.getText())) {</b>
<b class="nc">&nbsp;                JOptionPane.showMessageDialog(this, </b>
&nbsp;                        &quot;Unable to add model or chassis entry. Please select a unit model. &quot; +
&nbsp;                        &quot;If adding a model entry, make sure you already have a chassis entry defined.&quot;);
&nbsp;            }
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        button = new JButton(&quot;Delete Row&quot;);</b>
<b class="nc">&nbsp;        gbc.gridx = 4;</b>
<b class="nc">&nbsp;        gbc.gridy = 0;</b>
<b class="nc">&nbsp;        panEditTab.add(button, gbc);</b>
<b class="nc">&nbsp;        button.addActionListener(ev -&gt; {</b>
<b class="nc">&nbsp;            if (tblUnitEditor.getSelectedRow() &gt;= 0) {</b>
<b class="nc">&nbsp;                unitEditorModel.removeEntry(tblUnitEditor.convertRowIndexToModel(tblUnitEditor.getSelectedRow()));</b>
&nbsp;            }
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        button = new JButton(&quot;Copy Row&quot;);</b>
<b class="nc">&nbsp;        gbc.gridx = 5;</b>
<b class="nc">&nbsp;        gbc.gridy = 0;</b>
<b class="nc">&nbsp;        panEditTab.add(button, gbc);</b>
<b class="nc">&nbsp;        button.addActionListener(ev -&gt; {</b>
<b class="nc">&nbsp;            if (tblUnitEditor.getSelectedRow() &gt;= 0) {</b>
<b class="nc">&nbsp;                unitEditorModel.copyRow(tblUnitEditor.convertRowIndexToModel(tblUnitEditor.getSelectedRow()),</b>
<b class="nc">&nbsp;                        txtFaction.getText());</b>
&nbsp;            }
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        tblUnitEditor.setModel(unitEditorModel);</b>
<b class="nc">&nbsp;        tblUnitEditor.createDefaultColumnsFromModel();</b>
<b class="nc">&nbsp;        tblUnitEditor.setAutoResizeMode(JTable.AUTO_RESIZE_OFF);</b>
<b class="nc">&nbsp;        scroll = new JScrollPane(tblUnitEditor, JScrollPane.VERTICAL_SCROLLBAR_ALWAYS,</b>
&nbsp;                JScrollPane.HORIZONTAL_SCROLLBAR_AS_NEEDED);
<b class="nc">&nbsp;        scroll.setMinimumSize(new Dimension(600, 400));</b>
<b class="nc">&nbsp;        scroll.setPreferredSize(new Dimension(600, 400));</b>
<b class="nc">&nbsp;        scroll.setViewportView(tblUnitEditor);</b>
<b class="nc">&nbsp;        gbc.gridx = 2;</b>
<b class="nc">&nbsp;        gbc.gridy = 1;</b>
<b class="nc">&nbsp;        gbc.gridwidth = 8;</b>
<b class="nc">&nbsp;        gbc.weightx = 1.0;</b>
<b class="nc">&nbsp;        panEditTab.add(scroll, gbc);</b>
&nbsp;
<b class="nc">&nbsp;        return panEditTab;</b>
&nbsp;    }
&nbsp;
&nbsp;    private JPanel createFactionTab() {
<b class="nc">&nbsp;        JPanel panFactionEditorTab = new JPanel(new GridBagLayout());</b>
&nbsp;
<b class="nc">&nbsp;        GridBagConstraints gbc = new GridBagConstraints();</b>
<b class="nc">&nbsp;        gbc.anchor = GridBagConstraints.NORTHWEST;</b>
<b class="nc">&nbsp;        gbc.fill = GridBagConstraints.NONE;</b>
<b class="nc">&nbsp;        gbc.gridwidth = 1;</b>
<b class="nc">&nbsp;        gbc.insets = new Insets(5, 5, 5, 5);</b>
&nbsp;
<b class="nc">&nbsp;        txtNewFaction.setMinimumSize(new Dimension(100, 25));</b>
<b class="nc">&nbsp;        txtNewFaction.setPreferredSize(new Dimension(100, 25));</b>
<b class="nc">&nbsp;        gbc.gridx = 0;</b>
<b class="nc">&nbsp;        gbc.gridy = 0;</b>
<b class="nc">&nbsp;        panFactionEditorTab.add(txtNewFaction, gbc);</b>
&nbsp;
<b class="nc">&nbsp;        JButton button = new JButton(&quot;New&quot;);</b>
<b class="nc">&nbsp;        gbc.gridx = 1;</b>
<b class="nc">&nbsp;        gbc.gridy = 0;</b>
<b class="nc">&nbsp;        panFactionEditorTab.add(button, gbc);</b>
<b class="nc">&nbsp;        button.addActionListener(ev -&gt; {</b>
<b class="nc">&nbsp;            if (txtNewFaction.getText().length() &gt; 0) {</b>
<b class="nc">&nbsp;                FactionRecord rec = new FactionRecord(txtNewFaction.getText());</b>
<b class="nc">&nbsp;                rg.addFaction(rec);</b>
<b class="nc">&nbsp;                masterFactionListModel.addRecord(rec);</b>
&nbsp;            }
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        button = new JButton(&quot;Delete&quot;);</b>
<b class="nc">&nbsp;        gbc.gridx = 2;</b>
<b class="nc">&nbsp;        gbc.gridy = 0;</b>
<b class="nc">&nbsp;        panFactionEditorTab.add(button, gbc);</b>
<b class="nc">&nbsp;        button.addActionListener(ev -&gt; {</b>
<b class="nc">&nbsp;            if (tblMasterFactionList.getSelectedRow() &gt;= 0) {</b>
<b class="nc">&nbsp;                FactionRecord rec = masterFactionListModel.getFactionRecord(</b>
<b class="nc">&nbsp;                        tblMasterFactionList.convertRowIndexToModel(</b>
<b class="nc">&nbsp;                                tblMasterFactionList.getSelectedRow()));</b>
<b class="nc">&nbsp;                masterFactionListModel.delRecord(rec);</b>
<b class="nc">&nbsp;                rg.removeFaction(rec);</b>
&nbsp;            }
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        button = new JButton(&quot;Copy&quot;);</b>
<b class="nc">&nbsp;        gbc.gridx = 3;</b>
<b class="nc">&nbsp;        gbc.gridy = 0;</b>
<b class="nc">&nbsp;        panFactionEditorTab.add(button, gbc);</b>
<b class="nc">&nbsp;        button.addActionListener(ev -&gt; {</b>
<b class="nc">&nbsp;            if (txtNewFaction.getText().length() &gt; 0</b>
<b class="nc">&nbsp;                    &amp;&amp; tblMasterFactionList.getSelectedRow() &gt;= 0) {</b>
<b class="nc">&nbsp;                FactionRecord from = masterFactionListModel.getFactionRecord(</b>
<b class="nc">&nbsp;                        tblMasterFactionList.convertRowIndexToModel(</b>
<b class="nc">&nbsp;                                tblMasterFactionList.getSelectedRow()));</b>
<b class="nc">&nbsp;                FactionRecord rec = new FactionRecord(txtNewFaction.getText());</b>
<b class="nc">&nbsp;                rec.setClan(from.isClan());</b>
<b class="nc">&nbsp;                rec.setRatings(String.join(&quot;,&quot;, from.getRatingLevels()));</b>
<b class="nc">&nbsp;                rg.addFaction(rec);</b>
<b class="nc">&nbsp;                masterFactionListModel.addRecord(rec);</b>
&nbsp;            }
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        chkShowSubfactions.setText(&quot;Show Subfactions&quot;);</b>
<b class="nc">&nbsp;        chkShowSubfactions.setSelected(true);</b>
<b class="nc">&nbsp;        gbc.gridx = 4;</b>
<b class="nc">&nbsp;        gbc.gridy = 0;</b>
<b class="nc">&nbsp;        panFactionEditorTab.add(chkShowSubfactions, gbc);</b>
<b class="nc">&nbsp;        chkShowSubfactions.addActionListener(ev -&gt; filterFactionList());</b>
&nbsp;
<b class="nc">&nbsp;        chkShowMinorFactions.setText(&quot;Show Minor Factions&quot;);</b>
<b class="nc">&nbsp;        chkShowMinorFactions.setSelected(true);</b>
<b class="nc">&nbsp;        gbc.gridx = 5;</b>
<b class="nc">&nbsp;        gbc.gridy = 0;</b>
<b class="nc">&nbsp;        panFactionEditorTab.add(chkShowMinorFactions, gbc);</b>
<b class="nc">&nbsp;        chkShowMinorFactions.addActionListener(ev -&gt; filterFactionList());</b>
&nbsp;
<b class="nc">&nbsp;        masterFactionListModel = new FactionListTableModel(rg.getFactionList());</b>
<b class="nc">&nbsp;        tblMasterFactionList.setModel(masterFactionListModel);</b>
<b class="nc">&nbsp;        masterFactionListSorter =</b>
&nbsp;                new TableRowSorter&lt;&gt;(masterFactionListModel);
<b class="nc">&nbsp;        List&lt;RowSorter.SortKey&gt; sortKeys = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        sortKeys.add(new RowSorter.SortKey(FactionListTableModel.COL_CODE, SortOrder.ASCENDING));</b>
<b class="nc">&nbsp;        sortKeys.add(new RowSorter.SortKey(FactionListTableModel.COL_NAME, SortOrder.ASCENDING));</b>
<b class="nc">&nbsp;        sortKeys.add(new RowSorter.SortKey(FactionListTableModel.COL_CLAN, SortOrder.ASCENDING));</b>
<b class="nc">&nbsp;        masterFactionListSorter.setSortKeys(sortKeys);</b>
<b class="nc">&nbsp;        tblMasterFactionList.setRowSorter(masterFactionListSorter);</b>
<b class="nc">&nbsp;        tblMasterFactionList.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);</b>
<b class="nc">&nbsp;        tblMasterFactionList.getSelectionModel().addListSelectionListener(arg0 -&gt; {</b>
<b class="nc">&nbsp;            if (tblMasterFactionList.getSelectedRow() &gt;= 0) {</b>
<b class="nc">&nbsp;                FactionRecord rec = masterFactionListModel.</b>
<b class="nc">&nbsp;                        getFactionRecord(tblMasterFactionList.</b>
<b class="nc">&nbsp;                                convertRowIndexToModel(tblMasterFactionList.</b>
<b class="nc">&nbsp;                                        getSelectedRow()));</b>
<b class="nc">&nbsp;                factionEditorModel.setData(rec);</b>
<b class="nc">&nbsp;                salvageEditorModel.setData(rec);</b>
<b class="nc">&nbsp;            } else {</b>
<b class="nc">&nbsp;                factionEditorModel.clearData();</b>
<b class="nc">&nbsp;                salvageEditorModel.clearData();</b>
&nbsp;            }
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        JScrollPane scroll = new JScrollPane();</b>
<b class="nc">&nbsp;        scroll.setMinimumSize(new Dimension(600, 400));</b>
<b class="nc">&nbsp;        scroll.setPreferredSize(new Dimension(600, 400));</b>
<b class="nc">&nbsp;        scroll.setViewportView(tblMasterFactionList);</b>
<b class="nc">&nbsp;        gbc.gridx = 0;</b>
<b class="nc">&nbsp;        gbc.gridy = 1;</b>
<b class="nc">&nbsp;        gbc.gridwidth = 6;</b>
<b class="nc">&nbsp;        gbc.gridheight = 4;</b>
<b class="nc">&nbsp;        panFactionEditorTab.add(scroll, gbc);</b>
&nbsp;
<b class="nc">&nbsp;        factionEditorModel = new FactionEditorTableModel(null);</b>
<b class="nc">&nbsp;        tblFactionEditor.setModel(factionEditorModel);</b>
<b class="nc">&nbsp;        tblFactionEditor.createDefaultColumnsFromModel();</b>
<b class="nc">&nbsp;        tblFactionEditor.setAutoResizeMode(JTable.AUTO_RESIZE_OFF);</b>
<b class="nc">&nbsp;        scroll = new JScrollPane(tblFactionEditor, JScrollPane.VERTICAL_SCROLLBAR_ALWAYS,</b>
&nbsp;                JScrollPane.HORIZONTAL_SCROLLBAR_AS_NEEDED);
<b class="nc">&nbsp;        scroll.setMinimumSize(new Dimension(600, 200));</b>
<b class="nc">&nbsp;        scroll.setPreferredSize(new Dimension(600, 200));</b>
<b class="nc">&nbsp;        scroll.setViewportView(tblFactionEditor);</b>
<b class="nc">&nbsp;        gbc.gridx = 6;</b>
<b class="nc">&nbsp;        gbc.gridy = 1;</b>
<b class="nc">&nbsp;        gbc.gridwidth = 8;</b>
<b class="nc">&nbsp;        gbc.gridheight = 1;</b>
<b class="nc">&nbsp;        panFactionEditorTab.add(scroll, gbc);</b>
&nbsp;
<b class="nc">&nbsp;        txtSalvageFaction.setMinimumSize(new Dimension(60,25));</b>
<b class="nc">&nbsp;        txtSalvageFaction.setPreferredSize(new Dimension(60,25));</b>
<b class="nc">&nbsp;        gbc.gridx = 6;</b>
<b class="nc">&nbsp;        gbc.gridy = 2;</b>
<b class="nc">&nbsp;        gbc.gridwidth = 1;</b>
<b class="nc">&nbsp;        panFactionEditorTab.add(txtSalvageFaction, gbc);</b>
&nbsp;
<b class="nc">&nbsp;        button = new JButton(&quot;Add Row&quot;);</b>
<b class="nc">&nbsp;        gbc.gridx = 7;</b>
<b class="nc">&nbsp;        gbc.gridy = 2;</b>
<b class="nc">&nbsp;        panFactionEditorTab.add(button, gbc);</b>
<b class="nc">&nbsp;        button.addActionListener(ev -&gt; salvageEditorModel.addEntry(txtSalvageFaction.getText()));</b>
&nbsp;
<b class="nc">&nbsp;        button = new JButton(&quot;Delete Row&quot;);</b>
<b class="nc">&nbsp;        gbc.gridx = 8;</b>
<b class="nc">&nbsp;        gbc.gridy = 2;</b>
<b class="nc">&nbsp;        panFactionEditorTab.add(button, gbc);</b>
<b class="nc">&nbsp;        button.addActionListener(ev -&gt; {</b>
<b class="nc">&nbsp;                if (tblSalvageEditor.getSelectedRow() &gt;= 0) {</b>
<b class="nc">&nbsp;                    salvageEditorModel.removeEntry(tblSalvageEditor.convertRowIndexToModel(tblSalvageEditor.getSelectedRow()));</b>
&nbsp;                }
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        button = new JButton(&quot;Copy Row&quot;);</b>
<b class="nc">&nbsp;        gbc.gridx = 9;</b>
<b class="nc">&nbsp;        gbc.gridy = 2;</b>
<b class="nc">&nbsp;        panFactionEditorTab.add(button, gbc);</b>
<b class="nc">&nbsp;        button.addActionListener(ev -&gt; {</b>
<b class="nc">&nbsp;                if (tblSalvageEditor.getSelectedRow() &gt;= 0) {</b>
<b class="nc">&nbsp;                    salvageEditorModel.copyRow(tblSalvageEditor.convertRowIndexToModel(tblSalvageEditor.getSelectedRow()),</b>
<b class="nc">&nbsp;                            txtSalvageFaction.getText());</b>
&nbsp;                }
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        salvageEditorModel = new SalvageEditorTableModel();</b>
<b class="nc">&nbsp;        tblSalvageEditor.setModel(salvageEditorModel);</b>
<b class="nc">&nbsp;        tblSalvageEditor.createDefaultColumnsFromModel();</b>
<b class="nc">&nbsp;        tblSalvageEditor.setAutoResizeMode(JTable.AUTO_RESIZE_OFF);</b>
<b class="nc">&nbsp;        scroll = new JScrollPane(tblSalvageEditor, JScrollPane.VERTICAL_SCROLLBAR_ALWAYS,</b>
&nbsp;                JScrollPane.HORIZONTAL_SCROLLBAR_AS_NEEDED);
<b class="nc">&nbsp;        scroll.setMinimumSize(new Dimension(600, 200));</b>
<b class="nc">&nbsp;        scroll.setPreferredSize(new Dimension(600, 200));</b>
<b class="nc">&nbsp;        scroll.setViewportView(tblSalvageEditor);</b>
<b class="nc">&nbsp;        gbc.gridx = 6;</b>
<b class="nc">&nbsp;        gbc.gridy = 3;</b>
<b class="nc">&nbsp;        gbc.gridwidth = 8;</b>
<b class="nc">&nbsp;        gbc.weightx = 1.0;</b>
<b class="nc">&nbsp;        panFactionEditorTab.add(scroll, gbc);</b>
&nbsp;
<b class="nc">&nbsp;        return panFactionEditorTab;</b>
&nbsp;    }
&nbsp;
&nbsp;    private void filterFactionList() {
&nbsp;        RowFilter&lt;FactionListTableModel, Integer&gt; rf;
<b class="nc">&nbsp;        rf = new RowFilter&lt;FactionListTableModel, Integer&gt;() {</b>
&nbsp;            @Override
&nbsp;            public boolean include(Entry&lt;? extends FactionListTableModel,
&nbsp;                    ? extends Integer&gt; entry) {
<b class="nc">&nbsp;                FactionListTableModel model = entry.getModel();</b>
<b class="nc">&nbsp;                FactionRecord rec = model.getFactionRecord(entry.getIdentifier());</b>
<b class="nc">&nbsp;                if (!chkShowSubfactions.isSelected() &amp;&amp;</b>
<b class="nc">&nbsp;                        rec.getKey().contains(&quot;.&quot;)) {</b>
<b class="nc">&nbsp;                    return false;</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                return chkShowMinorFactions.isSelected() ||</b>
<b class="nc">&nbsp;                        rec.getParentFactions() == null;</b>
&nbsp;            }
&nbsp;        };
<b class="nc">&nbsp;        masterFactionListSorter.setRowFilter(rf);</b>
&nbsp;    }
&nbsp;
&nbsp;    private void filterMasterUnitList() {
&nbsp;        RowFilter&lt;MasterUnitListTableModel, Integer&gt; rf;
<b class="nc">&nbsp;        rf = new RowFilter&lt;MasterUnitListTableModel, Integer&gt;() {</b>
&nbsp;            @Override
&nbsp;            public boolean include(Entry&lt;? extends MasterUnitListTableModel,
&nbsp;                    ? extends Integer&gt; entry) {
<b class="nc">&nbsp;                MasterUnitListTableModel model = entry.getModel();</b>
<b class="nc">&nbsp;                ModelRecord rec = model.getUnitRecord(entry.getIdentifier());</b>
<b class="nc">&nbsp;                if (cbUnitType.getSelectedIndex() &gt; 0 &amp;&amp;</b>
<b class="nc">&nbsp;                        !UnitType.getTypeName(rec.getUnitType()).equals(cbUnitType.getSelectedItem())) {</b>
<b class="nc">&nbsp;                    return false;</b>
&nbsp;                }
<b class="nc">&nbsp;                if (cbMovementType.getSelectedIndex() &gt; 0 &amp;&amp;</b>
<b class="nc">&nbsp;                        (rec.getMovementMode() != EntityMovementMode.getMode((String) cbMovementType.getSelectedItem()))) {</b>
<b class="nc">&nbsp;                    return false;</b>
&nbsp;                }
<b class="nc">&nbsp;                if (txtSearch.getText().length() &gt; 0) {</b>
<b class="nc">&nbsp;                    return rec.getKey().toLowerCase().contains(txtSearch.getText().toLowerCase());</b>
&nbsp;                }
<b class="nc">&nbsp;                return true;</b>
&nbsp;            }
&nbsp;        };
<b class="nc">&nbsp;        masterUnitListSorter.setRowFilter(rf);</b>
&nbsp;    }
&nbsp;
&nbsp;    private static class MasterUnitListTableModel extends DefaultTableModel {
&nbsp;
&nbsp;        /**
&nbsp;         * 
&nbsp;         */
&nbsp;        private static final long serialVersionUID = 2792332961159226169L;
&nbsp;
&nbsp;        public static final int COL_CHASSIS = 0;
&nbsp;        public static final int COL_MODEL = 1;
&nbsp;        public static final int COL_UNIT_TYPE = 2;
&nbsp;        public static final int COL_YEAR = 3;
&nbsp;        public static final int COL_ROLE = 4;
&nbsp;        public static final int COL_DEPLOYED_WITH = 5;
&nbsp;        public static final int COL_EXCLUDE_FACTIONS = 6;
&nbsp;        public static final int NUM_COLS = 7;
<b class="nc">&nbsp;        public static final String[] colNames = {</b>
&nbsp;                &quot;Chassis&quot;, &quot;Model&quot;, &quot;Unit Type&quot;, &quot;Year&quot;, &quot;Role&quot;, &quot;Deployed With&quot;, &quot;Exclude Factions&quot;
&nbsp;        };
&nbsp;
&nbsp;        private ArrayList&lt;ModelRecord&gt; data;
&nbsp;
<b class="nc">&nbsp;        public MasterUnitListTableModel(Collection&lt;ModelRecord&gt; modelList) {</b>
<b class="nc">&nbsp;            data = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;            data.addAll(modelList);</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public String getColumnName(int column) {
<b class="nc">&nbsp;            return colNames[column];</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public int getColumnCount() {
<b class="nc">&nbsp;            return NUM_COLS;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public int getRowCount() {
<b class="nc">&nbsp;            if (data == null) {</b>
<b class="nc">&nbsp;                return 0;</b>
&nbsp;            }
<b class="nc">&nbsp;            return data.size();</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public boolean isCellEditable(int row, int col) {
<b class="nc">&nbsp;            return col &gt;= COL_ROLE;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public Class&lt;?&gt; getColumnClass(int col) {
<b class="nc">&nbsp;            if (col == COL_YEAR) {</b>
<b class="nc">&nbsp;                return Integer.class;</b>
&nbsp;            }
<b class="nc">&nbsp;            return String.class;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public Object getValueAt(int row, int col) {
<b class="nc">&nbsp;            switch (col) {</b>
&nbsp;                case COL_CHASSIS:
<b class="nc">&nbsp;                    return data.get(row).getChassis();</b>
&nbsp;                case COL_MODEL:
<b class="nc">&nbsp;                    if (data.get(row).isClan()) {</b>
<b class="nc">&nbsp;                        return data.get(row).getModel() + &quot;[C]&quot;;</b>
<b class="nc">&nbsp;                    } else if (data.get(row).isSL()) {</b>
<b class="nc">&nbsp;                        return data.get(row).getModel() + &quot;[*]&quot;;</b>
&nbsp;                    } 
<b class="nc">&nbsp;                    return data.get(row).getModel();</b>
&nbsp;                case COL_UNIT_TYPE:
<b class="nc">&nbsp;                    if (data.get(row).getMechSummary() == null) {</b>
<b class="nc">&nbsp;                        System.err.println(&quot;Could not find mechsummary for &quot; + data.get(row).getKey());</b>
&nbsp;                    }
<b class="nc">&nbsp;                    return data.get(row).getMechSummary().getUnitType();</b>
&nbsp;                case COL_YEAR:
<b class="nc">&nbsp;                    if (data.get(row).getMechSummary() == null) {</b>
<b class="nc">&nbsp;                        System.err.println(&quot;Could not find mechsummary for &quot; + data.get(row).getKey());</b>
&nbsp;                    }
<b class="nc">&nbsp;                    return data.get(row).getMechSummary().getYear();</b>
&nbsp;                case COL_ROLE:
<b class="nc">&nbsp;                    return data.get(row).getRoles().stream().map(Object::toString).collect(Collectors.joining(&quot;,&quot;));</b>
&nbsp;                case COL_DEPLOYED_WITH:
<b class="nc">&nbsp;                    StringJoiner sj = new StringJoiner(&quot;,&quot;);</b>
<b class="nc">&nbsp;                    data.get(row).getDeployedWith().forEach(sj::add);</b>
<b class="nc">&nbsp;                    data.get(row).getRequiredUnits().forEach(s -&gt; sj.add(&quot;req:&quot; + s));</b>
<b class="nc">&nbsp;                    return sj.toString();</b>
&nbsp;                case COL_EXCLUDE_FACTIONS:
<b class="nc">&nbsp;                    return String.join(&quot;,&quot;, data.get(row).getExcludedFactions());</b>
&nbsp;                default:
<b class="nc">&nbsp;                    return &quot;?&quot;;</b>
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void setValueAt(Object val, int row, int col) {
<b class="nc">&nbsp;            if (col == COL_ROLE) {</b>
<b class="nc">&nbsp;                data.get(row).addRoles((String)val);</b>
<b class="nc">&nbsp;            } else if (col == COL_DEPLOYED_WITH) {</b>
<b class="nc">&nbsp;                data.get(row).getRequiredUnits().clear();</b>
<b class="nc">&nbsp;                data.get(row).getDeployedWith().clear();</b>
<b class="nc">&nbsp;                if (((String)val).length() &gt; 0) {</b>
<b class="nc">&nbsp;                    for (String unit : ((String)val).split(&quot;,&quot;)) {</b>
<b class="nc">&nbsp;                        if (unit.startsWith(&quot;req:&quot;)) {</b>
<b class="nc">&nbsp;                            data.get(row).getRequiredUnits().add(unit);             </b>
&nbsp;                        } else {
<b class="nc">&nbsp;                            data.get(row).getDeployedWith().add(unit);</b>
&nbsp;                        }
&nbsp;                    }
&nbsp;                }
<b class="nc">&nbsp;            } else if (col == COL_EXCLUDE_FACTIONS) {</b>
<b class="nc">&nbsp;                data.get(row).setExcludedFactions((String)val);</b>
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;        public ModelRecord getUnitRecord(int row) {
<b class="nc">&nbsp;            return data.get(row);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private static class UnitEditorTableModel extends DefaultTableModel {
&nbsp;
&nbsp;        private static final long serialVersionUID = 1323721840252090355L;
&nbsp;
&nbsp;        public static final int MODE_MODEL = 0;
&nbsp;        public static final int MODE_CHASSIS = 1;
&nbsp;        public static final int MODE_SUMMARY = 2;
&nbsp;
&nbsp;        ArrayList&lt;String&gt; factions;
&nbsp;        HashMap&lt;String, ArrayList&lt;String&gt;&gt; data;
&nbsp;        private int mode;
&nbsp;        private AbstractUnitRecord unitRecord;
&nbsp;        
&nbsp;        private String getUnitKey() {
<b class="nc">&nbsp;            return (mode == MODE_CHASSIS) ? unitRecord.getChassisKey() : unitRecord.getKey();</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        public UnitEditorTableModel() {</b>
<b class="nc">&nbsp;            factions = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;            data = new HashMap&lt;&gt;();</b>
<b class="nc">&nbsp;            unitRecord = null;</b>
&nbsp;        }
&nbsp;
&nbsp;        public void clearData() {
<b class="nc">&nbsp;            factions.clear();</b>
<b class="nc">&nbsp;            data.clear();</b>
<b class="nc">&nbsp;            unitRecord = null;</b>
<b class="nc">&nbsp;            fireTableDataChanged();</b>
&nbsp;        }
&nbsp;
&nbsp;        public void setData(AbstractUnitRecord unitRec, int mode) {
<b class="nc">&nbsp;            factions.clear();</b>
<b class="nc">&nbsp;            data.clear();</b>
<b class="nc">&nbsp;            this.mode = mode;</b>
<b class="nc">&nbsp;            unitRecord = unitRec;</b>
<b class="nc">&nbsp;            final ArrayList&lt;String&gt; empty = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;            while (empty.size() &lt; rg.getEraSet().size()) {</b>
<b class="nc">&nbsp;                empty.add(&quot;&quot;);</b>
&nbsp;            }
<b class="nc">&nbsp;            for (int i = 0; i &lt; rg.getEraSet().size(); i++) {</b>
<b class="nc">&nbsp;                Collection&lt;AvailabilityRating&gt; recs = (mode == MODE_MODEL)?</b>
<b class="nc">&nbsp;                        rg.getModelFactionRatings(ERAS[i], getUnitKey()):</b>
<b class="nc">&nbsp;                            rg.getChassisFactionRatings(ERAS[i], unitRec.getChassisKey());</b>
<b class="nc">&nbsp;                        if (recs != null) {</b>
<b class="nc">&nbsp;                            for (AvailabilityRating rec : recs) {</b>
<b class="nc">&nbsp;                                String key = rec.getFactionCode();</b>
<b class="nc">&nbsp;                                if (!factions.contains(key)) {</b>
<b class="nc">&nbsp;                                    factions.add(key);</b>
<b class="nc">&nbsp;                                    data.put(key, new ArrayList&lt;&gt;(empty));</b>
&nbsp;                                }
<b class="nc">&nbsp;                                if (mode == MODE_SUMMARY) {</b>
<b class="nc">&nbsp;                                    AvailabilityRating mar = rg.findModelAvailabilityRecord(ERAS[i],</b>
<b class="nc">&nbsp;                                            unitRec.getKey(), rec.getFaction());</b>
<b class="nc">&nbsp;                                    if (mar != null) {</b>
<b class="nc">&nbsp;                                        int weight = (int)((rec.getWeight() * 10.0 * mar.getWeight()) /</b>
<b class="nc">&nbsp;                                                rg.getChassisRecord(unitRec.getChassisKey()).</b>
<b class="nc">&nbsp;                                                totalModelWeight(ERAS[i], rec.getFaction()) + 0.5);</b>
<b class="nc">&nbsp;                                        if (weight &gt; 0) {</b>
<b class="nc">&nbsp;                                            data.get(key).set(i, Integer.toString(weight));</b>
&nbsp;                                        }
&nbsp;                                    } 
<b class="nc">&nbsp;                                } else if (rec.getEra() == rec.getStartYear()){</b>
<b class="nc">&nbsp;                                    data.get(key).set(i, rec.getAvailabilityCode());</b>
&nbsp;                                } else {
<b class="nc">&nbsp;                                    data.get(key).set(i, rec.getAvailabilityCode() + &quot;:&quot; + rec.getStartYear());                     </b>
&nbsp;                                }
<b class="nc">&nbsp;                            }</b>
&nbsp;                        }
&nbsp;            }
<b class="nc">&nbsp;            fireTableDataChanged();</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public String getColumnName(int col) {
<b class="nc">&nbsp;            if (col == 0) {</b>
<b class="nc">&nbsp;                return &quot;Faction&quot;;</b>
&nbsp;            }
<b class="nc">&nbsp;            return Integer.toString(ERAS[col - 1]); </b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public int getColumnCount() {
<b class="nc">&nbsp;            if (data == null) {</b>
<b class="nc">&nbsp;                return 0;</b>
&nbsp;            }
<b class="nc">&nbsp;            return ERAS.length + 1;</b>
&nbsp;        }
&nbsp;
&nbsp;        public int getRowCount() {
<b class="nc">&nbsp;            if (data == null) {</b>
<b class="nc">&nbsp;                return 0;</b>
&nbsp;            }
<b class="nc">&nbsp;            return data.size();</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public Class&lt;?&gt; getColumnClass(int col) {
<b class="nc">&nbsp;            return String.class;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public Object getValueAt(int row, int col) {
<b class="nc">&nbsp;            if (col == 0) {</b>
<b class="nc">&nbsp;                return factions.get(row);</b>
&nbsp;            } else {
<b class="nc">&nbsp;                return data.get(factions.get(row)).get(col - 1);</b>
&nbsp;            } 
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public boolean isCellEditable(int row, int col) {
<b class="nc">&nbsp;            return mode &lt; MODE_SUMMARY &amp;&amp; col &gt; 0;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void setValueAt(Object value, int row, int col) {
&nbsp;            AvailabilityRating ar;
<b class="nc">&nbsp;            int era = ERAS[col - 1];</b>
<b class="nc">&nbsp;            if ((value).equals(&quot;&quot;)) {</b>
<b class="nc">&nbsp;                ar = null;</b>
<b class="nc">&nbsp;            } else if (!((String)value).matches(&quot;\\d+[+\\-]?(:\\d+)?&quot;)) {</b>
&nbsp;                return;
&nbsp;            } else {
<b class="nc">&nbsp;                ar = new AvailabilityRating(getUnitKey(), era,</b>
<b class="nc">&nbsp;                        factions.get(row) + &quot;:&quot; + value);</b>
&nbsp;            }
<b class="nc">&nbsp;            data.get(factions.get(row)).set(col - 1, (String)value);</b>
<b class="nc">&nbsp;            if (rg.getChassisRecord(getUnitKey()) != null) {</b>
<b class="nc">&nbsp;                if (ar == null) {</b>
<b class="nc">&nbsp;                    rg.removeChassisFactionRating(era, getUnitKey(), factions.get(row));                </b>
&nbsp;                } else {
<b class="nc">&nbsp;                    rg.setChassisFactionRating(era, getUnitKey(), ar);</b>
&nbsp;                }
&nbsp;            } else {
<b class="nc">&nbsp;                if (ar == null) {</b>
<b class="nc">&nbsp;                    rg.removeModelFactionRating(era, getUnitKey(), factions.get(row));               </b>
&nbsp;                } else {
<b class="nc">&nbsp;                    rg.setModelFactionRating(era, getUnitKey(), ar);</b>
&nbsp;                }
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;        public boolean addEntry(String faction) {
<b class="nc">&nbsp;            if(unitRecord == null) {                 </b>
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
&nbsp;            
<b class="nc">&nbsp;            if(mode == MODE_MODEL) {</b>
<b class="nc">&nbsp;                boolean chassisRecordFound = false;</b>
<b class="nc">&nbsp;                for(int era : ERAS) {</b>
<b class="nc">&nbsp;                    if(rg.getChassisFactionRatings(era, unitRecord.getChassisKey()) != null) {</b>
<b class="nc">&nbsp;                        chassisRecordFound = true;</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    }
&nbsp;                }
&nbsp;                
<b class="nc">&nbsp;                if(!chassisRecordFound) {</b>
<b class="nc">&nbsp;                    return false;</b>
&nbsp;                }
&nbsp;            }                    
&nbsp;            
<b class="nc">&nbsp;            factions.add(faction);</b>
<b class="nc">&nbsp;            ArrayList&lt;String&gt; list = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;            while (list.size() &lt; ERAS.length) {</b>
<b class="nc">&nbsp;                list.add(&quot;&quot;);</b>
&nbsp;            }
<b class="nc">&nbsp;            data.put(faction, list);</b>
<b class="nc">&nbsp;            fireTableDataChanged();</b>
<b class="nc">&nbsp;            return true;</b>
&nbsp;        }
&nbsp;
&nbsp;        public void removeEntry(int row) {
<b class="nc">&nbsp;            for (int era : ERAS) {</b>
<b class="nc">&nbsp;                if (mode == MODE_CHASSIS) {</b>
<b class="nc">&nbsp;                    rg.removeChassisFactionRating(era, getUnitKey(), factions.get(row));                </b>
&nbsp;                } else {
<b class="nc">&nbsp;                    rg.removeModelFactionRating(era, getUnitKey(), factions.get(row));                               </b>
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            data.remove(factions.get(row));</b>
<b class="nc">&nbsp;            factions.remove(row);</b>
<b class="nc">&nbsp;            fireTableDataChanged();</b>
&nbsp;        }
&nbsp;
&nbsp;        public void copyRow(int row, String newFaction) {
<b class="nc">&nbsp;            ArrayList&lt;String&gt; copyFrom = data.get(factions.get(row));</b>
<b class="nc">&nbsp;            factions.add(newFaction);</b>
<b class="nc">&nbsp;            ArrayList&lt;String&gt; copyTo = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;            for (int i = 0; i &lt; ERAS.length; i++) {</b>
<b class="nc">&nbsp;                copyTo.add(copyFrom.get(i));</b>
&nbsp;            }       
<b class="nc">&nbsp;            data.put(newFaction, copyTo);</b>
<b class="nc">&nbsp;            for (int i = 0; i &lt; ERAS.length; i++) {</b>
<b class="nc">&nbsp;                if (!copyFrom.get(i).equals(&quot;&quot;)) {</b>
<b class="nc">&nbsp;                    AvailabilityRating ar = new AvailabilityRating(getUnitKey(), ERAS[i],</b>
<b class="nc">&nbsp;                            newFaction + &quot;:&quot; + copyFrom.get(i));</b>
<b class="nc">&nbsp;                    if (mode == MODE_MODEL) {</b>
<b class="nc">&nbsp;                        rg.setModelFactionRating(ERAS[i], getUnitKey(), ar);</b>
&nbsp;                    } else {
<b class="nc">&nbsp;                        rg.setChassisFactionRating(ERAS[i], getUnitKey(), ar);</b>
&nbsp;                    }
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            fireTableDataChanged();</b>
&nbsp;        }
&nbsp;
&nbsp;        public int getMode() {
<b class="nc">&nbsp;            return mode;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private static class UnitTypeComparator implements Comparator&lt;String&gt; {
&nbsp;        private Map&lt;String, Integer&gt; keys;
&nbsp;
<b class="nc">&nbsp;        public UnitTypeComparator() {</b>
<b class="nc">&nbsp;            keys = new HashMap&lt;&gt;();</b>
<b class="nc">&nbsp;            for (int i = 0; i &lt; UnitType.SIZE; i++) {</b>
<b class="nc">&nbsp;                keys.put(UnitType.getTypeName(i), i);</b>
&nbsp;            }
&nbsp;        }
&nbsp;        @Override
&nbsp;        public int compare(String arg0, String arg1) {
<b class="nc">&nbsp;            return keys.get(arg0) - keys.get(arg1);</b>
&nbsp;        }
&nbsp;
&nbsp;    }
&nbsp;
&nbsp;    private static class FactionListTableModel extends DefaultTableModel {
&nbsp;
&nbsp;        /**
&nbsp;         * 
&nbsp;         */
&nbsp;        private static final long serialVersionUID = -2719685611810784836L;
&nbsp;
&nbsp;        public static final int COL_CODE = 0;
&nbsp;        public static final int COL_NAME = 1;
&nbsp;        public static final int COL_YEARS = 2;
&nbsp;        public static final int COL_MINOR = 3;
&nbsp;        public static final int COL_CLAN = 4;
&nbsp;        public static final int COL_PERIPHERY = 5;
&nbsp;        public static final int COL_RATINGS = 6;
&nbsp;        public static final int COL_USE_ALT_FACTION = 7;
&nbsp;        public static final int NUM_COLS = 8;
&nbsp;        
<b class="nc">&nbsp;        public static final String[] colNames = {&quot;Code&quot;, &quot;Name&quot;, &quot;Years&quot;, &quot;Minor&quot;, &quot;Clan&quot;,</b>
&nbsp;            &quot;Periphery&quot;, &quot;Ratings&quot;, &quot;Use Alt&quot;};
&nbsp;        
&nbsp;        private ArrayList&lt;FactionRecord&gt; data;
&nbsp;        
<b class="nc">&nbsp;        public FactionListTableModel(Collection&lt;FactionRecord&gt; factionList) {</b>
<b class="nc">&nbsp;            data = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;            data.addAll(factionList);</b>
&nbsp;        }
&nbsp;        
&nbsp;        public void addRecord(FactionRecord rec) {
<b class="nc">&nbsp;            data.add(rec);</b>
<b class="nc">&nbsp;            fireTableDataChanged();</b>
&nbsp;        }
&nbsp;        
&nbsp;        public void delRecord(FactionRecord rec) {
<b class="nc">&nbsp;            data.remove(rec);</b>
<b class="nc">&nbsp;            fireTableDataChanged();</b>
&nbsp;        }
&nbsp;        
&nbsp;        @Override
&nbsp;        public String getColumnName(int column) {
<b class="nc">&nbsp;            return colNames[column];</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public int getColumnCount() {
<b class="nc">&nbsp;            return NUM_COLS;</b>
&nbsp;        }
&nbsp;        
&nbsp;        @Override
&nbsp;        public int getRowCount() {
<b class="nc">&nbsp;            if (data == null) {</b>
<b class="nc">&nbsp;                return 0;</b>
&nbsp;            }
<b class="nc">&nbsp;            return data.size();</b>
&nbsp;        }
&nbsp;        
&nbsp;        @Override
&nbsp;        public boolean isCellEditable(int row, int col) {
<b class="nc">&nbsp;            return col &gt; COL_CODE;</b>
&nbsp;        }
&nbsp;        
&nbsp;        @Override
&nbsp;        public Class&lt;?&gt; getColumnClass(int col) {
<b class="nc">&nbsp;            if (col == COL_MINOR || col == COL_CLAN || col == COL_PERIPHERY) {</b>
<b class="nc">&nbsp;                return Boolean.class;</b>
&nbsp;            }
<b class="nc">&nbsp;            return String.class;</b>
&nbsp;        }
&nbsp;        
&nbsp;        @Override
&nbsp;        public Object getValueAt(int row, int col) {
<b class="nc">&nbsp;            switch (col) {</b>
&nbsp;            case COL_CODE:
<b class="nc">&nbsp;                return data.get(row).getKey();</b>
&nbsp;            case COL_NAME:
<b class="nc">&nbsp;                return data.get(row).getNamesAsString();</b>
&nbsp;            case COL_YEARS:
<b class="nc">&nbsp;                return data.get(row).getYearsAsString();</b>
&nbsp;            case COL_MINOR:
<b class="nc">&nbsp;                return data.get(row).isMinor();</b>
&nbsp;            case COL_CLAN:
<b class="nc">&nbsp;                return data.get(row).isClan();</b>
&nbsp;            case COL_PERIPHERY:
<b class="nc">&nbsp;                return data.get(row).isPeriphery();</b>
&nbsp;            case COL_RATINGS:
<b class="nc">&nbsp;                return String.join(&quot;,&quot;, data.get(row).getRatingLevels());</b>
&nbsp;            case COL_USE_ALT_FACTION:
<b class="nc">&nbsp;                return String.join(&quot;,&quot;, data.get(row).getParentFactions());</b>
&nbsp;            default:
<b class="nc">&nbsp;                return &quot;?&quot;;</b>
&nbsp;            }
&nbsp;        }
&nbsp;        
&nbsp;        @Override
&nbsp;        public void setValueAt(Object val, int row, int col) {
<b class="nc">&nbsp;            switch (col) {</b>
&nbsp;            case COL_CLAN:
<b class="nc">&nbsp;                data.get(row).setClan((Boolean)val);</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            case COL_PERIPHERY:
<b class="nc">&nbsp;                data.get(row).setPeriphery((Boolean)val);</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            case COL_NAME:
<b class="nc">&nbsp;                data.get(row).setNames((String)val);</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            case COL_YEARS:
&nbsp;                try {
<b class="nc">&nbsp;                    data.get(row).setYears((String)val);</b>
<b class="nc">&nbsp;                } catch (Exception ex) {</b>
&nbsp;                    //Illegal format; ignore new value
<b class="nc">&nbsp;                }</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            case COL_MINOR:
<b class="nc">&nbsp;                data.get(row).setMinor((Boolean)val);</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            case COL_RATINGS:
<b class="nc">&nbsp;                data.get(row).setRatings((String)val);</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            case COL_USE_ALT_FACTION:
<b class="nc">&nbsp;                data.get(row).setParentFactions((String)val);</b>
&nbsp;            }
&nbsp;        }
&nbsp;        
&nbsp;        public FactionRecord getFactionRecord(int row) {
<b class="nc">&nbsp;            return data.get(row);</b>
&nbsp;        }
&nbsp;        
&nbsp;    }
&nbsp;    
&nbsp;    private static class FactionEditorTableModel extends DefaultTableModel {
&nbsp;        
&nbsp;        private static final long serialVersionUID = 5324520609209690560L;
&nbsp;        
&nbsp;        private static final int CAT_OMNI_PCT = 0;
&nbsp;        private static final int CAT_CLAN_PCT = 1;
&nbsp;        private static final int CAT_SL_PCT = 2;
&nbsp;        private static final int CAT_OMNI_AERO_PCT = 3;
&nbsp;        private static final int CAT_CLAN_AERO_PCT = 4;
&nbsp;        private static final int CAT_SL_AERO_PCT = 5;
&nbsp;        private static final int CAT_CLAN_VEE_PCT = 6;
&nbsp;        private static final int CAT_SL_VEE_PCT = 7;
<b class="nc">&nbsp;        private static final String [] CATEGORIES = {</b>
&nbsp;            &quot;Omni %&quot;, &quot;Clan %&quot;, &quot;SL %&quot;,
&nbsp;            &quot;Omni % (Aero)&quot;, &quot;Clan % (Aero)&quot;, &quot;SL % (Aero)&quot;,
&nbsp;            &quot;Clan % (Vee)&quot;, &quot;SL % (Vee)&quot;
&nbsp;        };
&nbsp;        
<b class="nc">&nbsp;        private static final int[] WEIGHT_DIST_UNIT_TYPES = {</b>
&nbsp;                UnitType.MEK, UnitType.TANK, UnitType.AERO
&nbsp;        };
&nbsp;        
&nbsp;        private FactionRecord factionRec;
&nbsp;        
<b class="nc">&nbsp;        public FactionEditorTableModel(FactionRecord rec) {</b>
<b class="nc">&nbsp;            factionRec = rec;</b>
&nbsp;        }
&nbsp;
&nbsp;        public void clearData() {
<b class="nc">&nbsp;            setData(null);</b>
&nbsp;        }
&nbsp;        
&nbsp;        public void setData(FactionRecord rec) {
<b class="nc">&nbsp;            factionRec = rec;</b>
<b class="nc">&nbsp;            fireTableDataChanged();</b>
&nbsp;        }
&nbsp;        
&nbsp;        @Override
&nbsp;        public String getColumnName(int column) {
<b class="nc">&nbsp;            if (column == 0) {</b>
<b class="nc">&nbsp;                return &quot;&quot;;</b>
&nbsp;            } else {
<b class="nc">&nbsp;                return Integer.toString(ERAS[column - 1]);</b>
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public int getColumnCount() {
<b class="nc">&nbsp;            return ERAS.length + 1;</b>
&nbsp;        }
&nbsp;        
&nbsp;        @Override
&nbsp;        public int getRowCount() {
<b class="nc">&nbsp;            if (factionRec == null) {</b>
<b class="nc">&nbsp;                return 0;</b>
&nbsp;            }
<b class="nc">&nbsp;            return 1 + CATEGORIES.length * factionRec.getRatingLevels().size()</b>
&nbsp;                    + WEIGHT_DIST_UNIT_TYPES.length;
&nbsp;        }
&nbsp;        
&nbsp;        @Override
&nbsp;        public boolean isCellEditable(int row, int col) {
<b class="nc">&nbsp;            return factionRec != null &amp;&amp; col &gt; 0;</b>
&nbsp;        }
&nbsp;        
&nbsp;        @Override
&nbsp;        public Class&lt;?&gt; getColumnClass(int col) {
<b class="nc">&nbsp;            return String.class;</b>
&nbsp;        }
&nbsp;        
&nbsp;        @Override
&nbsp;        public Object getValueAt(int row, int col) {
<b class="nc">&nbsp;            if (factionRec == null) {</b>
<b class="nc">&nbsp;                return &quot;&quot;;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (col == 0) {</b>
<b class="nc">&nbsp;                if (row == 0) {</b>
<b class="nc">&nbsp;                    return &quot;Salvage %&quot;;</b>
<b class="nc">&nbsp;                } else if (row &gt; factionRec.getRatingLevels().size() * CATEGORIES.length) {</b>
<b class="nc">&nbsp;                    return WEIGHT_DIST_UNIT_TYPES[row - 1 - factionRec.getRatingLevels().size() * CATEGORIES.length];</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    return CATEGORIES[(row - 1) / factionRec.getRatingLevels().size()]</b>
<b class="nc">&nbsp;                            + &quot; &quot; + factionRec.getRatingLevels().get((row - 1) % factionRec.getRatingLevels().size());</b>
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            int era = ERAS[col - 1];</b>
&nbsp;            
<b class="nc">&nbsp;            if (row == 0) {</b>
<b class="nc">&nbsp;                Integer pct = factionRec.getPctSalvage(era);</b>
<b class="nc">&nbsp;                return (pct == null)?&quot;&quot;:pct.toString();</b>
<b class="nc">&nbsp;            } else if (row &gt; factionRec.getRatingLevels().size() * CATEGORIES.length) {</b>
<b class="nc">&nbsp;                int unitType = WEIGHT_DIST_UNIT_TYPES[row - 1 - factionRec.getRatingLevels().size() * CATEGORIES.length];</b>
<b class="nc">&nbsp;                return factionRec.getWeightDistributionAsString(era, unitType);</b>
&nbsp;            }
<b class="nc">&nbsp;            int rating = (row - 1) % factionRec.getRatingLevels().size();</b>
<b class="nc">&nbsp;            switch ((row - 1) / factionRec.getRatingLevels().size()) {</b>
&nbsp;            case CAT_OMNI_PCT:
<b class="nc">&nbsp;                return factionRec.getPctTech(TechCategory.OMNI, era, rating);</b>
&nbsp;            case CAT_CLAN_PCT:
<b class="nc">&nbsp;                return factionRec.getPctTech(TechCategory.CLAN, era, rating);</b>
&nbsp;            case CAT_SL_PCT:
<b class="nc">&nbsp;                return factionRec.getPctTech(TechCategory.IS_ADVANCED, era, rating);</b>
&nbsp;            case CAT_OMNI_AERO_PCT:
<b class="nc">&nbsp;                return factionRec.getPctTech(TechCategory.OMNI_AERO, era, rating);</b>
&nbsp;            case CAT_CLAN_AERO_PCT:
<b class="nc">&nbsp;                return factionRec.getPctTech(TechCategory.CLAN_AERO, era, rating);</b>
&nbsp;            case CAT_SL_AERO_PCT:
<b class="nc">&nbsp;                return factionRec.getPctTech(TechCategory.IS_ADVANCED_AERO, era, rating);</b>
&nbsp;            case CAT_CLAN_VEE_PCT:
<b class="nc">&nbsp;                return factionRec.getPctTech(TechCategory.CLAN_VEE, era, rating);</b>
&nbsp;            case CAT_SL_VEE_PCT:
<b class="nc">&nbsp;                return factionRec.getPctTech(TechCategory.IS_ADVANCED_VEE, era, rating);</b>
&nbsp;            default:
<b class="nc">&nbsp;                return &quot;?&quot;;</b>
&nbsp;            }
&nbsp;        }
&nbsp;        
&nbsp;        @Override
&nbsp;        public void setValueAt(Object val, int row, int col) {
<b class="nc">&nbsp;            int era = ERAS[col - 1];</b>
<b class="nc">&nbsp;            Integer value = null;</b>
<b class="nc">&nbsp;            if (((String)val).length() &gt; 0) {</b>
&nbsp;                try {
<b class="nc">&nbsp;                    value = Integer.parseInt((String)val);</b>
<b class="nc">&nbsp;                } catch (NumberFormatException ex) {</b>
&nbsp;                    //leave null
<b class="nc">&nbsp;                }</b>
&nbsp;            }
<b class="nc">&nbsp;            if (row == 0) {</b>
<b class="nc">&nbsp;                factionRec.setPctSalvage(era, value);</b>
<b class="nc">&nbsp;            } else if (row &gt; factionRec.getRatingLevels().size() * CATEGORIES.length) {</b>
<b class="nc">&nbsp;                int unitType = WEIGHT_DIST_UNIT_TYPES[row - 1 - factionRec.getRatingLevels().size() * CATEGORIES.length];</b>
<b class="nc">&nbsp;                if (((String)val).length() &gt; 0) {</b>
&nbsp;                    try {
<b class="nc">&nbsp;                        factionRec.setWeightDistribution(era, unitType, (String)val);</b>
<b class="nc">&nbsp;                    } catch (Exception ex) {</b>
&nbsp;                        //ignore
<b class="nc">&nbsp;                    }</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    factionRec.setWeightDistribution(era, unitType, null);</b>
&nbsp;                }
<b class="nc">&nbsp;            } else if (null != value) {</b>
<b class="nc">&nbsp;                int rating = (row - 1) % factionRec.getRatingLevels().size();</b>
<b class="nc">&nbsp;                switch ((row - 1) / factionRec.getRatingLevels().size()) {</b>
&nbsp;                case CAT_OMNI_PCT:
<b class="nc">&nbsp;                    factionRec.setPctTech(TechCategory.OMNI, era, rating, value);</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                case CAT_CLAN_PCT:
<b class="nc">&nbsp;                    factionRec.setPctTech(TechCategory.CLAN, era, rating, value);</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                case CAT_SL_PCT:
<b class="nc">&nbsp;                    factionRec.setPctTech(TechCategory.IS_ADVANCED, era, rating, value);</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                case CAT_OMNI_AERO_PCT:
<b class="nc">&nbsp;                    factionRec.setPctTech(TechCategory.OMNI_AERO, era, rating, value);</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                case CAT_CLAN_AERO_PCT:
<b class="nc">&nbsp;                    factionRec.setPctTech(TechCategory.CLAN_AERO, era, rating, value);</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                case CAT_SL_AERO_PCT:
<b class="nc">&nbsp;                    factionRec.setPctTech(TechCategory.IS_ADVANCED_AERO, era, rating, value);</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                case CAT_CLAN_VEE_PCT:
<b class="nc">&nbsp;                    factionRec.setPctTech(TechCategory.CLAN_VEE, era, rating, value);</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                case CAT_SL_VEE_PCT:
<b class="nc">&nbsp;                    factionRec.setPctTech(TechCategory.IS_ADVANCED_VEE, era, rating, value);</b>
&nbsp;                    break;
&nbsp;                }
&nbsp;            }
&nbsp;        }
&nbsp;        
&nbsp;    }
&nbsp;    
&nbsp;    private static class SalvageEditorTableModel extends DefaultTableModel {
&nbsp;        
&nbsp;        /**
&nbsp;         * 
&nbsp;         */
&nbsp;        private static final long serialVersionUID = -3155497417382584025L;
&nbsp;        
&nbsp;        ArrayList&lt;String&gt; factions;
&nbsp;        HashMap&lt;String, ArrayList&lt;String&gt;&gt; data;
&nbsp;        private FactionRecord factionRec;
&nbsp;        
<b class="nc">&nbsp;        public SalvageEditorTableModel() {</b>
<b class="nc">&nbsp;            factions = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;            data = new HashMap&lt;&gt;();</b>
<b class="nc">&nbsp;            factionRec = null;</b>
&nbsp;        }
&nbsp;
&nbsp;        public void clearData() {
<b class="nc">&nbsp;            factionRec = null;</b>
<b class="nc">&nbsp;            factions.clear();</b>
<b class="nc">&nbsp;            data.clear();</b>
<b class="nc">&nbsp;            fireTableDataChanged();</b>
&nbsp;        }
&nbsp;
&nbsp;        public void setData(FactionRecord rec) {
<b class="nc">&nbsp;            factionRec = rec;</b>
<b class="nc">&nbsp;            factions.clear();</b>
<b class="nc">&nbsp;            data.clear();</b>
<b class="nc">&nbsp;            final ArrayList&lt;String&gt; empty = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;            while (empty.size() &lt; ERAS.length) {</b>
<b class="nc">&nbsp;                empty.add(&quot;&quot;);</b>
&nbsp;            }
<b class="nc">&nbsp;            for (int i = 0; i &lt; ERAS.length; i++) {</b>
<b class="nc">&nbsp;                HashMap&lt;String,Integer&gt; recs = factionRec.getSalvage(ERAS[i]);</b>
<b class="nc">&nbsp;                if (recs != null) {</b>
<b class="nc">&nbsp;                    for (String faction : recs.keySet()) {</b>
<b class="nc">&nbsp;                        if (!factions.contains(faction)) {</b>
<b class="nc">&nbsp;                            factions.add(faction);</b>
<b class="nc">&nbsp;                            data.put(faction, new ArrayList&lt;&gt;(empty));</b>
&nbsp;                        }
<b class="nc">&nbsp;                        data.get(faction).set(i, recs.get(faction).toString());</b>
<b class="nc">&nbsp;                    }</b>
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            fireTableDataChanged();</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public String getColumnName(int col) {
<b class="nc">&nbsp;            if (col == 0) {</b>
<b class="nc">&nbsp;                return &quot;Faction&quot;;</b>
&nbsp;            }
<b class="nc">&nbsp;            return Integer.toString(ERAS[col - 1]); </b>
&nbsp;        }
&nbsp;        
&nbsp;        @Override
&nbsp;        public int getColumnCount() {
<b class="nc">&nbsp;            if (data == null) {</b>
<b class="nc">&nbsp;                return 0;</b>
&nbsp;            }
<b class="nc">&nbsp;            return ERAS.length + 1;</b>
&nbsp;        }
&nbsp;        
&nbsp;        public int getRowCount() {
<b class="nc">&nbsp;            if (data == null) {</b>
<b class="nc">&nbsp;                return 0;</b>
&nbsp;            }
<b class="nc">&nbsp;            return data.size();</b>
&nbsp;        }
&nbsp;        
&nbsp;        @Override
&nbsp;        public Class&lt;?&gt; getColumnClass(int col) {
<b class="nc">&nbsp;            return String.class;</b>
&nbsp;        }
&nbsp;        
&nbsp;        @Override
&nbsp;        public Object getValueAt(int row, int col) {
<b class="nc">&nbsp;            if (col == 0) {</b>
<b class="nc">&nbsp;                return factions.get(row);</b>
&nbsp;            } else {
<b class="nc">&nbsp;                return data.get(factions.get(row)).get(col - 1);</b>
&nbsp;            } 
&nbsp;        }
&nbsp;        
&nbsp;        @Override
&nbsp;        public boolean isCellEditable(int row, int col) {
<b class="nc">&nbsp;            return col &gt; 0;</b>
&nbsp;        }
&nbsp;        
&nbsp;        @Override
&nbsp;        public void setValueAt(Object value, int row, int col) {
&nbsp;            Integer wt;
<b class="nc">&nbsp;            int era = ERAS[col - 1];</b>
<b class="nc">&nbsp;            if (&quot;&quot;.equals(value)) {</b>
<b class="nc">&nbsp;                wt = null;</b>
<b class="nc">&nbsp;            } else if (!((String)value).matches(&quot;\\d+&quot;)) {</b>
&nbsp;                return;
&nbsp;            } else {
<b class="nc">&nbsp;                wt = Integer.parseInt((String)value);</b>
&nbsp;            }
<b class="nc">&nbsp;            data.get(factions.get(row)).set(col - 1, (String)value);</b>
<b class="nc">&nbsp;            if (wt == null) {</b>
<b class="nc">&nbsp;                factionRec.removeSalvage(era, factions.get(row));</b>
&nbsp;            } else {
<b class="nc">&nbsp;                factionRec.setSalvage(era, factions.get(row), wt);</b>
&nbsp;            }
&nbsp;        }
&nbsp;        
&nbsp;        public void addEntry(String faction) {
<b class="nc">&nbsp;            factions.add(faction);</b>
<b class="nc">&nbsp;            ArrayList&lt;String&gt; list = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;            while (list.size() &lt; ERAS.length) {</b>
<b class="nc">&nbsp;                list.add(&quot;&quot;);</b>
&nbsp;            }
<b class="nc">&nbsp;            data.put(faction, list);</b>
<b class="nc">&nbsp;            fireTableDataChanged();</b>
&nbsp;        }
&nbsp;        
&nbsp;        public void removeEntry(int row) {
<b class="nc">&nbsp;            for (int era : ERAS) {</b>
<b class="nc">&nbsp;                factionRec.removeSalvage(era, factions.get(row));</b>
&nbsp;            }
<b class="nc">&nbsp;            data.remove(factions.get(row));</b>
<b class="nc">&nbsp;            factions.remove(row);</b>
<b class="nc">&nbsp;            fireTableDataChanged();</b>
&nbsp;        }
&nbsp;        
&nbsp;        public void copyRow(int row, String newFaction) {
<b class="nc">&nbsp;            ArrayList&lt;String&gt; copyFrom = data.get(factions.get(row));</b>
<b class="nc">&nbsp;            factions.add(newFaction);</b>
<b class="nc">&nbsp;            ArrayList&lt;String&gt; copyTo = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;            for (int i = 0; i &lt; ERAS.length; i++) {</b>
<b class="nc">&nbsp;                copyTo.add(copyFrom.get(i));</b>
&nbsp;            }       
<b class="nc">&nbsp;            data.put(newFaction, copyTo);</b>
<b class="nc">&nbsp;            for (int i = 0; i &lt; ERAS.length; i++) {</b>
<b class="nc">&nbsp;                if (!copyFrom.get(i).equals(&quot;&quot;)) {</b>
<b class="nc">&nbsp;                    factionRec.setSalvage(ERAS[i], newFaction, Integer.parseInt(copyFrom.get(i)));</b>
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            fireTableDataChanged();</b>
&nbsp;        }
&nbsp;        
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Runs the RATGeneratorEditor UI
&nbsp;     *
&nbsp;     * @param args The RATGenerator data will be loaded from the directory named as the first element
&nbsp;     *             of the arguments. If the {@code args} element is empty, or the first element
&nbsp;     *             is not a valid directory, loads from the default location.
&nbsp;     */
&nbsp;    public static void main(String[] args) {
<b class="nc">&nbsp;        SwingUtilities.invokeLater (() -&gt; {</b>
&nbsp;            RATGeneratorEditor ui;
<b class="nc">&nbsp;            if (args.length &gt; 0) {</b>
<b class="nc">&nbsp;                File dir = new File(args[0]);</b>
<b class="nc">&nbsp;                if (dir.exists() &amp;&amp; dir.isDirectory()) {</b>
<b class="nc">&nbsp;                    ui = new RATGeneratorEditor(dir);</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    MegaMek.getLogger().info(args[0] + &quot; is not a valid directory name&quot;);</b>
<b class="nc">&nbsp;                    ui = new RATGeneratorEditor();</b>
&nbsp;                }
<b class="nc">&nbsp;            } else {</b>
<b class="nc">&nbsp;                ui = new RATGeneratorEditor();</b>
&nbsp;            }
<b class="nc">&nbsp;            ui.setVisible(true);</b>
&nbsp;        });
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2023-05-16 16:28</div>
</div>
</body>
</html>
