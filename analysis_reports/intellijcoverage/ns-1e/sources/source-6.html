


<!DOCTYPE html>
<html id="htmlId">
<head>
  <title>Coverage Report > BLKFile</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">megamek.common.loaders</a>
</div>

<h1>Coverage Summary for Class: BLKFile (megamek.common.loaders)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">BLKFile</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/15)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/783)
  </span>
</td>
</tr>
  <tr>
    <td class="name">BLKFile$ParsedBayInfo</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (7/7)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    97.7%
  </span>
  <span class="absValue">
    (42/43)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    31.8%
  </span>
  <span class="absValue">
    (7/22)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    5.1%
  </span>
  <span class="absValue">
    (42/826)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;/*
&nbsp; * MegaMek - Copyright (C) 2000-2004 Ben Mazur (bmazur@sev.org)
&nbsp; * Copyright (C) 2019 The MegaMek Team
&nbsp; *
&nbsp; * This program is free software; you can redistribute it and/or modify it under
&nbsp; * the terms of the GNU General Public License as published by the Free Software
&nbsp; * Foundation; either version 2 of the License, or (at your option) any later
&nbsp; * version.
&nbsp; *
&nbsp; * This program is distributed in the hope that it will be useful, but WITHOUT
&nbsp; * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
&nbsp; * FOR A PARTICULAR PURPOSE. See the GNU General Public License for more
&nbsp; * details.
&nbsp; */
&nbsp;
&nbsp;package megamek.common.loaders;
&nbsp;
&nbsp;import java.util.*;
&nbsp;import java.util.stream.Collectors;
&nbsp;
&nbsp;import megamek.common.*;
&nbsp;import megamek.common.InfantryBay.PlatoonType;
&nbsp;import megamek.common.options.IOption;
&nbsp;import megamek.common.options.PilotOptions;
&nbsp;import megamek.common.util.BuildingBlock;
&nbsp;import megamek.common.weapons.bayweapons.BayWeapon;
&nbsp;import megamek.common.weapons.infantry.InfantryWeapon;
&nbsp;
<b class="nc">&nbsp;public class BLKFile {</b>
&nbsp;
&nbsp;    BuildingBlock dataFile;
&nbsp;
&nbsp;    public static final int FUSION = 0;
&nbsp;    public static final int ICE = 1;
&nbsp;    public static final int XL = 2;
&nbsp;    public static final int XXL = 3; // don&#39;t ask
&nbsp;    public static final int LIGHT = 4; // don&#39;t ask
&nbsp;    public static final int COMPACT = 5; // don&#39;t ask
&nbsp;    public static final int FUELCELL = 6;
&nbsp;    public static final int FISSION = 7;
&nbsp;    public static final int NONE = 8;
&nbsp;    public static final int MAGLEV = 9;
&nbsp;    public static final int STEAM = 10;
&nbsp;    public static final int BATTERY = 11;
&nbsp;    public static final int SOLAR = 12;
&nbsp;    public static final int EXTERNAL = 13;
&nbsp;    
&nbsp;    private static final String COMSTAR_BAY = &quot;c*&quot;;
&nbsp;
&nbsp;    static final String BLK_EXTRA_SEATS = &quot;extra_seats&quot;;
&nbsp;    
&nbsp;    /**
&nbsp;     * If a vehicular grenade launcher does not have a facing provided, assign a default facing.
&nbsp;     * For vehicles this is determined by location. For protomechs the only legal location is
&nbsp;     * the torso, but it may be mounted rear-facing.
&nbsp;     * 
&nbsp;     * @param location The location where the VGL is mounted.
&nbsp;     * @param rear     Whether the VGL is rear-facing.
&nbsp;     * @return         The facing to assign to the VGL.
&nbsp;     */
&nbsp;    protected int defaultVGLFacing(int location, boolean rear) {
<b class="nc">&nbsp;        return rear ? 3 : 0;</b>
&nbsp;    }
&nbsp;
&nbsp;    public int defaultAeroVGLFacing(int location, boolean rearFacing) {
<b class="nc">&nbsp;        switch (location) {</b>
&nbsp;            case Aero.LOC_LWING:
<b class="nc">&nbsp;                return rearFacing ? 4 : 5;</b>
&nbsp;            case Aero.LOC_RWING:
<b class="nc">&nbsp;                return rearFacing ? 2 : 1;</b>
&nbsp;            case Aero.LOC_AFT:
<b class="nc">&nbsp;                return 4;</b>
&nbsp;            case Aero.LOC_NOSE:
&nbsp;            default:
<b class="nc">&nbsp;                return 0;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    /** Legacy support for Drone Carrier Control System capacity using additional equipment */
<b class="nc">&nbsp;    int legacyDCCSCapacity = 0;</b>
&nbsp;    /** Legacy support for MASH capacity using additional equipment */
<b class="nc">&nbsp;    int mashOperatingTheaters = 0;</b>
&nbsp;
&nbsp;    /**
&nbsp;     * Legacy support for variable sized equipment that expands capacity by using an
&nbsp;     * additional MiscType.
&nbsp;     *
&nbsp;     * @param lookup The lookup name
&nbsp;     */
&nbsp;    boolean checkLegacyExtraEquipment(String lookup) {
<b class="nc">&nbsp;        switch (lookup) {</b>
&nbsp;            case &quot;MASH Operation Theater&quot;:
<b class="nc">&nbsp;                mashOperatingTheaters++;</b>
<b class="nc">&nbsp;                return true;</b>
&nbsp;            case &quot;ISDroneExtra&quot;:
&nbsp;            case &quot;CLDroneExtra&quot;:
<b class="nc">&nbsp;                legacyDCCSCapacity++;</b>
<b class="nc">&nbsp;                return true;</b>
&nbsp;            default:
<b class="nc">&nbsp;                return false;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Legacy support for variable equipment that had a separate EquipmentType entry for each possible
&nbsp;     * size
&nbsp;     *
&nbsp;     * @param eqName The equipment lookup name
&nbsp;     * @return       The size of the equipment
&nbsp;     */
&nbsp;    static double getLegacyVariableSize(String eqName) {
<b class="nc">&nbsp;        if (eqName.startsWith(&quot;Cargo&quot;)</b>
<b class="nc">&nbsp;                || eqName.startsWith(&quot;Liquid Storage&quot;)</b>
<b class="nc">&nbsp;                || eqName.startsWith(&quot;Communications Equipment&quot;)) {</b>
<b class="nc">&nbsp;            return Double.parseDouble(eqName.substring(eqName.indexOf(&quot;(&quot;) + 1,</b>
<b class="nc">&nbsp;                    eqName.indexOf(&quot; ton&quot;)));</b>
&nbsp;        }
<b class="nc">&nbsp;        if (eqName.startsWith(&quot;CommsGear&quot;)) {</b>
<b class="nc">&nbsp;            return Double.parseDouble(eqName.substring(eqName.indexOf(&quot;:&quot;) + 1));</b>
&nbsp;        }
<b class="nc">&nbsp;        if (eqName.startsWith(&quot;Mission Equipment Storage&quot;)) {</b>
<b class="nc">&nbsp;            int pos = eqName.indexOf(&quot;(&quot;);</b>
<b class="nc">&nbsp;            if (pos &gt; 0) {</b>
<b class="nc">&nbsp;                return Double.parseDouble(eqName.substring(pos + 1,</b>
<b class="nc">&nbsp;                        eqName.indexOf(&quot;kg&quot;)).trim());</b>
&nbsp;            } else {
&nbsp;                // If the internal name does not include a size, it&#39;s the original 20 kg version.
<b class="nc">&nbsp;                return 0.02;</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        if (eqName.startsWith(&quot;Ladder&quot;)) {</b>
<b class="nc">&nbsp;            return Double.parseDouble(eqName.substring(eqName.indexOf(&quot;(&quot;) + 1,</b>
<b class="nc">&nbsp;                    eqName.indexOf(&quot;m)&quot;)));</b>
&nbsp;        }
<b class="nc">&nbsp;        return 1.0;</b>
&nbsp;    }
&nbsp;
&nbsp;    protected void loadEquipment(Entity t, String sName, int nLoc)
&nbsp;            throws EntityLoadingException {
<b class="nc">&nbsp;        String[] saEquip = dataFile.getDataAsString(sName + &quot; Equipment&quot;);</b>
<b class="nc">&nbsp;        if (saEquip == null) {</b>
<b class="nc">&nbsp;            return;</b>
&nbsp;        }
&nbsp;
&nbsp;        // prefix is &quot;Clan &quot; or &quot;IS &quot;
&nbsp;        String prefix;
<b class="nc">&nbsp;        if (t.isClan()) {</b>
<b class="nc">&nbsp;            prefix = &quot;Clan &quot;;</b>
&nbsp;        } else {
<b class="nc">&nbsp;            prefix = &quot;IS &quot;;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (saEquip[0] != null) {</b>
<b class="nc">&nbsp;            for (String s : saEquip) {</b>
<b class="nc">&nbsp;                String equipName = s.trim();</b>
<b class="nc">&nbsp;                boolean isOmniMounted = false;</b>
<b class="nc">&nbsp;                boolean isTurreted = false;</b>
<b class="nc">&nbsp;                boolean isPintleTurreted = false;</b>
<b class="nc">&nbsp;                double size = 0.0;</b>
<b class="nc">&nbsp;                int sizeIndex = equipName.toUpperCase().indexOf(&quot;:SIZE:&quot;);</b>
<b class="nc">&nbsp;                if (sizeIndex &gt; 0) {</b>
<b class="nc">&nbsp;                    size = Double.parseDouble(equipName.substring(sizeIndex + 6));</b>
<b class="nc">&nbsp;                    equipName = equipName.substring(0, sizeIndex);</b>
&nbsp;                }
<b class="nc">&nbsp;                if (equipName.toUpperCase().endsWith(&quot;:OMNI&quot;)) {</b>
<b class="nc">&nbsp;                    isOmniMounted = true;</b>
<b class="nc">&nbsp;                    equipName = equipName.substring(0, equipName.length() - 5).trim();</b>
&nbsp;                }
<b class="nc">&nbsp;                if (equipName.toUpperCase().endsWith(&quot;(PT)&quot;)) {</b>
<b class="nc">&nbsp;                    isPintleTurreted = true;</b>
<b class="nc">&nbsp;                    equipName = equipName.substring(0, equipName.length() - 4).trim();</b>
&nbsp;                }
<b class="nc">&nbsp;                if (equipName.toUpperCase().endsWith(&quot;(ST)&quot;)) {</b>
<b class="nc">&nbsp;                    isTurreted = true;</b>
<b class="nc">&nbsp;                    equipName = equipName.substring(0, equipName.length() - 4).trim();</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                int facing = -1;</b>
<b class="nc">&nbsp;                if (equipName.toUpperCase().endsWith(&quot;(FL)&quot;)) {</b>
<b class="nc">&nbsp;                    facing = 5;</b>
<b class="nc">&nbsp;                    equipName = equipName.substring(0, equipName.length() - 4).trim();</b>
&nbsp;                }
<b class="nc">&nbsp;                if (equipName.toUpperCase().endsWith(&quot;(FR)&quot;)) {</b>
<b class="nc">&nbsp;                    facing = 1;</b>
<b class="nc">&nbsp;                    equipName = equipName.substring(0, equipName.length() - 4).trim();</b>
&nbsp;                }
<b class="nc">&nbsp;                if (equipName.toUpperCase().endsWith(&quot;(RL)&quot;)) {</b>
<b class="nc">&nbsp;                    facing = 4;</b>
<b class="nc">&nbsp;                    equipName = equipName.substring(0, equipName.length() - 4).trim();</b>
&nbsp;                }
<b class="nc">&nbsp;                if (equipName.toUpperCase().endsWith(&quot;(RR)&quot;)) {</b>
<b class="nc">&nbsp;                    facing = 2;</b>
<b class="nc">&nbsp;                    equipName = equipName.substring(0, equipName.length() - 4).trim();</b>
&nbsp;                }
<b class="nc">&nbsp;                if (equipName.toUpperCase().endsWith(&quot;(R)&quot;)) {</b>
<b class="nc">&nbsp;                    facing = 3;</b>
<b class="nc">&nbsp;                    equipName = equipName.substring(0, equipName.length() - 4).trim();</b>
&nbsp;                }
<b class="nc">&nbsp;                EquipmentType etype = EquipmentType.get(equipName);</b>
&nbsp;
<b class="nc">&nbsp;                if (etype == null) {</b>
&nbsp;                    // try w/ prefix
<b class="nc">&nbsp;                    etype = EquipmentType.get(prefix + equipName);</b>
&nbsp;                }
<b class="nc">&nbsp;                if ((etype == null) &amp;&amp; checkLegacyExtraEquipment(equipName)) {</b>
<b class="nc">&nbsp;                    continue;</b>
&nbsp;                }
&nbsp;
&nbsp;                // The stealth armor mount is added when the armor type is set
<b class="nc">&nbsp;                if ((etype instanceof MiscType) &amp;&amp; etype.hasFlag(MiscType.F_STEALTH)) {</b>
<b class="nc">&nbsp;                    continue;</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                if (etype != null) {</b>
&nbsp;                    try {
<b class="nc">&nbsp;                        Mounted mount = t.addEquipment(etype, nLoc, false,</b>
&nbsp;                                BattleArmor.MOUNT_LOC_NONE, false, false,
&nbsp;                                isTurreted, isPintleTurreted, isOmniMounted);
&nbsp;                        // Need to set facing for VGLs
<b class="nc">&nbsp;                        if ((etype instanceof WeaponType)</b>
<b class="nc">&nbsp;                                &amp;&amp; etype.hasFlag(WeaponType.F_VGL)) {</b>
<b class="nc">&nbsp;                            if (facing == -1) {</b>
<b class="nc">&nbsp;                                mount.setFacing(defaultVGLFacing(nLoc, false));</b>
&nbsp;                            } else {
<b class="nc">&nbsp;                                mount.setFacing(facing);</b>
&nbsp;                            }
&nbsp;                        }
<b class="nc">&nbsp;                        if (etype.isVariableSize()) {</b>
<b class="nc">&nbsp;                            if (size == 0.0) {</b>
<b class="nc">&nbsp;                                size = getLegacyVariableSize(equipName);</b>
&nbsp;                            }
<b class="nc">&nbsp;                            mount.setSize(size);</b>
<b class="nc">&nbsp;                        } else if (t.isSupportVehicle() &amp;&amp; (mount.getType() instanceof InfantryWeapon)</b>
&nbsp;                                &amp;&amp; size &gt; 1) {
&nbsp;                            // The ammo bin is created by Entity#addEquipment but the size has not
&nbsp;                            // been set yet, so if the unit carries multiple clips the number of
&nbsp;                            // shots needs to be adjusted.
<b class="nc">&nbsp;                            mount.setSize(size);</b>
<b class="nc">&nbsp;                            assert(mount.getLinked() != null);</b>
<b class="nc">&nbsp;                            mount.getLinked().setOriginalShots((int) size</b>
<b class="nc">&nbsp;                                * ((InfantryWeapon) mount.getType()).getShots());</b>
<b class="nc">&nbsp;                            mount.getLinked().setShotsLeft(mount.getLinked().getOriginalShots());</b>
&nbsp;                        }
<b class="nc">&nbsp;                    } catch (LocationFullException ex) {</b>
<b class="nc">&nbsp;                        throw new EntityLoadingException(ex.getMessage());</b>
<b class="nc">&nbsp;                    }</b>
<b class="nc">&nbsp;                } else if (!equipName.equals(&quot;&quot;)) {</b>
<b class="nc">&nbsp;                    t.addFailedEquipment(equipName);</b>
&nbsp;                }
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        if (mashOperatingTheaters &gt; 0) {</b>
<b class="nc">&nbsp;            for (Mounted m : t.getMisc()) {</b>
<b class="nc">&nbsp;                if (m.getType().hasFlag(MiscType.F_MASH)) {</b>
&nbsp;                    // includes one as part of the core component
<b class="nc">&nbsp;                    m.setSize(m.getSize() + mashOperatingTheaters);</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                }
<b class="nc">&nbsp;            }</b>
&nbsp;        }
<b class="nc">&nbsp;        if (legacyDCCSCapacity &gt; 0) {</b>
<b class="nc">&nbsp;            for (Mounted m : t.getMisc()) {</b>
<b class="nc">&nbsp;                if (m.getType().hasFlag(MiscType.F_DRONE_CARRIER_CONTROL)) {</b>
&nbsp;                    // core system does not include drone capacity
<b class="nc">&nbsp;                    m.setSize(legacyDCCSCapacity);</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                }
<b class="nc">&nbsp;            }</b>
&nbsp;        }
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    public boolean isMine() {
<b class="nc">&nbsp;        return dataFile.exists(&quot;blockversion&quot;);</b>
&nbsp;    }
&nbsp;
&nbsp;    static int translateEngineCode(int code) {
<b class="nc">&nbsp;        if (code == BLKFile.FUSION) {</b>
<b class="nc">&nbsp;            return Engine.NORMAL_ENGINE;</b>
<b class="nc">&nbsp;        } else if (code == BLKFile.ICE) {</b>
<b class="nc">&nbsp;            return Engine.COMBUSTION_ENGINE;</b>
<b class="nc">&nbsp;        } else if (code == BLKFile.XL) {</b>
<b class="nc">&nbsp;            return Engine.XL_ENGINE;</b>
<b class="nc">&nbsp;        } else if (code == BLKFile.LIGHT) {</b>
<b class="nc">&nbsp;            return Engine.LIGHT_ENGINE;</b>
<b class="nc">&nbsp;        } else if (code == BLKFile.XXL) {</b>
<b class="nc">&nbsp;            return Engine.XXL_ENGINE;</b>
<b class="nc">&nbsp;        } else if (code == BLKFile.COMPACT) {</b>
<b class="nc">&nbsp;            return Engine.COMPACT_ENGINE;</b>
<b class="nc">&nbsp;        } else if (code == BLKFile.FUELCELL) {</b>
<b class="nc">&nbsp;            return Engine.FUEL_CELL;</b>
<b class="nc">&nbsp;        } else if (code == BLKFile.FISSION) {</b>
<b class="nc">&nbsp;            return Engine.FISSION;</b>
<b class="nc">&nbsp;        } else if (code == BLKFile.NONE) {</b>
<b class="nc">&nbsp;            return Engine.NONE;</b>
<b class="nc">&nbsp;        } else if (code == BLKFile.MAGLEV) {</b>
<b class="nc">&nbsp;            return Engine.MAGLEV;</b>
<b class="nc">&nbsp;        } else if (code == BLKFile.STEAM) {</b>
<b class="nc">&nbsp;            return Engine.STEAM;</b>
<b class="nc">&nbsp;        } else if (code == BLKFile.BATTERY) {</b>
<b class="nc">&nbsp;            return Engine.BATTERY;</b>
<b class="nc">&nbsp;        } else if (code == BLKFile.SOLAR) {</b>
<b class="nc">&nbsp;            return Engine.SOLAR;</b>
<b class="nc">&nbsp;        } else if (code == BLKFile.EXTERNAL) {</b>
<b class="nc">&nbsp;            return Engine.EXTERNAL;</b>
&nbsp;        } else {
<b class="nc">&nbsp;            return -1;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    public void setFluff(Entity e) {
&nbsp;
<b class="nc">&nbsp;        if (dataFile.exists(&quot;capabilities&quot;)) {</b>
<b class="nc">&nbsp;            e.getFluff().setCapabilities(dataFile.getDataAsString(&quot;capabilities&quot;)[0]);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (dataFile.exists(&quot;overview&quot;)) {</b>
<b class="nc">&nbsp;            e.getFluff().setOverview(dataFile.getDataAsString(&quot;overview&quot;)[0]);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (dataFile.exists(&quot;deployment&quot;)) {</b>
<b class="nc">&nbsp;            e.getFluff().setDeployment(dataFile.getDataAsString(&quot;deployment&quot;)[0]);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (dataFile.exists(&quot;history&quot;)) {</b>
<b class="nc">&nbsp;            e.getFluff().setHistory(dataFile.getDataAsString(&quot;history&quot;)[0]);</b>
&nbsp;        }
&nbsp;        
<b class="nc">&nbsp;        if (dataFile.exists(&quot;manufacturer&quot;)) {</b>
<b class="nc">&nbsp;        	e.getFluff().setManufacturer(dataFile.getDataAsString(&quot;manufacturer&quot;)[0]);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (dataFile.exists(&quot;primaryFactory&quot;)) {</b>
<b class="nc">&nbsp;        	e.getFluff().setPrimaryFactory(dataFile.getDataAsString(&quot;primaryFactory&quot;)[0]);</b>
&nbsp;        }
&nbsp;        
<b class="nc">&nbsp;        if (dataFile.exists(&quot;systemManufacturers&quot;)) {</b>
<b class="nc">&nbsp;        	for (String line : dataFile.getDataAsString(&quot;systemManufacturers&quot;)) {</b>
<b class="nc">&nbsp;        		String[] fields = line.split(&quot;:&quot;);</b>
<b class="nc">&nbsp;        		EntityFluff.System comp = EntityFluff.System.parse(fields[0]);</b>
<b class="nc">&nbsp;        		if ((null != comp) &amp;&amp; (fields.length &gt; 1)) {</b>
<b class="nc">&nbsp;        			e.getFluff().setSystemManufacturer(comp, fields[1]);</b>
&nbsp;        		}
&nbsp;        	}
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (dataFile.exists(&quot;systemModels&quot;)) {</b>
<b class="nc">&nbsp;        	for (String line : dataFile.getDataAsString(&quot;systemModels&quot;)) {</b>
<b class="nc">&nbsp;        		String[] fields = line.split(&quot;:&quot;);</b>
<b class="nc">&nbsp;        		EntityFluff.System comp = EntityFluff.System.parse(fields[0]);</b>
<b class="nc">&nbsp;        		if ((null != comp) &amp;&amp; (fields.length &gt; 1)) {</b>
<b class="nc">&nbsp;        			e.getFluff().setSystemModel(comp, fields[1]);</b>
&nbsp;        		}
&nbsp;        	}
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (dataFile.exists(&quot;imagepath&quot;)) {</b>
<b class="nc">&nbsp;            e.getFluff().setMMLImagePath(</b>
<b class="nc">&nbsp;                    dataFile.getDataAsString(&quot;imagepath&quot;)[0]);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (dataFile.exists(&quot;notes&quot;)) {</b>
<b class="nc">&nbsp;            e.getFluff().setNotes(dataFile.getDataAsString(&quot;notes&quot;)[0]);</b>
&nbsp;        }
&nbsp;        
<b class="nc">&nbsp;        if (dataFile.exists(&quot;use&quot;)) {</b>
<b class="nc">&nbsp;            e.getFluff().setUse(dataFile.getDataAsString(&quot;use&quot;)[0]);</b>
&nbsp;        }
&nbsp;        
<b class="nc">&nbsp;        if (dataFile.exists(&quot;length&quot;)) {</b>
<b class="nc">&nbsp;            e.getFluff().setLength(dataFile.getDataAsString(&quot;length&quot;)[0]);</b>
&nbsp;        }
&nbsp;        
<b class="nc">&nbsp;        if (dataFile.exists(&quot;width&quot;)) {</b>
<b class="nc">&nbsp;            e.getFluff().setWidth(dataFile.getDataAsString(&quot;width&quot;)[0]);</b>
&nbsp;        }
&nbsp;        
<b class="nc">&nbsp;        if (dataFile.exists(&quot;height&quot;)) {</b>
<b class="nc">&nbsp;            e.getFluff().setHeight(dataFile.getDataAsString(&quot;height&quot;)[0]);</b>
&nbsp;        }
&nbsp;        
<b class="nc">&nbsp;        if (dataFile.exists(&quot;source&quot;)) {</b>
<b class="nc">&nbsp;            e.setSource(dataFile.getDataAsString(&quot;source&quot;)[0]);</b>
&nbsp;        }
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    public void checkManualBV(Entity e) {
<b class="nc">&nbsp;        if (dataFile.exists(&quot;bv&quot;)) {</b>
<b class="nc">&nbsp;            int bv = dataFile.getDataAsInt(&quot;bv&quot;)[0];</b>
&nbsp;
<b class="nc">&nbsp;            if (bv != 0) {</b>
<b class="nc">&nbsp;                e.setUseManualBV(true);</b>
<b class="nc">&nbsp;                e.setManualBV(bv);</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    public void setTechLevel(Entity e) throws EntityLoadingException {
<b class="nc">&nbsp;        if (!dataFile.exists(&quot;year&quot;)) {</b>
<b class="nc">&nbsp;            throw new EntityLoadingException(&quot;Could not find year block.&quot;);</b>
&nbsp;        }
<b class="nc">&nbsp;        e.setYear(dataFile.getDataAsInt(&quot;year&quot;)[0]);</b>
&nbsp;
<b class="nc">&nbsp;        if (!dataFile.exists(&quot;type&quot;)) {</b>
<b class="nc">&nbsp;            throw new EntityLoadingException(&quot;Could not find type block.&quot;);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        switch (dataFile.getDataAsString(&quot;type&quot;)[0]) {</b>
&nbsp;            case &quot;IS&quot;:
<b class="nc">&nbsp;                if (e.getYear() == 3025) {</b>
<b class="nc">&nbsp;                    e.setTechLevel(TechConstants.T_INTRO_BOXSET);</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    e.setTechLevel(TechConstants.T_IS_TW_NON_BOX);</b>
&nbsp;                }
<b class="nc">&nbsp;                break;</b>
&nbsp;            case &quot;IS Level 1&quot;:
<b class="nc">&nbsp;                e.setTechLevel(TechConstants.T_INTRO_BOXSET);</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            case &quot;IS Level 2&quot;:
<b class="nc">&nbsp;                e.setTechLevel(TechConstants.T_IS_TW_NON_BOX);</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            case &quot;IS Level 3&quot;:
<b class="nc">&nbsp;                e.setTechLevel(TechConstants.T_IS_ADVANCED);</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            case &quot;IS Level 4&quot;:
<b class="nc">&nbsp;                e.setTechLevel(TechConstants.T_IS_EXPERIMENTAL);</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            case &quot;IS Level 5&quot;:
<b class="nc">&nbsp;                e.setTechLevel(TechConstants.T_IS_UNOFFICIAL);</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            case &quot;Clan&quot;:
&nbsp;            case &quot;Clan Level 2&quot;:
<b class="nc">&nbsp;                e.setTechLevel(TechConstants.T_CLAN_TW);</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            case &quot;Clan Level 3&quot;:
<b class="nc">&nbsp;                e.setTechLevel(TechConstants.T_CLAN_ADVANCED);</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            case &quot;Clan Level 4&quot;:
<b class="nc">&nbsp;                e.setTechLevel(TechConstants.T_CLAN_EXPERIMENTAL);</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            case &quot;Clan Level 5&quot;:
<b class="nc">&nbsp;                e.setTechLevel(TechConstants.T_CLAN_UNOFFICIAL);</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            case &quot;Mixed (IS Chassis)&quot;:
<b class="nc">&nbsp;                e.setTechLevel(TechConstants.T_IS_TW_NON_BOX);</b>
<b class="nc">&nbsp;                e.setMixedTech(true);</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            case &quot;Mixed (IS Chassis) Advanced&quot;:
<b class="nc">&nbsp;                e.setTechLevel(TechConstants.T_IS_ADVANCED);</b>
<b class="nc">&nbsp;                e.setMixedTech(true);</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            case &quot;Mixed (IS Chassis) Experimental&quot;:
<b class="nc">&nbsp;                e.setTechLevel(TechConstants.T_IS_EXPERIMENTAL);</b>
<b class="nc">&nbsp;                e.setMixedTech(true);</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            case &quot;Mixed (IS Chassis) Unofficial&quot;:
<b class="nc">&nbsp;                e.setTechLevel(TechConstants.T_IS_UNOFFICIAL);</b>
<b class="nc">&nbsp;                e.setMixedTech(true);</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            case &quot;Mixed (Clan Chassis)&quot;:
<b class="nc">&nbsp;                e.setTechLevel(TechConstants.T_CLAN_TW);</b>
<b class="nc">&nbsp;                e.setMixedTech(true);</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            case &quot;Mixed (Clan Chassis) Advanced&quot;:
<b class="nc">&nbsp;                e.setTechLevel(TechConstants.T_CLAN_ADVANCED);</b>
<b class="nc">&nbsp;                e.setMixedTech(true);</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            case &quot;Mixed (Clan Chassis) Experimental&quot;:
<b class="nc">&nbsp;                e.setTechLevel(TechConstants.T_CLAN_EXPERIMENTAL);</b>
<b class="nc">&nbsp;                e.setMixedTech(true);</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            case &quot;Mixed (Clan Chassis) Unofficial&quot;:
<b class="nc">&nbsp;                e.setTechLevel(TechConstants.T_CLAN_UNOFFICIAL);</b>
<b class="nc">&nbsp;                e.setMixedTech(true);</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            case &quot;Mixed&quot;:
<b class="nc">&nbsp;                throw new EntityLoadingException(&quot;Unsupported tech base: \&quot;Mixed\&quot; is no longer allowed by itself.  You must specify \&quot;Mixed (IS Chassis)\&quot; or \&quot;Mixed (Clan Chassis)\&quot;.&quot;);</b>
&nbsp;            default:
<b class="nc">&nbsp;                throw new EntityLoadingException(&quot;Unsupported tech level: &quot;</b>
<b class="nc">&nbsp;                        + dataFile.getDataAsString(&quot;type&quot;)[0]);</b>
&nbsp;        }
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    public static BuildingBlock getBlock(Entity t) {
<b class="nc">&nbsp;        BuildingBlock blk = new BuildingBlock();</b>
<b class="nc">&nbsp;        blk.createNewBlock();</b>
&nbsp;
<b class="nc">&nbsp;        if (t instanceof BattleArmor) {</b>
<b class="nc">&nbsp;            blk.writeBlockData(&quot;UnitType&quot;, &quot;BattleArmor&quot;);</b>
<b class="nc">&nbsp;        } else if (t instanceof Protomech) {</b>
<b class="nc">&nbsp;            blk.writeBlockData(&quot;UnitType&quot;, &quot;ProtoMech&quot;);</b>
<b class="nc">&nbsp;        } else if (t instanceof Mech) {</b>
<b class="nc">&nbsp;            blk.writeBlockData(&quot;UnitType&quot;, &quot;Mech&quot;);</b>
<b class="nc">&nbsp;        } else if (t instanceof GunEmplacement) {</b>
<b class="nc">&nbsp;            blk.writeBlockData(&quot;UnitType&quot;, &quot;GunEmplacement&quot;);</b>
<b class="nc">&nbsp;        } else if (t instanceof LargeSupportTank) {</b>
<b class="nc">&nbsp;            blk.writeBlockData(&quot;UnitType&quot;, &quot;LargeSupportTank&quot;);</b>
<b class="nc">&nbsp;        } else if (t instanceof SupportTank) {</b>
<b class="nc">&nbsp;            blk.writeBlockData(&quot;UnitType&quot;, &quot;SupportTank&quot;);</b>
<b class="nc">&nbsp;        } else if (t instanceof SupportVTOL) {</b>
<b class="nc">&nbsp;            blk.writeBlockData(&quot;UnitType&quot;, &quot;SupportVTOL&quot;);</b>
<b class="nc">&nbsp;        } else if (t instanceof VTOL) {</b>
<b class="nc">&nbsp;            blk.writeBlockData(&quot;UnitType&quot;, &quot;VTOL&quot;);</b>
<b class="nc">&nbsp;        } else if (t instanceof FixedWingSupport) {</b>
<b class="nc">&nbsp;            blk.writeBlockData(&quot;UnitType&quot;, &quot;FixedWingSupport&quot;);</b>
<b class="nc">&nbsp;        } else if (t instanceof ConvFighter) {</b>
<b class="nc">&nbsp;            blk.writeBlockData(&quot;UnitType&quot;, &quot;ConvFighter&quot;);</b>
<b class="nc">&nbsp;        } else if (t instanceof Dropship) {</b>
<b class="nc">&nbsp;            blk.writeBlockData(&quot;UnitType&quot;, &quot;Dropship&quot;);</b>
<b class="nc">&nbsp;        } else if (t instanceof SmallCraft) {</b>
<b class="nc">&nbsp;            blk.writeBlockData(&quot;UnitType&quot;, &quot;SmallCraft&quot;);</b>
<b class="nc">&nbsp;        } else if (t instanceof Warship) {</b>
<b class="nc">&nbsp;            blk.writeBlockData(&quot;UnitType&quot;, &quot;Warship&quot;);</b>
<b class="nc">&nbsp;        } else if (t instanceof SpaceStation) {</b>
<b class="nc">&nbsp;            blk.writeBlockData(&quot;UnitType&quot;, &quot;SpaceStation&quot;);</b>
<b class="nc">&nbsp;        } else if (t instanceof Jumpship) {</b>
<b class="nc">&nbsp;            blk.writeBlockData(&quot;UnitType&quot;, &quot;Jumpship&quot;);</b>
<b class="nc">&nbsp;        } else if (t instanceof Tank) {</b>
<b class="nc">&nbsp;            blk.writeBlockData(&quot;UnitType&quot;, &quot;Tank&quot;);</b>
<b class="nc">&nbsp;        } else if (t instanceof Infantry) {</b>
<b class="nc">&nbsp;            blk.writeBlockData(&quot;UnitType&quot;, &quot;Infantry&quot;);</b>
<b class="nc">&nbsp;        } else if (t instanceof Aero) {</b>
<b class="nc">&nbsp;            blk.writeBlockData(&quot;UnitType&quot;, &quot;Aero&quot;);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        blk.writeBlockData(&quot;Name&quot;, t.getChassis());</b>
<b class="nc">&nbsp;        blk.writeBlockData(&quot;Model&quot;, t.getModel());</b>
<b class="nc">&nbsp;        blk.writeBlockData(&quot;year&quot;, t.getYear());</b>
<b class="nc">&nbsp;        if (t.getOriginalBuildYear() &gt;= 0) {</b>
<b class="nc">&nbsp;            blk.writeBlockData(&quot;originalBuildYear&quot;, t.getOriginalBuildYear());</b>
&nbsp;        }
&nbsp;        String type;
<b class="nc">&nbsp;        if (t.isMixedTech()) {</b>
<b class="nc">&nbsp;            if (!t.isClan()) {</b>
<b class="nc">&nbsp;                type = &quot;Mixed (IS Chassis)&quot;;</b>
&nbsp;            } else {
<b class="nc">&nbsp;                type = &quot;Mixed (Clan Chassis)&quot;;</b>
&nbsp;            }
<b class="nc">&nbsp;            if ((t.getTechLevel() == TechConstants.T_IS_ADVANCED)</b>
<b class="nc">&nbsp;                    || (t.getTechLevel() == TechConstants.T_CLAN_ADVANCED)) {</b>
<b class="nc">&nbsp;                type += &quot; Advanced&quot;;</b>
<b class="nc">&nbsp;            } else if ((t.getTechLevel() == TechConstants.T_IS_EXPERIMENTAL)</b>
<b class="nc">&nbsp;                    || (t.getTechLevel() == TechConstants.T_CLAN_EXPERIMENTAL)) {</b>
<b class="nc">&nbsp;                type += &quot; Experimental&quot;;</b>
&nbsp;            }
<b class="nc">&nbsp;            if ((t.getTechLevel() == TechConstants.T_IS_UNOFFICIAL)</b>
<b class="nc">&nbsp;                    || (t.getTechLevel() == TechConstants.T_CLAN_UNOFFICIAL)) {</b>
<b class="nc">&nbsp;                type += &quot; Unofficial&quot;;</b>
&nbsp;            }
&nbsp;        } else {
<b class="nc">&nbsp;            switch (t.getTechLevel()) {</b>
&nbsp;                case TechConstants.T_INTRO_BOXSET:
<b class="nc">&nbsp;                    type = &quot;IS Level 1&quot;;</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                case TechConstants.T_IS_TW_NON_BOX:
<b class="nc">&nbsp;                    type = &quot;IS Level 2&quot;;</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                case TechConstants.T_IS_ADVANCED:
<b class="nc">&nbsp;                    type = &quot;IS Level 3&quot;;</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                case TechConstants.T_IS_EXPERIMENTAL:
<b class="nc">&nbsp;                    type = &quot;IS Level 4&quot;;</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                case TechConstants.T_IS_UNOFFICIAL:
&nbsp;                default:
<b class="nc">&nbsp;                    type = &quot;IS Level 5&quot;;</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                case TechConstants.T_CLAN_TW:
<b class="nc">&nbsp;                    type = &quot;Clan Level 2&quot;;</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                case TechConstants.T_CLAN_ADVANCED:
<b class="nc">&nbsp;                    type = &quot;Clan Level 3&quot;;</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                case TechConstants.T_CLAN_EXPERIMENTAL:
<b class="nc">&nbsp;                    type = &quot;Clan Level 4&quot;;</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                case TechConstants.T_CLAN_UNOFFICIAL:
<b class="nc">&nbsp;                    type = &quot;Clan Level 5&quot;;</b>
&nbsp;                    break;
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        blk.writeBlockData(&quot;type&quot;, type);</b>
&nbsp;
<b class="nc">&nbsp;        blk.writeBlockData(&quot;motion_type&quot;, t.getMovementModeAsString());</b>
&nbsp;
<b class="nc">&nbsp;        String[] transporter_array = new String[t.getTransports().size()];</b>
<b class="nc">&nbsp;        int index = 0;</b>
<b class="nc">&nbsp;        for (Transporter transporter : t.getTransports()) {</b>
<b class="nc">&nbsp;            transporter_array[index] = transporter.toString();</b>
<b class="nc">&nbsp;            if (t.isPodMountedTransport(transporter)) {</b>
<b class="nc">&nbsp;                transporter_array[index] += &quot;:omni&quot;;</b>
&nbsp;            }
<b class="nc">&nbsp;            index++;</b>
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;        blk.writeBlockData(&quot;transporters&quot;, transporter_array);</b>
&nbsp;
<b class="nc">&nbsp;        if (!((t instanceof Infantry) &amp;&amp; !(t instanceof BattleArmor))) {</b>
<b class="nc">&nbsp;            if (t instanceof Aero){</b>
<b class="nc">&nbsp;                blk.writeBlockData(&quot;SafeThrust&quot;, t.getOriginalWalkMP());</b>
&nbsp;            } else {
<b class="nc">&nbsp;                blk.writeBlockData(&quot;cruiseMP&quot;, t.getOriginalWalkMP());</b>
<b class="nc">&nbsp;                if (t.hasETypeFlag(Entity.ETYPE_PROTOMECH)) {</b>
<b class="nc">&nbsp;                    blk.writeBlockData(&quot;jumpingMP&quot;, t.getOriginalJumpMP());</b>
<b class="nc">&nbsp;                    blk.writeBlockData(&quot;interface_cockpit&quot;,</b>
<b class="nc">&nbsp;                            String.valueOf(((Protomech) t).hasInterfaceCockpit()));</b>
&nbsp;                }
&nbsp;            }
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        int numLocs = t.locations();</b>
<b class="nc">&nbsp;        if (!(t instanceof Infantry)) {</b>
<b class="nc">&nbsp;            if (t instanceof Aero){</b>
<b class="nc">&nbsp;                if (t.isFighter()) {</b>
<b class="nc">&nbsp;                    blk.writeBlockData(&quot;cockpit_type&quot;, ((Aero)t).getCockpitType());</b>
<b class="nc">&nbsp;                    if (t.hasETypeFlag(Entity.ETYPE_CONV_FIGHTER) &amp;&amp; ((Aero) t).isVSTOL()) {</b>
<b class="nc">&nbsp;                        blk.writeBlockData(&quot;vstol&quot;, 1);</b>
&nbsp;                    }
<b class="nc">&nbsp;                } else if ((t instanceof Dropship) &amp;&amp; ((Aero)t).isPrimitive()) {</b>
<b class="nc">&nbsp;                    blk.writeBlockData(&quot;collartype&quot;, ((Dropship)t).getCollarType());</b>
&nbsp;                }
<b class="nc">&nbsp;                blk.writeBlockData(&quot;heatsinks&quot;, ((Aero)t).getHeatSinks());</b>
<b class="nc">&nbsp;                blk.writeBlockData(&quot;sink_type&quot;, ((Aero)t).getHeatType());</b>
<b class="nc">&nbsp;                if (((Aero)t).getPodHeatSinks() &gt; 0) {</b>
<b class="nc">&nbsp;                    blk.writeBlockData(&quot;omnipodheatsinks&quot;, ((Aero)t).getPodHeatSinks());</b>
&nbsp;                }
<b class="nc">&nbsp;                blk.writeBlockData(&quot;fuel&quot;, ((Aero)t).getFuel());</b>
&nbsp;            }
<b class="nc">&nbsp;            if(t.hasEngine()) {</b>
<b class="nc">&nbsp;                int engineCode = BLKFile.FUSION;</b>
<b class="nc">&nbsp;                switch (t.getEngine().getEngineType()) {</b>
&nbsp;                    case Engine.COMBUSTION_ENGINE:
<b class="nc">&nbsp;                        engineCode = BLKFile.ICE;</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    case Engine.LIGHT_ENGINE:
<b class="nc">&nbsp;                        engineCode = BLKFile.LIGHT;</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    case Engine.XL_ENGINE:
<b class="nc">&nbsp;                        engineCode = BLKFile.XL;</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    case Engine.XXL_ENGINE:
<b class="nc">&nbsp;                        engineCode = BLKFile.XXL;</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    case Engine.FUEL_CELL:
<b class="nc">&nbsp;                        engineCode = BLKFile.FUELCELL;</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    case Engine.FISSION:
<b class="nc">&nbsp;                        engineCode = BLKFile.FISSION;</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    case Engine.NONE:
<b class="nc">&nbsp;                        engineCode = BLKFile.NONE;</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    case Engine.MAGLEV:
<b class="nc">&nbsp;                        engineCode = BLKFile.MAGLEV;</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    case Engine.STEAM:
<b class="nc">&nbsp;                        engineCode = BLKFile.STEAM;</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    case Engine.BATTERY:
<b class="nc">&nbsp;                        engineCode = BLKFile.BATTERY;</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    case Engine.SOLAR:
<b class="nc">&nbsp;                        engineCode = BLKFile.SOLAR;</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    case Engine.EXTERNAL:
<b class="nc">&nbsp;                        engineCode = BLKFile.EXTERNAL;</b>
&nbsp;                        break;
&nbsp;                }
<b class="nc">&nbsp;                blk.writeBlockData(&quot;engine_type&quot;, engineCode);</b>
<b class="nc">&nbsp;                if (t.getEngine().isClan() != t.isClan()) {</b>
<b class="nc">&nbsp;                    blk.writeBlockData(&quot;clan_engine&quot;, Boolean.toString(t.getEngine().isClan()));</b>
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            if (!t.hasPatchworkArmor() &amp;&amp; (t.getArmorType(1) != 0)) {</b>
<b class="nc">&nbsp;                blk.writeBlockData(&quot;armor_type&quot;, t.getArmorType(1));</b>
<b class="nc">&nbsp;                blk.writeBlockData(&quot;armor_tech&quot;, t.getArmorTechLevel(1));</b>
<b class="nc">&nbsp;            } else if (t.hasPatchworkArmor()) {</b>
<b class="nc">&nbsp;                blk.writeBlockData(&quot;armor_type&quot;,</b>
&nbsp;                        EquipmentType.T_ARMOR_PATCHWORK);
<b class="nc">&nbsp;                for (int i = 1; i &lt; t.locations(); i++) {</b>
<b class="nc">&nbsp;                    blk.writeBlockData(t.getLocationName(i) + &quot;_armor_type&quot;, t.getArmorType(i));</b>
<b class="nc">&nbsp;                    blk.writeBlockData(t.getLocationName(i) + &quot;_armor_tech&quot;,</b>
<b class="nc">&nbsp;                            TechConstants.getTechName(t.getArmorTechLevel(i)));</b>
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            if (t.getStructureType() != 0) {</b>
<b class="nc">&nbsp;                blk.writeBlockData(&quot;internal_type&quot;, t.getStructureType());</b>
&nbsp;            }
<b class="nc">&nbsp;            if (t.isOmni()) {</b>
<b class="nc">&nbsp;                blk.writeBlockData(&quot;omni&quot;, 1);</b>
&nbsp;            }
&nbsp;            
&nbsp;            int[] armor_array;
<b class="nc">&nbsp;            if (t.hasETypeFlag(Entity.ETYPE_AERO)) {</b>
<b class="nc">&nbsp;                if (t.hasETypeFlag(Entity.ETYPE_JUMPSHIP)) {</b>
<b class="nc">&nbsp;                    armor_array = new int[6];</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    armor_array = new int[4];</b>
&nbsp;                }
<b class="nc">&nbsp;                for (int i = 0; i &lt; armor_array.length; i++) {</b>
<b class="nc">&nbsp;                    armor_array[i] = t.getOArmor(i);</b>
&nbsp;                }
&nbsp;            } else {
<b class="nc">&nbsp;                armor_array = new int[numLocs - 1];</b>
<b class="nc">&nbsp;                for (int i = 1; i &lt; numLocs; i++) {</b>
<b class="nc">&nbsp;                    armor_array[i - 1] = t.getOArmor(i);</b>
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            blk.writeBlockData(&quot;armor&quot;, armor_array);</b>
&nbsp;        }
&nbsp;
&nbsp;        // Write out armor_type and armor_tech entries for BA
<b class="nc">&nbsp;        if (t instanceof BattleArmor) {</b>
<b class="nc">&nbsp;            blk.writeBlockData(&quot;armor_type&quot;, t.getArmorType(1));</b>
<b class="nc">&nbsp;            blk.writeBlockData(&quot;armor_tech&quot;, t.getArmorTechLevel(1));</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        Vector&lt;Vector&lt;String&gt;&gt; eq = new Vector&lt;&gt;(numLocs);</b>
&nbsp;
<b class="nc">&nbsp;        for (int i = 0; i &lt; numLocs; i++) {</b>
<b class="nc">&nbsp;            eq.add(new Vector&lt;&gt;());</b>
&nbsp;        }
<b class="nc">&nbsp;        for (Mounted m : t.getEquipment()) {</b>
&nbsp;            // Ignore Mounteds that represent a WeaponGroup
&nbsp;            // BA anti-personnel weapons are written just after the mount
<b class="nc">&nbsp;            if (m.isWeaponGroup() || m.isAPMMounted()){</b>
<b class="nc">&nbsp;                continue;</b>
&nbsp;            }
&nbsp;
&nbsp;            // Ignore ammo for one-shot launchers
<b class="nc">&nbsp;            if ((m.getLinkedBy() != null) &amp;&amp; (m.getLinkedBy().isOneShot())) {</b>
<b class="nc">&nbsp;                continue;</b>
&nbsp;            }
&nbsp;            
<b class="nc">&nbsp;            if (m.getType() instanceof BayWeapon) {</b>
<b class="nc">&nbsp;                int loc = m.getLocation();</b>
<b class="nc">&nbsp;                if (loc == Entity.LOC_NONE) {</b>
<b class="nc">&nbsp;                    continue;</b>
&nbsp;                }
<b class="nc">&nbsp;                boolean rear = m.isRearMounted();</b>
<b class="nc">&nbsp;                for (int i = 0; i &lt; m.getBayWeapons().size(); i++) {</b>
<b class="nc">&nbsp;                    Mounted w = t.getEquipment(m.getBayWeapons().get(i));</b>
<b class="nc">&nbsp;                    String name = w.getType().getInternalName();</b>
<b class="nc">&nbsp;                    if (i == 0) {</b>
<b class="nc">&nbsp;                        name = &quot;(B) &quot; + name;</b>
&nbsp;                    }
<b class="nc">&nbsp;                    if (rear) {</b>
<b class="nc">&nbsp;                        name = &quot;(R) &quot; + name;</b>
&nbsp;                    }
<b class="nc">&nbsp;                    eq.get(loc).add(name);</b>
&nbsp;                }
<b class="nc">&nbsp;                for (Integer aNum : m.getBayAmmo()) {</b>
<b class="nc">&nbsp;                    Mounted a = t.getEquipment(aNum);</b>
<b class="nc">&nbsp;                    String name = a.getType().getInternalName();</b>
<b class="nc">&nbsp;                    name += &quot;:&quot; + a.getBaseShotsLeft();</b>
<b class="nc">&nbsp;                    if (rear) {</b>
<b class="nc">&nbsp;                        name = &quot;(R) &quot; + name;</b>
&nbsp;                    }
<b class="nc">&nbsp;                    eq.get(loc).add(name);</b>
<b class="nc">&nbsp;                }</b>
<b class="nc">&nbsp;                continue;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (t.usesWeaponBays() &amp;&amp; ((m.getType() instanceof WeaponType)</b>
<b class="nc">&nbsp;                    || (m.getType() instanceof AmmoType))) {</b>
<b class="nc">&nbsp;                continue;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            String name = encodeEquipmentLine(m);</b>
<b class="nc">&nbsp;            int loc = m.getLocation();</b>
<b class="nc">&nbsp;            if (loc != Entity.LOC_NONE) {</b>
<b class="nc">&nbsp;                eq.get(loc).add(name);</b>
&nbsp;            }
<b class="nc">&nbsp;            if ((m.getLinked() != null) &amp;&amp; m.getLinked().isAPMMounted()) {</b>
<b class="nc">&nbsp;                eq.get(loc).add(encodeEquipmentLine(m.getLinked()));</b>
&nbsp;            }
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;        for (int i = 0; i &lt; numLocs; i++) {</b>
<b class="nc">&nbsp;            if (!(((t instanceof Infantry) &amp;&amp; !(t instanceof BattleArmor)) &amp;&amp; (i == Infantry.LOC_INFANTRY))) {</b>
<b class="nc">&nbsp;                blk.writeBlockData(t.getLocationName(i) + &quot; Equipment&quot;, eq.get(i));</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        if (!t.hasPatchworkArmor() &amp;&amp; t.hasBARArmor(1)) {</b>
<b class="nc">&nbsp;            blk.writeBlockData(&quot;barrating&quot;, t.getBARRating(1));</b>
&nbsp;        }
&nbsp;        
<b class="nc">&nbsp;        if (t.isSupportVehicle()) {</b>
<b class="nc">&nbsp;            blk.writeBlockData(&quot;structural_tech_rating&quot;, t.getStructuralTechRating());</b>
<b class="nc">&nbsp;            blk.writeBlockData(&quot;engine_tech_rating&quot;, t.getEngineTechRating());</b>
<b class="nc">&nbsp;            blk.writeBlockData(&quot;armor_tech_rating&quot;, t.getArmorTechRating());</b>
&nbsp;        }
&nbsp;        
<b class="nc">&nbsp;        if (t.hasETypeFlag(Entity.ETYPE_SMALL_CRAFT) || t.hasETypeFlag(Entity.ETYPE_JUMPSHIP)) {</b>
<b class="nc">&nbsp;            blk.writeBlockData(&quot;structural_integrity&quot;, ((Aero)t).get0SI());</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (t.getFluff().getCapabilities().trim().length() &gt; 0) {</b>
<b class="nc">&nbsp;            blk.writeBlockData(&quot;capabilities&quot;, t.getFluff().getCapabilities());</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (t.getFluff().getOverview().trim().length() &gt; 0) {</b>
<b class="nc">&nbsp;            blk.writeBlockData(&quot;overview&quot;, t.getFluff().getOverview());</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (t.getFluff().getDeployment().trim().length() &gt; 0) {</b>
<b class="nc">&nbsp;            blk.writeBlockData(&quot;deployment&quot;, t.getFluff().getDeployment());</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (t.getFluff().getHistory().trim().length() &gt; 0) {</b>
<b class="nc">&nbsp;            blk.writeBlockData(&quot;history&quot;, t.getFluff().getHistory());</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (t.getFluff().getManufacturer().trim().length() &gt; 0) {</b>
<b class="nc">&nbsp;            blk.writeBlockData(&quot;manufacturer&quot;, t.getFluff().getManufacturer());</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (t.getFluff().getPrimaryFactory().trim().length() &gt; 0) {</b>
<b class="nc">&nbsp;            blk.writeBlockData(&quot;primaryFactory&quot;, t.getFluff().getPrimaryFactory());</b>
&nbsp;        }
&nbsp;        
<b class="nc">&nbsp;        List&lt;String&gt; list = t.getFluff().createSystemManufacturersList();</b>
<b class="nc">&nbsp;        if (!list.isEmpty()) {</b>
<b class="nc">&nbsp;        	blk.writeBlockData(&quot;systemManufacturers&quot;, list);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        list = t.getFluff().createSystemModelsList();</b>
<b class="nc">&nbsp;        if (!list.isEmpty()) {</b>
<b class="nc">&nbsp;        	blk.writeBlockData(&quot;systemModels&quot;, list);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (t.getFluff().getMMLImagePath().trim().length() &gt; 0) {</b>
<b class="nc">&nbsp;            blk.writeBlockData(&quot;imagepath&quot;, t.getFluff().getMMLImagePath());</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (t.getFluff().getNotes().trim().length() &gt; 0) {</b>
<b class="nc">&nbsp;            blk.writeBlockData(&quot;notes&quot;, t.getFluff().getNotes());</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (t.getFluff().getUse().trim().length() &gt; 0) {</b>
<b class="nc">&nbsp;            blk.writeBlockData(&quot;use&quot;, t.getFluff().getUse());</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (t.getFluff().getLength().trim().length() &gt; 0) {</b>
<b class="nc">&nbsp;            blk.writeBlockData(&quot;length&quot;, t.getFluff().getLength());</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (t.getFluff().getWidth().trim().length() &gt; 0) {</b>
<b class="nc">&nbsp;            blk.writeBlockData(&quot;width&quot;, t.getFluff().getWidth());</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (t.getFluff().getHeight().trim().length() &gt; 0) {</b>
<b class="nc">&nbsp;            blk.writeBlockData(&quot;height&quot;, t.getFluff().getHeight());</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (t.getSource().trim().length() &gt; 0) {</b>
<b class="nc">&nbsp;            blk.writeBlockData(&quot;source&quot;, t.getSource());</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (t instanceof BattleArmor) {</b>
<b class="nc">&nbsp;            BattleArmor ba = (BattleArmor) t;</b>
<b class="nc">&nbsp;            if (ba.getChassisType() == BattleArmor.CHASSIS_TYPE_BIPED) {</b>
<b class="nc">&nbsp;                blk.writeBlockData(&quot;chassis&quot;, &quot;biped&quot;);</b>
&nbsp;
<b class="nc">&nbsp;            } else if (ba.getChassisType() == BattleArmor.CHASSIS_TYPE_QUAD) {</b>
<b class="nc">&nbsp;                blk.writeBlockData(&quot;chassis&quot;, &quot;quad&quot;);</b>
<b class="nc">&nbsp;                if (ba.getTurretCapacity() &gt; 0) {</b>
<b class="nc">&nbsp;                    blk.writeBlockData(&quot;turret&quot;,</b>
<b class="nc">&nbsp;                            (ba.hasModularTurretMount()? &quot;Modular:&quot; : &quot;Standard:&quot;) + ba.getTurretCapacity());</b>
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            if (ba.isExoskeleton()) {</b>
<b class="nc">&nbsp;                blk.writeBlockData(&quot;exoskeleton&quot;, &quot;true&quot;);</b>
&nbsp;            }
<b class="nc">&nbsp;            blk.writeBlockData(&quot;jumpingMP&quot;, ba.getOriginalJumpMP());</b>
<b class="nc">&nbsp;            blk.writeBlockData(&quot;armor&quot;, new int[] { ba.getArmor(1) });</b>
<b class="nc">&nbsp;            blk.writeBlockData(&quot;Trooper Count&quot;, (int) t.getWeight());</b>
<b class="nc">&nbsp;            blk.writeBlockData(&quot;weightclass&quot;, ba.getWeightClass());</b>
<b class="nc">&nbsp;        } else if (t instanceof Infantry) {</b>
<b class="nc">&nbsp;            Infantry infantry = (Infantry) t;</b>
<b class="nc">&nbsp;            blk.writeBlockData(&quot;squad_size&quot;, infantry.getSquadSize());</b>
<b class="nc">&nbsp;            blk.writeBlockData(&quot;squadn&quot;, infantry.getSquadN());</b>
<b class="nc">&nbsp;            if (infantry.getSecondaryN() &gt; 0) {</b>
<b class="nc">&nbsp;                blk.writeBlockData(&quot;secondn&quot;, infantry.getSecondaryN());</b>
&nbsp;            }
<b class="nc">&nbsp;            if (null != infantry.getPrimaryWeapon()) {</b>
<b class="nc">&nbsp;                blk.writeBlockData(&quot;Primary&quot;, infantry.getPrimaryWeapon()</b>
<b class="nc">&nbsp;                        .getInternalName());</b>
&nbsp;            }
<b class="nc">&nbsp;            if (null != infantry.getSecondaryWeapon()) {</b>
<b class="nc">&nbsp;                blk.writeBlockData(&quot;Secondary&quot;, infantry.getSecondaryWeapon()</b>
<b class="nc">&nbsp;                        .getInternalName());</b>
&nbsp;            }
&nbsp;            
<b class="nc">&nbsp;            if (infantry.canMakeAntiMekAttacks()) {</b>
<b class="nc">&nbsp;                blk.writeBlockData(&quot;antimek&quot;, (infantry.getAntiMekSkill() + &quot;&quot;));</b>
&nbsp;            }
&nbsp;            
<b class="nc">&nbsp;            EquipmentType et = infantry.getArmorKit();</b>
<b class="nc">&nbsp;            if (et != null) {</b>
<b class="nc">&nbsp;            	blk.writeBlockData(&quot;armorKit&quot;, et.getInternalName());</b>
&nbsp;            }
<b class="nc">&nbsp;            if (infantry.getArmorDamageDivisor() != 1) {</b>
<b class="nc">&nbsp;                blk.writeBlockData(&quot;armordivisor&quot;,</b>
<b class="nc">&nbsp;                        Double.toString(infantry.getArmorDamageDivisor()));</b>
&nbsp;            }
<b class="nc">&nbsp;            if (infantry.isArmorEncumbering()) {</b>
<b class="nc">&nbsp;                blk.writeBlockData(&quot;encumberingarmor&quot;, &quot;true&quot;);</b>
&nbsp;            }
<b class="nc">&nbsp;            if (infantry.hasSpaceSuit()) {</b>
<b class="nc">&nbsp;                blk.writeBlockData(&quot;spacesuit&quot;, &quot;true&quot;);</b>
&nbsp;            }
<b class="nc">&nbsp;            if (infantry.hasDEST()) {</b>
<b class="nc">&nbsp;                blk.writeBlockData(&quot;dest&quot;, &quot;true&quot;);</b>
&nbsp;            }
<b class="nc">&nbsp;            if (infantry.hasSneakCamo()) {</b>
<b class="nc">&nbsp;                blk.writeBlockData(&quot;sneakcamo&quot;, &quot;true&quot;);</b>
&nbsp;            }
<b class="nc">&nbsp;            if (infantry.hasSneakIR()) {</b>
<b class="nc">&nbsp;                blk.writeBlockData(&quot;sneakir&quot;, &quot;true&quot;);</b>
&nbsp;            }
<b class="nc">&nbsp;            if (infantry.hasSneakECM()) {</b>
<b class="nc">&nbsp;                blk.writeBlockData(&quot;sneakecm&quot;, &quot;true&quot;);</b>
&nbsp;            }
<b class="nc">&nbsp;            if (infantry.hasSpecialization()) {</b>
<b class="nc">&nbsp;                blk.writeBlockData(&quot;specialization&quot;, infantry.getSpecializations());</b>
&nbsp;            }
<b class="nc">&nbsp;            ArrayList&lt;String&gt; augmentations = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;            for (Enumeration&lt;IOption&gt; e = infantry.getCrew().getOptions(PilotOptions.MD_ADVANTAGES);</b>
<b class="nc">&nbsp;            		e.hasMoreElements();) {</b>
<b class="nc">&nbsp;            	final IOption o = e.nextElement();</b>
<b class="nc">&nbsp;            	if (o.booleanValue()) {</b>
<b class="nc">&nbsp;            		augmentations.add(o.getName());</b>
&nbsp;            	}
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;            if (augmentations.size() &gt; 0) {</b>
<b class="nc">&nbsp;            	blk.writeBlockData(&quot;augmentation&quot;, augmentations.toArray(new String[augmentations.size()]));</b>
&nbsp;            }
<b class="nc">&nbsp;        } else {</b>
<b class="nc">&nbsp;            blk.writeBlockData(&quot;tonnage&quot;, t.getWeight());</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (t.getUseManualBV()) {</b>
<b class="nc">&nbsp;            blk.writeBlockData(&quot;bv&quot;, t.getManualBV());</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if ((t instanceof Tank) &amp;&amp; t.isOmni()) {</b>
<b class="nc">&nbsp;            Tank tank = (Tank) t;</b>
<b class="nc">&nbsp;            if (tank.getBaseChassisTurretWeight() &gt;= 0) {</b>
<b class="nc">&nbsp;                blk.writeBlockData(&quot;baseChassisTurretWeight&quot;,</b>
<b class="nc">&nbsp;                        tank.getBaseChassisTurretWeight());</b>
&nbsp;            }
<b class="nc">&nbsp;            if (tank.getBaseChassisTurret2Weight() &gt;= 0) {</b>
<b class="nc">&nbsp;                blk.writeBlockData(&quot;baseChassisTurret2Weight&quot;,</b>
<b class="nc">&nbsp;                        tank.getBaseChassisTurret2Weight());</b>
&nbsp;            }
<b class="nc">&nbsp;            if (tank.getBaseChassisSponsonPintleWeight() &gt;= 0) {</b>
<b class="nc">&nbsp;                blk.writeBlockData(&quot;baseChassisSponsonPintleWeight&quot;,</b>
<b class="nc">&nbsp;                        tank.getBaseChassisSponsonPintleWeight());</b>
&nbsp;            }
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (t.isSupportVehicle() &amp;&amp; t.isOmni()) {</b>
<b class="nc">&nbsp;            blk.writeBlockData(&quot;baseChassisFireConWeight&quot;,</b>
<b class="nc">&nbsp;                    t.getBaseChassisFireConWeight());</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (t instanceof Tank) {</b>
<b class="nc">&nbsp;            Tank tank = (Tank) t;</b>
<b class="nc">&nbsp;            if (tank.isSupportVehicle()) {</b>
<b class="nc">&nbsp;                blk.writeBlockData(&quot;fuel&quot;, tank.getFuelTonnage());</b>
&nbsp;            }
<b class="nc">&nbsp;            if (tank.getEngine().getEngineType() == Engine.COMBUSTION_ENGINE) {</b>
<b class="nc">&nbsp;                blk.writeBlockData(&quot;fuelType&quot;, tank.getICEFuelType().toString());</b>
&nbsp;            }
<b class="nc">&nbsp;            if (tank.hasNoControlSystems()) {</b>
<b class="nc">&nbsp;                blk.writeBlockData(&quot;hasNoControlSystems&quot;, 1);</b>
&nbsp;            }
<b class="nc">&nbsp;            if (!t.isSupportVehicle() &amp;&amp; t.isTrailer()) {</b>
<b class="nc">&nbsp;                blk.writeBlockData(&quot;trailer&quot;, 1);</b>
&nbsp;            }
<b class="nc">&nbsp;            if (tank.getExtraCrewSeats() &gt; 0) {</b>
<b class="nc">&nbsp;                blk.writeBlockData(BLK_EXTRA_SEATS, tank.getExtraCrewSeats());</b>
&nbsp;            }
&nbsp;        }
&nbsp;        
<b class="nc">&nbsp;        if (t instanceof SmallCraft) {</b>
<b class="nc">&nbsp;            SmallCraft sc = (SmallCraft) t;</b>
<b class="nc">&nbsp;            blk.writeBlockData(&quot;designtype&quot;, sc.getDesignType());</b>
<b class="nc">&nbsp;            blk.writeBlockData(&quot;crew&quot;, sc.getNCrew());</b>
<b class="nc">&nbsp;            blk.writeBlockData(&quot;officers&quot;, sc.getNOfficers());</b>
<b class="nc">&nbsp;            blk.writeBlockData(&quot;gunners&quot;, sc.getNGunners());</b>
<b class="nc">&nbsp;            blk.writeBlockData(&quot;passengers&quot;, sc.getNPassenger());</b>
<b class="nc">&nbsp;            blk.writeBlockData(&quot;marines&quot;, sc.getNMarines());</b>
<b class="nc">&nbsp;            blk.writeBlockData(&quot;battlearmor&quot;, sc.getNBattleArmor());</b>
<b class="nc">&nbsp;            blk.writeBlockData(&quot;otherpassenger&quot;, sc.getNOtherPassenger());</b>
<b class="nc">&nbsp;            blk.writeBlockData(&quot;life_boat&quot;, sc.getLifeBoats());</b>
<b class="nc">&nbsp;            blk.writeBlockData(&quot;escape_pod&quot;, sc.getEscapePods());</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (t instanceof Warship) {</b>
<b class="nc">&nbsp;            Warship ws = (Warship) t;</b>
<b class="nc">&nbsp;            blk.writeBlockData(&quot;kf_core&quot;, ws.getDriveCoreType());</b>
<b class="nc">&nbsp;            if (ws.getDriveCoreType() == Warship.DRIVE_CORE_PRIMITIVE) {</b>
<b class="nc">&nbsp;                blk.writeBlockData(&quot;jump_range&quot;, ws.getJumpRange());</b>
&nbsp;            }
<b class="nc">&nbsp;        } else if ((t instanceof SpaceStation)</b>
<b class="nc">&nbsp;                &amp;&amp; ((SpaceStation) t).isModular()) {</b>
<b class="nc">&nbsp;            blk.writeBlockData(&quot;modular&quot;, 1);</b>
&nbsp;        }
&nbsp;        
<b class="nc">&nbsp;        if (t instanceof Jumpship) {</b>
<b class="nc">&nbsp;            Jumpship js = (Jumpship) t;</b>
<b class="nc">&nbsp;            if (js.hasHPG()) {</b>
<b class="nc">&nbsp;                blk.writeBlockData(&quot;hpg&quot;, 1);</b>
&nbsp;            }
<b class="nc">&nbsp;            if (js.hasLF()) {</b>
<b class="nc">&nbsp;                blk.writeBlockData(&quot;lithium-fusion&quot;, 1);</b>
&nbsp;            }
<b class="nc">&nbsp;            blk.writeBlockData(&quot;sail&quot;, js.hasSail()? 1 : 0);</b>
<b class="nc">&nbsp;            if (js.getTotalGravDeck() &gt; 0) {</b>
<b class="nc">&nbsp;                blk.writeBlockData(&quot;grav_decks&quot;, (Vector&lt;String&gt;)js.getGravDecks().stream()</b>
<b class="nc">&nbsp;                        .map(String::valueOf)</b>
<b class="nc">&nbsp;                        .collect(Collectors.toCollection(Vector::new)));</b>
&nbsp;            }
<b class="nc">&nbsp;            blk.writeBlockData(&quot;crew&quot;, js.getNCrew());</b>
<b class="nc">&nbsp;            blk.writeBlockData(&quot;officers&quot;, js.getNOfficers());</b>
<b class="nc">&nbsp;            blk.writeBlockData(&quot;gunners&quot;, js.getNGunners());</b>
<b class="nc">&nbsp;            blk.writeBlockData(&quot;passengers&quot;, js.getNPassenger());</b>
<b class="nc">&nbsp;            blk.writeBlockData(&quot;marines&quot;, js.getNMarines());</b>
<b class="nc">&nbsp;            blk.writeBlockData(&quot;battlearmor&quot;, js.getNBattleArmor());</b>
<b class="nc">&nbsp;            blk.writeBlockData(&quot;life_boat&quot;, js.getLifeBoats());</b>
<b class="nc">&nbsp;            blk.writeBlockData(&quot;escape_pod&quot;, js.getEscapePods());</b>
&nbsp;        }
<b class="nc">&nbsp;        return blk;</b>
&nbsp;    }
&nbsp;
&nbsp;    private static String encodeEquipmentLine(Mounted m) {
<b class="nc">&nbsp;        String name = m.getType().getInternalName();</b>
<b class="nc">&nbsp;        if (m.isRearMounted()) {</b>
<b class="nc">&nbsp;            name = &quot;(R) &quot; + name;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (m.isSponsonTurretMounted()) {</b>
<b class="nc">&nbsp;            name = name + &quot;(ST)&quot;;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (m.isMechTurretMounted()) {</b>
<b class="nc">&nbsp;            name = name + &quot;(T)&quot;;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (m.isPintleTurretMounted()) {</b>
<b class="nc">&nbsp;            name = name + &quot;(PT)&quot;;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (m.isDWPMounted()) {</b>
<b class="nc">&nbsp;            name += &quot;:DWP&quot;;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (m.isSquadSupportWeapon()) {</b>
<b class="nc">&nbsp;            name += &quot;:SSWM&quot;;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (m.isAPMMounted()) {</b>
<b class="nc">&nbsp;            name += &quot;:APM&quot;;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (m.isOmniPodMounted()) {</b>
<b class="nc">&nbsp;            name += &quot;:OMNI&quot;;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (m.getBaMountLoc() == BattleArmor.MOUNT_LOC_BODY) {</b>
<b class="nc">&nbsp;            name += &quot;:Body&quot;;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (m.getBaMountLoc() == BattleArmor.MOUNT_LOC_LARM) {</b>
<b class="nc">&nbsp;            name += &quot;:LA&quot;;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (m.getBaMountLoc() == BattleArmor.MOUNT_LOC_RARM) {</b>
<b class="nc">&nbsp;            name += &quot;:RA&quot;;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (m.getBaMountLoc() == BattleArmor.MOUNT_LOC_TURRET) {</b>
<b class="nc">&nbsp;            name += &quot;:TU&quot;;</b>
&nbsp;        }
&nbsp;        // For BattleArmor and ProtoMechs, we need to save how many shots are in this
&nbsp;        //  location but they have different formats, yay!
<b class="nc">&nbsp;        if ((m.getEntity() instanceof BattleArmor) &amp;&amp; (m.getType() instanceof AmmoType)) {</b>
<b class="nc">&nbsp;            name += &quot;:Shots&quot; + m.getBaseShotsLeft() + &quot;#&quot;;</b>
<b class="nc">&nbsp;        } else if (m.getEntity() instanceof Protomech &amp;&amp; (m.getType() instanceof AmmoType)) {</b>
<b class="nc">&nbsp;            name += &quot; (&quot; + m.getBaseShotsLeft() + &quot;)&quot;;</b>
<b class="nc">&nbsp;        } else if (m.getType().isVariableSize()</b>
<b class="nc">&nbsp;                || (m.getEntity().isSupportVehicle() &amp;&amp; (m.getType() instanceof InfantryWeapon))) {</b>
<b class="nc">&nbsp;            name += &quot;:SIZE:&quot; + m.getSize();</b>
&nbsp;        }
<b class="nc">&nbsp;        return name;</b>
&nbsp;    }
&nbsp;
&nbsp;    public static void encode(String fileName, Entity t) {
<b class="nc">&nbsp;        BuildingBlock blk = BLKFile.getBlock(t);</b>
<b class="nc">&nbsp;        blk.writeBlockFile(fileName);</b>
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    protected void addTransports(Entity e) {
<b class="nc">&nbsp;        if (dataFile.exists(&quot;transporters&quot;)) {</b>
<b class="nc">&nbsp;            String[] transporters = dataFile.getDataAsString(&quot;transporters&quot;);</b>
<b class="nc">&nbsp;            HashSet&lt;Integer&gt; usedBayNumbers = new HashSet&lt;&gt;();</b>
&nbsp;            
&nbsp;            // Walk the array of transporters.
<b class="nc">&nbsp;            for (String transporter : transporters) {</b>
<b class="nc">&nbsp;                transporter = transporter.toLowerCase();</b>
<b class="nc">&nbsp;            	boolean isPod = transporter.endsWith(&quot;:omni&quot;);</b>
<b class="nc">&nbsp;            	transporter = transporter.replace(&quot;:omni&quot;, &quot;&quot;);</b>
<b class="nc">&nbsp;            	boolean hasARTS = transporter.startsWith(&quot;arts&quot;);</b>
<b class="nc">&nbsp;            	if (hasARTS) {</b>
<b class="nc">&nbsp;            	    transporter = transporter.substring(4);</b>
&nbsp;                }
&nbsp;
&nbsp;            	// TroopSpace:
<b class="nc">&nbsp;                if (transporter.startsWith(&quot;troopspace:&quot;)) {</b>
&nbsp;                    // Everything after the &#39;:&#39; should be the space&#39;s size.
<b class="nc">&nbsp;                    double fsize = Double.parseDouble(transporter.substring(11));</b>
<b class="nc">&nbsp;                    e.addTransporter(new TroopSpace(fsize), isPod);</b>
<b class="nc">&nbsp;                } else if (transporter.startsWith(&quot;cargobay:&quot;)) {</b>
<b class="nc">&nbsp;                    String numbers = transporter.substring(9);</b>
<b class="nc">&nbsp;                    ParsedBayInfo pbi = new ParsedBayInfo(numbers, usedBayNumbers);</b>
<b class="nc">&nbsp;                    e.addTransporter(new CargoBay(pbi.getSize(), pbi.getDoors(), pbi.getBayNumber()), isPod);</b>
<b class="nc">&nbsp;                } else if (transporter.startsWith(&quot;liquidcargobay:&quot;)) {</b>
<b class="nc">&nbsp;                    String numbers = transporter.substring(15);</b>
<b class="nc">&nbsp;                    ParsedBayInfo pbi = new ParsedBayInfo(numbers, usedBayNumbers);</b>
<b class="nc">&nbsp;                    e.addTransporter(new LiquidCargoBay(pbi.getSize(), pbi.getDoors(), pbi.getBayNumber()), isPod);</b>
<b class="nc">&nbsp;                } else if (transporter.startsWith(&quot;insulatedcargobay:&quot;)) {</b>
<b class="nc">&nbsp;                    String numbers = transporter.substring(18);</b>
<b class="nc">&nbsp;                    ParsedBayInfo pbi = new ParsedBayInfo(numbers, usedBayNumbers);</b>
<b class="nc">&nbsp;                    e.addTransporter(new InsulatedCargoBay(pbi.getSize(), pbi.getDoors(), pbi.getBayNumber()), isPod);</b>
<b class="nc">&nbsp;                } else if (transporter.startsWith(&quot;refrigeratedcargobay:&quot;)) {</b>
<b class="nc">&nbsp;                    String numbers = transporter.substring(21);</b>
<b class="nc">&nbsp;                    ParsedBayInfo pbi = new ParsedBayInfo(numbers, usedBayNumbers);</b>
<b class="nc">&nbsp;                    e.addTransporter(new RefrigeratedCargoBay(pbi.getSize(), pbi.getDoors(), pbi.getBayNumber()), isPod);</b>
<b class="nc">&nbsp;                } else if (transporter.startsWith(&quot;livestockcargobay:&quot;)) {</b>
<b class="nc">&nbsp;                    String numbers = transporter.substring(18);</b>
<b class="nc">&nbsp;                    ParsedBayInfo pbi = new ParsedBayInfo(numbers, usedBayNumbers);</b>
<b class="nc">&nbsp;                    e.addTransporter(new LivestockCargoBay(pbi.getSize(), pbi.getDoors(), pbi.getBayNumber()), isPod);</b>
<b class="nc">&nbsp;                } else if (transporter.startsWith(&quot;asfbay:&quot;)) {</b>
<b class="nc">&nbsp;                    String numbers = transporter.substring(7);</b>
<b class="nc">&nbsp;                    ParsedBayInfo pbi = new ParsedBayInfo(numbers, usedBayNumbers);</b>
<b class="nc">&nbsp;                    e.addTransporter(new ASFBay(pbi.getSize(), pbi.getDoors(), pbi.getBayNumber(), hasARTS), isPod);</b>
<b class="nc">&nbsp;                } else if (transporter.startsWith(&quot;smallcraftbay:&quot;)) {</b>
<b class="nc">&nbsp;                    String numbers = transporter.substring(14);</b>
<b class="nc">&nbsp;                    ParsedBayInfo pbi = new ParsedBayInfo(numbers, usedBayNumbers);</b>
<b class="nc">&nbsp;                    e.addTransporter(new SmallCraftBay(pbi.getSize(), pbi.getDoors(), pbi.getBayNumber(), hasARTS), isPod);</b>
<b class="nc">&nbsp;                } else if (transporter.startsWith(&quot;mechbay:&quot;)) {</b>
<b class="nc">&nbsp;                    String numbers = transporter.substring(8);</b>
<b class="nc">&nbsp;                    ParsedBayInfo pbi = new ParsedBayInfo(numbers, usedBayNumbers);</b>
<b class="nc">&nbsp;                    e.addTransporter(new MechBay(pbi.getSize(), pbi.getDoors(), pbi.getBayNumber()), isPod);</b>
<b class="nc">&nbsp;                } else if (transporter.startsWith(&quot;lightvehiclebay:&quot;)) {</b>
<b class="nc">&nbsp;                    String numbers = transporter.substring(16);</b>
<b class="nc">&nbsp;                    ParsedBayInfo pbi = new ParsedBayInfo(numbers, usedBayNumbers);</b>
<b class="nc">&nbsp;                    e.addTransporter(new LightVehicleBay(pbi.getSize(), pbi.getDoors(), pbi.getBayNumber()), isPod);</b>
<b class="nc">&nbsp;                } else if (transporter.startsWith(&quot;heavyvehiclebay:&quot;)) {</b>
<b class="nc">&nbsp;                    String numbers = transporter.substring(16);</b>
<b class="nc">&nbsp;                    ParsedBayInfo pbi = new ParsedBayInfo(numbers, usedBayNumbers);</b>
<b class="nc">&nbsp;                    e.addTransporter(new HeavyVehicleBay(pbi.getSize(), pbi.getDoors(), pbi.getBayNumber()), isPod);</b>
<b class="nc">&nbsp;                } else if (transporter.startsWith(&quot;superheavyvehiclebay:&quot;)) {</b>
<b class="nc">&nbsp;                    String numbers = transporter.substring(21);</b>
<b class="nc">&nbsp;                    ParsedBayInfo pbi = new ParsedBayInfo(numbers, usedBayNumbers);</b>
<b class="nc">&nbsp;                    e.addTransporter(new SuperHeavyVehicleBay(pbi.getSize(), pbi.getDoors(), pbi.getBayNumber()), isPod);</b>
<b class="nc">&nbsp;                } else if (transporter.startsWith(&quot;infantrybay:&quot;)) {</b>
<b class="nc">&nbsp;                    String numbers = transporter.substring(12);</b>
<b class="nc">&nbsp;                    ParsedBayInfo pbi = new ParsedBayInfo(numbers, usedBayNumbers);</b>
<b class="nc">&nbsp;                    e.addTransporter(new InfantryBay(pbi.getSize(), pbi.getDoors(), pbi.getBayNumber(), pbi.getPlatoonType()), isPod);</b>
<b class="nc">&nbsp;                } else if (transporter.startsWith(&quot;battlearmorbay:&quot;)) {</b>
<b class="nc">&nbsp;                    String numbers = transporter.substring(15);</b>
<b class="nc">&nbsp;                    ParsedBayInfo pbi = new ParsedBayInfo(numbers, usedBayNumbers);</b>
<b class="nc">&nbsp;                    e.addTransporter(new BattleArmorBay(pbi.getSize(), pbi.getDoors(), pbi.getBayNumber(),</b>
<b class="nc">&nbsp;                            e.isClan(), pbi.isComstarBay()), isPod);</b>
<b class="nc">&nbsp;                } else if (transporter.startsWith(&quot;bay:&quot;)) {</b>
<b class="nc">&nbsp;                    String numbers = transporter.substring(4);</b>
<b class="nc">&nbsp;                    ParsedBayInfo pbi = new ParsedBayInfo(numbers, usedBayNumbers);</b>
<b class="nc">&nbsp;                    e.addTransporter(new Bay(pbi.getSize(), pbi.getDoors(), pbi.getBayNumber()), isPod);</b>
<b class="nc">&nbsp;                } else if (transporter.startsWith(&quot;protomechbay:&quot;)) {</b>
<b class="nc">&nbsp;                    String numbers = transporter.substring(13);</b>
<b class="nc">&nbsp;                    ParsedBayInfo pbi = new ParsedBayInfo(numbers, usedBayNumbers);</b>
<b class="nc">&nbsp;                    e.addTransporter(new ProtomechBay(pbi.getSize(), pbi.getDoors(), pbi.getBayNumber()), isPod);</b>
<b class="nc">&nbsp;                } else if (transporter.startsWith(&quot;dropshuttlebay:&quot;)) {</b>
<b class="nc">&nbsp;                    String numbers = transporter.substring(&quot;dropshuttlebay:&quot;.length());</b>
<b class="nc">&nbsp;                    ParsedBayInfo pbi = new ParsedBayInfo(numbers, usedBayNumbers);</b>
<b class="nc">&nbsp;                    e.addTransporter(new DropshuttleBay(pbi.getDoors(), pbi.getBayNumber(), pbi.getFacing()), isPod);</b>
<b class="nc">&nbsp;                } else if (transporter.startsWith(&quot;navalrepairpressurized:&quot;)) {</b>
<b class="nc">&nbsp;                    String numbers = transporter.substring(&quot;navalrepairpressurized:&quot;.length());</b>
<b class="nc">&nbsp;                    ParsedBayInfo pbi = new ParsedBayInfo(numbers, usedBayNumbers);</b>
<b class="nc">&nbsp;                    e.addTransporter(new NavalRepairFacility(pbi.getSize(), pbi.getDoors(), pbi.getBayNumber(),</b>
<b class="nc">&nbsp;                            pbi.getFacing(), true, hasARTS), isPod);</b>
<b class="nc">&nbsp;                } else if (transporter.startsWith(&quot;navalrepairunpressurized:&quot;)) {</b>
<b class="nc">&nbsp;                    String numbers = transporter.substring(&quot;navalrepairunpressurized:&quot;.length());</b>
<b class="nc">&nbsp;                    ParsedBayInfo pbi = new ParsedBayInfo(numbers, usedBayNumbers);</b>
<b class="nc">&nbsp;                    e.addTransporter(new NavalRepairFacility(pbi.getSize(), pbi.getDoors(),</b>
<b class="nc">&nbsp;                            pbi.getBayNumber(), pbi.getFacing(), false, hasARTS), isPod);</b>
<b class="nc">&nbsp;                } else if (transporter.startsWith(&quot;reinforcedrepairfacility:&quot;)) {</b>
<b class="nc">&nbsp;                    String numbers = transporter.substring(&quot;reinforcedrepairfacility:&quot;.length());</b>
<b class="nc">&nbsp;                    ParsedBayInfo pbi = new ParsedBayInfo(numbers, usedBayNumbers);</b>
<b class="nc">&nbsp;                    e.addTransporter(new ReinforcedRepairFacility(pbi.getSize(), pbi.getDoors(),</b>
<b class="nc">&nbsp;                            pbi.getBayNumber(), pbi.getFacing()), isPod);</b>
<b class="nc">&nbsp;                } else if (transporter.startsWith(&quot;crewquarters:&quot;)) {</b>
<b class="nc">&nbsp;                    String numbers = transporter.substring(13);</b>
<b class="nc">&nbsp;                    ParsedBayInfo pbi = new ParsedBayInfo(numbers, usedBayNumbers);</b>
<b class="nc">&nbsp;                    e.addTransporter(new CrewQuartersCargoBay(pbi.getSize(), pbi.getDoors()), isPod);</b>
<b class="nc">&nbsp;                } else if (transporter.startsWith(&quot;steeragequarters:&quot;)) {</b>
<b class="nc">&nbsp;                    String numbers = transporter.substring(17);</b>
<b class="nc">&nbsp;                    ParsedBayInfo pbi = new ParsedBayInfo(numbers, usedBayNumbers);</b>
<b class="nc">&nbsp;                    e.addTransporter(new SteerageQuartersCargoBay(pbi.getSize(), pbi.getDoors()), isPod);</b>
<b class="nc">&nbsp;                } else if (transporter.startsWith(&quot;2ndclassquarters:&quot;)) {</b>
<b class="nc">&nbsp;                    String numbers = transporter.substring(17);</b>
<b class="nc">&nbsp;                    ParsedBayInfo pbi = new ParsedBayInfo(numbers, usedBayNumbers);</b>
<b class="nc">&nbsp;                    e.addTransporter(new SecondClassQuartersCargoBay(pbi.getSize(), pbi.getDoors()), isPod);</b>
<b class="nc">&nbsp;                } else if (transporter.startsWith(&quot;1stclassquarters:&quot;)) {</b>
<b class="nc">&nbsp;                    String numbers = transporter.substring(17);</b>
<b class="nc">&nbsp;                    ParsedBayInfo pbi = new ParsedBayInfo(numbers, usedBayNumbers);</b>
<b class="nc">&nbsp;                    e.addTransporter(new FirstClassQuartersCargoBay(pbi.getSize(), pbi.getDoors()), isPod);</b>
<b class="nc">&nbsp;                } else if (transporter.startsWith(&quot;pillionseats:&quot;)) {</b>
<b class="nc">&nbsp;                    String numbers = transporter.substring(13);</b>
<b class="nc">&nbsp;                    ParsedBayInfo pbi = new ParsedBayInfo(numbers, usedBayNumbers);</b>
<b class="nc">&nbsp;                    e.addTransporter(new PillionSeatCargoBay(pbi.getSize()), isPod);</b>
<b class="nc">&nbsp;                } else if (transporter.startsWith(&quot;standardseats:&quot;)) {</b>
<b class="nc">&nbsp;                    String numbers = transporter.substring(14);</b>
<b class="nc">&nbsp;                    ParsedBayInfo pbi = new ParsedBayInfo(numbers, usedBayNumbers);</b>
<b class="nc">&nbsp;                    e.addTransporter(new StandardSeatCargoBay(pbi.getSize()), isPod);</b>
<b class="nc">&nbsp;                } else if (transporter.startsWith(&quot;ejectionseats:&quot;)) {</b>
<b class="nc">&nbsp;                    String numbers = transporter.substring(&quot;ejectionseats:&quot;.length());</b>
<b class="nc">&nbsp;                    ParsedBayInfo pbi = new ParsedBayInfo(numbers, usedBayNumbers);</b>
<b class="nc">&nbsp;                    e.addTransporter(new EjectionSeatCargoBay(pbi.getSize()), isPod);</b>
<b class="nc">&nbsp;                } else if (transporter.startsWith(&quot;dockingcollar&quot;)) {</b>
&nbsp;                    //Add values for collars so they can be parsed and assigned a &#39;bay&#39; number
<b class="nc">&nbsp;                    String numbers = &quot;1.0:0&quot;;</b>
<b class="nc">&nbsp;                    ParsedBayInfo pbi = new ParsedBayInfo(numbers, usedBayNumbers);</b>
<b class="nc">&nbsp;                    e.addTransporter(new DockingCollar(1,pbi.getBayNumber()));</b>
&nbsp;                }
&nbsp;
&nbsp;            } // Handle the next transportation component.
&nbsp;
&nbsp;        } // End has-transporters
<b class="nc">&nbsp;    }</b>
&nbsp;    
&nbsp;    /**
&nbsp;     * Class that holds data relating to transport bays
&nbsp;     * and functionality to parse .blk file transport bay entries
&nbsp;     * @author NickAragua
&nbsp;     *
&nbsp;     */
&nbsp;    public static class ParsedBayInfo {
&nbsp;        private double size;
&nbsp;        private int doors;
<b class="fc">&nbsp;        private int bayNumber = -1;</b>
<b class="fc">&nbsp;        private PlatoonType platoonType = InfantryBay.PlatoonType.FOOT;</b>
&nbsp;        private boolean isComstarBay;
<b class="fc">&nbsp;        private int facing = Entity.LOC_NONE;</b>
&nbsp;        
<b class="fc">&nbsp;        public ParsedBayInfo(String numbers, HashSet&lt;Integer&gt; usedBayNumbers) {</b>
&nbsp;            // expected format of &quot;numbers&quot; string:
&nbsp;            // a:b:c:d
&nbsp;            // a is the size of the bay, in tons or # of units and is required
&nbsp;            // b is the number of doors in the bay, and is required
&nbsp;            // c is the bay number OR an indicator that this bay is a comstar bay OR an indicator of the kind of infantry bay it is, and is optional
&nbsp;            // d is like c except that it&#39;s not going to be the bay number
&nbsp;            
<b class="fc">&nbsp;            String[] temp = numbers.split(Bay.FIELD_SEPARATOR);</b>
<b class="fc">&nbsp;            size = Double.parseDouble(temp[0]);</b>
<b class="fc">&nbsp;            doors = Integer.parseInt(temp[1]);</b>
&nbsp;            
&nbsp;            // the bay type indicator will be either the third or fourth item, but the bay number always comes before it
&nbsp;            // so we make sure to pick the last item in the array
<b class="fc">&nbsp;            String potentialBayTypeIndicator = &quot;&quot;;</b>
<b class="fc">&nbsp;            boolean bayNumberPresent = false;</b>
&nbsp;            
<b class="fc">&nbsp;            if(temp.length == 3) {</b>
<b class="fc">&nbsp;                potentialBayTypeIndicator = temp[2];</b>
<b class="fc">&nbsp;            } else if (temp.length == 4) {</b>
<b class="fc">&nbsp;                potentialBayTypeIndicator = temp[3];</b>
<b class="fc">&nbsp;                bayNumberPresent = true; // a 4-length array indicates that the bay number is in the third element</b>
&nbsp;            }
&nbsp;                        
<b class="fc">&nbsp;            if(!potentialBayTypeIndicator.isEmpty()) {</b>
&nbsp;                // normally a great time for a switch statement, but we&#39;re using equalsignorecase for the comparator
<b class="fc">&nbsp;                if(potentialBayTypeIndicator.equalsIgnoreCase(COMSTAR_BAY)) {</b>
<b class="fc">&nbsp;                    isComstarBay = true;</b>
<b class="fc">&nbsp;                } else if (potentialBayTypeIndicator.equalsIgnoreCase(&quot;jump&quot;)) {</b>
<b class="fc">&nbsp;                    platoonType = InfantryBay.PlatoonType.JUMP;</b>
<b class="fc">&nbsp;                } else if (potentialBayTypeIndicator.equalsIgnoreCase(&quot;foot&quot;)) {</b>
<b class="fc">&nbsp;                    platoonType = InfantryBay.PlatoonType.FOOT;</b>
<b class="fc">&nbsp;                } else if (potentialBayTypeIndicator.equalsIgnoreCase(&quot;motorized&quot;)) {</b>
<b class="fc">&nbsp;                    platoonType = InfantryBay.PlatoonType.MOTORIZED;</b>
<b class="fc">&nbsp;                } else if (potentialBayTypeIndicator.equalsIgnoreCase(&quot;mechanized&quot;)) {</b>
<b class="fc">&nbsp;                    platoonType = InfantryBay.PlatoonType.MECHANIZED;</b>
<b class="fc">&nbsp;                } else if (potentialBayTypeIndicator.startsWith(Bay.FACING_PREFIX)) {</b>
<b class="fc">&nbsp;                    facing = Integer.parseInt(potentialBayTypeIndicator.replace(Bay.FACING_PREFIX, &quot;&quot;));</b>
&nbsp;                } else {
&nbsp;                    // if we looked at the 
<b class="nc">&nbsp;                    bayNumberPresent = temp.length == 3; </b>
&nbsp;                }
&nbsp;            }
&nbsp;            
&nbsp;            // if we are looking for a bay number
&nbsp;            // and a bay number is present, parse it
<b class="fc">&nbsp;            if(usedBayNumbers != null &amp;&amp; bayNumberPresent) {</b>
<b class="fc">&nbsp;                bayNumber = Integer.parseInt(temp[2]);</b>
&nbsp;            }
&nbsp;
&nbsp;            // if a bay number was not specified, assign one
&nbsp;            // if a bay number was specified but is a duplicate, assign a different one
<b class="fc">&nbsp;            int newBay = 1;</b>
<b class="fc">&nbsp;            if(bayNumber == -1 || usedBayNumbers.contains(bayNumber)) {</b>
<b class="fc">&nbsp;                while(usedBayNumbers.contains(newBay)) {</b>
<b class="fc">&nbsp;                    newBay++;</b>
&nbsp;                }
&nbsp;                
<b class="fc">&nbsp;                bayNumber = newBay;</b>
&nbsp;            }
&nbsp;            
<b class="fc">&nbsp;            usedBayNumbers.add(bayNumber);</b>
<b class="fc">&nbsp;        }</b>
&nbsp;        
&nbsp;        public double getSize() {
<b class="fc">&nbsp;            return size;</b>
&nbsp;        }
&nbsp;        
&nbsp;        public int getDoors() {
<b class="fc">&nbsp;            return doors;</b>
&nbsp;        }
&nbsp;        
&nbsp;        public int getBayNumber() {
<b class="fc">&nbsp;            return bayNumber;</b>
&nbsp;        }
&nbsp;        
&nbsp;        public PlatoonType getPlatoonType() {
<b class="fc">&nbsp;            return platoonType;</b>
&nbsp;        }
&nbsp;        
&nbsp;        public boolean isComstarBay() {
<b class="fc">&nbsp;            return isComstarBay;</b>
&nbsp;        }
&nbsp;        
&nbsp;        public int getFacing() {
<b class="fc">&nbsp;            return facing;</b>
&nbsp;        }
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2023-05-16 16:28</div>
</div>
</body>
</html>
