


<!DOCTYPE html>
<html id="htmlId">
<head>
  <title>Coverage Report > MtfFile</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">megamek.common.loaders</a>
</div>

<h1>Coverage Summary for Class: MtfFile (megamek.common.loaders)</h1>

<table class="coverageStats">
<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Class, %
</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">MtfFile</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    92.9%
  </span>
  <span class="absValue">
    (13/14)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    57.8%
  </span>
  <span class="absValue">
    (398/688)
  </span>
</td>
</tr>

</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;/*
&nbsp; * MegaMek - Copyright (C) 2000-2002 Ben Mazur (bmazur@sev.org)
&nbsp; *
&nbsp; * This program is free software; you can redistribute it and/or modify it under
&nbsp; * the terms of the GNU General Public License as published by the Free Software
&nbsp; * Foundation; either version 2 of the License, or (at your option) any later
&nbsp; * version.
&nbsp; *
&nbsp; * This program is distributed in the hope that it will be useful, but WITHOUT
&nbsp; * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
&nbsp; * FOR A PARTICULAR PURPOSE. See the GNU General Public License for more
&nbsp; * details.
&nbsp; */
&nbsp;
&nbsp;/*
&nbsp; * MtfFile.java
&nbsp; *
&nbsp; * Created on April 7, 2002, 8:47 PM
&nbsp; */
&nbsp;
&nbsp;package megamek.common.loaders;
&nbsp;
&nbsp;import java.io.*;
&nbsp;import java.util.*;
&nbsp;
&nbsp;import megamek.common.*;
&nbsp;
&nbsp;/**
&nbsp; * @author Ben
&nbsp; */
&nbsp;public class MtfFile implements IMechLoader {
&nbsp;
&nbsp;    private String name;
&nbsp;    private String model;
&nbsp;
&nbsp;    private String chassisConfig;
&nbsp;    private String techBase;
&nbsp;    private String techYear;
&nbsp;    private String rulesLevel;
<b class="fc">&nbsp;    private String source = &quot;Source:&quot;;</b>
&nbsp;
&nbsp;    private String tonnage;
&nbsp;    private String engine;
&nbsp;    private String internalType;
&nbsp;    private String gyroType;
&nbsp;    private String cockpitType;
&nbsp;    private String lamType;
&nbsp;    private String motiveType;
&nbsp;    private String ejectionType;
&nbsp;
&nbsp;    private String heatSinks;
&nbsp;    private String jumpMP;
<b class="fc">&nbsp;    private String baseChassieHeatSinks = &quot;base chassis heat sinks:-1&quot;;</b>
&nbsp;
&nbsp;    private String armorType;
<b class="fc">&nbsp;    private String[] armorValues = new String[12];</b>
&nbsp;
&nbsp;    private String[][] critData;
<b class="fc">&nbsp;    private List&lt;String&gt; noCritEquipment = new ArrayList&lt;&gt;();</b>
&nbsp;
<b class="fc">&nbsp;    private String capabilities = &quot;&quot;;</b>
<b class="fc">&nbsp;    private String deployment = &quot;&quot;;</b>
<b class="fc">&nbsp;    private String overview = &quot;&quot;;</b>
<b class="fc">&nbsp;    private String history = &quot;&quot;;</b>
<b class="fc">&nbsp;    private String manufacturer = &quot;&quot;;</b>
<b class="fc">&nbsp;    private String primaryFactory = &quot;&quot;;</b>
<b class="fc">&nbsp;    private Map&lt;EntityFluff.System, String&gt; systemManufacturers = new EnumMap&lt;&gt;(EntityFluff.System.class);</b>
<b class="fc">&nbsp;    private Map&lt;EntityFluff.System, String&gt; systemModels = new EnumMap&lt;&gt;(EntityFluff.System.class);</b>
<b class="fc">&nbsp;    private String notes = &quot;&quot;;</b>
<b class="fc">&nbsp;    private String imagePath = &quot;&quot;;</b>
&nbsp;
<b class="fc">&nbsp;    private int bv = 0;</b>
&nbsp;
<b class="fc">&nbsp;    private Map&lt;EquipmentType, Mounted&gt; hSharedEquip = new HashMap&lt;&gt;();</b>
<b class="fc">&nbsp;    private List&lt;Mounted&gt; vSplitWeapons = new ArrayList&lt;&gt;();</b>
&nbsp;
<b class="fc">&nbsp;    public static final int[] locationOrder =</b>
&nbsp;            {Mech.LOC_LARM, Mech.LOC_RARM, Mech.LOC_LT, Mech.LOC_RT, Mech.LOC_CT, Mech.LOC_HEAD, Mech.LOC_LLEG, Mech.LOC_RLEG, Mech.LOC_CLEG};
<b class="fc">&nbsp;    public static final int[] rearLocationOrder =</b>
&nbsp;            {Mech.LOC_LT, Mech.LOC_RT, Mech.LOC_CT};
&nbsp;
&nbsp;    public static final String COCKPIT = &quot;cockpit:&quot;;
&nbsp;    public static final String GYRO = &quot;gyro:&quot;;
&nbsp;    public static final String MOTIVE = &quot;motive:&quot;;
&nbsp;    public static final String EJECTION = &quot;ejection:&quot;;
&nbsp;    public static final String MASS = &quot;mass:&quot;;
&nbsp;    public static final String ENGINE = &quot;engine:&quot;;
&nbsp;    public static final String STRUCTURE = &quot;structure:&quot;;
&nbsp;    public static final String MYOMER = &quot;myomer:&quot;;
&nbsp;    public static final String LAM = &quot;lam:&quot;;
&nbsp;    public static final String CONFIG = &quot;config:&quot;;
&nbsp;    public static final String TECH_BASE = &quot;techbase:&quot;;
&nbsp;    public static final String ERA = &quot;era:&quot;;
&nbsp;    public static final String SOURCE = &quot;source:&quot;;
&nbsp;    public static final String RULES_LEVEL = &quot;rules level:&quot;;
&nbsp;    public static final String HEAT_SINKS = &quot;heat sinks:&quot;;
&nbsp;    public static final String BASE_CHASSIS_HEAT_SINKS = &quot;base chassis heat sinks:&quot;;
&nbsp;    public static final String HS_SINGLE = &quot;Single&quot;;
&nbsp;    public static final String HS_DOUBLE = &quot;Double&quot;;
&nbsp;    public static final String HS_LASER = &quot;Laser&quot;;
&nbsp;    public static final String HS_COMPACT = &quot;Compact&quot;;
&nbsp;    public static final String TECH_BASE_IS = &quot;IS&quot;;
&nbsp;    public static final String TECH_BASE_CLAN = &quot;Clan&quot;;
&nbsp;    public static final String WALK_MP = &quot;walk mp:&quot;;
&nbsp;    public static final String JUMP_MP = &quot;jump mp:&quot;;
&nbsp;    public static final String ARMOR = &quot;armor:&quot;;
&nbsp;    public static final String OVERVIEW = &quot;overview:&quot;;
&nbsp;    public static final String CAPABILITIES = &quot;capabilities:&quot;;
&nbsp;    public static final String DEPLOYMENT = &quot;deployment:&quot;;
&nbsp;    public static final String HISTORY = &quot;history:&quot;;
&nbsp;    public static final String MANUFACTURER = &quot;manufacturer:&quot;;
&nbsp;    public static final String PRIMARY_FACTORY = &quot;primaryfactory:&quot;;
&nbsp;    public static final String SYSTEM_MANUFACTURER = &quot;systemmanufacturer:&quot;;
&nbsp;    public static final String SYSTEM_MODEL = &quot;systemmode:&quot;;
&nbsp;    public static final String NOTES = &quot;notes:&quot;;
&nbsp;    public static final String IMAGE_FILE = &quot;imagefile:&quot;;
&nbsp;    public static final String BV = &quot;bv:&quot;;
&nbsp;    public static final String WEAPONS = &quot;weapons:&quot;;
&nbsp;    public static final String EMPTY = &quot;-Empty-&quot;;
&nbsp;    public static final String ARMORED = &quot;(ARMORED)&quot;;
&nbsp;    public static final String OMNIPOD = &quot;(OMNIPOD)&quot;;
&nbsp;    public static final String NO_CRIT = &quot;nocrit:&quot;;
&nbsp;    public static final String SIZE = &quot;:SIZE:&quot;;
&nbsp;
&nbsp;    /**
&nbsp;     * Creates new MtfFile
&nbsp;     */
<b class="fc">&nbsp;    public MtfFile(InputStream is) throws EntityLoadingException {</b>
<b class="fc">&nbsp;        try (BufferedReader r = new BufferedReader(new InputStreamReader(is))) {</b>
<b class="fc">&nbsp;            String version = r.readLine();</b>
<b class="fc">&nbsp;            if (version == null) {</b>
<b class="nc">&nbsp;                throw new EntityLoadingException(&quot;MTF File empty!&quot;);</b>
&nbsp;            }
&nbsp;            // Version 1.0: Initial version.
&nbsp;            // Version 1.1: Added level 3 cockpit and gyro options.
&nbsp;            // version 1.2: added full head ejection
<b class="fc">&nbsp;            if (!version.trim().equalsIgnoreCase(&quot;Version:1.0&quot;) &amp;&amp; !version.trim().equalsIgnoreCase(&quot;Version:1.1&quot;) &amp;&amp; !version.trim().equalsIgnoreCase(&quot;Version:1.2&quot;)) {</b>
<b class="nc">&nbsp;                throw new EntityLoadingException(&quot;Wrong MTF file version.&quot;);</b>
&nbsp;            }
&nbsp;
<b class="fc">&nbsp;            name = r.readLine();</b>
<b class="fc">&nbsp;            model = r.readLine();</b>
&nbsp;
<b class="fc">&nbsp;            critData = new String[9][12];</b>
&nbsp;
<b class="fc">&nbsp;            readCrits(r);</b>
<b class="fc">&nbsp;        } catch (IOException ex) {</b>
<b class="nc">&nbsp;            ex.printStackTrace();</b>
<b class="nc">&nbsp;            throw new EntityLoadingException(&quot;I/O Error reading file&quot;);</b>
<b class="nc">&nbsp;        } catch (StringIndexOutOfBoundsException ex) {</b>
<b class="nc">&nbsp;            ex.printStackTrace();</b>
<b class="nc">&nbsp;            throw new EntityLoadingException(&quot;StringIndexOutOfBoundsException reading file (format error)&quot;);</b>
<b class="nc">&nbsp;        } catch (NumberFormatException ex) {</b>
<b class="nc">&nbsp;            ex.printStackTrace();</b>
<b class="nc">&nbsp;            throw new EntityLoadingException(&quot;NumberFormatException reading file (format error)&quot;);</b>
<b class="fc">&nbsp;        }</b>
<b class="fc">&nbsp;    }</b>
&nbsp;
&nbsp;    private void readCrits(BufferedReader r) throws IOException {
<b class="fc">&nbsp;        int slot = 0;</b>
<b class="fc">&nbsp;        int loc = 0;</b>
&nbsp;        String crit;
&nbsp;        int weaponsCount;
&nbsp;        int armorLocation;
<b class="fc">&nbsp;        while (r.ready()) {</b>
<b class="fc">&nbsp;            crit = r.readLine().trim();</b>
<b class="fc">&nbsp;            if (crit.isEmpty()) {</b>
<b class="fc">&nbsp;                continue;</b>
&nbsp;            }
&nbsp;
<b class="fc">&nbsp;            if (isValidLocation(crit)) {</b>
<b class="fc">&nbsp;                loc = getLocation(crit);</b>
<b class="fc">&nbsp;                slot = 0;</b>
<b class="fc">&nbsp;                continue;</b>
&nbsp;            }
&nbsp;
<b class="fc">&nbsp;            if (isProcessedComponent(crit)) {</b>
<b class="fc">&nbsp;                continue;</b>
&nbsp;            }
&nbsp;
<b class="fc">&nbsp;            weaponsCount = weaponsList(crit);</b>
&nbsp;
<b class="fc">&nbsp;            if (weaponsCount &gt; 0) {</b>
<b class="fc">&nbsp;                for (int count = 0; count &lt; weaponsCount; count++) {</b>
<b class="fc">&nbsp;                    r.readLine();</b>
&nbsp;                }
<b class="fc">&nbsp;                continue;</b>
&nbsp;            }
&nbsp;
<b class="fc">&nbsp;            armorLocation = getArmorLocation(crit);</b>
&nbsp;
<b class="fc">&nbsp;            if (armorLocation &gt;= 0) {</b>
<b class="fc">&nbsp;                armorValues[armorLocation] = crit;</b>
<b class="fc">&nbsp;                continue;</b>
&nbsp;            }
<b class="fc">&nbsp;            if (critData.length &lt;= loc) {</b>
<b class="nc">&nbsp;                continue;</b>
&nbsp;            }
<b class="fc">&nbsp;            if (critData[loc].length &lt;= slot) {</b>
<b class="fc">&nbsp;                continue;</b>
&nbsp;            }
<b class="fc">&nbsp;            critData[loc][slot++] = crit.trim();</b>
&nbsp;
&nbsp;        }
<b class="fc">&nbsp;    }</b>
&nbsp;
&nbsp;    public Entity getEntity() throws EntityLoadingException {
&nbsp;        try {
&nbsp;            Mech mech;
&nbsp;
&nbsp;            int iGyroType;
&nbsp;            try {
<b class="fc">&nbsp;                iGyroType = Mech.getGyroTypeForString(gyroType.substring(5));</b>
<b class="nc">&nbsp;                if (iGyroType == Mech.GYRO_UNKNOWN) {</b>
<b class="nc">&nbsp;                    iGyroType = Mech.GYRO_STANDARD;</b>
&nbsp;                }
<b class="fc">&nbsp;            } catch (Exception e) {</b>
<b class="fc">&nbsp;                iGyroType = Mech.GYRO_STANDARD;</b>
<b class="nc">&nbsp;            }</b>
&nbsp;            int iCockpitType;
&nbsp;            try {
<b class="fc">&nbsp;                iCockpitType = Mech.getCockpitTypeForString(cockpitType.substring(8));</b>
<b class="nc">&nbsp;                if (iCockpitType == Mech.COCKPIT_UNKNOWN) {</b>
<b class="nc">&nbsp;                    iCockpitType = Mech.COCKPIT_STANDARD;</b>
&nbsp;                }
<b class="fc">&nbsp;            } catch (Exception e) {</b>
<b class="fc">&nbsp;                iCockpitType = Mech.COCKPIT_STANDARD;</b>
<b class="nc">&nbsp;            }</b>
&nbsp;            boolean fullHead;
&nbsp;            try {
<b class="fc">&nbsp;                fullHead = ejectionType.substring(9).equals(Mech.FULL_HEAD_EJECT_STRING);</b>
<b class="fc">&nbsp;            } catch (Exception e) {</b>
<b class="fc">&nbsp;                fullHead = false;</b>
<b class="nc">&nbsp;            }</b>
<b class="fc">&nbsp;            if (chassisConfig.contains(&quot;QuadVee&quot;)) {</b>
&nbsp;                int iMotiveType;
&nbsp;                try {
<b class="nc">&nbsp;                    iMotiveType = QuadVee.getMotiveTypeForString(motiveType.substring(7));</b>
<b class="nc">&nbsp;                    if (iMotiveType == QuadVee.MOTIVE_UNKNOWN) {</b>
<b class="nc">&nbsp;                        iMotiveType = QuadVee.MOTIVE_TRACK;</b>
&nbsp;                    }
<b class="nc">&nbsp;                } catch (Exception e) {</b>
<b class="nc">&nbsp;                    iMotiveType = QuadVee.MOTIVE_TRACK;</b>
<b class="nc">&nbsp;                }</b>
<b class="nc">&nbsp;                mech = new QuadVee(iGyroType, iMotiveType);</b>
<b class="nc">&nbsp;            } else if (chassisConfig.contains(&quot;Quad&quot;)) {</b>
<b class="nc">&nbsp;                mech = new QuadMech(iGyroType, iCockpitType);</b>
<b class="fc">&nbsp;            } else if (chassisConfig.contains(&quot;LAM&quot;)) {</b>
&nbsp;                int iLAMType;
&nbsp;                try {
<b class="nc">&nbsp;                    iLAMType = LandAirMech.getLAMTypeForString(lamType.substring(4));</b>
<b class="nc">&nbsp;                    if (iLAMType == LandAirMech.LAM_UNKNOWN) {</b>
<b class="nc">&nbsp;                        iLAMType = LandAirMech.LAM_STANDARD;</b>
&nbsp;                    }
<b class="nc">&nbsp;                } catch (Exception e) {</b>
<b class="nc">&nbsp;                    iLAMType = LandAirMech.LAM_STANDARD;</b>
<b class="nc">&nbsp;                }</b>
<b class="nc">&nbsp;                mech = new LandAirMech(iGyroType, iCockpitType, iLAMType);</b>
<b class="nc">&nbsp;            } else if (chassisConfig.contains(&quot;Tripod&quot;)) {</b>
<b class="nc">&nbsp;                mech = new TripodMech(iGyroType, iCockpitType);</b>
&nbsp;            } else {
<b class="fc">&nbsp;                mech = new BipedMech(iGyroType, iCockpitType);</b>
&nbsp;            }
<b class="fc">&nbsp;            mech.setFullHeadEject(fullHead);</b>
<b class="fc">&nbsp;            mech.setChassis(name.trim());</b>
<b class="fc">&nbsp;            mech.setModel(model.trim());</b>
<b class="fc">&nbsp;            mech.setYear(Integer.parseInt(techYear.substring(4).trim()));</b>
<b class="fc">&nbsp;            mech.setSource(source.substring(&quot;Source:&quot;.length()).trim());</b>
&nbsp;
<b class="fc">&nbsp;            if (chassisConfig.contains(&quot;Omni&quot;)) {</b>
<b class="nc">&nbsp;                mech.setOmni(true);</b>
&nbsp;            }
<b class="fc">&nbsp;            setTechLevel(mech);</b>
<b class="fc">&nbsp;            mech.setWeight(Integer.parseInt(tonnage.substring(5)));</b>
&nbsp;
<b class="fc">&nbsp;            int engineFlags = 0;</b>
<b class="fc">&nbsp;            if ((mech.isClan() &amp;&amp; !mech.isMixedTech()) || (mech.isMixedTech() &amp;&amp; mech.isClan() &amp;&amp; !mech.itemOppositeTech(engine)) || (mech.isMixedTech() &amp;&amp; !mech.isClan() &amp;&amp; mech.itemOppositeTech(engine))) {</b>
<b class="nc">&nbsp;                engineFlags = Engine.CLAN_ENGINE;</b>
&nbsp;            }
<b class="fc">&nbsp;            if (mech.isSuperHeavy()) {</b>
<b class="fc">&nbsp;                engineFlags |= Engine.SUPERHEAVY_ENGINE;</b>
&nbsp;            }
&nbsp;
<b class="fc">&nbsp;            int engineRating = Integer.parseInt(engine.substring(engine.indexOf(&quot;:&quot;) + 1, engine.indexOf(&quot; &quot;)));</b>
<b class="fc">&nbsp;            mech.setEngine(new Engine(engineRating, Engine.getEngineTypeByString(engine), engineFlags));</b>
&nbsp;
<b class="fc">&nbsp;            mech.setOriginalJumpMP(Integer.parseInt(jumpMP.substring(8)));</b>
&nbsp;
<b class="fc">&nbsp;            boolean dblSinks = heatSinks.contains(HS_DOUBLE);</b>
<b class="fc">&nbsp;            boolean laserSinks = heatSinks.contains(HS_LASER);</b>
<b class="fc">&nbsp;            boolean compactSinks = heatSinks.contains(HS_COMPACT);</b>
<b class="fc">&nbsp;            int expectedSinks = Integer.parseInt(heatSinks.substring(11, 13).trim());</b>
<b class="fc">&nbsp;            int baseHeatSinks = Integer.parseInt(baseChassieHeatSinks.substring(&quot;base chassis heat sinks:&quot;.length()).trim());</b>
&nbsp;            // For mixed tech units with double heat sinks we want to install the correct type. Legacy files
&nbsp;            // don&#39;t specify, so we&#39;ll use TECH_BASE_ALL to indicate unknown and check for heat sinks on the
&nbsp;            // critical table.
&nbsp;            int heatSinkBase;
<b class="fc">&nbsp;            if (heatSinks.contains(TECH_BASE_CLAN)) {</b>
<b class="nc">&nbsp;                heatSinkBase = ITechnology.TECH_BASE_CLAN;</b>
<b class="fc">&nbsp;            } else if (heatSinks.contains(TECH_BASE_IS)) {</b>
<b class="nc">&nbsp;                heatSinkBase = ITechnology.TECH_BASE_IS;</b>
&nbsp;            } else {
<b class="fc">&nbsp;                heatSinkBase = ITechnology.TECH_BASE_ALL;</b>
&nbsp;            }
&nbsp;
<b class="fc">&nbsp;            String thisStructureType = internalType.substring(internalType.indexOf(&#39;:&#39;) + 1);</b>
<b class="fc">&nbsp;            if (thisStructureType.length() &gt; 0) {</b>
<b class="fc">&nbsp;                mech.setStructureType(thisStructureType);</b>
&nbsp;            } else {
<b class="nc">&nbsp;                mech.setStructureType(EquipmentType.T_STRUCTURE_STANDARD);</b>
&nbsp;            }
<b class="fc">&nbsp;            mech.autoSetInternal();</b>
&nbsp;
<b class="fc">&nbsp;            String thisArmorType = armorType.substring(armorType.indexOf(&#39;:&#39;) + 1);</b>
<b class="fc">&nbsp;            if (thisArmorType.indexOf(&#39;(&#39;) != -1) {</b>
<b class="fc">&nbsp;                boolean clan = thisArmorType.toLowerCase().contains(&quot;clan&quot;);</b>
<b class="fc">&nbsp;                if (clan) {</b>
<b class="nc">&nbsp;                    switch (Integer.parseInt(rulesLevel.substring(12).trim())) {</b>
&nbsp;                        case 2:
<b class="nc">&nbsp;                            mech.setArmorTechLevel(TechConstants.T_CLAN_TW);</b>
<b class="nc">&nbsp;                            break;</b>
&nbsp;                        case 3:
<b class="nc">&nbsp;                            mech.setArmorTechLevel(TechConstants.T_CLAN_ADVANCED);</b>
<b class="nc">&nbsp;                            break;</b>
&nbsp;                        case 4:
<b class="nc">&nbsp;                            mech.setArmorTechLevel(TechConstants.T_CLAN_EXPERIMENTAL);</b>
<b class="nc">&nbsp;                            break;</b>
&nbsp;                        case 5:
<b class="nc">&nbsp;                            mech.setArmorTechLevel(TechConstants.T_CLAN_UNOFFICIAL);</b>
<b class="nc">&nbsp;                            break;</b>
&nbsp;                        default:
<b class="nc">&nbsp;                            throw new EntityLoadingException(&quot;Unsupported tech level: &quot; + rulesLevel.substring(12).trim());</b>
&nbsp;                    }
&nbsp;                } else {
<b class="fc">&nbsp;                    switch (Integer.parseInt(rulesLevel.substring(12).trim())) {</b>
&nbsp;                        case 1:
<b class="fc">&nbsp;                            mech.setArmorTechLevel(TechConstants.T_INTRO_BOXSET);</b>
<b class="fc">&nbsp;                            break;</b>
&nbsp;                        case 2:
<b class="nc">&nbsp;                            mech.setArmorTechLevel(TechConstants.T_IS_TW_NON_BOX);</b>
<b class="nc">&nbsp;                            break;</b>
&nbsp;                        case 3:
<b class="nc">&nbsp;                            mech.setArmorTechLevel(TechConstants.T_IS_ADVANCED);</b>
<b class="nc">&nbsp;                            break;</b>
&nbsp;                        case 4:
<b class="nc">&nbsp;                            mech.setArmorTechLevel(TechConstants.T_IS_EXPERIMENTAL);</b>
<b class="nc">&nbsp;                            break;</b>
&nbsp;                        case 5:
<b class="nc">&nbsp;                            mech.setArmorTechLevel(TechConstants.T_IS_UNOFFICIAL);</b>
<b class="nc">&nbsp;                            break;</b>
&nbsp;                        default:
<b class="nc">&nbsp;                            throw new EntityLoadingException(&quot;Unsupported tech level: &quot; + rulesLevel.substring(12).trim());</b>
&nbsp;                    }
&nbsp;                }
<b class="fc">&nbsp;                thisArmorType = thisArmorType.substring(0, thisArmorType.indexOf(&#39;(&#39;)).trim();</b>
<b class="fc">&nbsp;                mech.setArmorType(thisArmorType);</b>
<b class="fc">&nbsp;            } else if (!thisArmorType.equals(EquipmentType.getArmorTypeName(EquipmentType.T_ARMOR_PATCHWORK))) {</b>
<b class="nc">&nbsp;                mech.setArmorTechLevel(mech.getTechLevel());</b>
<b class="nc">&nbsp;                mech.setArmorType(thisArmorType);</b>
&nbsp;            }
<b class="fc">&nbsp;            if (!(thisArmorType.length() &gt; 0)) {</b>
<b class="nc">&nbsp;                mech.setArmorType(EquipmentType.T_ARMOR_STANDARD);</b>
&nbsp;            }
<b class="fc">&nbsp;            mech.recalculateTechAdvancement();</b>
&nbsp;
<b class="fc">&nbsp;            for (int x = 0; x &lt; locationOrder.length; x++) {</b>
<b class="fc">&nbsp;                if ((locationOrder[x] == Mech.LOC_CLEG) &amp;&amp; !(mech instanceof TripodMech)) {</b>
<b class="fc">&nbsp;                    continue;</b>
&nbsp;                }
<b class="fc">&nbsp;                mech.initializeArmor(Integer.parseInt(armorValues[x].substring(armorValues[x].lastIndexOf(&#39;:&#39;) + 1)), locationOrder[x]);</b>
<b class="fc">&nbsp;                if (thisArmorType.equals(EquipmentType.getArmorTypeName(EquipmentType.T_ARMOR_PATCHWORK))) {</b>
<b class="nc">&nbsp;                    boolean clan = false;</b>
<b class="nc">&nbsp;                    if (armorValues[x].contains(&quot;Clan&quot;)) {</b>
<b class="nc">&nbsp;                        clan = true;</b>
&nbsp;                    }
<b class="nc">&nbsp;                    String armorName = armorValues[x].substring(armorValues[x].indexOf(&#39;:&#39;) + 1, armorValues[x].indexOf(&#39;(&#39;));</b>
<b class="nc">&nbsp;                    if (!armorName.contains(&quot;Clan&quot;)</b>
<b class="nc">&nbsp;                        &amp;&amp; !armorName.contains(&quot;IS&quot;)) {</b>
<b class="nc">&nbsp;                        if (clan) {</b>
<b class="nc">&nbsp;                            armorName = &quot;Clan &quot; + armorName;</b>
&nbsp;                        } else {
<b class="nc">&nbsp;                            armorName = &quot;IS &quot; + armorName;</b>
&nbsp;                        }
&nbsp;                    }
<b class="nc">&nbsp;                    mech.setArmorType(EquipmentType.getArmorType(EquipmentType.get(armorName)), locationOrder[x]);</b>
&nbsp;
<b class="nc">&nbsp;                    String armorValue = armorValues[x].toLowerCase();</b>
<b class="nc">&nbsp;                    if (armorValue.contains(&quot;clan&quot;)) {</b>
<b class="nc">&nbsp;                        switch (Integer.parseInt(rulesLevel.substring(12).trim())) {</b>
&nbsp;                            case 2:
<b class="nc">&nbsp;                                mech.setArmorTechLevel(TechConstants.T_CLAN_TW, locationOrder[x]);</b>
<b class="nc">&nbsp;                                break;</b>
&nbsp;                            case 3:
<b class="nc">&nbsp;                                mech.setArmorTechLevel(TechConstants.T_CLAN_ADVANCED, locationOrder[x]);</b>
<b class="nc">&nbsp;                                break;</b>
&nbsp;                            case 4:
<b class="nc">&nbsp;                                mech.setArmorTechLevel(TechConstants.T_CLAN_EXPERIMENTAL, locationOrder[x]);</b>
<b class="nc">&nbsp;                                break;</b>
&nbsp;                            case 5:
<b class="nc">&nbsp;                                mech.setArmorTechLevel(TechConstants.T_CLAN_UNOFFICIAL, locationOrder[x]);</b>
<b class="nc">&nbsp;                                break;</b>
&nbsp;                            default:
<b class="nc">&nbsp;                                throw new EntityLoadingException(&quot;Unsupported tech level: &quot; + rulesLevel.substring(12).trim());</b>
&nbsp;                        }
<b class="nc">&nbsp;                    } else if (armorValue.contains(&quot;inner sphere&quot;)) {</b>
<b class="nc">&nbsp;                        switch (Integer.parseInt(rulesLevel.substring(12).trim())) {</b>
&nbsp;                            case 1:
<b class="nc">&nbsp;                                mech.setArmorTechLevel(TechConstants.T_INTRO_BOXSET, locationOrder[x]);</b>
<b class="nc">&nbsp;                                break;</b>
&nbsp;                            case 2:
<b class="nc">&nbsp;                                mech.setArmorTechLevel(TechConstants.T_IS_TW_NON_BOX, locationOrder[x]);</b>
<b class="nc">&nbsp;                                break;</b>
&nbsp;                            case 3:
<b class="nc">&nbsp;                                mech.setArmorTechLevel(TechConstants.T_IS_ADVANCED, locationOrder[x]);</b>
<b class="nc">&nbsp;                                break;</b>
&nbsp;                            case 4:
<b class="nc">&nbsp;                                mech.setArmorTechLevel(TechConstants.T_IS_EXPERIMENTAL, locationOrder[x]);</b>
<b class="nc">&nbsp;                                break;</b>
&nbsp;                            case 5:
<b class="nc">&nbsp;                                mech.setArmorTechLevel(TechConstants.T_IS_UNOFFICIAL, locationOrder[x]);</b>
<b class="nc">&nbsp;                                break;</b>
&nbsp;                            default:
<b class="nc">&nbsp;                                throw new EntityLoadingException(&quot;Unsupported tech level: &quot; + rulesLevel.substring(12).trim());</b>
&nbsp;                        }
&nbsp;                    }
&nbsp;                }
&nbsp;            }
<b class="fc">&nbsp;            for (int x = 0; x &lt; rearLocationOrder.length; x++) {</b>
<b class="fc">&nbsp;                mech.initializeRearArmor(Integer.parseInt(armorValues[x + locationOrder.length].substring(10)), rearLocationOrder[x]);</b>
&nbsp;            }
&nbsp;            
&nbsp;            // Set capital fighter stats for LAMs
<b class="fc">&nbsp;            if (mech instanceof LandAirMech) {</b>
<b class="nc">&nbsp;                ((LandAirMech)mech).autoSetCapArmor();</b>
<b class="nc">&nbsp;                ((LandAirMech)mech).autoSetFatalThresh();</b>
&nbsp;            }
&nbsp;
&nbsp;            // oog, crits.
<b class="fc">&nbsp;            compactCriticals(mech);</b>
&nbsp;            // we do these in reverse order to get the outermost
&nbsp;            // locations first, which is necessary for split crits to work
<b class="fc">&nbsp;            for (int i = mech.locations() - 1; i &gt;= 0; i--) {</b>
<b class="fc">&nbsp;                parseCrits(mech, i);</b>
&nbsp;            }
<b class="fc">&nbsp;            for (String equipment : noCritEquipment) {</b>
<b class="nc">&nbsp;                parseNoCritEquipment(mech, equipment);</b>
<b class="nc">&nbsp;            }</b>
<b class="fc">&nbsp;            if (mech.isClan()) {</b>
<b class="nc">&nbsp;                mech.addClanCase();</b>
&nbsp;            }
&nbsp;
&nbsp;            // add any heat sinks not allocated
<b class="fc">&nbsp;            if (laserSinks) {</b>
<b class="nc">&nbsp;                mech.addEngineSinks(expectedSinks - mech.heatSinks(), MiscType.F_LASER_HEAT_SINK);</b>
<b class="fc">&nbsp;            } else if (dblSinks) {</b>
&nbsp;                // If the heat sink entry didn&#39;t specify Clan or IS double, check for sinks that take
&nbsp;                // critical slots. If none are found, default to the overall tech base of the unit.
<b class="nc">&nbsp;                if (heatSinkBase == ITechnology.TECH_BASE_ALL) {</b>
<b class="nc">&nbsp;                    for (Mounted mounted : mech.getMisc()) {</b>
<b class="nc">&nbsp;                        if (mounted.getType().hasFlag(MiscType.F_DOUBLE_HEAT_SINK)) {</b>
<b class="nc">&nbsp;                            heatSinkBase = mounted.getType().getTechBase();</b>
&nbsp;                        }
<b class="nc">&nbsp;                    }</b>
&nbsp;                }
&nbsp;                boolean clan;
<b class="nc">&nbsp;                switch (heatSinkBase) {</b>
&nbsp;                    case ITechnology.TECH_BASE_IS:
<b class="nc">&nbsp;                        clan = false;</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    case ITechnology.TECH_BASE_CLAN:
<b class="nc">&nbsp;                        clan = true;</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    default:
<b class="nc">&nbsp;                        clan = mech.isClan();</b>
&nbsp;                }
<b class="nc">&nbsp;                mech.addEngineSinks(expectedSinks - mech.heatSinks(), MiscType.F_DOUBLE_HEAT_SINK, clan);</b>
<b class="nc">&nbsp;            } else if (compactSinks) {</b>
<b class="nc">&nbsp;                mech.addEngineSinks(expectedSinks - mech.heatSinks(), MiscType.F_COMPACT_HEAT_SINK);</b>
&nbsp;            } else {
<b class="fc">&nbsp;                mech.addEngineSinks(expectedSinks - mech.heatSinks(), MiscType.F_HEAT_SINK);</b>
&nbsp;            }
&nbsp;
<b class="fc">&nbsp;            if (mech.isOmni() &amp;&amp; mech.hasEngine()) {</b>
<b class="nc">&nbsp;                if (baseHeatSinks &gt;= 10) {</b>
<b class="nc">&nbsp;                    mech.getEngine().setBaseChassisHeatSinks(baseHeatSinks);</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    mech.getEngine().setBaseChassisHeatSinks(expectedSinks);</b>
&nbsp;                }
&nbsp;            }
&nbsp;
<b class="fc">&nbsp;            mech.getFluff().setCapabilities(capabilities);</b>
<b class="fc">&nbsp;            mech.getFluff().setOverview(overview);</b>
<b class="fc">&nbsp;            mech.getFluff().setDeployment(deployment);</b>
<b class="fc">&nbsp;            mech.getFluff().setHistory(history);</b>
<b class="fc">&nbsp;            mech.getFluff().setManufacturer(manufacturer);</b>
<b class="fc">&nbsp;            mech.getFluff().setPrimaryFactory(primaryFactory);</b>
<b class="fc">&nbsp;            mech.getFluff().setNotes(notes);</b>
<b class="fc">&nbsp;            systemManufacturers.forEach((k, v) -&gt; mech.getFluff().setSystemManufacturer(k, v));</b>
<b class="fc">&nbsp;            systemModels.forEach((k, v) -&gt; mech.getFluff().setSystemModel(k, v));</b>
<b class="fc">&nbsp;            mech.getFluff().setMMLImagePath(imagePath);</b>
&nbsp;
<b class="fc">&nbsp;            mech.setArmorTonnage(mech.getArmorWeight());</b>
&nbsp;
<b class="fc">&nbsp;            if (bv != 0) {</b>
<b class="nc">&nbsp;                mech.setUseManualBV(true);</b>
<b class="nc">&nbsp;                mech.setManualBV(bv);</b>
&nbsp;            }
<b class="fc">&nbsp;            return mech;</b>
<b class="nc">&nbsp;        } catch (NumberFormatException ex) {</b>
<b class="nc">&nbsp;            ex.printStackTrace();</b>
<b class="nc">&nbsp;            throw new EntityLoadingException(&quot;NumberFormatException parsing file&quot;);</b>
<b class="nc">&nbsp;        } catch (NullPointerException ex) {</b>
<b class="nc">&nbsp;            ex.printStackTrace();</b>
<b class="nc">&nbsp;            throw new EntityLoadingException(&quot;NullPointerException parsing file&quot;);</b>
<b class="nc">&nbsp;        } catch (StringIndexOutOfBoundsException ex) {</b>
<b class="nc">&nbsp;            ex.printStackTrace();</b>
<b class="nc">&nbsp;            throw new EntityLoadingException(&quot;StringIndexOutOfBoundsException parsing file&quot;);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void setTechLevel(Mech mech) throws EntityLoadingException {
<b class="fc">&nbsp;        String techBase = this.techBase.substring(9).trim();</b>
<b class="fc">&nbsp;        if (techBase.equalsIgnoreCase(&quot;Inner Sphere&quot;)) {</b>
<b class="fc">&nbsp;            switch (Integer.parseInt(rulesLevel.substring(12).trim())) {</b>
&nbsp;                case 1:
<b class="fc">&nbsp;                    mech.setTechLevel(TechConstants.T_INTRO_BOXSET);</b>
<b class="fc">&nbsp;                    break;</b>
&nbsp;                case 2:
<b class="nc">&nbsp;                    mech.setTechLevel(TechConstants.T_IS_TW_NON_BOX);</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                case 3:
<b class="nc">&nbsp;                    mech.setTechLevel(TechConstants.T_IS_ADVANCED);</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                case 4:
<b class="nc">&nbsp;                    mech.setTechLevel(TechConstants.T_IS_EXPERIMENTAL);</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                case 5:
<b class="nc">&nbsp;                    mech.setTechLevel(TechConstants.T_IS_UNOFFICIAL);</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                default:
<b class="nc">&nbsp;                    throw new EntityLoadingException(&quot;Unsupported tech level: &quot; + rulesLevel.substring(12).trim());</b>
&nbsp;            }
<b class="nc">&nbsp;        } else if (techBase.equalsIgnoreCase(&quot;Clan&quot;)) {</b>
<b class="nc">&nbsp;            switch (Integer.parseInt(rulesLevel.substring(12).trim())) {</b>
&nbsp;                case 2:
<b class="nc">&nbsp;                    mech.setTechLevel(TechConstants.T_CLAN_TW);</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                case 3:
<b class="nc">&nbsp;                    mech.setTechLevel(TechConstants.T_CLAN_ADVANCED);</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                case 4:
<b class="nc">&nbsp;                    mech.setTechLevel(TechConstants.T_CLAN_EXPERIMENTAL);</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                case 5:
<b class="nc">&nbsp;                    mech.setTechLevel(TechConstants.T_CLAN_UNOFFICIAL);</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                default:
<b class="nc">&nbsp;                    throw new EntityLoadingException(&quot;Unsupported tech level: &quot; + rulesLevel.substring(12).trim());</b>
&nbsp;            }
<b class="nc">&nbsp;        } else if (techBase.equalsIgnoreCase(&quot;Mixed (IS Chassis)&quot;)) {</b>
<b class="nc">&nbsp;            switch (Integer.parseInt(rulesLevel.substring(12).trim())) {</b>
&nbsp;                case 2:
<b class="nc">&nbsp;                    mech.setTechLevel(TechConstants.T_IS_TW_NON_BOX);</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                case 3:
<b class="nc">&nbsp;                    mech.setTechLevel(TechConstants.T_IS_ADVANCED);</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                case 4:
<b class="nc">&nbsp;                    mech.setTechLevel(TechConstants.T_IS_EXPERIMENTAL);</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                case 5:
<b class="nc">&nbsp;                    mech.setTechLevel(TechConstants.T_IS_UNOFFICIAL);</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                default:
<b class="nc">&nbsp;                    throw new EntityLoadingException(&quot;Unsupported tech level: &quot; + rulesLevel.substring(12).trim());</b>
&nbsp;            }
<b class="nc">&nbsp;            mech.setMixedTech(true);</b>
<b class="nc">&nbsp;        } else if (techBase.equalsIgnoreCase(&quot;Mixed (Clan Chassis)&quot;)) {</b>
<b class="nc">&nbsp;            switch (Integer.parseInt(rulesLevel.substring(12).trim())) {</b>
&nbsp;                case 2:
<b class="nc">&nbsp;                    mech.setTechLevel(TechConstants.T_CLAN_TW);</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                case 3:
<b class="nc">&nbsp;                    mech.setTechLevel(TechConstants.T_CLAN_ADVANCED);</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                case 4:
<b class="nc">&nbsp;                    mech.setTechLevel(TechConstants.T_CLAN_EXPERIMENTAL);</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                case 5:
<b class="nc">&nbsp;                    mech.setTechLevel(TechConstants.T_CLAN_UNOFFICIAL);</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                default:
<b class="nc">&nbsp;                    throw new EntityLoadingException(&quot;Unsupported tech level: &quot; + rulesLevel.substring(12).trim());</b>
&nbsp;            }
<b class="nc">&nbsp;            mech.setMixedTech(true);</b>
<b class="nc">&nbsp;        } else if (techBase.equalsIgnoreCase(&quot;Mixed&quot;)) {</b>
<b class="nc">&nbsp;            throw new EntityLoadingException(&quot;Unsupported tech base: \&quot;Mixed\&quot; is no longer allowed by itself.  You must specify \&quot;Mixed (IS Chassis)\&quot; or \&quot;Mixed (Clan Chassis)\&quot;.&quot;);</b>
&nbsp;        } else {
<b class="nc">&nbsp;            throw new EntityLoadingException(&quot;Unsupported tech base: &quot; + techBase);</b>
&nbsp;        }
<b class="fc">&nbsp;    }</b>
&nbsp;
&nbsp;    private void parseCrits(Mech mech, int loc) throws EntityLoadingException {
&nbsp;        // check for removed arm actuators
<b class="fc">&nbsp;        if (!(mech instanceof QuadMech)) {</b>
<b class="fc">&nbsp;            if ((loc == Mech.LOC_LARM) || (loc == Mech.LOC_RARM)) {</b>
<b class="fc">&nbsp;                String toCheck = critData[loc][3].toUpperCase().trim();</b>
<b class="fc">&nbsp;                if (toCheck.endsWith(ARMORED)) {</b>
<b class="nc">&nbsp;                    toCheck = toCheck.substring(0, toCheck.length() - ARMORED.length()).trim();</b>
&nbsp;                }
<b class="fc">&nbsp;                if (!toCheck.equalsIgnoreCase(&quot;Hand Actuator&quot;)) {</b>
<b class="nc">&nbsp;                    mech.setCritical(loc, 3, null);</b>
&nbsp;                }
<b class="fc">&nbsp;                toCheck = critData[loc][2].toUpperCase().trim();</b>
<b class="fc">&nbsp;                if (toCheck.endsWith(ARMORED)) {</b>
<b class="nc">&nbsp;                    toCheck = toCheck.substring(0, toCheck.length() - ARMORED.length()).trim();</b>
&nbsp;                }
<b class="fc">&nbsp;                if (!toCheck.equalsIgnoreCase(&quot;Lower Arm Actuator&quot;)) {</b>
<b class="nc">&nbsp;                    mech.setCritical(loc, 2, null);</b>
&nbsp;                }
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;        // go thru file, add weapons
<b class="fc">&nbsp;        for (int i = 0; i &lt; mech.getNumberOfCriticals(loc); i++) {</b>
&nbsp;
&nbsp;            // parse out and add the critical
<b class="fc">&nbsp;            String critName = critData[loc][i];</b>
&nbsp;
<b class="fc">&nbsp;            critName = critName.trim();</b>
<b class="fc">&nbsp;            String critNameUpper = critName.toUpperCase();</b>
<b class="fc">&nbsp;            boolean rearMounted = false;</b>
<b class="fc">&nbsp;            boolean isArmored = false;</b>
<b class="fc">&nbsp;            boolean isTurreted = false;</b>
<b class="fc">&nbsp;            boolean isOmniPod = false;</b>
<b class="fc">&nbsp;            double size = 0.0;</b>
&nbsp;
&nbsp;            // Check for Armored Actuators
<b class="fc">&nbsp;            if (critNameUpper.endsWith(ARMORED)) {</b>
<b class="fc">&nbsp;                critName = critName.substring(0, critName.length() - ARMORED.length()).trim();</b>
<b class="fc">&nbsp;                isArmored = true;</b>
<b class="fc">&nbsp;                critNameUpper = critName.toUpperCase();</b>
&nbsp;            }
&nbsp;
<b class="fc">&nbsp;            if (critName.equalsIgnoreCase(&quot;Fusion Engine&quot;) || critName.equalsIgnoreCase(&quot;Engine&quot;)) {</b>
<b class="fc">&nbsp;                mech.setCritical(loc, i, new CriticalSlot(CriticalSlot.TYPE_SYSTEM, Mech.SYSTEM_ENGINE, true, isArmored));</b>
<b class="fc">&nbsp;                continue;</b>
<b class="fc">&nbsp;            } else if (critName.equalsIgnoreCase(&quot;Life Support&quot;)) {</b>
<b class="fc">&nbsp;                mech.setCritical(loc, i, new CriticalSlot(CriticalSlot.TYPE_SYSTEM, Mech.SYSTEM_LIFE_SUPPORT, true, isArmored));</b>
<b class="fc">&nbsp;                continue;</b>
<b class="fc">&nbsp;            } else if (critName.equalsIgnoreCase(&quot;Sensors&quot;)) {</b>
<b class="fc">&nbsp;                mech.setCritical(loc, i, new CriticalSlot(CriticalSlot.TYPE_SYSTEM, Mech.SYSTEM_SENSORS, true, isArmored));</b>
<b class="fc">&nbsp;                continue;</b>
<b class="fc">&nbsp;            } else if (critName.equalsIgnoreCase(&quot;Cockpit&quot;)) {</b>
<b class="fc">&nbsp;                mech.setCritical(loc, i, new CriticalSlot(CriticalSlot.TYPE_SYSTEM, Mech.SYSTEM_COCKPIT, true, isArmored));</b>
<b class="fc">&nbsp;                continue;</b>
<b class="fc">&nbsp;            } else if (critName.equalsIgnoreCase(&quot;Gyro&quot;)) {</b>
<b class="fc">&nbsp;                mech.setCritical(loc, i, new CriticalSlot(CriticalSlot.TYPE_SYSTEM, Mech.SYSTEM_GYRO, true, isArmored));</b>
<b class="fc">&nbsp;                continue;</b>
<b class="fc">&nbsp;            } else if ((critName.contains(&quot;Actuator&quot;)) || critName.equalsIgnoreCase(&quot;Shoulder&quot;) || critName.equalsIgnoreCase(&quot;Hip&quot;)) {</b>
<b class="fc">&nbsp;                mech.getCritical(loc, i).setArmored(isArmored);</b>
<b class="fc">&nbsp;                continue;</b>
<b class="fc">&nbsp;            } else if (critName.equalsIgnoreCase(&quot;Landing Gear&quot;)) {</b>
<b class="nc">&nbsp;                mech.setCritical(loc, i, new CriticalSlot(CriticalSlot.TYPE_SYSTEM, LandAirMech.LAM_LANDING_GEAR, true, isArmored));</b>
<b class="nc">&nbsp;                continue;</b>
<b class="fc">&nbsp;            } else if (critName.equalsIgnoreCase(&quot;Avionics&quot;)) {</b>
<b class="nc">&nbsp;                mech.setCritical(loc, i, new CriticalSlot(CriticalSlot.TYPE_SYSTEM, LandAirMech.LAM_AVIONICS, true, isArmored));</b>
<b class="nc">&nbsp;                continue;</b>
&nbsp;            }
&nbsp;            // if the slot&#39;s full already, skip it.
<b class="fc">&nbsp;            if (mech.getCritical(loc, i) != null) {</b>
<b class="fc">&nbsp;                continue;</b>
&nbsp;            }
&nbsp;
<b class="fc">&nbsp;            int sizeIndex = critNameUpper.indexOf(SIZE);</b>
<b class="fc">&nbsp;            if (sizeIndex &gt; 0) {</b>
<b class="nc">&nbsp;                size = Double.parseDouble(critName.substring(sizeIndex + SIZE.length()));</b>
<b class="nc">&nbsp;                critNameUpper = critNameUpper.substring(0, sizeIndex);</b>
&nbsp;            }
<b class="fc">&nbsp;            if (critNameUpper.endsWith(OMNIPOD)) {</b>
<b class="fc">&nbsp;                critNameUpper = critNameUpper.substring(0, critNameUpper.length() - OMNIPOD.length()).trim();</b>
<b class="fc">&nbsp;                isOmniPod = true;</b>
&nbsp;            }
<b class="fc">&nbsp;            if (critNameUpper.endsWith(&quot;(T)&quot;)) {</b>
<b class="fc">&nbsp;                isTurreted = true;</b>
<b class="fc">&nbsp;                critNameUpper = critNameUpper.substring(0, critNameUpper.length() - 3).trim();</b>
&nbsp;            }
<b class="fc">&nbsp;            if (critNameUpper.endsWith(&quot;(R)&quot;)) {</b>
<b class="fc">&nbsp;                rearMounted = true;</b>
<b class="fc">&nbsp;                critNameUpper = critNameUpper.substring(0, critNameUpper.length() - 3).trim();</b>
&nbsp;            }
<b class="fc">&nbsp;            if (critNameUpper.endsWith(&quot;(SPLIT)&quot;)) {</b>
<b class="nc">&nbsp;                critNameUpper = critNameUpper.substring(0, critNameUpper.length() - 7).trim();</b>
&nbsp;            }
&nbsp;            // keep track of facing for vehicular grenade launchers
<b class="fc">&nbsp;            int facing = -1;</b>
<b class="fc">&nbsp;            if (critNameUpper.endsWith(&quot;(FL)&quot;)) {</b>
<b class="fc">&nbsp;                facing = 5;</b>
<b class="fc">&nbsp;                critNameUpper = critNameUpper.substring(0, critNameUpper.length() - 4).trim();</b>
&nbsp;            }
<b class="fc">&nbsp;            if (critNameUpper.endsWith(&quot;(FR)&quot;)) {</b>
<b class="fc">&nbsp;                facing = 1;</b>
<b class="fc">&nbsp;                critNameUpper = critNameUpper.substring(0, critNameUpper.length() - 4).trim();</b>
&nbsp;            }
<b class="fc">&nbsp;            if (critNameUpper.endsWith(&quot;(RL)&quot;)) {</b>
<b class="fc">&nbsp;                facing = 4;</b>
<b class="fc">&nbsp;                critNameUpper = critNameUpper.substring(0, critNameUpper.length() - 4).trim();</b>
&nbsp;            }
<b class="fc">&nbsp;            if (critNameUpper.endsWith(&quot;(RR)&quot;)) {</b>
<b class="fc">&nbsp;                facing = 2;</b>
<b class="fc">&nbsp;                critNameUpper = critNameUpper.substring(0, critNameUpper.length() - 4).trim();</b>
&nbsp;            }
<b class="fc">&nbsp;            critName = critName.substring(0, critNameUpper.length());</b>
<b class="fc">&nbsp;            EquipmentType etype2 = null;</b>
<b class="fc">&nbsp;            if (critName.contains(&quot;|&quot;)) {</b>
<b class="fc">&nbsp;                String critName2 = critName.substring(critName.indexOf(&quot;|&quot;) + 1);</b>
<b class="fc">&nbsp;                etype2 = EquipmentType.get(critName2);</b>
<b class="fc">&nbsp;                if (etype2 == null) {</b>
<b class="nc">&nbsp;                    etype2 = EquipmentType.get(mech.isClan() ? &quot;Clan &quot; + critName2 : &quot;IS &quot; + critName2);</b>
&nbsp;                }
<b class="fc">&nbsp;                critName = critName.substring(0, critName.indexOf(&quot;|&quot;));</b>
&nbsp;            }
&nbsp;
&nbsp;            try {
<b class="fc">&nbsp;                EquipmentType etype = EquipmentType.get(critName);</b>
<b class="fc">&nbsp;                if (etype == null) {</b>
<b class="fc">&nbsp;                    etype = EquipmentType.get(mech.isClan() ? &quot;Clan &quot; + critName : &quot;IS &quot; + critName);</b>
&nbsp;                }
<b class="fc">&nbsp;                if (etype != null) {</b>
<b class="fc">&nbsp;                    if (etype.isSpreadable()) {</b>
&nbsp;                        // do we already have one of these? Key on Type
<b class="nc">&nbsp;                        Mounted m = hSharedEquip.get(etype);</b>
<b class="nc">&nbsp;                        if (m != null) {</b>
&nbsp;                            // use the existing one
<b class="nc">&nbsp;                            mech.addCritical(loc, new CriticalSlot(m));</b>
<b class="nc">&nbsp;                            continue;</b>
&nbsp;                        }
<b class="nc">&nbsp;                        m = mech.addEquipment(etype, loc, rearMounted,</b>
&nbsp;                                              BattleArmor.MOUNT_LOC_NONE, isArmored,
&nbsp;                                              isTurreted);
<b class="nc">&nbsp;                        m.setOmniPodMounted(isOmniPod);</b>
<b class="nc">&nbsp;                        hSharedEquip.put(etype, m);</b>
<b class="nc">&nbsp;                    } else if (((etype instanceof WeaponType) &amp;&amp; ((WeaponType) etype).isSplitable()) || ((etype instanceof MiscType) &amp;&amp; etype.hasFlag(MiscType.F_SPLITABLE))) {</b>
&nbsp;                        // do we already have this one in this or an outer
&nbsp;                        // location?
<b class="nc">&nbsp;                        Mounted m = null;</b>
<b class="nc">&nbsp;                        boolean bFound = false;</b>
<b class="nc">&nbsp;                        for (Mounted vSplitWeapon : vSplitWeapons) {</b>
<b class="nc">&nbsp;                            m = vSplitWeapon;</b>
<b class="nc">&nbsp;                            int nLoc = m.getLocation();</b>
<b class="nc">&nbsp;                            if (((nLoc == loc) || (loc == Mech.getInnerLocation(nLoc))) &amp;&amp; (m.getType() == etype)) {</b>
<b class="nc">&nbsp;                                bFound = true;</b>
<b class="nc">&nbsp;                                break;</b>
&nbsp;                            }
<b class="nc">&nbsp;                        }</b>
<b class="nc">&nbsp;                        if (bFound) {</b>
<b class="nc">&nbsp;                            m.setFoundCrits(m.getFoundCrits() + (mech.isSuperHeavy()? 2 : 1));</b>
<b class="nc">&nbsp;                            if (m.getFoundCrits() &gt;= m.getCriticals()) {</b>
<b class="nc">&nbsp;                                vSplitWeapons.remove(m);</b>
&nbsp;                            }
&nbsp;                            // if we&#39;re in a new location, set the weapon as
&nbsp;                            // split
<b class="nc">&nbsp;                            if (loc != m.getLocation()) {</b>
<b class="nc">&nbsp;                                m.setSplit(true);</b>
&nbsp;                            }
&nbsp;                            // give the most restrictive location for arcs
<b class="nc">&nbsp;                            int help = m.getLocation();</b>
<b class="nc">&nbsp;                            m.setLocation(Mech.mostRestrictiveLoc(loc, help));</b>
<b class="nc">&nbsp;                            if (loc != help) {</b>
<b class="nc">&nbsp;                                m.setSecondLocation(Mech.leastRestrictiveLoc(loc, help));</b>
&nbsp;                            }
<b class="nc">&nbsp;                        } else {</b>
&nbsp;                            // make a new one
<b class="nc">&nbsp;                            m = new Mounted(mech, etype);</b>
<b class="nc">&nbsp;                            m.setFoundCrits(1);</b>
<b class="nc">&nbsp;                            m.setArmored(isArmored);</b>
<b class="nc">&nbsp;                            m.setMechTurretMounted(isTurreted);</b>
<b class="nc">&nbsp;                            vSplitWeapons.add(m);</b>
&nbsp;                        }
<b class="nc">&nbsp;                        m.setArmored(isArmored);</b>
<b class="nc">&nbsp;                        m.setMechTurretMounted(isTurreted);</b>
<b class="nc">&nbsp;                        m.setOmniPodMounted(isOmniPod);</b>
<b class="nc">&nbsp;                        mech.addEquipment(m, loc, rearMounted);</b>
<b class="nc">&nbsp;                    } else {</b>
&nbsp;                        Mounted mount;
<b class="fc">&nbsp;                        if (etype2 == null) {</b>
<b class="fc">&nbsp;                            mount = mech.addEquipment(etype, loc, rearMounted,</b>
&nbsp;                                                      BattleArmor.MOUNT_LOC_NONE, isArmored,
&nbsp;                                                      isTurreted, false, false, isOmniPod);
&nbsp;                        } else {
<b class="fc">&nbsp;                            if (etype instanceof AmmoType) {</b>
<b class="nc">&nbsp;                                if (!(etype2 instanceof AmmoType) || (((AmmoType) etype).getAmmoType() != ((AmmoType) etype2).getAmmoType())) {</b>
<b class="nc">&nbsp;                                    throw new EntityLoadingException(&quot;Can&#39;t combine ammo for different weapons in one slot&quot;);</b>
&nbsp;                                }
&nbsp;                            } else {
<b class="fc">&nbsp;                                if (!(etype.equals(etype2)) || ((etype instanceof MiscType) &amp;&amp; (!etype.hasFlag(MiscType.F_HEAT_SINK) &amp;&amp; !etype.hasFlag(MiscType.F_DOUBLE_HEAT_SINK)))) {</b>
<b class="nc">&nbsp;                                    throw new EntityLoadingException(&quot;must combine ammo or heatsinks in one slot&quot;);</b>
&nbsp;                                }
&nbsp;                            }
<b class="fc">&nbsp;                            mount = mech.addEquipment(etype, etype2, loc, isOmniPod, isArmored);</b>
&nbsp;                        }
<b class="fc">&nbsp;                        if (etype.isVariableSize()) {</b>
<b class="nc">&nbsp;                            if (size == 0.0) {</b>
<b class="nc">&nbsp;                                size = BLKFile.getLegacyVariableSize(critName);</b>
&nbsp;                            }
<b class="nc">&nbsp;                            mount.setSize(size);</b>
&nbsp;                            // THe size may require additional critical slots
<b class="nc">&nbsp;                            for (int c = 1; c &lt; mount.getCriticals(); c++) {</b>
<b class="nc">&nbsp;                                CriticalSlot cs = new CriticalSlot(mount);</b>
<b class="nc">&nbsp;                                mech.addCritical(loc, cs, i + c);</b>
&nbsp;                            }
&nbsp;                        }
&nbsp;
&nbsp;                        // vehicular grenade launchers need to have their facing
&nbsp;                        // set
<b class="fc">&nbsp;                        if ((etype instanceof WeaponType) &amp;&amp; etype.hasFlag(WeaponType.F_VGL)) {</b>
<b class="fc">&nbsp;                            if (facing == -1) {</b>
&nbsp;                                // if facing has not been set earlier, we are
&nbsp;                                // front or rear mounted
<b class="fc">&nbsp;                                if (rearMounted) {</b>
<b class="fc">&nbsp;                                    mount.setFacing(3);</b>
&nbsp;                                } else {
<b class="fc">&nbsp;                                    mount.setFacing(0);</b>
&nbsp;                                }
&nbsp;                            } else {
<b class="fc">&nbsp;                                mount.setFacing(facing);</b>
&nbsp;                            }
&nbsp;                        }
<b class="fc">&nbsp;                    }</b>
&nbsp;                } else {
<b class="fc">&nbsp;                    if (!critName.equals(MtfFile.EMPTY)) {</b>
&nbsp;                        // Can&#39;t load this piece of equipment!
&nbsp;                        // Add it to the list so we can show the user.
<b class="nc">&nbsp;                        mech.addFailedEquipment(critName);</b>
&nbsp;                        // Make the failed equipment an empty slot
<b class="nc">&nbsp;                        critData[loc][i] = MtfFile.EMPTY;</b>
&nbsp;                        // Compact criticals again
<b class="nc">&nbsp;                        compactCriticals(mech, loc);</b>
&nbsp;                        // Re-parse the same slot, since the compacting
&nbsp;                        // could have moved new equipment to this slot
<b class="nc">&nbsp;                        i--;</b>
&nbsp;                    }
&nbsp;
&nbsp;                }
<b class="nc">&nbsp;            } catch (LocationFullException ex) {</b>
<b class="nc">&nbsp;                throw new EntityLoadingException(ex.getMessage());</b>
<b class="fc">&nbsp;            }</b>
&nbsp;        }
<b class="fc">&nbsp;    }</b>
&nbsp;
&nbsp;    private void parseNoCritEquipment(Mech mech, String name) throws EntityLoadingException {
<b class="nc">&nbsp;        int loc = Mech.LOC_NONE;</b>
<b class="nc">&nbsp;        int splitIndex = name.indexOf(&quot;:&quot;);</b>
<b class="nc">&nbsp;        if (splitIndex &gt; 0) {</b>
<b class="nc">&nbsp;            loc = mech.getLocationFromAbbr(name.substring(splitIndex + 1));</b>
<b class="nc">&nbsp;            name = name.substring(0, splitIndex);</b>
&nbsp;        }
<b class="nc">&nbsp;        EquipmentType eq = EquipmentType.get(name);</b>
<b class="nc">&nbsp;        if (eq != null) {</b>
&nbsp;            try {
<b class="nc">&nbsp;                Mounted mount = mech.addEquipment(eq, loc);</b>
<b class="nc">&nbsp;            } catch (LocationFullException ex) {</b>
<b class="nc">&nbsp;                throw new EntityLoadingException(ex.getMessage());</b>
<b class="nc">&nbsp;            }</b>
&nbsp;        } else {
<b class="nc">&nbsp;            mech.addFailedEquipment(name);</b>
&nbsp;        }
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    /**
&nbsp;     * This function moves all &quot;empty&quot; slots to the end of a location&#39;s critical
&nbsp;     * list. MegaMek adds equipment to the first empty slot available in a
&nbsp;     * location. This means that any &quot;holes&quot; (empty slots not at the end of a
&nbsp;     * location), will cause the file crits and MegaMek&#39;s crits to become out of
&nbsp;     * sync.
&nbsp;     */
&nbsp;    private void compactCriticals(Mech mech) {
<b class="fc">&nbsp;        for (int loc = 0; loc &lt; mech.locations(); loc++) {</b>
<b class="fc">&nbsp;            compactCriticals(mech, loc);</b>
&nbsp;        }
<b class="fc">&nbsp;    }</b>
&nbsp;
&nbsp;    private void compactCriticals(Mech mech, int loc) {
<b class="fc">&nbsp;        if (loc == Mech.LOC_HEAD) {</b>
&nbsp;            // This location has an empty slot inbetween systems crits
&nbsp;            // which will mess up parsing if compacted.
<b class="fc">&nbsp;            return;</b>
&nbsp;        }
<b class="fc">&nbsp;        int firstEmpty = -1;</b>
<b class="fc">&nbsp;        for (int slot = 0; slot &lt; mech.getNumberOfCriticals(loc); slot++) {</b>
<b class="fc">&nbsp;            if (critData[loc][slot] == null) {</b>
<b class="nc">&nbsp;                critData[loc][slot] = MtfFile.EMPTY;</b>
&nbsp;            }
&nbsp;
<b class="fc">&nbsp;            if (critData[loc][slot].equals(MtfFile.EMPTY) &amp;&amp; (firstEmpty == -1)) {</b>
<b class="fc">&nbsp;                firstEmpty = slot;</b>
&nbsp;            }
<b class="fc">&nbsp;            if ((firstEmpty != -1) &amp;&amp; !critData[loc][slot].equals(MtfFile.EMPTY)) {</b>
&nbsp;                // move this to the first empty slot
<b class="nc">&nbsp;                critData[loc][firstEmpty] = critData[loc][slot];</b>
&nbsp;                // mark the old slot empty
<b class="nc">&nbsp;                critData[loc][slot] = MtfFile.EMPTY;</b>
&nbsp;                // restart just after the moved slot&#39;s new location
<b class="nc">&nbsp;                slot = firstEmpty;</b>
<b class="nc">&nbsp;                firstEmpty = -1;</b>
&nbsp;            }
&nbsp;        }
<b class="fc">&nbsp;    }</b>
&nbsp;
&nbsp;    private int getLocation(String location) {
<b class="fc">&nbsp;        if (location.equalsIgnoreCase(&quot;Left Arm:&quot;) || location.equalsIgnoreCase(&quot;Front Left Leg:&quot;)) {</b>
<b class="fc">&nbsp;            return Mech.LOC_LARM;</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        if (location.equalsIgnoreCase(&quot;Right Arm:&quot;) || location.equalsIgnoreCase(&quot;Front Right Leg:&quot;)) {</b>
<b class="fc">&nbsp;            return Mech.LOC_RARM;</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        if (location.equalsIgnoreCase(&quot;Left Leg:&quot;) || location.equalsIgnoreCase(&quot;Rear Left Leg:&quot;)) {</b>
<b class="fc">&nbsp;            return Mech.LOC_LLEG;</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        if (location.equalsIgnoreCase(&quot;Right Leg:&quot;) || location.equalsIgnoreCase(&quot;Rear Right Leg:&quot;)) {</b>
<b class="fc">&nbsp;            return Mech.LOC_RLEG;</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        if (location.equalsIgnoreCase(&quot;Center Leg:&quot;)) {</b>
<b class="nc">&nbsp;            return Mech.LOC_CLEG;</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        if (location.equalsIgnoreCase(&quot;Left Torso:&quot;)) {</b>
<b class="fc">&nbsp;            return Mech.LOC_LT;</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        if (location.equalsIgnoreCase(&quot;Right Torso:&quot;)) {</b>
<b class="fc">&nbsp;            return Mech.LOC_RT;</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        if (location.equalsIgnoreCase(&quot;Center Torso:&quot;)) {</b>
<b class="fc">&nbsp;            return Mech.LOC_CT;</b>
&nbsp;        }
&nbsp;
&nbsp;        // else
<b class="fc">&nbsp;        return Mech.LOC_HEAD;</b>
&nbsp;    }
&nbsp;
&nbsp;    private int getArmorLocation(String location) {
&nbsp;
<b class="fc">&nbsp;        int loc = -1;</b>
<b class="fc">&nbsp;        boolean rear = false;</b>
<b class="fc">&nbsp;        String locationName = location.toLowerCase();</b>
<b class="fc">&nbsp;        if (locationName.startsWith(&quot;la armor:&quot;) || locationName.startsWith(&quot;fll armor:&quot;)) {</b>
<b class="fc">&nbsp;            loc = Mech.LOC_LARM;</b>
<b class="fc">&nbsp;        } else if (locationName.startsWith(&quot;ra armor:&quot;) || locationName.startsWith(&quot;frl armor:&quot;)) {</b>
<b class="fc">&nbsp;            loc = Mech.LOC_RARM;</b>
<b class="fc">&nbsp;        } else if (locationName.startsWith(&quot;lt armor:&quot;)) {</b>
<b class="fc">&nbsp;            loc = Mech.LOC_LT;</b>
<b class="fc">&nbsp;        } else if (locationName.startsWith(&quot;rt armor:&quot;)) {</b>
<b class="fc">&nbsp;            loc = Mech.LOC_RT;</b>
<b class="fc">&nbsp;        } else if (locationName.startsWith(&quot;ct armor:&quot;)) {</b>
<b class="fc">&nbsp;            loc = Mech.LOC_CT;</b>
<b class="fc">&nbsp;        } else if (locationName.startsWith(&quot;hd armor:&quot;)) {</b>
<b class="fc">&nbsp;            loc = Mech.LOC_HEAD;</b>
<b class="fc">&nbsp;        } else if (locationName.startsWith(&quot;ll armor:&quot;) || locationName.startsWith(&quot;rll armor:&quot;)) {</b>
<b class="fc">&nbsp;            loc = Mech.LOC_LLEG;</b>
<b class="fc">&nbsp;        } else if (locationName.startsWith(&quot;rl armor:&quot;) || locationName.startsWith(&quot;rrl armor:&quot;)) {</b>
<b class="fc">&nbsp;            loc = Mech.LOC_RLEG;</b>
<b class="fc">&nbsp;        } else if (locationName.startsWith(&quot;rtl armor:&quot;)) {</b>
<b class="fc">&nbsp;            loc = Mech.LOC_LT;</b>
<b class="fc">&nbsp;            rear = true;</b>
<b class="fc">&nbsp;        } else if (locationName.startsWith(&quot;rtr armor:&quot;)) {</b>
<b class="fc">&nbsp;            loc = Mech.LOC_RT;</b>
<b class="fc">&nbsp;            rear = true;</b>
<b class="fc">&nbsp;        } else if (locationName.startsWith(&quot;rtc armor:&quot;)) {</b>
<b class="fc">&nbsp;            loc = Mech.LOC_CT;</b>
<b class="fc">&nbsp;            rear = true;</b>
<b class="fc">&nbsp;        } else if (locationName.startsWith(&quot;cl armor:&quot;)) {</b>
<b class="nc">&nbsp;            loc = Mech.LOC_CLEG;</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        if (!rear) {</b>
<b class="fc">&nbsp;            for (int pos = 0; pos &lt; locationOrder.length; pos++) {</b>
<b class="fc">&nbsp;                if (locationOrder[pos] == loc) {</b>
<b class="fc">&nbsp;                    loc = pos;</b>
<b class="fc">&nbsp;                    break;</b>
&nbsp;                }
&nbsp;            }
&nbsp;        } else {
<b class="fc">&nbsp;            for (int pos = 0; pos &lt; rearLocationOrder.length; pos++) {</b>
<b class="fc">&nbsp;                if (rearLocationOrder[pos] == loc) {</b>
<b class="fc">&nbsp;                    loc = pos + locationOrder.length;</b>
<b class="fc">&nbsp;                    break;</b>
&nbsp;                }
&nbsp;            }
&nbsp;        }
<b class="fc">&nbsp;        return loc;</b>
&nbsp;    }
&nbsp;
&nbsp;    private boolean isValidLocation(String location) {
<b class="fc">&nbsp;        return location.equalsIgnoreCase(&quot;Left Arm:&quot;)</b>
<b class="fc">&nbsp;                || location.equalsIgnoreCase(&quot;Right Arm:&quot;)</b>
<b class="fc">&nbsp;                || location.equalsIgnoreCase(&quot;Left Leg:&quot;)</b>
<b class="fc">&nbsp;                || location.equalsIgnoreCase(&quot;Right Leg:&quot;)</b>
<b class="fc">&nbsp;                || location.equalsIgnoreCase(&quot;Center Leg:&quot;)</b>
<b class="fc">&nbsp;                || location.equalsIgnoreCase(&quot;Front Left Leg:&quot;)</b>
<b class="fc">&nbsp;                || location.equalsIgnoreCase(&quot;Front Right Leg:&quot;)</b>
<b class="fc">&nbsp;                || location.equalsIgnoreCase(&quot;Rear Left Leg:&quot;)</b>
<b class="fc">&nbsp;                || location.equalsIgnoreCase(&quot;Rear Right Leg:&quot;)</b>
<b class="fc">&nbsp;                || location.equalsIgnoreCase(&quot;Left Torso:&quot;)</b>
<b class="fc">&nbsp;                || location.equalsIgnoreCase(&quot;Right Torso:&quot;)</b>
<b class="fc">&nbsp;                || location.equalsIgnoreCase(&quot;Center Torso:&quot;)</b>
<b class="fc">&nbsp;                || location.equalsIgnoreCase(&quot;Head:&quot;);</b>
&nbsp;    }
&nbsp;
&nbsp;    private boolean isProcessedComponent(String line) {
<b class="fc">&nbsp;        String lineLower = line.toLowerCase();</b>
<b class="fc">&nbsp;        if (lineLower.startsWith(COCKPIT)) {</b>
<b class="nc">&nbsp;            cockpitType = line;</b>
<b class="nc">&nbsp;            return true;</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        if (lineLower.startsWith(GYRO)) {</b>
<b class="nc">&nbsp;            gyroType = line;</b>
<b class="nc">&nbsp;            return true;</b>
&nbsp;        }
&nbsp;        
<b class="fc">&nbsp;        if (lineLower.startsWith(MOTIVE)) {</b>
<b class="nc">&nbsp;            motiveType = line;</b>
<b class="nc">&nbsp;            return true;</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        if (lineLower.startsWith(EJECTION)) {</b>
<b class="nc">&nbsp;            ejectionType = line;</b>
<b class="nc">&nbsp;            return true;</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        if (lineLower.startsWith(MASS)) {</b>
<b class="fc">&nbsp;            tonnage = line;</b>
<b class="fc">&nbsp;            return true;</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        if (lineLower.startsWith(ENGINE)) {</b>
<b class="fc">&nbsp;            engine = line;</b>
<b class="fc">&nbsp;            return true;</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        if (lineLower.startsWith(STRUCTURE)) {</b>
<b class="fc">&nbsp;            internalType = line;</b>
<b class="fc">&nbsp;            return true;</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        if (lineLower.startsWith(MYOMER)) {</b>
<b class="fc">&nbsp;            return true;</b>
&nbsp;        }
&nbsp;        
<b class="fc">&nbsp;        if (lineLower.startsWith(LAM)) {</b>
<b class="nc">&nbsp;            lamType = line;</b>
<b class="nc">&nbsp;            return true;</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        if (lineLower.startsWith(CONFIG)) {</b>
<b class="fc">&nbsp;            chassisConfig = line;</b>
<b class="fc">&nbsp;            return true;</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        if (lineLower.startsWith(TECH_BASE)) {</b>
<b class="fc">&nbsp;            techBase = line;</b>
<b class="fc">&nbsp;            return true;</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        if (lineLower.startsWith(ERA)) {</b>
<b class="fc">&nbsp;            techYear = line;</b>
<b class="fc">&nbsp;            return true;</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        if (lineLower.startsWith(SOURCE)) {</b>
<b class="fc">&nbsp;            source = line;</b>
<b class="fc">&nbsp;            return true;</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        if (lineLower.startsWith(RULES_LEVEL)) {</b>
<b class="fc">&nbsp;            rulesLevel = line;</b>
<b class="fc">&nbsp;            return true;</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        if (lineLower.startsWith(HEAT_SINKS)) {</b>
<b class="fc">&nbsp;            heatSinks = line;</b>
<b class="fc">&nbsp;            return true;</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        if (lineLower.startsWith(BASE_CHASSIS_HEAT_SINKS)) {</b>
<b class="nc">&nbsp;            baseChassieHeatSinks = line;</b>
<b class="nc">&nbsp;            return true;</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        if (lineLower.startsWith(WALK_MP)) {</b>
<b class="fc">&nbsp;            return true;</b>
&nbsp;        }
<b class="fc">&nbsp;        if (lineLower.startsWith(JUMP_MP)) {</b>
<b class="fc">&nbsp;            jumpMP = line;</b>
<b class="fc">&nbsp;            return true;</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        if (lineLower.startsWith(ARMOR)) {</b>
<b class="fc">&nbsp;            armorType = line;</b>
<b class="fc">&nbsp;            return true;</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        if (lineLower.startsWith(NO_CRIT)) {</b>
<b class="nc">&nbsp;            noCritEquipment.add(line.substring(NO_CRIT.length()));</b>
<b class="nc">&nbsp;            return true;</b>
&nbsp;        }
&nbsp;        
<b class="fc">&nbsp;        if (lineLower.startsWith(OVERVIEW)) {</b>
<b class="fc">&nbsp;            overview = line.substring(OVERVIEW.length());</b>
<b class="fc">&nbsp;            return true;</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        if (lineLower.startsWith(CAPABILITIES)) {</b>
<b class="fc">&nbsp;            capabilities = line.substring(CAPABILITIES.length());</b>
<b class="fc">&nbsp;            return true;</b>
&nbsp;        }
&nbsp;                
<b class="fc">&nbsp;        if (lineLower.startsWith(DEPLOYMENT)) {</b>
<b class="fc">&nbsp;            deployment = line.substring(DEPLOYMENT.length());</b>
<b class="fc">&nbsp;            return true;</b>
&nbsp;        }
&nbsp;        
<b class="fc">&nbsp;        if (lineLower.startsWith(HISTORY)) {</b>
<b class="nc">&nbsp;            history = line.substring(HISTORY.length());</b>
<b class="nc">&nbsp;            return true;</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        if (lineLower.startsWith(MANUFACTURER)) {</b>
<b class="nc">&nbsp;        	manufacturer = line.substring(MANUFACTURER.length());</b>
<b class="nc">&nbsp;        	return true;</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        if (lineLower.startsWith(PRIMARY_FACTORY)) {</b>
<b class="nc">&nbsp;        	primaryFactory = line.substring(PRIMARY_FACTORY.length());</b>
<b class="nc">&nbsp;        	return true;</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        if (lineLower.startsWith(SYSTEM_MANUFACTURER)) {</b>
<b class="fc">&nbsp;        	String[] fields = line.split(&quot;:&quot;);</b>
<b class="fc">&nbsp;        	if (fields.length &gt; 2) {</b>
<b class="fc">&nbsp;        		EntityFluff.System system = EntityFluff.System.parse(fields[1]);</b>
<b class="fc">&nbsp;        		if (null != system) {</b>
<b class="fc">&nbsp;        			systemManufacturers.put(system, fields[2].trim());</b>
&nbsp;        		}
&nbsp;        	}
<b class="fc">&nbsp;        	return true;</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        if (lineLower.startsWith(SYSTEM_MODEL)) {</b>
<b class="fc">&nbsp;        	String[] fields = line.split(&quot;:&quot;);</b>
<b class="fc">&nbsp;        	if (fields.length &gt; 2) {</b>
<b class="fc">&nbsp;        		EntityFluff.System system = EntityFluff.System.parse(fields[1]);</b>
<b class="fc">&nbsp;        		if (null != system) {</b>
<b class="fc">&nbsp;        			systemModels.put(system, fields[2].trim());</b>
&nbsp;        		}
&nbsp;        	}
<b class="fc">&nbsp;        	return true;</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        if (lineLower.startsWith(NOTES)) {</b>
<b class="nc">&nbsp;            notes = line.substring(NOTES.length());</b>
<b class="nc">&nbsp;            return true;</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        if (lineLower.startsWith(IMAGE_FILE)) {</b>
<b class="nc">&nbsp;            imagePath = line.substring(IMAGE_FILE.length());</b>
<b class="nc">&nbsp;            return true;</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        if (lineLower.startsWith(BV)) {</b>
<b class="nc">&nbsp;            bv = Integer.parseInt(line.substring(BV.length()));</b>
<b class="nc">&nbsp;            return true;</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        return false;</b>
&nbsp;    }
&nbsp;
&nbsp;    private int weaponsList(String line) {
<b class="fc">&nbsp;        if (line.toLowerCase().startsWith(WEAPONS)) {</b>
<b class="fc">&nbsp;            return Integer.parseInt(line.substring(WEAPONS.length()));</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        return -1;</b>
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2023-05-16 16:28</div>
</div>
</body>
</html>
