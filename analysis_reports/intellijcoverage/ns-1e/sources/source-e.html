


<!DOCTYPE html>
<html id="htmlId">
<head>
  <title>Coverage Report > BLKSmallCraftFile</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">megamek.common.loaders</a>
</div>

<h1>Coverage Summary for Class: BLKSmallCraftFile (megamek.common.loaders)</h1>

<table class="coverageStats">
<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Class, %
</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">BLKSmallCraftFile</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/164)
  </span>
</td>
</tr>

</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;/*
&nbsp; * MegaMek - Copyright (C) 2000-2002 Ben Mazur (bmazur@sev.org)
&nbsp; *
&nbsp; * This program is free software; you can redistribute it and/or modify it under
&nbsp; * the terms of the GNU General Public License as published by the Free Software
&nbsp; * Foundation; either version 2 of the License, or (at your option) any later
&nbsp; * version.
&nbsp; *
&nbsp; * This program is distributed in the hope that it will be useful, but WITHOUT
&nbsp; * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
&nbsp; * FOR A PARTICULAR PURPOSE. See the GNU General Public License for more
&nbsp; * details.
&nbsp; */
&nbsp;
&nbsp;/*
&nbsp; * BLkFile.java
&nbsp; *
&nbsp; * Created on April 6, 2002, 2:06 AM
&nbsp; */
&nbsp;
&nbsp;/**
&nbsp; *
&nbsp; * @author taharqa
&nbsp; * @version
&nbsp; */
&nbsp;package megamek.common.loaders;
&nbsp;
&nbsp;import megamek.common.*;
&nbsp;import megamek.common.util.BuildingBlock;
&nbsp;import megamek.common.verifier.TestEntity;
&nbsp;
&nbsp;public class BLKSmallCraftFile extends BLKFile implements IMechLoader {
&nbsp;
<b class="nc">&nbsp;    public BLKSmallCraftFile(BuildingBlock bb) {</b>
<b class="nc">&nbsp;        dataFile = bb;</b>
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    @Override
&nbsp;    public Entity getEntity() throws EntityLoadingException {
&nbsp;
<b class="nc">&nbsp;        SmallCraft a = new SmallCraft();</b>
&nbsp;
<b class="nc">&nbsp;        if (!dataFile.exists(&quot;Name&quot;)) {</b>
<b class="nc">&nbsp;            throw new EntityLoadingException(&quot;Could not find name block.&quot;);</b>
&nbsp;        }
<b class="nc">&nbsp;        a.setChassis(dataFile.getDataAsString(&quot;Name&quot;)[0]);</b>
<b class="nc">&nbsp;        if (dataFile.exists(&quot;Model&quot;) &amp;&amp; (dataFile.getDataAsString(&quot;Model&quot;)[0] != null)) {</b>
<b class="nc">&nbsp;            a.setModel(dataFile.getDataAsString(&quot;Model&quot;)[0]);</b>
&nbsp;        } else {
<b class="nc">&nbsp;            a.setModel(&quot;&quot;);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (dataFile.exists(&quot;source&quot;)) {</b>
<b class="nc">&nbsp;            a.setSource(dataFile.getDataAsString(&quot;source&quot;)[0]);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        setTechLevel(a);</b>
<b class="nc">&nbsp;        setFluff(a);</b>
<b class="nc">&nbsp;        checkManualBV(a);</b>
&nbsp;
<b class="nc">&nbsp;        if (dataFile.exists(&quot;originalBuildYear&quot;)) {</b>
<b class="nc">&nbsp;            a.setOriginalBuildYear(dataFile.getDataAsInt(&quot;originalBuildYear&quot;)[0]);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (!dataFile.exists(&quot;tonnage&quot;)) {</b>
<b class="nc">&nbsp;            throw new EntityLoadingException(&quot;Could not find tonnage block.&quot;);</b>
&nbsp;        }
<b class="nc">&nbsp;        a.setWeight(dataFile.getDataAsDouble(&quot;tonnage&quot;)[0]);</b>
&nbsp;
<b class="nc">&nbsp;        if (!dataFile.exists(&quot;crew&quot;)) {</b>
<b class="nc">&nbsp;            throw new EntityLoadingException(&quot;Could not find crew block.&quot;);</b>
&nbsp;        }
<b class="nc">&nbsp;        a.setNCrew(dataFile.getDataAsInt(&quot;crew&quot;)[0]);</b>
&nbsp;
<b class="nc">&nbsp;        if (dataFile.exists(&quot;officers&quot;)) {</b>
<b class="nc">&nbsp;            a.setNOfficers(dataFile.getDataAsInt(&quot;officers&quot;)[0]);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (dataFile.exists(&quot;gunners&quot;)) {</b>
<b class="nc">&nbsp;            a.setNGunners(dataFile.getDataAsInt(&quot;gunners&quot;)[0]);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (dataFile.exists(&quot;battlearmor&quot;)) {</b>
<b class="nc">&nbsp;            a.setNBattleArmor(dataFile.getDataAsInt(&quot;battlearmor&quot;)[0]);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (dataFile.exists(&quot;marines&quot;)) {</b>
<b class="nc">&nbsp;            a.setNMarines(dataFile.getDataAsInt(&quot;marines&quot;)[0]);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (dataFile.exists(&quot;otherpassenger&quot;)) {</b>
<b class="nc">&nbsp;            a.setNOtherPassenger(dataFile.getDataAsInt(&quot;otherpassenger&quot;)[0]);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (dataFile.exists(&quot;life_boat&quot;)) {</b>
<b class="nc">&nbsp;            a.setLifeBoats(dataFile.getDataAsInt(&quot;life_boat&quot;)[0]);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (dataFile.exists(&quot;escape_pod&quot;)) {</b>
<b class="nc">&nbsp;            a.setEscapePods(dataFile.getDataAsInt(&quot;escape_pod&quot;)[0]);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (!dataFile.exists(&quot;motion_type&quot;)) {</b>
<b class="nc">&nbsp;            throw new EntityLoadingException(&quot;Could not find motion_type block.&quot;);</b>
&nbsp;        }
<b class="nc">&nbsp;        String sMotion = dataFile.getDataAsString(&quot;motion_type&quot;)[0];</b>
<b class="nc">&nbsp;        EntityMovementMode nMotion = EntityMovementMode.AERODYNE;</b>
<b class="nc">&nbsp;        if (sMotion.equalsIgnoreCase(&quot;spheroid&quot;)) {</b>
<b class="nc">&nbsp;            nMotion = EntityMovementMode.SPHEROID;</b>
<b class="nc">&nbsp;            a.setSpheroid(true);</b>
&nbsp;        }
<b class="nc">&nbsp;        a.setMovementMode(nMotion);</b>
<b class="nc">&nbsp;        if (a.isSpheroid()) {</b>
<b class="nc">&nbsp;            a.setVSTOL(true);</b>
&nbsp;        }
&nbsp;
&nbsp;        // figure out structural integrity
<b class="nc">&nbsp;        if (!dataFile.exists(&quot;structural_integrity&quot;)) {</b>
<b class="nc">&nbsp;            throw new EntityLoadingException(&quot;Could not find structual_integrity block.&quot;);</b>
&nbsp;        }
<b class="nc">&nbsp;        a.set0SI(dataFile.getDataAsInt(&quot;structural_integrity&quot;)[0]);</b>
&nbsp;
&nbsp;        // figure out heat
<b class="nc">&nbsp;        if (!dataFile.exists(&quot;heatsinks&quot;)) {</b>
<b class="nc">&nbsp;            throw new EntityLoadingException(&quot;Could not find heatsinks block.&quot;);</b>
&nbsp;        }
<b class="nc">&nbsp;        a.setHeatSinks(dataFile.getDataAsInt(&quot;heatsinks&quot;)[0]);</b>
<b class="nc">&nbsp;        a.setOHeatSinks(dataFile.getDataAsInt(&quot;heatsinks&quot;)[0]);</b>
<b class="nc">&nbsp;        if (!dataFile.exists(&quot;sink_type&quot;)) {</b>
<b class="nc">&nbsp;            throw new EntityLoadingException(&quot;Could not find sink_type block.&quot;);</b>
&nbsp;        }
<b class="nc">&nbsp;        a.setHeatType(dataFile.getDataAsInt(&quot;sink_type&quot;)[0]);</b>
&nbsp;
&nbsp;        // figure out fuel
<b class="nc">&nbsp;        if (!dataFile.exists(&quot;fuel&quot;)) {</b>
<b class="nc">&nbsp;            throw new EntityLoadingException(&quot;Could not find fuel block.&quot;);</b>
&nbsp;        }
<b class="nc">&nbsp;        a.setFuel(dataFile.getDataAsInt(&quot;fuel&quot;)[0]);</b>
&nbsp;
&nbsp;        // figure out engine stuff
&nbsp;        // not done for small craft and up
<b class="nc">&nbsp;        if (!dataFile.exists(&quot;SafeThrust&quot;)) {</b>
<b class="nc">&nbsp;            throw new EntityLoadingException(&quot;Could not find SafeThrust block.&quot;);</b>
&nbsp;        }
<b class="nc">&nbsp;        a.setOriginalWalkMP(dataFile.getDataAsInt(&quot;SafeThrust&quot;)[0]);</b>
&nbsp;
<b class="nc">&nbsp;        a.setEngine(new Engine(400, 0, 0));</b>
&nbsp;
&nbsp;        // Switch older files with standard armor to aerospace
<b class="nc">&nbsp;        int at = EquipmentType.T_ARMOR_AEROSPACE;</b>
<b class="nc">&nbsp;        if (dataFile.exists(&quot;armor_type&quot;)) {</b>
<b class="nc">&nbsp;            at = dataFile.getDataAsInt(&quot;armor_type&quot;)[0];</b>
<b class="nc">&nbsp;            if (at == EquipmentType.T_ARMOR_STANDARD) {</b>
<b class="nc">&nbsp;                at = EquipmentType.T_ARMOR_AEROSPACE;</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        a.setArmorType(at);</b>
<b class="nc">&nbsp;        if (dataFile.exists(&quot;armor_tech&quot;)) {</b>
<b class="nc">&nbsp;            a.setArmorTechLevel(dataFile.getDataAsInt(&quot;armor_tech&quot;)[0]);</b>
&nbsp;        }
<b class="nc">&nbsp;        if (dataFile.exists(&quot;internal_type&quot;)) {</b>
<b class="nc">&nbsp;            a.setStructureType(dataFile.getDataAsInt(&quot;internal_type&quot;)[0]);</b>
&nbsp;        } else {
<b class="nc">&nbsp;            a.setStructureType(EquipmentType.T_STRUCTURE_STANDARD);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (!dataFile.exists(&quot;armor&quot;)) {</b>
<b class="nc">&nbsp;            throw new EntityLoadingException(&quot;Could not find armor block.&quot;);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        int[] armor = dataFile.getDataAsInt(&quot;armor&quot;);</b>
&nbsp;
<b class="nc">&nbsp;        if (armor.length != 4) {</b>
<b class="nc">&nbsp;            throw new EntityLoadingException(&quot;Incorrect armor array length&quot;);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        a.initializeArmor(armor[BLKAeroFile.NOSE], SmallCraft.LOC_NOSE);</b>
<b class="nc">&nbsp;        a.initializeArmor(armor[BLKAeroFile.RW], SmallCraft.LOC_RWING);</b>
<b class="nc">&nbsp;        a.initializeArmor(armor[BLKAeroFile.LW], SmallCraft.LOC_LWING);</b>
<b class="nc">&nbsp;        a.initializeArmor(armor[BLKAeroFile.AFT], SmallCraft.LOC_AFT);</b>
<b class="nc">&nbsp;        a.initializeArmor(IArmorState.ARMOR_NA, SmallCraft.LOC_HULL);</b>
&nbsp;
<b class="nc">&nbsp;        a.autoSetInternal();</b>
&nbsp;        // This is not working right for arrays for some reason
<b class="nc">&nbsp;        a.autoSetThresh();</b>
<b class="nc">&nbsp;        a.recalculateTechAdvancement();</b>
&nbsp;
<b class="nc">&nbsp;        for (int loc = 0; loc &lt; a.locations(); loc++) {</b>
<b class="nc">&nbsp;            loadEquipment(a, a.getLocationName(loc), loc);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        addTransports(a);</b>
<b class="nc">&nbsp;        a.setArmorTonnage(a.getArmorWeight());</b>
&nbsp;
<b class="nc">&nbsp;        return a;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    protected void loadEquipment(Entity t, String sName, int nLoc) throws EntityLoadingException {
<b class="nc">&nbsp;        String[] saEquip = dataFile.getDataAsString(sName + &quot; Equipment&quot;);</b>
<b class="nc">&nbsp;        if (saEquip == null) {</b>
<b class="nc">&nbsp;            return;</b>
&nbsp;        }
&nbsp;
&nbsp;        // prefix is &quot;Clan &quot; or &quot;IS &quot;
&nbsp;        String prefix;
<b class="nc">&nbsp;        if (t.getTechLevel() == TechConstants.T_CLAN_TW) {</b>
<b class="nc">&nbsp;            prefix = &quot;Clan &quot;;</b>
&nbsp;        } else {
<b class="nc">&nbsp;            prefix = &quot;IS &quot;;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        boolean rearMount = false;</b>
&nbsp;
<b class="nc">&nbsp;        if (saEquip[0] != null) {</b>
<b class="nc">&nbsp;            for (String element : saEquip) {</b>
<b class="nc">&nbsp;                rearMount = false;</b>
<b class="nc">&nbsp;                String equipName = element.trim();</b>
&nbsp;
<b class="nc">&nbsp;                double size = 0.0;</b>
<b class="nc">&nbsp;                int sizeIndex = equipName.toUpperCase().indexOf(&quot;:SIZE:&quot;);</b>
<b class="nc">&nbsp;                if (sizeIndex &gt; 0) {</b>
<b class="nc">&nbsp;                    size = Double.parseDouble(equipName.substring(sizeIndex + 6));</b>
<b class="nc">&nbsp;                    equipName = equipName.substring(0, sizeIndex);</b>
&nbsp;                }
<b class="nc">&nbsp;                if (equipName.startsWith(&quot;(R) &quot;)) {</b>
<b class="nc">&nbsp;                    rearMount = true;</b>
<b class="nc">&nbsp;                    equipName = equipName.substring(4);</b>
&nbsp;                }
<b class="nc">&nbsp;                int facing = -1;</b>
<b class="nc">&nbsp;                if (equipName.toUpperCase().endsWith(&quot;(FL)&quot;)) {</b>
<b class="nc">&nbsp;                    facing = 5;</b>
<b class="nc">&nbsp;                    equipName = equipName.substring(0, equipName.length() - 4)</b>
<b class="nc">&nbsp;                            .trim();</b>
&nbsp;                }
<b class="nc">&nbsp;                if (equipName.toUpperCase().endsWith(&quot;(FR)&quot;)) {</b>
<b class="nc">&nbsp;                    facing = 1;</b>
<b class="nc">&nbsp;                    equipName = equipName.substring(0, equipName.length() - 4)</b>
<b class="nc">&nbsp;                            .trim();</b>
&nbsp;                }
<b class="nc">&nbsp;                if (equipName.toUpperCase().endsWith(&quot;(RL)&quot;)) {</b>
<b class="nc">&nbsp;                    facing = 4;</b>
<b class="nc">&nbsp;                    equipName = equipName.substring(0, equipName.length() - 4)</b>
<b class="nc">&nbsp;                            .trim();</b>
&nbsp;                }
<b class="nc">&nbsp;                if (equipName.toUpperCase().endsWith(&quot;(RR)&quot;)) {</b>
<b class="nc">&nbsp;                    facing = 2;</b>
<b class="nc">&nbsp;                    equipName = equipName.substring(0, equipName.length() - 4)</b>
<b class="nc">&nbsp;                            .trim();</b>
&nbsp;                }                 
&nbsp;
<b class="nc">&nbsp;                EquipmentType etype = EquipmentType.get(equipName);</b>
&nbsp;
<b class="nc">&nbsp;                if (etype == null) {</b>
&nbsp;                    // try w/ prefix
<b class="nc">&nbsp;                    etype = EquipmentType.get(prefix + equipName);</b>
&nbsp;                }
<b class="nc">&nbsp;                if ((etype == null) &amp;&amp; checkLegacyExtraEquipment(equipName)) {</b>
<b class="nc">&nbsp;                    continue;</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                if (etype != null) {</b>
&nbsp;                    try {
<b class="nc">&nbsp;                        int useLoc = TestEntity.eqRequiresLocation(t, etype)? nLoc : SmallCraft.LOC_HULL;</b>
<b class="nc">&nbsp;                        Mounted mount = t.addEquipment(etype, useLoc, rearMount);</b>
&nbsp;                        // Need to set facing for VGLs
<b class="nc">&nbsp;                        if ((etype instanceof WeaponType) </b>
<b class="nc">&nbsp;                                &amp;&amp; etype.hasFlag(WeaponType.F_VGL)) {</b>
<b class="nc">&nbsp;                            if (facing == -1) {</b>
<b class="nc">&nbsp;                                mount.setFacing(defaultAeroVGLFacing(useLoc, rearMount));</b>
&nbsp;                            } else {
<b class="nc">&nbsp;                                mount.setFacing(facing);</b>
&nbsp;                            }
&nbsp;                        }
<b class="nc">&nbsp;                        if (etype.isVariableSize()) {</b>
<b class="nc">&nbsp;                            if (size == 0.0) {</b>
<b class="nc">&nbsp;                                size = getLegacyVariableSize(equipName);</b>
&nbsp;                            }
<b class="nc">&nbsp;                            mount.setSize(size);</b>
&nbsp;                        }
<b class="nc">&nbsp;                    } catch (LocationFullException ex) {</b>
<b class="nc">&nbsp;                        throw new EntityLoadingException(ex.getMessage());</b>
<b class="nc">&nbsp;                    }</b>
<b class="nc">&nbsp;                } else if (!equipName.equals(&quot;&quot;)) {</b>
<b class="nc">&nbsp;                    t.addFailedEquipment(equipName);</b>
&nbsp;                }
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        if (mashOperatingTheaters &gt; 0) {</b>
<b class="nc">&nbsp;            for (Mounted m : t.getMisc()) {</b>
<b class="nc">&nbsp;                if (m.getType().hasFlag(MiscType.F_MASH)) {</b>
&nbsp;                    // includes one as part of the core component
<b class="nc">&nbsp;                    m.setSize(m.getSize() + mashOperatingTheaters);</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                }
<b class="nc">&nbsp;            }</b>
&nbsp;        }
<b class="nc">&nbsp;        if (legacyDCCSCapacity &gt; 0) {</b>
<b class="nc">&nbsp;            for (Mounted m : t.getMisc()) {</b>
<b class="nc">&nbsp;                if (m.getType().hasFlag(MiscType.F_DRONE_CARRIER_CONTROL)) {</b>
&nbsp;                    // core system does not include drone capacity
<b class="nc">&nbsp;                    m.setSize(legacyDCCSCapacity);</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                }
<b class="nc">&nbsp;            }</b>
&nbsp;        }
<b class="nc">&nbsp;    }</b>
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2023-05-16 16:28</div>
</div>
</body>
</html>
