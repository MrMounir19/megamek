


<!DOCTYPE html>
<html id="htmlId">
<head>
  <title>Coverage Report > AbstractUnitSelectorDialog</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">megamek.client.ui.swing.dialog</a>
</div>

<h1>Coverage Summary for Class: AbstractUnitSelectorDialog (megamek.client.ui.swing.dialog)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">AbstractUnitSelectorDialog</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/21)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/375)
  </span>
</td>
</tr>
  <tr>
    <td class="name">AbstractUnitSelectorDialog$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">AbstractUnitSelectorDialog$2</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">AbstractUnitSelectorDialog$3</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">AbstractUnitSelectorDialog$4</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/22)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">AbstractUnitSelectorDialog$MechTableModel</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/9)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/51)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/40)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/456)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;/*
&nbsp; *  MechSelectorDialog.java - Copyright (C) 2002,2004 Josh Yockey
&nbsp; *  Renamed UnitSelectorDialog - Jay Lawson &lt;jaylawson39 at yahoo.com&gt;
&nbsp; *  Renamed AbstractUnitSelectorDialog - Copyright (c) 2020 - The MegaMek Team
&nbsp; *  This program is free software; you can redistribute it and/or modify it
&nbsp; *  under the terms of the GNU General Public License as published by the Free
&nbsp; *  Software Foundation; either version 2 of the License, or (at your option)
&nbsp; *  any later version.
&nbsp; *
&nbsp; *  This program is distributed in the hope that it will be useful, but
&nbsp; *  WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
&nbsp; *  or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License
&nbsp; *  for more details.
&nbsp; */
&nbsp;package megamek.client.ui.swing.dialog;
&nbsp;
&nbsp;import java.awt.Dimension;
&nbsp;import java.awt.Font;
&nbsp;import java.awt.GridBagConstraints;
&nbsp;import java.awt.GridBagLayout;
&nbsp;import java.awt.Insets;
&nbsp;import java.awt.event.ActionEvent;
&nbsp;import java.awt.event.ActionListener;
&nbsp;import java.awt.event.KeyEvent;
&nbsp;import java.awt.event.KeyListener;
&nbsp;import java.awt.event.WindowEvent;
&nbsp;import java.util.*;
&nbsp;import java.util.regex.PatternSyntaxException;
&nbsp;
&nbsp;import javax.swing.AbstractAction;
&nbsp;import javax.swing.Action;
&nbsp;import javax.swing.DefaultComboBoxModel;
&nbsp;import javax.swing.DefaultRowSorter;
&nbsp;import javax.swing.JButton;
&nbsp;import javax.swing.JComboBox;
&nbsp;import javax.swing.JComponent;
&nbsp;import javax.swing.JDialog;
&nbsp;import javax.swing.JEditorPane;
&nbsp;import javax.swing.JFrame;
&nbsp;import javax.swing.JLabel;
&nbsp;import javax.swing.JList;
&nbsp;import javax.swing.JOptionPane;
&nbsp;import javax.swing.JPanel;
&nbsp;import javax.swing.JRootPane;
&nbsp;import javax.swing.JScrollPane;
&nbsp;import javax.swing.JSplitPane;
&nbsp;import javax.swing.JTabbedPane;
&nbsp;import javax.swing.JTable;
&nbsp;import javax.swing.JTextField;
&nbsp;import javax.swing.KeyStroke;
&nbsp;import javax.swing.ListSelectionModel;
&nbsp;import javax.swing.RowFilter;
&nbsp;import javax.swing.RowSorter.SortKey;
&nbsp;import javax.swing.ScrollPaneConstants;
&nbsp;import javax.swing.SortOrder;
&nbsp;import javax.swing.SwingConstants;
&nbsp;import javax.swing.event.DocumentEvent;
&nbsp;import javax.swing.event.DocumentListener;
&nbsp;import javax.swing.event.ListSelectionEvent;
&nbsp;import javax.swing.event.ListSelectionListener;
&nbsp;import javax.swing.table.AbstractTableModel;
&nbsp;import javax.swing.table.TableColumn;
&nbsp;import javax.swing.table.TableRowSorter;
&nbsp;
&nbsp;import megamek.MegaMek;
&nbsp;import megamek.client.ui.Messages;
&nbsp;import megamek.client.ui.swing.*;
&nbsp;import megamek.common.Entity;
&nbsp;import megamek.common.EntityWeightClass;
&nbsp;import megamek.common.MechFileParser;
&nbsp;import megamek.common.MechSearchFilter;
&nbsp;import megamek.common.MechSummary;
&nbsp;import megamek.common.MechSummaryCache;
&nbsp;import megamek.common.MechView;
&nbsp;import megamek.common.TechConstants;
&nbsp;import megamek.common.UnitType;
&nbsp;import megamek.common.loaders.EntityLoadingException;
&nbsp;import megamek.common.options.GameOptions;
&nbsp;import megamek.common.options.OptionsConstants;
&nbsp;import megamek.common.templates.TROView;
&nbsp;import megamek.common.util.sorter.NaturalOrderComparator;
&nbsp;
&nbsp;/**
&nbsp; * This is a heavily reworked version of the original MechSelectorDialog which
&nbsp; * brings up a list of units for the player to select to add to their forces.
&nbsp; * The original list has been changed to a sortable table and a text filter
&nbsp; * is used for advanced searching.
&nbsp; */
<b class="nc">&nbsp;public abstract class AbstractUnitSelectorDialog extends JDialog implements Runnable, KeyListener,</b>
&nbsp;        ActionListener, ListSelectionListener {
&nbsp;    //region Variable Declarations
&nbsp;    private static final long serialVersionUID = 8144354264100884817L;
&nbsp;
&nbsp;    public static final String CLOSE_ACTION = &quot;closeAction&quot;;
&nbsp;    public static final String SELECT_ACTION = &quot;selectAction&quot;;
&nbsp;
&nbsp;    public static final int ALLOWED_YEAR_ANY = 999999;
&nbsp;
&nbsp;    protected static final int TECH_LEVEL_DISPLAY_IS = 0;
&nbsp;    protected static final int TECH_LEVEL_DISPLAY_CLAN = 1;
&nbsp;    protected static final int TECH_LEVEL_DISPLAY_IS_CLAN = 2;
&nbsp;
&nbsp;    protected JButton buttonSelectClose;
&nbsp;    protected JButton buttonSelect;
&nbsp;    protected JButton buttonClose;
&nbsp;    protected JButton buttonShowBV;
&nbsp;
&nbsp;    private JButton buttonAdvancedSearch;
&nbsp;    private JButton buttonResetSearch;
<b class="nc">&nbsp;    protected JList&lt;String&gt; listTechLevel = new JList&lt;&gt;();</b>
&nbsp;    /**
&nbsp;     * We need to map the selected index of listTechLevel to the actual TL it
&nbsp;     * belongs to
&nbsp;     */
<b class="nc">&nbsp;    protected Map&lt;Integer, Integer&gt; techLevelListToIndex = new HashMap&lt;&gt;();</b>
<b class="nc">&nbsp;    protected JComboBox&lt;String&gt; comboUnitType = new JComboBox&lt;&gt;();</b>
<b class="nc">&nbsp;    protected JComboBox&lt;String&gt; comboWeight = new JComboBox&lt;&gt;();</b>
<b class="nc">&nbsp;    protected JLabel labelImage = new JLabel(&quot;&quot;); //inline to avoid potential null pointer issues</b>
&nbsp;    protected JTable tableUnits;
&nbsp;    protected JTextField textFilter;
&nbsp;    private MechViewPanel panelMechView;
&nbsp;    private MechViewPanel panelTROView;
&nbsp;
<b class="nc">&nbsp;    private StringBuffer searchBuffer = new StringBuffer();</b>
<b class="nc">&nbsp;    private long lastSearch = 0;</b>
&nbsp;    // how long after a key is typed does a new search begin
&nbsp;    private static final int KEY_TIMEOUT = 1000;
&nbsp;
<b class="nc">&nbsp;    protected static MechSummaryCache mscInstance = MechSummaryCache.getInstance();</b>
&nbsp;    protected MechSummary[] mechs;
&nbsp;
<b class="nc">&nbsp;    private MechTableModel unitModel = new MechTableModel();</b>
&nbsp;    protected MechSearchFilter searchFilter;
&nbsp;
&nbsp;    private UnitLoadingDialog unitLoadingDialog;
&nbsp;    private AdvancedSearchDialog asd;
&nbsp;    protected JFrame frame;
&nbsp;
&nbsp;    protected TableRowSorter&lt;MechTableModel&gt; sorter;
&nbsp;
<b class="nc">&nbsp;    protected GameOptions gameOptions = null;</b>
<b class="nc">&nbsp;    protected boolean enableYearLimits = false;</b>
<b class="nc">&nbsp;    protected int allowedYear = ALLOWED_YEAR_ANY;</b>
<b class="nc">&nbsp;    protected boolean canonOnly = false;</b>
<b class="nc">&nbsp;    protected boolean allowInvalid = true;</b>
<b class="nc">&nbsp;    protected int gameTechLevel = TechConstants.T_SIMPLE_INTRO;</b>
<b class="nc">&nbsp;    protected int techLevelDisplayType = TECH_LEVEL_DISPLAY_IS_CLAN;</b>
&nbsp;    //endregion Variable Declarations
&nbsp;
&nbsp;    protected AbstractUnitSelectorDialog(JFrame frame, UnitLoadingDialog unitLoadingDialog) {
<b class="nc">&nbsp;        super(frame, Messages.getString(&quot;MechSelectorDialog.title&quot;), true); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        setName(&quot;UnitSelectorDialog&quot;);</b>
<b class="nc">&nbsp;        this.frame = frame;</b>
<b class="nc">&nbsp;        this.unitLoadingDialog = unitLoadingDialog;</b>
<b class="nc">&nbsp;        super.setVisible(false);</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * This is used to update any values that are set based on individual options
&nbsp;     */
&nbsp;    public abstract void updateOptionValues();
&nbsp;
&nbsp;    /**
&nbsp;     * This has been set up to permit preference implementation in anything that extends this
&nbsp;     */
&nbsp;    private void setUserPreferences() {
<b class="nc">&nbsp;        GUIPreferences guiPreferences = GUIPreferences.getInstance();</b>
<b class="nc">&nbsp;        setSize(guiPreferences.getMechSelectorSizeWidth(), guiPreferences.getMechSelectorSizeHeight());</b>
&nbsp;
<b class="nc">&nbsp;        comboUnitType.setSelectedIndex(guiPreferences.getMechSelectorUnitType());</b>
&nbsp;
<b class="nc">&nbsp;        comboWeight.setSelectedIndex(guiPreferences.getMechSelectorWeightClass());</b>
&nbsp;
<b class="nc">&nbsp;        updateTypeCombo(guiPreferences);</b>
&nbsp;
<b class="nc">&nbsp;        List&lt;SortKey&gt; sortList = new ArrayList&lt;&gt;();</b>
&nbsp;        try {
<b class="nc">&nbsp;            sortList.add(new SortKey(guiPreferences.getMechSelectorSortColumn(),</b>
<b class="nc">&nbsp;                    SortOrder.valueOf(guiPreferences.getMechSelectorSortOrder())));</b>
<b class="nc">&nbsp;        } catch (Exception e) {</b>
<b class="nc">&nbsp;            MegaMek.getLogger().error(&quot;Failed to set based on user preferences, attempting to use default&quot;, e);</b>
&nbsp;
<b class="nc">&nbsp;            sortList.add(new SortKey(guiPreferences.getMechSelectorDefaultSortColumn(),</b>
<b class="nc">&nbsp;                    SortOrder.valueOf(guiPreferences.getMechSelectorDefaultSortOrder())));</b>
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;        tableUnits.getRowSorter().setSortKeys(sortList);</b>
<b class="nc">&nbsp;        ((DefaultRowSorter&lt;?, ?&gt;) tableUnits.getRowSorter()).sort();</b>
&nbsp;
<b class="nc">&nbsp;        tableUnits.invalidate(); // force re-layout of window</b>
<b class="nc">&nbsp;        pack();</b>
&nbsp;    }
&nbsp;
&nbsp;    protected void initialize() {
<b class="nc">&nbsp;        initComponents();</b>
&nbsp;
<b class="nc">&nbsp;        setLocationRelativeTo(frame);</b>
<b class="nc">&nbsp;        asd = new AdvancedSearchDialog(frame, allowedYear);</b>
&nbsp;    }
&nbsp;
&nbsp;    private void initComponents() {
<b class="nc">&nbsp;        GridBagConstraints gridBagConstraints = new GridBagConstraints();</b>
&nbsp;
&nbsp;        // To use the below you MUST AND ONLY modify the gridx and gridy components
<b class="nc">&nbsp;        GridBagConstraints gridBagConstraintsWest = new GridBagConstraints();</b>
<b class="nc">&nbsp;        gridBagConstraintsWest.anchor = GridBagConstraints.WEST;</b>
&nbsp;
<b class="nc">&nbsp;        setMinimumSize(new Dimension(640, 480));</b>
<b class="nc">&nbsp;        getContentPane().setLayout(new GridBagLayout());</b>
&nbsp;
&nbsp;        //region Unit Preview Pane
<b class="nc">&nbsp;        JTabbedPane panePreview = new JTabbedPane();</b>
&nbsp;
<b class="nc">&nbsp;        panelMechView = new MechViewPanel();</b>
<b class="nc">&nbsp;        panelMechView.setMinimumSize(new Dimension(300, 500));</b>
<b class="nc">&nbsp;        panelMechView.setPreferredSize(new Dimension(300, 600));</b>
<b class="nc">&nbsp;        panePreview.addTab(&quot;Summary&quot;, panelMechView);</b>
&nbsp;
<b class="nc">&nbsp;        panelTROView = new MechViewPanel();</b>
<b class="nc">&nbsp;        panePreview.addTab(&quot;TRO&quot;, panelTROView);</b>
&nbsp;        //endregion Unit Preview Pane
&nbsp;
&nbsp;        //region Selection Panel
<b class="nc">&nbsp;        JPanel selectionPanel = new JPanel(new GridBagLayout());</b>
<b class="nc">&nbsp;        selectionPanel.setMinimumSize(new Dimension(500, 500));</b>
<b class="nc">&nbsp;        selectionPanel.setPreferredSize(new Dimension(500, 600));</b>
&nbsp;
<b class="nc">&nbsp;        tableUnits = new JTable(unitModel);</b>
<b class="nc">&nbsp;        tableUnits.setName(&quot;tableUnits&quot;);</b>
<b class="nc">&nbsp;        tableUnits.addKeyListener(this);</b>
<b class="nc">&nbsp;        tableUnits.getInputMap(JComponent.WHEN_ANCESTOR_OF_FOCUSED_COMPONENT).put(</b>
<b class="nc">&nbsp;                KeyStroke.getKeyStroke(KeyEvent.VK_ENTER, 0), &quot;&quot;);</b>
<b class="nc">&nbsp;        tableUnits.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);</b>
<b class="nc">&nbsp;        sorter = new TableRowSorter&lt;&gt;(unitModel);</b>
<b class="nc">&nbsp;        sorter.setComparator(MechTableModel.COL_CHASSIS, new NaturalOrderComparator());</b>
<b class="nc">&nbsp;        sorter.setComparator(MechTableModel.COL_MODEL, new NaturalOrderComparator());</b>
<b class="nc">&nbsp;        tableUnits.setRowSorter(sorter);</b>
<b class="nc">&nbsp;        tableUnits.getSelectionModel().addListSelectionListener(</b>
&nbsp;                evt -&gt; {
&nbsp;                    // There can be multiple events for one selection. Check to see if this is the last.
<b class="nc">&nbsp;                    if (!evt.getValueIsAdjusting()) {</b>
<b class="nc">&nbsp;                        refreshUnitView();</b>
&nbsp;                    }
&nbsp;                });
&nbsp;        TableColumn column;
<b class="nc">&nbsp;        for (int i = 0; i &lt; MechTableModel.N_COL; i++) {</b>
<b class="nc">&nbsp;            column = tableUnits.getColumnModel().getColumn(i);</b>
<b class="nc">&nbsp;            if (i == MechTableModel.COL_CHASSIS) {</b>
<b class="nc">&nbsp;                column.setPreferredWidth(125);</b>
<b class="nc">&nbsp;            } else if ((i == MechTableModel.COL_MODEL) || (i == MechTableModel.COL_COST)) {</b>
<b class="nc">&nbsp;                column.setPreferredWidth(75);</b>
<b class="nc">&nbsp;            } else if ((i == MechTableModel.COL_WEIGHT) || (i == MechTableModel.COL_BV)) {</b>
<b class="nc">&nbsp;                column.setPreferredWidth(50);</b>
&nbsp;            } else {
<b class="nc">&nbsp;                column.setPreferredWidth(25);</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        tableUnits.setFont(new Font(&quot;Monospaced&quot;, Font.PLAIN, 12)); //$NON-NLS-1$</b>
&nbsp;
<b class="nc">&nbsp;        JScrollPane scrollTableUnits = new JScrollPane(tableUnits);</b>
<b class="nc">&nbsp;        scrollTableUnits.setName(&quot;scrollTableUnits&quot;);</b>
<b class="nc">&nbsp;        scrollTableUnits.setMinimumSize(new Dimension(500, 400));</b>
<b class="nc">&nbsp;        scrollTableUnits.setPreferredSize(new Dimension(500, 400));</b>
<b class="nc">&nbsp;        gridBagConstraints.gridx = 0;</b>
<b class="nc">&nbsp;        gridBagConstraints.gridy = 2;</b>
<b class="nc">&nbsp;        gridBagConstraints.fill = GridBagConstraints.BOTH;</b>
<b class="nc">&nbsp;        gridBagConstraints.anchor = GridBagConstraints.NORTHWEST;</b>
<b class="nc">&nbsp;        gridBagConstraints.weightx = 1.0;</b>
<b class="nc">&nbsp;        gridBagConstraints.weighty = 1.0;</b>
<b class="nc">&nbsp;        selectionPanel.add(scrollTableUnits, gridBagConstraints);</b>
&nbsp;
<b class="nc">&nbsp;        JPanel panelFilterButtons = new JPanel(new GridBagLayout());</b>
<b class="nc">&nbsp;        panelFilterButtons.setMinimumSize(new Dimension(300, 180));</b>
<b class="nc">&nbsp;        panelFilterButtons.setPreferredSize(new Dimension(300, 180));</b>
&nbsp;
<b class="nc">&nbsp;        JLabel labelType = new JLabel(Messages.getString(&quot;MechSelectorDialog.m_labelType&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        labelType.setToolTipText(Messages.getString(&quot;MechSelectorDialog.m_labelType.ToolTip&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        gridBagConstraintsWest.gridx = 0;</b>
<b class="nc">&nbsp;        gridBagConstraintsWest.gridy = 2;</b>
<b class="nc">&nbsp;        panelFilterButtons.add(labelType, gridBagConstraintsWest);</b>
&nbsp;
<b class="nc">&nbsp;        listTechLevel.setToolTipText(Messages.getString(&quot;MechSelectorDialog.m_labelType.ToolTip&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        JScrollPane techLevelScroll = new JScrollPane(listTechLevel);</b>
<b class="nc">&nbsp;        techLevelScroll.setMinimumSize(new Dimension(300, 100));</b>
<b class="nc">&nbsp;        techLevelScroll.setPreferredSize(new Dimension(300, 100));</b>
<b class="nc">&nbsp;        gridBagConstraintsWest.gridx = 1;</b>
<b class="nc">&nbsp;        gridBagConstraintsWest.gridy = 2;</b>
<b class="nc">&nbsp;        panelFilterButtons.add(techLevelScroll, gridBagConstraintsWest);</b>
&nbsp;
<b class="nc">&nbsp;        JLabel labelWeight = new JLabel(Messages.getString(&quot;MechSelectorDialog.m_labelWeightClass&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        labelWeight.setName(&quot;labelWeight&quot;);</b>
<b class="nc">&nbsp;        gridBagConstraintsWest.gridx = 0;</b>
<b class="nc">&nbsp;        gridBagConstraintsWest.gridy = 1;</b>
<b class="nc">&nbsp;        panelFilterButtons.add(labelWeight, gridBagConstraintsWest);</b>
&nbsp;
<b class="nc">&nbsp;        DefaultComboBoxModel&lt;String&gt; weightModel = new DefaultComboBoxModel&lt;&gt;();</b>
<b class="nc">&nbsp;        for (int i = 0; i &lt; EntityWeightClass.SIZE; i++) {</b>
<b class="nc">&nbsp;            weightModel.addElement(EntityWeightClass.getClassName(i));</b>
&nbsp;        }
<b class="nc">&nbsp;        weightModel.addElement(Messages.getString(&quot;MechSelectorDialog.All&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        comboWeight.setModel(weightModel);</b>
<b class="nc">&nbsp;        comboWeight.setName(&quot;comboWeight&quot;);</b>
<b class="nc">&nbsp;        comboWeight.setMinimumSize(new Dimension(300, 27));</b>
<b class="nc">&nbsp;        comboWeight.setPreferredSize(new Dimension(300, 27));</b>
<b class="nc">&nbsp;        comboWeight.addActionListener(this);</b>
<b class="nc">&nbsp;        gridBagConstraintsWest.gridx = 1;</b>
<b class="nc">&nbsp;        gridBagConstraintsWest.gridy = 1;</b>
<b class="nc">&nbsp;        panelFilterButtons.add(comboWeight, gridBagConstraintsWest);</b>
&nbsp;
<b class="nc">&nbsp;        JLabel labelUnitType = new JLabel(Messages.getString(&quot;MechSelectorDialog.m_labelUnitType&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        labelUnitType.setName(&quot;labelUnitType&quot;);</b>
<b class="nc">&nbsp;        gridBagConstraints = new GridBagConstraints();</b>
<b class="nc">&nbsp;        gridBagConstraints.gridx = 0;</b>
<b class="nc">&nbsp;        gridBagConstraints.gridy = 0;</b>
<b class="nc">&nbsp;        gridBagConstraints.fill = GridBagConstraints.HORIZONTAL;</b>
<b class="nc">&nbsp;        gridBagConstraints.anchor = GridBagConstraints.WEST;</b>
<b class="nc">&nbsp;        panelFilterButtons.add(labelUnitType, gridBagConstraints);</b>
&nbsp;
<b class="nc">&nbsp;        DefaultComboBoxModel&lt;String&gt; unitTypeModel = new DefaultComboBoxModel&lt;&gt;();</b>
<b class="nc">&nbsp;        unitTypeModel.addElement(Messages.getString(&quot;MechSelectorDialog.All&quot;));</b>
<b class="nc">&nbsp;        for (int i = 0; i &lt; UnitType.SIZE; i++) {</b>
<b class="nc">&nbsp;            unitTypeModel.addElement(UnitType.getTypeDisplayableName(i));</b>
&nbsp;        }
<b class="nc">&nbsp;        unitTypeModel.addElement(Messages.getString(&quot;MechSelectorDialog.SupportVee&quot;));</b>
<b class="nc">&nbsp;        comboUnitType.setModel(unitTypeModel);</b>
<b class="nc">&nbsp;        comboUnitType.setName(&quot;comboUnitType&quot;);</b>
<b class="nc">&nbsp;        comboUnitType.setMinimumSize(new Dimension(300, 27));</b>
<b class="nc">&nbsp;        comboUnitType.setPreferredSize(new Dimension(300, 27));</b>
<b class="nc">&nbsp;        comboUnitType.addActionListener(this);</b>
<b class="nc">&nbsp;        gridBagConstraintsWest.gridx = 1;</b>
<b class="nc">&nbsp;        gridBagConstraintsWest.gridy = 0;</b>
<b class="nc">&nbsp;        panelFilterButtons.add(comboUnitType, gridBagConstraintsWest);</b>
&nbsp;
<b class="nc">&nbsp;        textFilter = new JTextField(&quot;&quot;);</b>
<b class="nc">&nbsp;        textFilter.setName(&quot;textFilter&quot;);</b>
<b class="nc">&nbsp;        textFilter.setMinimumSize(new Dimension(300, 28));</b>
<b class="nc">&nbsp;        textFilter.setPreferredSize(new Dimension(300, 28));</b>
<b class="nc">&nbsp;        textFilter.getDocument().addDocumentListener(new DocumentListener() {</b>
&nbsp;            public void changedUpdate(DocumentEvent e) {
<b class="nc">&nbsp;                filterUnits();</b>
&nbsp;            }
&nbsp;
&nbsp;            public void insertUpdate(DocumentEvent e) {
<b class="nc">&nbsp;                filterUnits();</b>
&nbsp;            }
&nbsp;
&nbsp;            public void removeUpdate(DocumentEvent e) {
<b class="nc">&nbsp;                filterUnits();</b>
&nbsp;            }
&nbsp;        });
<b class="nc">&nbsp;        gridBagConstraintsWest.gridx = 1;</b>
<b class="nc">&nbsp;        gridBagConstraintsWest.gridy = 3;</b>
<b class="nc">&nbsp;        panelFilterButtons.add(textFilter, gridBagConstraintsWest);</b>
&nbsp;
<b class="nc">&nbsp;        JLabel labelFilter = new JLabel(Messages.getString(&quot;MechSelectorDialog.m_labelFilter&quot;)); //$NON-NLS-1$</b>
<b class="nc">&nbsp;        labelFilter.setName(&quot;labelFilter&quot;);</b>
<b class="nc">&nbsp;        gridBagConstraintsWest.gridx = 0;</b>
<b class="nc">&nbsp;        gridBagConstraintsWest.gridy = 3;</b>
<b class="nc">&nbsp;        panelFilterButtons.add(labelFilter, gridBagConstraintsWest);</b>
&nbsp;
<b class="nc">&nbsp;        labelImage.setHorizontalAlignment(SwingConstants.CENTER);</b>
<b class="nc">&nbsp;        labelImage.setName(&quot;labelImage&quot;);</b>
<b class="nc">&nbsp;        gridBagConstraints = new GridBagConstraints();</b>
<b class="nc">&nbsp;        gridBagConstraints.gridx = 2;</b>
<b class="nc">&nbsp;        gridBagConstraints.gridy = 0;</b>
<b class="nc">&nbsp;        gridBagConstraints.gridheight = 4;</b>
<b class="nc">&nbsp;        gridBagConstraints.fill = GridBagConstraints.BOTH;</b>
<b class="nc">&nbsp;        gridBagConstraints.weightx = 1.0;</b>
<b class="nc">&nbsp;        gridBagConstraints.weighty = 1.0;</b>
<b class="nc">&nbsp;        panelFilterButtons.add(labelImage, gridBagConstraints);</b>
&nbsp;
<b class="nc">&nbsp;        gridBagConstraints = new GridBagConstraints();</b>
<b class="nc">&nbsp;        gridBagConstraints.gridx = 0;</b>
<b class="nc">&nbsp;        gridBagConstraints.gridy = 0;</b>
<b class="nc">&nbsp;        gridBagConstraints.fill = GridBagConstraints.HORIZONTAL;</b>
<b class="nc">&nbsp;        gridBagConstraints.anchor = GridBagConstraints.NORTHWEST;</b>
<b class="nc">&nbsp;        gridBagConstraints.weightx = 0.0;</b>
<b class="nc">&nbsp;        gridBagConstraints.insets = new Insets(10, 10, 5, 0);</b>
<b class="nc">&nbsp;        selectionPanel.add(panelFilterButtons, gridBagConstraints);</b>
&nbsp;
<b class="nc">&nbsp;        JPanel panelSearchButtons = new JPanel(new GridBagLayout());</b>
&nbsp;
<b class="nc">&nbsp;        buttonAdvancedSearch = new JButton(Messages.getString(&quot;MechSelectorDialog.AdvSearch&quot;));</b>
<b class="nc">&nbsp;        buttonAdvancedSearch.setName(&quot;buttonAdvancedSearch&quot;);</b>
<b class="nc">&nbsp;        buttonAdvancedSearch.addActionListener(this);</b>
<b class="nc">&nbsp;        gridBagConstraintsWest.gridx = 0;</b>
<b class="nc">&nbsp;        gridBagConstraintsWest.gridy = 0;</b>
<b class="nc">&nbsp;        panelSearchButtons.add(buttonAdvancedSearch, gridBagConstraintsWest);</b>
&nbsp;
<b class="nc">&nbsp;        buttonResetSearch = new JButton(Messages.getString(&quot;MechSelectorDialog.Reset&quot;));</b>
<b class="nc">&nbsp;        buttonResetSearch.setName(&quot;buttonResetSearch&quot;);</b>
<b class="nc">&nbsp;        buttonResetSearch.addActionListener(this);</b>
<b class="nc">&nbsp;        buttonResetSearch.setEnabled(false);</b>
<b class="nc">&nbsp;        gridBagConstraintsWest.gridx = 1;</b>
<b class="nc">&nbsp;        gridBagConstraintsWest.gridy = 0;</b>
<b class="nc">&nbsp;        panelSearchButtons.add(buttonResetSearch, gridBagConstraintsWest);</b>
&nbsp;
<b class="nc">&nbsp;        gridBagConstraints = new GridBagConstraints();</b>
<b class="nc">&nbsp;        gridBagConstraints.gridx = 0;</b>
<b class="nc">&nbsp;        gridBagConstraints.gridy = 1;</b>
<b class="nc">&nbsp;        gridBagConstraints.fill = GridBagConstraints.HORIZONTAL;</b>
<b class="nc">&nbsp;        gridBagConstraints.anchor = GridBagConstraints.NORTHWEST;</b>
<b class="nc">&nbsp;        gridBagConstraints.weightx = 0.0;</b>
<b class="nc">&nbsp;        gridBagConstraints.insets = new Insets(10, 10, 10, 0);</b>
<b class="nc">&nbsp;        selectionPanel.add(panelSearchButtons, gridBagConstraints);</b>
&nbsp;        //endregion Selection Panel
&nbsp;
<b class="nc">&nbsp;        JPanel panelButtons = createButtonsPanel();</b>
&nbsp;
<b class="nc">&nbsp;        JSplitPane splitPane = new JSplitPane(JSplitPane.HORIZONTAL_SPLIT, true,</b>
&nbsp;                selectionPanel, panePreview);
<b class="nc">&nbsp;        splitPane.setResizeWeight(0);</b>
<b class="nc">&nbsp;        gridBagConstraints = new GridBagConstraints();</b>
<b class="nc">&nbsp;        gridBagConstraints.gridx = gridBagConstraints.gridy = 0;</b>
<b class="nc">&nbsp;        gridBagConstraints.fill = GridBagConstraints.BOTH;</b>
<b class="nc">&nbsp;        gridBagConstraints.weightx = gridBagConstraints.weighty = 1;</b>
<b class="nc">&nbsp;        getContentPane().add(splitPane, gridBagConstraints);</b>
&nbsp;
<b class="nc">&nbsp;        gridBagConstraints.insets = new Insets(5,0,5,0);</b>
<b class="nc">&nbsp;        gridBagConstraints.weightx = gridBagConstraints.weighty = 0;</b>
<b class="nc">&nbsp;        gridBagConstraints.gridy = 1;</b>
<b class="nc">&nbsp;        getContentPane().add(panelButtons, gridBagConstraints);</b>
&nbsp;
<b class="nc">&nbsp;        pack();</b>
&nbsp;
&nbsp;        // Escape keypress
<b class="nc">&nbsp;        Action closeAction = new AbstractAction() {</b>
&nbsp;            private static final long serialVersionUID = 2587225044226668664L;
&nbsp;
&nbsp;            public void actionPerformed(ActionEvent e) {
<b class="nc">&nbsp;                close();</b>
&nbsp;            }
&nbsp;        };
&nbsp;
<b class="nc">&nbsp;        Action selectAction = new AbstractAction() {</b>
&nbsp;            private static final long serialVersionUID = 4043951169453748540L;
&nbsp;
&nbsp;            public void actionPerformed(ActionEvent e) {
<b class="nc">&nbsp;                select(false);</b>
&nbsp;            }
&nbsp;        };
&nbsp;
<b class="nc">&nbsp;        JRootPane rootPane = getRootPane();</b>
<b class="nc">&nbsp;        KeyStroke escape = KeyStroke.getKeyStroke(KeyEvent.VK_ESCAPE, 0);</b>
<b class="nc">&nbsp;        KeyStroke enter = KeyStroke.getKeyStroke(KeyEvent.VK_ENTER, 0);</b>
<b class="nc">&nbsp;        rootPane.getInputMap(JComponent.WHEN_ANCESTOR_OF_FOCUSED_COMPONENT).put(escape, CLOSE_ACTION);</b>
<b class="nc">&nbsp;        rootPane.getInputMap(JComponent.WHEN_IN_FOCUSED_WINDOW).put(escape, CLOSE_ACTION);</b>
<b class="nc">&nbsp;        rootPane.getInputMap(JComponent.WHEN_FOCUSED).put(escape, CLOSE_ACTION);</b>
<b class="nc">&nbsp;        rootPane.getActionMap().put(CLOSE_ACTION, closeAction);</b>
&nbsp;
<b class="nc">&nbsp;        rootPane.getInputMap(JComponent.WHEN_ANCESTOR_OF_FOCUSED_COMPONENT).put(enter, SELECT_ACTION);</b>
<b class="nc">&nbsp;        rootPane.getInputMap(JComponent.WHEN_IN_FOCUSED_WINDOW).put(enter, SELECT_ACTION);</b>
<b class="nc">&nbsp;        rootPane.getInputMap(JComponent.WHEN_FOCUSED).put(enter, SELECT_ACTION);</b>
<b class="nc">&nbsp;        rootPane.getActionMap().put(SELECT_ACTION, selectAction);</b>
&nbsp;    }
&nbsp;
&nbsp;    private void updateTypeCombo(GUIPreferences preferences) {
<b class="nc">&nbsp;        listTechLevel.removeListSelectionListener(this);</b>
<b class="nc">&nbsp;        int[] selectedIndices = listTechLevel.getSelectedIndices();</b>
&nbsp;
<b class="nc">&nbsp;        if (selectedIndices.length == 0) {</b>
<b class="nc">&nbsp;            String option = preferences.getMechSelectorRulesLevels().replaceAll(&quot;[\\[\\]]&quot;, &quot;&quot;);</b>
<b class="nc">&nbsp;            if (option.length() &gt; 0) {</b>
<b class="nc">&nbsp;                String[] strSelections = option.split(&quot;[,]&quot;);</b>
<b class="nc">&nbsp;                selectedIndices = new int[strSelections.length];</b>
<b class="nc">&nbsp;                for (int i = 0; i &lt; strSelections.length; i++) {</b>
<b class="nc">&nbsp;                    selectedIndices[i] = Integer.parseInt(strSelections[i].trim());</b>
&nbsp;                }
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;        int maxTech;
<b class="nc">&nbsp;        switch (gameTechLevel) {</b>
&nbsp;            case TechConstants.T_SIMPLE_INTRO:
<b class="nc">&nbsp;                maxTech = TechConstants.T_INTRO_BOXSET;</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            case TechConstants.T_SIMPLE_STANDARD:
<b class="nc">&nbsp;                maxTech = TechConstants.T_TW_ALL;</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            case TechConstants.T_SIMPLE_ADVANCED:
<b class="nc">&nbsp;                maxTech = TechConstants.T_CLAN_ADVANCED;</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            case TechConstants.T_SIMPLE_EXPERIMENTAL:
<b class="nc">&nbsp;                maxTech = TechConstants.T_CLAN_EXPERIMENTAL;</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            case TechConstants.T_SIMPLE_UNOFFICIAL:
&nbsp;            default:
<b class="nc">&nbsp;                maxTech = TechConstants.T_CLAN_UNOFFICIAL;</b>
&nbsp;                break;
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        techLevelListToIndex.clear();</b>
<b class="nc">&nbsp;        DefaultComboBoxModel&lt;String&gt; techModel = new DefaultComboBoxModel&lt;&gt;();</b>
<b class="nc">&nbsp;        int selectionIdx = 0;</b>
<b class="nc">&nbsp;        for (int tl = 0; tl &lt;= maxTech; tl++) {</b>
<b class="nc">&nbsp;            if ((tl != TechConstants.T_IS_TW_ALL) &amp;&amp; (tl != TechConstants.T_TW_ALL)) {</b>
<b class="nc">&nbsp;                switch (techLevelDisplayType) {</b>
&nbsp;                    case TECH_LEVEL_DISPLAY_IS:
<b class="nc">&nbsp;                        if (TechConstants.getTechName(tl).equals(&quot;Inner Sphere&quot;)</b>
<b class="nc">&nbsp;                                || TechConstants.getTechName(tl).contains(&quot;IS&quot;)) {</b>
<b class="nc">&nbsp;                            techLevelListToIndex.put(selectionIdx, tl);</b>
<b class="nc">&nbsp;                            techModel.addElement(TechConstants.getLevelDisplayableName(tl));</b>
<b class="nc">&nbsp;                            selectionIdx++;</b>
&nbsp;                        }
&nbsp;                        break;
&nbsp;                    case TECH_LEVEL_DISPLAY_CLAN:
<b class="nc">&nbsp;                        if (TechConstants.getTechName(tl).contains(&quot;Clan&quot;)) {</b>
<b class="nc">&nbsp;                            techLevelListToIndex.put(selectionIdx, tl);</b>
<b class="nc">&nbsp;                            techModel.addElement(TechConstants.getLevelDisplayableName(tl));</b>
<b class="nc">&nbsp;                            selectionIdx++;</b>
&nbsp;                        }
&nbsp;                        break;
&nbsp;                    case TECH_LEVEL_DISPLAY_IS_CLAN:
&nbsp;                    default:
<b class="nc">&nbsp;                        techLevelListToIndex.put(selectionIdx, tl);</b>
<b class="nc">&nbsp;                        techModel.addElement(TechConstants.getLevelDisplayableName(tl));</b>
<b class="nc">&nbsp;                        selectionIdx++;</b>
&nbsp;                        break;
&nbsp;                }
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        listTechLevel.setModel(techModel);</b>
&nbsp;
<b class="nc">&nbsp;        listTechLevel.setSelectedIndices(selectedIndices);</b>
<b class="nc">&nbsp;        listTechLevel.addListSelectionListener(this);</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * This is used to create the bottom row of buttons for the interface
&nbsp;     * @return the panel containing the buttons to place in the interface
&nbsp;     */
&nbsp;    protected abstract JPanel createButtonsPanel();
&nbsp;
&nbsp;    /**
&nbsp;     * This is the function to add a unit to the current interface. That could be a purchase (MekHQ),
&nbsp;     * addition (MekHQ), or unit selection (MegaMek/MegaMekLab)
&nbsp;     * @param modifier a boolean to modify how the function will work. In MegaMek this is used to
&nbsp;     *                 close the dialog, in MekHQ to GM add.
&nbsp;     */
&nbsp;    protected abstract void select(boolean modifier);
&nbsp;
&nbsp;    /**
&nbsp;     * This filters the units on the display. It is overwritten for MekHQ
&nbsp;     */
&nbsp;    protected void filterUnits() {
&nbsp;        RowFilter&lt;MechTableModel, Integer&gt; unitTypeFilter;
&nbsp;
<b class="nc">&nbsp;        List&lt;Integer&gt; techLevels = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        for (Integer selectedIdx : listTechLevel.getSelectedIndices()) {</b>
<b class="nc">&nbsp;            techLevels.add(techLevelListToIndex.get(selectedIdx));</b>
&nbsp;        }
<b class="nc">&nbsp;        final Integer[] nTypes = new Integer[techLevels.size()];</b>
<b class="nc">&nbsp;        techLevels.toArray(nTypes);</b>
&nbsp;
<b class="nc">&nbsp;        final int nClass = comboWeight.getSelectedIndex();</b>
<b class="nc">&nbsp;        final int nUnit = comboUnitType.getSelectedIndex() - 1;</b>
<b class="nc">&nbsp;        final boolean checkSupportVee = Messages.getString(&quot;MechSelectorDialog.SupportVee&quot;)</b>
<b class="nc">&nbsp;                .equals(comboUnitType.getSelectedItem());</b>
&nbsp;        //If current expression doesn&#39;t parse, don&#39;t update.
&nbsp;        try {
<b class="nc">&nbsp;            unitTypeFilter = new RowFilter&lt;MechTableModel, Integer&gt;() {</b>
&nbsp;                @Override
&nbsp;                public boolean include(Entry&lt;? extends MechTableModel, ? extends Integer&gt; entry) {
<b class="nc">&nbsp;                    MechTableModel mechModel = entry.getModel();</b>
<b class="nc">&nbsp;                    MechSummary mech = mechModel.getMechSummary(entry.getIdentifier());</b>
<b class="nc">&nbsp;                    boolean techLevelMatch = false;</b>
<b class="nc">&nbsp;                    int type = enableYearLimits ? mech.getType(allowedYear) : mech.getType();</b>
<b class="nc">&nbsp;                    for (int tl : nTypes) {</b>
<b class="nc">&nbsp;                        if (type == tl) {</b>
<b class="nc">&nbsp;                            techLevelMatch = true;</b>
<b class="nc">&nbsp;                            break;</b>
&nbsp;                        }
&nbsp;                    }
<b class="nc">&nbsp;                    if (</b>
&nbsp;                            /* Year Limits */
<b class="nc">&nbsp;                            (!enableYearLimits || (mech.getYear() &lt;= allowedYear))</b>
&nbsp;                            /* Canon */
<b class="nc">&nbsp;                            &amp;&amp; (!canonOnly || mech.isCanon())</b>
&nbsp;                            /* Invalid units */
<b class="nc">&nbsp;                            &amp;&amp; (allowInvalid || !mech.getLevel().equals(&quot;F&quot;))</b>
&nbsp;                            /* Weight */
<b class="nc">&nbsp;                            &amp;&amp; ((nClass == EntityWeightClass.SIZE) || (nClass == mech.getWeightClass()))</b>
&nbsp;                            /* Technology Level */
&nbsp;                            &amp;&amp; (techLevelMatch)
&nbsp;                            /* Support Vehicles */
&nbsp;                            &amp;&amp; ((nUnit == -1)
<b class="nc">&nbsp;                                    || (!checkSupportVee &amp;&amp; mech.getUnitType().equals(UnitType.getTypeName(nUnit)))</b>
<b class="nc">&nbsp;                                    || (checkSupportVee &amp;&amp; mech.isSupport()))</b>
&nbsp;                            /* Advanced Search */
<b class="nc">&nbsp;                            &amp;&amp; ((searchFilter == null) || MechSearchFilter.isMatch(mech, searchFilter))</b>
&nbsp;                    ) {
<b class="nc">&nbsp;                        if (textFilter.getText().length() &gt; 0) {</b>
<b class="nc">&nbsp;                            String text = textFilter.getText();</b>
<b class="nc">&nbsp;                            return mech.getName().toLowerCase().contains(text.toLowerCase());</b>
&nbsp;                        }
<b class="nc">&nbsp;                        return true;</b>
&nbsp;                    }
<b class="nc">&nbsp;                    return false;</b>
&nbsp;                }
&nbsp;            };
<b class="nc">&nbsp;        } catch (PatternSyntaxException ignored) {</b>
&nbsp;            return;
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;        sorter.setRowFilter(unitTypeFilter);</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * @return the selected entity (required for MekHQ/MegaMek overrides)
&nbsp;     */
&nbsp;    protected Entity refreshUnitView() {
<b class="nc">&nbsp;        boolean populateTextFields = true;</b>
&nbsp;
<b class="nc">&nbsp;        Entity selectedEntity = getSelectedEntity();</b>
&nbsp;        // null entity, so load a default unit.
<b class="nc">&nbsp;        if (selectedEntity == null) {</b>
<b class="nc">&nbsp;            panelMechView.reset();</b>
<b class="nc">&nbsp;            labelImage.setIcon(null);</b>
<b class="nc">&nbsp;            return null;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        MechView mechView = null;</b>
<b class="nc">&nbsp;        TROView troView = null;</b>
&nbsp;        try {
<b class="nc">&nbsp;            mechView = new MechView(selectedEntity, false);</b>
<b class="nc">&nbsp;            troView = TROView.createView(selectedEntity, true);</b>
<b class="nc">&nbsp;        } catch (Exception e) {</b>
<b class="nc">&nbsp;            MegaMek.getLogger().error(e);</b>
&nbsp;            // error: unit didn&#39;t load right. this is bad news.
<b class="nc">&nbsp;            populateTextFields = false;</b>
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;        if (populateTextFields) {</b>
<b class="nc">&nbsp;            panelMechView.setMech(selectedEntity, mechView);</b>
<b class="nc">&nbsp;            panelTROView.setMech(selectedEntity, troView);</b>
&nbsp;        } else {
<b class="nc">&nbsp;            panelMechView.reset();</b>
<b class="nc">&nbsp;            panelTROView.reset();</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return selectedEntity;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * @return the selected entity
&nbsp;     */
&nbsp;    public Entity getSelectedEntity() {
<b class="nc">&nbsp;        int view = tableUnits.getSelectedRow();</b>
<b class="nc">&nbsp;        if (view &lt; 0) {</b>
&nbsp;            // selection got filtered away
<b class="nc">&nbsp;            return null;</b>
&nbsp;        }
<b class="nc">&nbsp;        int selected = tableUnits.convertRowIndexToModel(view);</b>
<b class="nc">&nbsp;        MechSummary ms = mechs[selected];</b>
&nbsp;        try {
&nbsp;            // For some unknown reason the base path gets screwed up after you
&nbsp;            // print so this sets the source file to the full path.
<b class="nc">&nbsp;            return new MechFileParser(ms.getSourceFile(), ms.getEntryName()).getEntity();</b>
<b class="nc">&nbsp;        } catch (EntityLoadingException e) {</b>
<b class="nc">&nbsp;            MegaMek.getLogger().error(&quot;Unable to load mech: &quot; + ms.getSourceFile() + &quot;: &quot; + ms.getEntryName()</b>
<b class="nc">&nbsp;                            + &quot;: &quot; + e.getMessage(), e);</b>
<b class="nc">&nbsp;            return null;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    public void run() {
&nbsp;        // Loading mechs can take a while, so it will have its own thread for MegaMek
&nbsp;        // This prevents the UI from freezing, and allows the
&nbsp;        // &quot;Please wait...&quot; dialog to behave properly on various Java VMs.
<b class="nc">&nbsp;        mechs = mscInstance.getAllMechs();</b>
<b class="nc">&nbsp;        unitLoadingDialog.setVisible(false);</b>
&nbsp;
&nbsp;        // break out if there are no units to filter
<b class="nc">&nbsp;        if (mechs == null) {</b>
<b class="nc">&nbsp;            MegaMek.getLogger().error(&quot;No mechs were loaded&quot;);</b>
&nbsp;        } else {
<b class="nc">&nbsp;            unitModel.setData(mechs);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     *
&nbsp;     * @param visible whether or not to make the GUI visible
&nbsp;     */
&nbsp;    @Override
&nbsp;    public void setVisible(boolean visible) {
<b class="nc">&nbsp;        if (visible) {</b>
<b class="nc">&nbsp;            setUserPreferences();</b>
&nbsp;        }
<b class="nc">&nbsp;        asd.clearValues();</b>
<b class="nc">&nbsp;        searchFilter = null;</b>
<b class="nc">&nbsp;        buttonResetSearch.setEnabled(false);</b>
<b class="nc">&nbsp;        filterUnits();</b>
&nbsp;
<b class="nc">&nbsp;        super.setVisible(visible);</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * This handles processing windows events
&nbsp;     * @param e the event to process
&nbsp;     */
&nbsp;    @Override
&nbsp;    protected void processWindowEvent(WindowEvent e) {
<b class="nc">&nbsp;        super.processWindowEvent(e);</b>
<b class="nc">&nbsp;        if ((e.getID() == WindowEvent.WINDOW_DEACTIVATED) || (e.getID() == WindowEvent.WINDOW_CLOSING)) {</b>
<b class="nc">&nbsp;            GUIPreferences guiPreferences = GUIPreferences.getInstance();</b>
<b class="nc">&nbsp;            guiPreferences.setMechSelectorUnitType(comboUnitType.getSelectedIndex());</b>
<b class="nc">&nbsp;            guiPreferences.setMechSelectorWeightClass(comboWeight.getSelectedIndex());</b>
<b class="nc">&nbsp;            guiPreferences.setMechSelectorRulesLevels(Arrays.toString(listTechLevel.getSelectedIndices()));</b>
<b class="nc">&nbsp;            guiPreferences.setMechSelectorSortColumn(tableUnits.getRowSorter().getSortKeys().get(0).getColumn());</b>
<b class="nc">&nbsp;            guiPreferences.setMechSelectorSortOrder(tableUnits.getRowSorter().getSortKeys().get(0).getSortOrder().name());</b>
<b class="nc">&nbsp;            guiPreferences.setMechSelectorSizeHeight(getSize().height);</b>
<b class="nc">&nbsp;            guiPreferences.setMechSelectorSizeWidth(getSize().width);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * This handles key released events
&nbsp;     * @param ke the key that was released
&nbsp;     */
&nbsp;    public void keyReleased(KeyEvent ke) {
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    /**
&nbsp;     * This handles key pressed events
&nbsp;     * @param ke the pressed key
&nbsp;     */
&nbsp;    public void keyPressed(KeyEvent ke) {
<b class="nc">&nbsp;        long curTime = System.currentTimeMillis();</b>
<b class="nc">&nbsp;        if ((curTime - lastSearch) &gt; KEY_TIMEOUT) {</b>
<b class="nc">&nbsp;            searchBuffer = new StringBuffer();</b>
&nbsp;        }
<b class="nc">&nbsp;        lastSearch = curTime;</b>
<b class="nc">&nbsp;        searchBuffer.append(ke.getKeyChar());</b>
<b class="nc">&nbsp;        searchFor(searchBuffer.toString().toLowerCase());</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Searches the table for any entity with a name that starts with the search string
&nbsp;     * @param search the search parameters
&nbsp;     */
&nbsp;    private void searchFor(String search) {
<b class="nc">&nbsp;        for (int i = 0; i &lt; mechs.length; i++) {</b>
<b class="nc">&nbsp;            if (mechs[i].getName().toLowerCase().startsWith(search)) {</b>
<b class="nc">&nbsp;                int selected = tableUnits.convertRowIndexToView(i);</b>
<b class="nc">&nbsp;                if (selected &gt; -1) {</b>
<b class="nc">&nbsp;                    tableUnits.changeSelection(selected, 0, false, false);</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                }
&nbsp;            }
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * This handles key typed events
&nbsp;     * @param ke the typed key
&nbsp;     */
&nbsp;    public void keyTyped(KeyEvent ke) {
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    /**
&nbsp;     * This handles the primary action events (any that can come from buttons in this class)
&nbsp;     * @param ev the event containing the performed action
&nbsp;     */
&nbsp;    public void actionPerformed(ActionEvent ev) {
<b class="nc">&nbsp;        if (ev.getSource().equals(comboWeight) || ev.getSource().equals(comboUnitType)) {</b>
<b class="nc">&nbsp;            filterUnits();</b>
<b class="nc">&nbsp;        } else if (ev.getSource().equals(buttonSelect)) {</b>
<b class="nc">&nbsp;            select(false);</b>
<b class="nc">&nbsp;        } else if (ev.getSource().equals(buttonSelectClose)) {</b>
<b class="nc">&nbsp;            select(true);</b>
<b class="nc">&nbsp;        } else if (ev.getSource().equals(buttonClose)) {</b>
<b class="nc">&nbsp;            close();</b>
<b class="nc">&nbsp;        } else if (ev.getSource().equals(buttonShowBV)) {</b>
<b class="nc">&nbsp;            JEditorPane tEditorPane = new JEditorPane();</b>
<b class="nc">&nbsp;            tEditorPane.setContentType(&quot;text/html&quot;);</b>
<b class="nc">&nbsp;            tEditorPane.setEditable(false);</b>
<b class="nc">&nbsp;            Entity e = getSelectedEntity();</b>
<b class="nc">&nbsp;            if (null == e) {</b>
&nbsp;                return;
&nbsp;            }
<b class="nc">&nbsp;            e.calculateBattleValue();</b>
<b class="nc">&nbsp;            tEditorPane.setText(e.getBVText());</b>
<b class="nc">&nbsp;            tEditorPane.setCaretPosition(0);</b>
<b class="nc">&nbsp;            JScrollPane tScroll = new JScrollPane(tEditorPane,</b>
&nbsp;                    ScrollPaneConstants.VERTICAL_SCROLLBAR_AS_NEEDED,
&nbsp;                    ScrollPaneConstants.HORIZONTAL_SCROLLBAR_AS_NEEDED);
<b class="nc">&nbsp;            Dimension size = new Dimension(550, 300);</b>
<b class="nc">&nbsp;            tScroll.setPreferredSize(size);</b>
<b class="nc">&nbsp;            JOptionPane.showMessageDialog(null, tScroll, &quot;BV&quot;,</b>
&nbsp;                    JOptionPane.INFORMATION_MESSAGE, null);
<b class="nc">&nbsp;        } else if (ev.getSource().equals(buttonAdvancedSearch)) {</b>
<b class="nc">&nbsp;            searchFilter = asd.showDialog();</b>
<b class="nc">&nbsp;            buttonResetSearch.setEnabled((searchFilter != null) &amp;&amp; !searchFilter.isDisabled);</b>
<b class="nc">&nbsp;            filterUnits();</b>
<b class="nc">&nbsp;        } else if (ev.getSource().equals(buttonResetSearch)) {</b>
<b class="nc">&nbsp;            asd.clearValues();</b>
<b class="nc">&nbsp;            searchFilter = null;</b>
<b class="nc">&nbsp;            buttonResetSearch.setEnabled(false);</b>
<b class="nc">&nbsp;            filterUnits();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void close() {
<b class="nc">&nbsp;        setVisible(false);</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * This handles list selection events, which are only thrown by MegaMek/MegaMekLab
&nbsp;     * @param evt the event to process
&nbsp;     */
&nbsp;    @Override
&nbsp;    public void valueChanged(ListSelectionEvent evt) {
<b class="nc">&nbsp;        if (!evt.getValueIsAdjusting() &amp;&amp; evt.getSource().equals(listTechLevel)) {</b>
<b class="nc">&nbsp;            filterUnits();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * A table model for displaying work items
&nbsp;     */
<b class="nc">&nbsp;    protected class MechTableModel extends AbstractTableModel {</b>
&nbsp;        //region Variable Declarations
&nbsp;        private static final long serialVersionUID = -5457068129532709857L;
&nbsp;        private static final int COL_CHASSIS = 0;
&nbsp;        private static final int COL_MODEL = 1;
&nbsp;        private static final int COL_WEIGHT = 2;
&nbsp;        private static final int COL_BV = 3;
&nbsp;        private static final int COL_YEAR = 4;
&nbsp;        private static final int COL_COST = 5;
&nbsp;        private static final int COL_LEVEL = 6;
&nbsp;        private static final int N_COL = 7;
&nbsp;
<b class="nc">&nbsp;        private MechSummary[] data = new MechSummary[0];</b>
&nbsp;        //endregion Variable Declarations
&nbsp;
&nbsp;        public int getRowCount() {
<b class="nc">&nbsp;            return data.length;</b>
&nbsp;        }
&nbsp;
&nbsp;        public int getColumnCount() {
<b class="nc">&nbsp;            return N_COL;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public String getColumnName(int column) {
<b class="nc">&nbsp;            switch (column) {</b>
&nbsp;                case COL_MODEL:
<b class="nc">&nbsp;                    return &quot;Model&quot;;</b>
&nbsp;                case COL_CHASSIS:
<b class="nc">&nbsp;                    return &quot;Chassis&quot;;</b>
&nbsp;                case COL_WEIGHT:
<b class="nc">&nbsp;                    return &quot;Weight&quot;;</b>
&nbsp;                case COL_BV:
<b class="nc">&nbsp;                    return &quot;BV&quot;;</b>
&nbsp;                case COL_YEAR:
<b class="nc">&nbsp;                    return &quot;Year&quot;;</b>
&nbsp;                case COL_COST:
<b class="nc">&nbsp;                    return &quot;Price&quot;;</b>
&nbsp;                case COL_LEVEL:
<b class="nc">&nbsp;                    return &quot;Level&quot;;</b>
&nbsp;                default:
<b class="nc">&nbsp;                    return &quot;?&quot;;</b>
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public Class&lt;?&gt; getColumnClass(int col) {
<b class="nc">&nbsp;            return getValueAt(0, col).getClass();</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public boolean isCellEditable(int row, int col) {
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;
&nbsp;        public MechSummary getMechSummary(int i) {
<b class="nc">&nbsp;            return data[i];</b>
&nbsp;        }
&nbsp;
&nbsp;        // fill table with values
&nbsp;        public void setData(MechSummary[] ms) {
<b class="nc">&nbsp;            data = ms;</b>
<b class="nc">&nbsp;            fireTableDataChanged();</b>
&nbsp;        }
&nbsp;
&nbsp;        public Object getValueAt(int row, int col) {
<b class="nc">&nbsp;            if (data.length &lt;= row) {</b>
<b class="nc">&nbsp;                return &quot;?&quot;;</b>
&nbsp;            }
<b class="nc">&nbsp;            MechSummary ms = data[row];</b>
<b class="nc">&nbsp;            if (col == COL_MODEL) {</b>
<b class="nc">&nbsp;                return ms.getModel();</b>
<b class="nc">&nbsp;            } else if (col == COL_CHASSIS) {</b>
<b class="nc">&nbsp;                return ms.getChassis();</b>
<b class="nc">&nbsp;            } else if (col == COL_WEIGHT) {</b>
<b class="nc">&nbsp;                if ((gameOptions != null) &amp;&amp; ms.getUnitType().equals(&quot;BattleArmor&quot;)) {</b>
<b class="nc">&nbsp;                    if (gameOptions.booleanOption(OptionsConstants.ADVANCED_TACOPS_BA_WEIGHT)) {</b>
<b class="nc">&nbsp;                        return ms.getTOweight();</b>
&nbsp;                    } else {
<b class="nc">&nbsp;                        return ms.getTWweight();</b>
&nbsp;                    }
&nbsp;                }
<b class="nc">&nbsp;                return ms.getTons();</b>
<b class="nc">&nbsp;            } else if (col == COL_BV) {</b>
<b class="nc">&nbsp;                if ((gameOptions != null)</b>
<b class="nc">&nbsp;                        &amp;&amp; gameOptions.booleanOption(OptionsConstants.ADVANCED_GEOMETRIC_MEAN_BV)) {</b>
<b class="nc">&nbsp;                    if (gameOptions.booleanOption(OptionsConstants.ADVANCED_REDUCED_OVERHEAT_MODIFIER_BV)) {</b>
<b class="nc">&nbsp;                        return ms.getRHGMBV();</b>
&nbsp;                    } else {
<b class="nc">&nbsp;                        return ms.getGMBV();</b>
&nbsp;                    }
<b class="nc">&nbsp;                } else if ((gameOptions != null)</b>
<b class="nc">&nbsp;                        &amp;&amp; gameOptions.booleanOption(OptionsConstants.ADVANCED_REDUCED_OVERHEAT_MODIFIER_BV)) {</b>
<b class="nc">&nbsp;                    return ms.getRHBV();</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    return ms.getBV();</b>
&nbsp;                }
<b class="nc">&nbsp;            } else if (col == COL_YEAR) {</b>
<b class="nc">&nbsp;                return ms.getYear();</b>
<b class="nc">&nbsp;            } else if (col == COL_COST) {</b>
<b class="nc">&nbsp;                return ms.getCost();</b>
<b class="nc">&nbsp;            } else if (col == COL_LEVEL) {</b>
<b class="nc">&nbsp;                if ((gameOptions != null)</b>
<b class="nc">&nbsp;                        &amp;&amp; gameOptions.booleanOption(OptionsConstants.ALLOWED_ERA_BASED)) {</b>
<b class="nc">&nbsp;                    return ms.getLevel(gameOptions.intOption(OptionsConstants.ALLOWED_YEAR));</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    return ms.getLevel();</b>
&nbsp;                }
&nbsp;            } else {
<b class="nc">&nbsp;                return &quot;?&quot;;</b>
&nbsp;            }
&nbsp;        }
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2023-05-16 16:28</div>
</div>
</body>
</html>
