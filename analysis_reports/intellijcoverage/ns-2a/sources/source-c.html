


<!DOCTYPE html>
<html id="htmlId">
<head>
  <title>Coverage Report > TestProtomech</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">megamek.common.verifier</a>
</div>

<h1>Coverage Summary for Class: TestProtomech (megamek.common.verifier)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">TestProtomech</td>
<td class="coverageStat">
  <span class="percent">
    54.9%
  </span>
  <span class="absValue">
    (28/51)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    45.5%
  </span>
  <span class="absValue">
    (137/301)
  </span>
</td>
</tr>
  <tr>
    <td class="name">TestProtomech$ProtomechArmor</td>
<td class="coverageStat">
  <span class="percent">
    45.5%
  </span>
  <span class="absValue">
    (5/11)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    61.9%
  </span>
  <span class="absValue">
    (13/21)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestProtomech$ProtomechJumpJets</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/12)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    49.3%
  </span>
  <span class="absValue">
    (33/67)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    44.9%
  </span>
  <span class="absValue">
    (150/334)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;/*
&nbsp; * Copyright (C) 2018 - The MegaMek Team
&nbsp; *
&nbsp; *  This program is free software; you can redistribute it and/or modify it
&nbsp; *  under the terms of the GNU General Public License as published by the Free
&nbsp; *  Software Foundation; either version 2 of the License, or (at your option)
&nbsp; *  any later version.
&nbsp; *
&nbsp; *  This program is distributed in the hope that it will be useful, but
&nbsp; *  WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
&nbsp; *  or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License
&nbsp; *  for more details.
&nbsp; */
&nbsp;package megamek.common.verifier;
&nbsp;
&nbsp;import java.util.ArrayList;
&nbsp;import java.util.Arrays;
&nbsp;import java.util.HashMap;
&nbsp;import java.util.List;
&nbsp;import java.util.Map;
&nbsp;import java.util.stream.Collectors;
&nbsp;
&nbsp;import megamek.common.AmmoType;
&nbsp;import megamek.common.Entity;
&nbsp;import megamek.common.EquipmentType;
&nbsp;import megamek.common.ITechManager;
&nbsp;import megamek.common.MiscType;
&nbsp;import megamek.common.Mounted;
&nbsp;import megamek.common.Protomech;
&nbsp;import megamek.common.TechConstants;
&nbsp;import megamek.common.WeaponType;
&nbsp;import megamek.common.annotations.Nullable;
&nbsp;import megamek.common.util.StringUtil;
&nbsp;
&nbsp;/**
&nbsp; * @author Neoancient
&nbsp; *
&nbsp; */
&nbsp;public class TestProtomech extends TestEntity {
&nbsp;
&nbsp;    /**
&nbsp;     * Minimum tonnage for a protomech
&nbsp;     */
&nbsp;    public static final double MIN_TONNAGE = 2.0;
&nbsp;
&nbsp;    /**
&nbsp;     * Any protomech with a larger mass than this is ultra-heavy
&nbsp;     */
&nbsp;    public static final double MAX_STD_TONNAGE = 9.0;
&nbsp;    
&nbsp;    /**
&nbsp;     * Maximum weight for a protomech
&nbsp;     */
&nbsp;    public static final double MAX_TONNAGE = 15.0;
&nbsp;    
&nbsp;    /**
&nbsp;     * Minimum walk MP for glider protomech
&nbsp;     */
&nbsp;    public static final int GLIDER_MIN_MP = 4;
&nbsp;    /**
&nbsp;     * Minimum walk MP for quad protomech
&nbsp;     */
&nbsp;    public static final int QUAD_MIN_MP = 3;
&nbsp;    
<b class="nc">&nbsp;    public enum ProtomechJumpJets {</b>
<b class="nc">&nbsp;        JJ_STANDARD (&quot;ProtomechJumpJet&quot;, false),</b>
<b class="nc">&nbsp;        JJ_EXTENDED (&quot;ExtendedJumpJetSystem&quot;, true),</b>
<b class="nc">&nbsp;        JJ_UMU (&quot;ProtomechUMU&quot;, false);</b>
&nbsp;        
&nbsp;        private final String internalName;
&nbsp;        private final boolean improved;
&nbsp;        
<b class="nc">&nbsp;        private ProtomechJumpJets(String internalName, boolean improved) {</b>
<b class="nc">&nbsp;            this.internalName = internalName;</b>
<b class="nc">&nbsp;            this.improved = improved;</b>
&nbsp;        }
&nbsp;        
&nbsp;        public String getName() {
<b class="nc">&nbsp;            return internalName;</b>
&nbsp;        }
&nbsp;        
&nbsp;        public boolean isImproved() {
<b class="nc">&nbsp;            return improved;</b>
&nbsp;        }
&nbsp;        
&nbsp;        public static List&lt;EquipmentType&gt; allJJs() {
<b class="nc">&nbsp;            return Arrays.stream(values())</b>
<b class="nc">&nbsp;                    .map(jj -&gt; EquipmentType.get(jj.internalName))</b>
<b class="nc">&nbsp;                    .collect(Collectors.toList());</b>
&nbsp;        }
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * All the protomech armor options. Both of the them.
&nbsp;     *
&nbsp;     */
<b class="fc">&nbsp;    public static enum ProtomechArmor {</b>
<b class="fc">&nbsp;        STANDARD (EquipmentType.T_ARMOR_STANDARD, 0),</b>
<b class="fc">&nbsp;        EDP (EquipmentType.T_ARMOR_EDP, 1);</b>
&nbsp;
&nbsp;        private final int type;
&nbsp;        private final int torsoSlots;
&nbsp;
<b class="fc">&nbsp;        ProtomechArmor(int t, int slots) {</b>
<b class="fc">&nbsp;            type = t;</b>
<b class="fc">&nbsp;            torsoSlots = slots;</b>
<b class="fc">&nbsp;        }</b>
&nbsp;
&nbsp;        public static int armorCount() {
<b class="nc">&nbsp;            return values().length;</b>
&nbsp;        }
&nbsp;
&nbsp;        /**
&nbsp;         * Given a protomech, return the {@link ProtomechArmor} instance that
&nbsp;         * represents the type installed
&nbsp;         *
&nbsp;         * @param proto The protomech
&nbsp;         * @return      The {@link ProtomechArmor} that corresponds to the given type
&nbsp;         *              or null if no match was found.
&nbsp;         */
&nbsp;        public static @Nullable ProtomechArmor getArmor(Protomech proto) {
<b class="fc">&nbsp;            return getArmor(proto.getArmorType(Protomech.LOC_TORSO));</b>
&nbsp;        }
&nbsp;
&nbsp;        /**
&nbsp;         * Given an armor type, return the {@link ProtomechArmor} instance that
&nbsp;         * represents that type.
&nbsp;         *
&nbsp;         * @param t   The armor type.
&nbsp;         * @return    The {@link ProtomechArmor} that corresponds to the given type
&nbsp;         *            or null if no match was found.
&nbsp;         */
&nbsp;        public static @Nullable ProtomechArmor getArmor(int t) {
<b class="fc">&nbsp;            for (ProtomechArmor a : values()) {</b>
<b class="fc">&nbsp;                if (a.type == t) {</b>
<b class="fc">&nbsp;                    return a;</b>
&nbsp;                }
&nbsp;            }
<b class="fc">&nbsp;            return null;</b>
&nbsp;        }
&nbsp;
&nbsp;        /**
&nbsp;         * Given an armor type, return the {@link ProtomechArmor} instance that
&nbsp;         * represents that type.
&nbsp;         * @deprecated Use {@link #getArmor(int)} instead
&nbsp;
&nbsp;         * @param t   The armor type.
&nbsp;         * @param c   Whether the armor has a Clan tech base
&nbsp;         * @return    The {@link ProtomechArmor} that corresponds to the given type
&nbsp;         *            or null if no match was found.
&nbsp;         */
&nbsp;        @Deprecated
&nbsp;        public static @Nullable ProtomechArmor getArmor(int t, boolean c) {
<b class="nc">&nbsp;            return getArmor(t);</b>
&nbsp;        }
&nbsp;        
&nbsp;        /**
&nbsp;         * @return The {@link MiscType} for this armor.
&nbsp;         */
&nbsp;        public EquipmentType getArmorEqType() {
<b class="nc">&nbsp;            String name = EquipmentType.getArmorTypeName(type, true);</b>
<b class="nc">&nbsp;            return EquipmentType.get(name);</b>
&nbsp;        }
&nbsp;        
&nbsp;        public int getType() {
<b class="nc">&nbsp;            return type;</b>
&nbsp;        }
&nbsp;        
&nbsp;        public int getArmorTech() {
<b class="nc">&nbsp;            EquipmentType eq = getArmorEqType();</b>
<b class="nc">&nbsp;            return eq.getStaticTechLevel().getCompoundTechLevel(true);</b>
&nbsp;        }
&nbsp;        
&nbsp;        public int getTorsoSlots() {
<b class="fc">&nbsp;            return torsoSlots;</b>
&nbsp;        }
&nbsp;        
&nbsp;        public double getWtPerPoint() {
<b class="nc">&nbsp;            return EquipmentType.getProtomechArmorWeightPerPoint(type);</b>
&nbsp;        }
&nbsp;    }
&nbsp;    
&nbsp;    public static int maxJumpMP(Protomech proto) {
<b class="fc">&nbsp;        if (proto.getMisc().stream().map(Mounted::getType)</b>
<b class="fc">&nbsp;                .anyMatch(eq -&gt; eq.hasFlag(MiscType.F_JUMP_JET)</b>
<b class="nc">&nbsp;                        &amp;&amp; eq.hasSubType(MiscType.S_IMPROVED))) {</b>
<b class="nc">&nbsp;            return (int) Math.ceil(proto.getOriginalWalkMP() * 1.5);</b>
&nbsp;        }
<b class="fc">&nbsp;        return proto.getOriginalWalkMP();</b>
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;
&nbsp;    /**
&nbsp;     * Filters all protomech armor according to given tech constraints
&nbsp;     * 
&nbsp;     * @param techManager
&nbsp;     * @return A list of all armors that meet the tech constraints
&nbsp;     */
&nbsp;    public static List&lt;EquipmentType&gt; legalArmorsFor(ITechManager techManager) {
<b class="nc">&nbsp;        List&lt;EquipmentType&gt; retVal = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        for (ProtomechArmor armor : ProtomechArmor.values()) {</b>
<b class="nc">&nbsp;            final EquipmentType eq = armor.getArmorEqType();</b>
<b class="nc">&nbsp;            if ((null != eq) &amp;&amp; techManager.isLegal(eq)) {</b>
<b class="nc">&nbsp;                retVal.add(eq);</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        return retVal;</b>
&nbsp;    }
&nbsp;        
&nbsp;    private final Protomech proto;
&nbsp;    private final String fileString;
&nbsp;
&nbsp;    public TestProtomech(Protomech proto, TestEntityOption option, String fileString) {
<b class="fc">&nbsp;        super(option, proto.getEngine(), getArmor(proto), null);</b>
<b class="fc">&nbsp;        this.proto = proto;</b>
<b class="fc">&nbsp;        this.fileString = fileString;</b>
<b class="fc">&nbsp;    }</b>
&nbsp;
&nbsp;    private static Armor[] getArmor(Protomech proto) {
<b class="fc">&nbsp;        Armor[] armor = new Armor[proto.locations()];</b>
<b class="fc">&nbsp;        for (int i = 0; i &lt; proto.locations(); i++) {</b>
<b class="fc">&nbsp;            int type = proto.getArmorType(i);</b>
<b class="fc">&nbsp;            int flag = 0;</b>
<b class="fc">&nbsp;            if (proto.isClanArmor(i)) {</b>
<b class="nc">&nbsp;                flag |= Armor.CLAN_ARMOR;</b>
&nbsp;            }
<b class="fc">&nbsp;            armor[i] = new Armor(type, flag);</b>
&nbsp;        }
<b class="fc">&nbsp;        return armor;</b>
&nbsp;    }
&nbsp;    
&nbsp;    @Override
&nbsp;    public Entity getEntity() {
<b class="fc">&nbsp;        return proto;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean isTank() {
<b class="nc">&nbsp;        return false;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean isMech() {
<b class="nc">&nbsp;        return false;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean isAero() {
<b class="nc">&nbsp;        return false;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean isSmallCraft() {
<b class="nc">&nbsp;        return false;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean isAdvancedAerospace() {
<b class="nc">&nbsp;        return false;</b>
&nbsp;    }
&nbsp;    
&nbsp;    @Override
&nbsp;    public boolean isProtomech() {
<b class="nc">&nbsp;        return true;</b>
&nbsp;    }
&nbsp;    
&nbsp;    @Override
&nbsp;    public double getWeightStructure() {
<b class="fc">&nbsp;        return round(proto.getWeight() * 0.1, Ceil.KILO);</b>
&nbsp;    }
&nbsp;    
&nbsp;    @Override
&nbsp;    public double getWeightEngine() {
<b class="fc">&nbsp;        return proto.getEngine().getWeightEngine(proto);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public double getWeightControls() {
<b class="fc">&nbsp;        return (proto.getWeight() &gt; MAX_STD_TONNAGE)? 0.75 : 0.5;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public double getWeightMisc() {
<b class="fc">&nbsp;        return 0;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public double getWeightHeatSinks() {
<b class="fc">&nbsp;        return getCountHeatSinks() * 0.25;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean hasDoubleHeatSinks() {
<b class="nc">&nbsp;        return false;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public int getCountHeatSinks() {
<b class="fc">&nbsp;        return heatNeutralHSRequirement();</b>
&nbsp;    }
&nbsp;    
&nbsp;    @Override
&nbsp;    public double calculateWeight() {
&nbsp;        // Deal with some floating point precision issues
<b class="fc">&nbsp;        return round(super.calculateWeight(), Ceil.KILO);</b>
&nbsp;    }
&nbsp;    
&nbsp;    @Override
&nbsp;    public double getWeightAllocatedArmor() {
<b class="nc">&nbsp;        ProtomechArmor armor = ProtomechArmor.getArmor(proto);</b>
<b class="nc">&nbsp;        double wtPerPoint = 0.0;</b>
<b class="nc">&nbsp;        if (null != armor) {</b>
<b class="nc">&nbsp;            wtPerPoint = armor.getWtPerPoint();</b>
&nbsp;        }
<b class="nc">&nbsp;        return proto.getTotalArmor() * wtPerPoint;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public String printWeightStructure() {
<b class="nc">&nbsp;        return StringUtil.makeLength(</b>
&nbsp;                &quot;Structure: &quot;
<b class="nc">&nbsp;                        + Integer.toString(getEntity().getTotalOInternal()), getPrintSize() - 5)</b>
<b class="nc">&nbsp;                + TestEntity.makeWeightString(getWeightStructure(), true) + &quot;\n&quot;;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public String printWeightMisc() {
<b class="nc">&nbsp;        return &quot;&quot;;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public String printWeightControls() {
<b class="nc">&nbsp;        StringBuffer retVal = new StringBuffer(StringUtil.makeLength(</b>
<b class="nc">&nbsp;                &quot;Controls:&quot;, getPrintSize() - 5));</b>
<b class="nc">&nbsp;        retVal.append(makeWeightString(getWeightControls(), true));</b>
<b class="nc">&nbsp;        retVal.append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;        return retVal.toString();</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public StringBuffer printMiscEquip(StringBuffer buff, int posLoc,
&nbsp;            int posWeight) {
<b class="nc">&nbsp;        for (Mounted m : getEntity().getMisc()) {</b>
<b class="nc">&nbsp;            MiscType mt = (MiscType) m.getType();</b>
&nbsp;
<b class="nc">&nbsp;            buff.append(StringUtil.makeLength(m.getName(), 20));</b>
<b class="nc">&nbsp;            buff.append(</b>
<b class="nc">&nbsp;                    StringUtil.makeLength(getLocationAbbr(m.getLocation()),</b>
<b class="nc">&nbsp;                            getPrintSize() - 5 - 20)).append(</b>
<b class="nc">&nbsp;                    TestEntity.makeWeightString(round(m.getTonnage(), Ceil.KILO), true));</b>
<b class="nc">&nbsp;            buff.append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;        return buff;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public StringBuffer printWeapon(StringBuffer buff, int posLoc, int posWeight) {
<b class="nc">&nbsp;        for (Mounted m : getEntity().getWeaponList()) {</b>
<b class="nc">&nbsp;            WeaponType mt = (WeaponType) m.getType();</b>
&nbsp;
<b class="nc">&nbsp;            buff.append(StringUtil.makeLength(m.getName(), 20));</b>
<b class="nc">&nbsp;            buff.append(</b>
<b class="nc">&nbsp;                    StringUtil.makeLength(getLocationAbbr(m.getLocation()),</b>
<b class="nc">&nbsp;                            getPrintSize() - 5 - 20))</b>
<b class="nc">&nbsp;                    .append(TestEntity.makeWeightString(m.getTonnage(), true)).append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;        return buff;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public StringBuffer printAmmo(StringBuffer buff, int posLoc, int posWeight) {
<b class="nc">&nbsp;        for (Mounted m : getEntity().getAmmo()) {</b>
<b class="nc">&nbsp;            AmmoType mt = (AmmoType) m.getType();</b>
&nbsp;
<b class="nc">&nbsp;            buff.append(StringUtil.makeLength(mt.getName(), 20));</b>
<b class="nc">&nbsp;            buff.append(&quot; &quot;).append(</b>
<b class="nc">&nbsp;                    StringUtil.makeLength(getLocationAbbr(m.getLocation()),</b>
<b class="nc">&nbsp;                            getPrintSize() - 5 - 20))</b>
<b class="nc">&nbsp;                    .append(TestEntity.makeWeightString(</b>
<b class="nc">&nbsp;                            Math.ceil(mt.getKgPerShot() * m.getBaseShotsLeft()) / 1000.0, true)).append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;        return buff;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public double getWeightCarryingSpace() {
<b class="fc">&nbsp;        return 0.0;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean correctEntity(StringBuffer buff) {
<b class="nc">&nbsp;        return correctEntity(buff, getEntity().getTechLevel());</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean correctEntity(StringBuffer buff, int ammoTechLvl) {
<b class="nc">&nbsp;        boolean correct = true;</b>
<b class="nc">&nbsp;        if (skip()) {</b>
<b class="nc">&nbsp;            return correct;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (!correctWeight(buff)) {</b>
<b class="nc">&nbsp;            buff.insert(0, printTechLevel() + printShortMovement());</b>
<b class="nc">&nbsp;            buff.append(printWeightCalculation());</b>
<b class="nc">&nbsp;            correct = false;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (!engine.engineValid) {</b>
<b class="nc">&nbsp;            buff.append(engine.problem.toString()).append(&quot;\n\n&quot;);</b>
<b class="nc">&nbsp;            correct = false;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (showCorrectArmor() &amp;&amp; !correctArmor(buff)) {</b>
<b class="nc">&nbsp;            correct = false;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (showFailedEquip() &amp;&amp; hasFailedEquipment(buff)) {</b>
<b class="nc">&nbsp;            correct = false;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (hasIllegalTechLevels(buff, ammoTechLvl)) {</b>
<b class="nc">&nbsp;            correct = false;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (showIncorrectIntroYear() &amp;&amp; hasIncorrectIntroYear(buff)) {</b>
<b class="nc">&nbsp;            correct = false;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (hasIllegalEquipmentCombinations(buff)) {</b>
<b class="nc">&nbsp;            correct = false;</b>
&nbsp;        }
<b class="nc">&nbsp;        correct = correct &amp;&amp; correctMovement(buff);</b>
<b class="nc">&nbsp;        return correct;</b>
&nbsp;    }
&nbsp;    
&nbsp;    @Override
&nbsp;    public boolean correctWeight(StringBuffer buff) {
<b class="fc">&nbsp;        boolean correct = super.correctWeight(buff);</b>
<b class="fc">&nbsp;        if (proto.getWeight() &gt; MAX_TONNAGE) {</b>
<b class="fc">&nbsp;            buff.append(&quot;Exceeds maximum weight of &quot;).append(MAX_TONNAGE).append(&quot;\n&quot;);</b>
<b class="fc">&nbsp;            correct = false;</b>
&nbsp;        }
<b class="fc">&nbsp;        return correct;</b>
&nbsp;    }
&nbsp;    
&nbsp;    @Override
&nbsp;    public boolean hasIllegalEquipmentCombinations(StringBuffer buff) {
<b class="fc">&nbsp;        boolean illegal = false;</b>
<b class="fc">&nbsp;        Map&lt;Integer, Integer&gt; slotsByLoc = new HashMap&lt;&gt;();</b>
<b class="fc">&nbsp;        Map&lt;Integer, Double&gt; weightByLoc = new HashMap&lt;&gt;();</b>
<b class="fc">&nbsp;        int meleeWeapons = 0;</b>
<b class="fc">&nbsp;        for (Mounted mount : proto.getEquipment()) {</b>
<b class="fc">&nbsp;            if (!requiresSlot(mount.getType())) {</b>
<b class="nc">&nbsp;                continue;</b>
&nbsp;            }
<b class="fc">&nbsp;            slotsByLoc.merge(mount.getLocation(), 1, Integer::sum);</b>
<b class="fc">&nbsp;            weightByLoc.merge(mount.getLocation(), mount.getTonnage(), Double::sum);</b>
<b class="fc">&nbsp;            if (mount.isRearMounted() &amp;&amp; (mount.getLocation() != Protomech.LOC_TORSO)) {</b>
<b class="fc">&nbsp;                buff.append(&quot;Equipment can only be rear-mounted on the torso\n&quot;);</b>
<b class="fc">&nbsp;                illegal = true;</b>
&nbsp;            }
<b class="fc">&nbsp;            if ((mount.getType() instanceof WeaponType)</b>
<b class="fc">&nbsp;                    &amp;&amp; !mount.getType().hasFlag(WeaponType.F_PROTO_WEAPON)) {</b>
<b class="nc">&nbsp;                buff.append(mount.toString()).append(&quot; is not a legal protomech weapon.\n&quot;);</b>
<b class="nc">&nbsp;                illegal = true;</b>
<b class="fc">&nbsp;            } else if ((mount.getType() instanceof MiscType)</b>
<b class="nc">&nbsp;                    &amp;&amp; !mount.getType().hasFlag(MiscType.F_PROTOMECH_EQUIPMENT)) {</b>
<b class="nc">&nbsp;                buff.append(mount.toString()).append(&quot; is not legal protomech equipment.\n&quot;);</b>
<b class="nc">&nbsp;                illegal = true;</b>
&nbsp;            }
<b class="fc">&nbsp;            if ((mount.getType() instanceof MiscType) &amp;&amp; mount.getType().hasFlag(MiscType.F_MAGNETIC_CLAMP)) {</b>
<b class="nc">&nbsp;                if (proto.isGlider() || proto.isQuad()) {</b>
<b class="nc">&nbsp;                    buff.append(&quot;Quad and glider protomechs cannot use a magnetic clamp system.\n&quot;);</b>
<b class="nc">&nbsp;                    illegal = true;</b>
&nbsp;                }
&nbsp;            }
<b class="fc">&nbsp;            if ((mount.getType() instanceof MiscType) &amp;&amp; mount.getType().hasFlag(MiscType.F_PROTOMECH_MELEE)) {</b>
<b class="nc">&nbsp;                meleeWeapons++;</b>
<b class="nc">&nbsp;                if (meleeWeapons == 2) {</b>
<b class="nc">&nbsp;                    buff.append(&quot;Cannot mount multiple melee weapons.\n&quot;);</b>
<b class="nc">&nbsp;                    illegal = true;</b>
&nbsp;                }
<b class="nc">&nbsp;                if (mount.getType().hasSubType(MiscType.S_PROTO_QMS) &amp;&amp; !proto.isQuad()) {</b>
<b class="nc">&nbsp;                    buff.append(mount.getType().getName() + &quot;can only be used by quad protomechs.\n&quot;);</b>
<b class="nc">&nbsp;                    illegal = true;</b>
&nbsp;                }
<b class="nc">&nbsp;                if (mount.getType().hasSubType(MiscType.S_PROTOMECH_WEAPON) &amp;&amp; proto.isQuad()) {</b>
<b class="nc">&nbsp;                    buff.append(mount.getType().getName() + &quot;cannot be used by quad protomechs.\n&quot;);</b>
<b class="nc">&nbsp;                    illegal = true;</b>
&nbsp;                }
&nbsp;            }
<b class="fc">&nbsp;        }</b>
<b class="fc">&nbsp;        ProtomechArmor armor = ProtomechArmor.getArmor(proto);</b>
<b class="fc">&nbsp;        if (null == armor) {</b>
<b class="fc">&nbsp;            buff.append(&quot;Does not have legal armor type.\n&quot;);</b>
<b class="fc">&nbsp;            illegal = true;</b>
&nbsp;        } else {
<b class="fc">&nbsp;            slotsByLoc.merge(Protomech.LOC_TORSO, armor.getTorsoSlots(), Integer::sum);</b>
&nbsp;        }
<b class="fc">&nbsp;        for (int loc = 0; loc &lt; proto.locations(); loc++) {</b>
<b class="fc">&nbsp;            if (slotsByLoc.getOrDefault(loc, 0) &gt; maxSlotsByLocation(loc, proto)) {</b>
<b class="fc">&nbsp;                buff.append(&quot;Exceeds &quot;).append(maxSlotsByLocation(loc, proto))</b>
<b class="fc">&nbsp;                    .append(&quot; slot limit in &quot;).append(proto.getLocationName(loc)).append(&quot;\n&quot;);</b>
<b class="fc">&nbsp;                illegal = true;</b>
&nbsp;            }
<b class="fc">&nbsp;            if (weightByLoc.getOrDefault(loc, 0.0) &gt; maxWeightByLocation(loc, proto)) {</b>
<b class="fc">&nbsp;                buff.append(&quot;Exceeds &quot;).append(maxWeightByLocation(loc, proto) * 1000)</b>
<b class="fc">&nbsp;                    .append(&quot; kg limit in &quot;).append(proto.getLocationName(loc)).append(&quot;\n&quot;);</b>
<b class="fc">&nbsp;                illegal = true;</b>
&nbsp;            }
&nbsp;        }
<b class="fc">&nbsp;        if (proto.isGlider() &amp;&amp; proto.isQuad()) {</b>
<b class="fc">&nbsp;            buff.append(&quot;Glider protomechs cannot be quads.\n&quot;);</b>
<b class="fc">&nbsp;            illegal = true;</b>
&nbsp;        }
&nbsp;        
<b class="fc">&nbsp;        return illegal;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * @param protomech  The Protomech
&nbsp;     * @param eq         The equipment
&nbsp;     * @param location   A location index on the Entity
&nbsp;     * @param buffer    If non-null and the location is invalid, will be appended with an explanation
&nbsp;     * @return           Whether the equipment can be mounted in the location on the Protomech
&nbsp;     */
&nbsp;    public static boolean isValidProtomechLocation(Protomech protomech, EquipmentType eq, int location,
&nbsp;                                                   @Nullable StringBuffer buffer) {
<b class="nc">&nbsp;        if (eq instanceof MiscType) {</b>
<b class="nc">&nbsp;            if (eq.hasFlag(MiscType.F_PROTOMECH_MELEE) &amp;&amp; eq.hasSubType(MiscType.S_PROTOMECH_WEAPON)</b>
&nbsp;                    &amp;&amp; (location != Protomech.LOC_LARM) &amp;&amp; (location != Protomech.LOC_RARM)) {
<b class="nc">&nbsp;                if (buffer != null) {</b>
<b class="nc">&nbsp;                    buffer.append(eq.getName()).append(&quot; must be mounted in an arm.\n&quot;);</b>
&nbsp;                }
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
<b class="nc">&nbsp;            if ((eq.hasFlag(MiscType.F_MAGNETIC_CLAMP)</b>
<b class="nc">&nbsp;                    || (eq.hasFlag(MiscType.F_PROTOMECH_MELEE) &amp;&amp; eq.hasSubType(MiscType.S_PROTO_QMS)))</b>
&nbsp;                    &amp;&amp; (location != Protomech.LOC_TORSO)) {
<b class="nc">&nbsp;                if (buffer != null) {</b>
<b class="nc">&nbsp;                    buffer.append(eq.getName()).append(&quot; must be mounted in the torso.\n&quot;);</b>
&nbsp;                }
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        if (!TestProtomech.eqRequiresLocation(protomech, eq) &amp;&amp; (location != Protomech.LOC_BODY)) {</b>
<b class="nc">&nbsp;            if (buffer != null) {</b>
<b class="nc">&nbsp;                buffer.append(eq.getName()).append(&quot; must be mounted in the body.\n&quot;);</b>
&nbsp;            }
<b class="nc">&nbsp;            return false;</b>
<b class="nc">&nbsp;        } else if (TestProtomech.maxSlotsByLocation(location, protomech) == 0) {</b>
<b class="nc">&nbsp;            if (buffer != null) {</b>
<b class="nc">&nbsp;                buffer.append(eq.getName()).append(&quot; cannot be mounted in the &quot;)</b>
<b class="nc">&nbsp;                        .append(protomech.getLocationName(location)).append(&quot;\n&quot;);</b>
&nbsp;            }
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
<b class="nc">&nbsp;        return true;</b>
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * Checks for exceeding the maximum number of armor points by location for the tonnage.
&nbsp;     * 
&nbsp;     * @param buffer  A string buffer for appending error messages.
&nbsp;     * @return        Whether the number of armor points is legal
&nbsp;     */
&nbsp;    public boolean correctArmor(StringBuffer buffer) {
<b class="fc">&nbsp;        boolean correct = true;</b>
<b class="fc">&nbsp;        for (int loc = 0; loc &lt; proto.locations(); loc++) {</b>
<b class="fc">&nbsp;            if (proto.getOArmor(loc) &gt; maxArmorFactor(proto, loc)) {</b>
<b class="fc">&nbsp;                buffer.append(proto.getLocationAbbr(loc))</b>
<b class="fc">&nbsp;                    .append(&quot; exceeds maximum of &quot;)</b>
<b class="fc">&nbsp;                    .append(maxArmorFactor(proto, loc)).append(&quot; armor points.\n&quot;);</b>
<b class="fc">&nbsp;                correct = false;</b>
&nbsp;            }
&nbsp;        }
<b class="fc">&nbsp;        return correct;</b>
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * Checks whether the protomech meets the minimum MP requirements for the configuration.
&nbsp;     * 
&nbsp;     * @param buffer A buffer for error messages
&nbsp;     * @return       Whether the MP is legal.
&nbsp;     */
&nbsp;    public boolean correctMovement(StringBuffer buffer) {
<b class="fc">&nbsp;        boolean correct = true;</b>
<b class="fc">&nbsp;        if (proto.isGlider()</b>
<b class="fc">&nbsp;                &amp;&amp; proto.getOriginalWalkMP() &lt; GLIDER_MIN_MP) {</b>
<b class="fc">&nbsp;            buffer.append(&quot;Glider protomechs have a minimum cruising MP of &quot; + GLIDER_MIN_MP + &quot;.\n&quot;);</b>
<b class="fc">&nbsp;            correct = false;</b>
<b class="fc">&nbsp;        } else if (proto.isQuad()</b>
<b class="fc">&nbsp;                &amp;&amp; proto.getOriginalWalkMP() &lt; QUAD_MIN_MP) {</b>
<b class="fc">&nbsp;            buffer.append(&quot;Quad protomechs have a minimum walk MP of &quot; + QUAD_MIN_MP + &quot;.\n&quot;);</b>
<b class="fc">&nbsp;            correct = false;</b>
&nbsp;        }
<b class="fc">&nbsp;        int maxJump = maxJumpMP(proto);</b>
<b class="fc">&nbsp;        if (proto.getOriginalJumpMP() &gt; maxJump) {</b>
<b class="nc">&nbsp;            buffer.append(&quot;Exceeds maximum jump MP.\n&quot;);</b>
<b class="nc">&nbsp;            correct = false;</b>
&nbsp;        }
<b class="fc">&nbsp;        if (proto.getAllUMUCount() &gt; maxJump) { </b>
<b class="nc">&nbsp;            buffer.append(&quot;Exceeds maximum UMU MP.\n&quot;);</b>
<b class="nc">&nbsp;            correct = false;</b>
&nbsp;        }
<b class="fc">&nbsp;        return correct;</b>
&nbsp;    }
&nbsp;    
&nbsp;
&nbsp;    @Override
&nbsp;    public StringBuffer printEntity() {
<b class="nc">&nbsp;        StringBuffer buff = new StringBuffer();</b>
<b class="nc">&nbsp;        buff.append(&quot;Protomech: &quot;).append(proto.getDisplayName()).append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;        buff.append(&quot;Found in: &quot;).append(fileString).append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;        buff.append(printTechLevel());</b>
<b class="nc">&nbsp;        buff.append(&quot;Intro year: &quot;).append(proto.getYear()).append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;        buff.append(printSource());</b>
<b class="nc">&nbsp;        buff.append(printShortMovement());</b>
<b class="nc">&nbsp;        if (correctWeight(buff, true, true)) {</b>
<b class="nc">&nbsp;            buff.append(&quot;Weight: &quot;).append(getWeight() * 1000).append(&quot; kg (&quot;)</b>
<b class="nc">&nbsp;                    .append(calculateWeight() * 1000).append(&quot; kg)\n&quot;);</b>
&nbsp;        }
<b class="nc">&nbsp;        buff.append(printWeightCalculation()).append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;        buff.append(printArmorPlacement());</b>
<b class="nc">&nbsp;        correctArmor(buff);</b>
<b class="nc">&nbsp;        buff.append(printLocations());</b>
<b class="nc">&nbsp;        printFailedEquipment(buff);</b>
<b class="nc">&nbsp;        return buff;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public String getName() {
<b class="nc">&nbsp;        return &quot;Protomech: &quot; + proto.getDisplayName();</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public double getWeightAmmo() {
<b class="fc">&nbsp;        double weight = 0.0;</b>
<b class="fc">&nbsp;        for (Mounted m : getEntity().getAmmo()) {</b>
<b class="nc">&nbsp;            if (!m.isOneShotAmmo()) {</b>
<b class="nc">&nbsp;                AmmoType mt = (AmmoType) m.getType();</b>
<b class="nc">&nbsp;                weight += ceil(mt.getKgPerShot() * m.getBaseShotsLeft() / 1000, Ceil.KILO);</b>
&nbsp;            }
<b class="nc">&nbsp;        }</b>
<b class="fc">&nbsp;        return weight;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public double getWeightPowerAmp() {
<b class="fc">&nbsp;        return 0;</b>
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * Determine the minimum walk MP for the protomech based on configuration
&nbsp;     * 
&nbsp;     * @param proto The protomech
&nbsp;     * @return      The minimum walk MP
&nbsp;     */
&nbsp;    public int getMinimumWalkMP(Protomech proto) {
<b class="nc">&nbsp;        if (proto.isGlider()) {</b>
<b class="nc">&nbsp;            return 4;</b>
<b class="nc">&nbsp;        } else if (proto.isQuad()) {</b>
<b class="nc">&nbsp;            return 3;</b>
&nbsp;        } else {
<b class="nc">&nbsp;            return 1;</b>
&nbsp;        }
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * Computes the required engine rating
&nbsp;     * 
&nbsp;     * @param proto The protomech
&nbsp;     * @return      The engine rating required for the weight, speed, and configuration
&nbsp;     */
&nbsp;    public static int calcEngineRating(Protomech proto) {
<b class="fc">&nbsp;        return calcEngineRating(proto.getOriginalWalkMP(),</b>
<b class="fc">&nbsp;                proto.getWeight(), proto.isQuad() || proto.isGlider());</b>
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * Computes the required engine rating
&nbsp;     * 
&nbsp;     * @param walkMP The base walking MP
&nbsp;     * @param tonnage The weight of the protomech in tons
&nbsp;     * @param quadOrGlider Whether the protomech is a quad or glider configuration
&nbsp;     * @return      The engine rating required for the weight, speed, and configuration
&nbsp;     */
&nbsp;    public static int calcEngineRating(int walkMP, double tonnage, boolean quadOrGlider) {
<b class="fc">&nbsp;        int moveFactor = (int) Math.ceil(walkMP * 1.5);</b>
&nbsp;        // More efficient engine use for gliders and quads
<b class="fc">&nbsp;        if (quadOrGlider) {</b>
<b class="fc">&nbsp;            moveFactor -= 2;</b>
&nbsp;        }
<b class="fc">&nbsp;        return Math.max(1, (int)(moveFactor * tonnage));</b>
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * Determines whether a piece of equipment counts toward the slot and weight limits of a location.
&nbsp;     * 
&nbsp;     * @param etype The equipment
&nbsp;     * @return      Whether the equipment takes a slot.
&nbsp;     */
&nbsp;    public static boolean requiresSlot(EquipmentType etype) {
<b class="fc">&nbsp;        if (etype instanceof AmmoType) {</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
<b class="fc">&nbsp;        if (etype instanceof MiscType) {</b>
<b class="nc">&nbsp;            return !(etype.hasFlag(MiscType.F_MASC)</b>
<b class="nc">&nbsp;                || etype.hasFlag(MiscType.F_UMU)</b>
<b class="nc">&nbsp;                || etype.hasFlag(MiscType.F_JUMP_JET));</b>
&nbsp;        }
<b class="fc">&nbsp;        return true;</b>
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * Equipment slot limit by location
&nbsp;     * 
&nbsp;     * @param loc   The Protomech location
&nbsp;     * @param proto The Protomech
&nbsp;     * @return      The number of equipment slots in the location
&nbsp;     */
&nbsp;    public static int maxSlotsByLocation(int loc, Protomech proto) {
<b class="fc">&nbsp;        return maxSlotsByLocation(loc, proto.isQuad(), proto.getWeight() &gt; MAX_STD_TONNAGE);</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Equipment slot limit by location
&nbsp;     * 
&nbsp;     * @param loc   The Protomech location
&nbsp;     * @param quad  Whether the protomech is a quad
&nbsp;     * @param ultra Whether the protomech is ultraheavy
&nbsp;     * @return      The number of equipment slots in the location
&nbsp;     */
&nbsp;    public static int maxSlotsByLocation(int loc, boolean quad, boolean ultra) {
<b class="fc">&nbsp;        switch(loc) {</b>
&nbsp;            case Protomech.LOC_TORSO: {
<b class="fc">&nbsp;                int slots = 2;</b>
<b class="fc">&nbsp;                if (ultra) {</b>
<b class="nc">&nbsp;                    slots++;</b>
&nbsp;                }
<b class="fc">&nbsp;                if (quad) {</b>
<b class="fc">&nbsp;                    slots += slots;</b>
&nbsp;                }
<b class="fc">&nbsp;                return slots;</b>
&nbsp;            }
&nbsp;            case Protomech.LOC_LARM:
&nbsp;            case Protomech.LOC_RARM:
<b class="fc">&nbsp;                return quad? 0 : 1;</b>
&nbsp;            case Protomech.LOC_MAINGUN:
<b class="fc">&nbsp;                return (quad &amp;&amp; ultra)? 2 : 1;</b>
&nbsp;            case Protomech.LOC_HEAD:
&nbsp;            case Protomech.LOC_LEG:
&nbsp;            default:
<b class="fc">&nbsp;                return 0;</b>
&nbsp;        }
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * The maximum total weight that can be mounted in a given location.
&nbsp;     * 
&nbsp;     * @param loc   The Protomech location
&nbsp;     * @param proto The Protomech
&nbsp;     * @return      The weight limit for that location, in tons.
&nbsp;     */
&nbsp;    public static double maxWeightByLocation(int loc, Protomech proto) {
<b class="fc">&nbsp;        return maxWeightByLocation(loc, proto.isQuad(), proto.getWeight() &gt; MAX_STD_TONNAGE);</b>
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * The maximum total weight that can be mounted in a given location.
&nbsp;     * 
&nbsp;     * @param loc   The Protomech location
&nbsp;     * @param quad  Whether the protomech is a quad
&nbsp;     * @param ultra Whether the protomech is ultraheavy
&nbsp;     * @return      The weight limit for that location, in tons.
&nbsp;     */
&nbsp;    public static double maxWeightByLocation(int loc, boolean quad, boolean ultra) {
<b class="fc">&nbsp;        switch(loc) {</b>
&nbsp;            case Protomech.LOC_TORSO:
<b class="fc">&nbsp;                if (quad) {</b>
<b class="fc">&nbsp;                    return ultra? 8.0 : 5.0;</b>
&nbsp;                } else {
<b class="fc">&nbsp;                    return ultra? 4.0 : 2.0;</b>
&nbsp;                }
&nbsp;            case Protomech.LOC_LARM:
&nbsp;            case Protomech.LOC_RARM:
<b class="fc">&nbsp;                if (quad) {</b>
<b class="fc">&nbsp;                    return 0;</b>
&nbsp;                }
<b class="fc">&nbsp;                return ultra? 1.0 : 0.5;</b>
&nbsp;            case Protomech.LOC_MAINGUN:
<b class="fc">&nbsp;                return Double.MAX_VALUE;</b>
&nbsp;            case Protomech.LOC_HEAD:
&nbsp;            case Protomech.LOC_LEG:
&nbsp;            default:
<b class="fc">&nbsp;                return 0.0;</b>
&nbsp;        }
&nbsp;    }
&nbsp;    
<b class="fc">&nbsp;    private static final int MAX_ARMOR_FACTOR[] = { 15, 17, 22, 24, 33, 35, 40, 42, 51, 53, 58, 60, 65, 67 };</b>
&nbsp;    
&nbsp;    /**
&nbsp;     * Calculate the maximum armor factor based on weight and whether there is a main gun location
&nbsp;     * 
&nbsp;     * @param proto   The protomech
&nbsp;     * @return        The maximum total number of armor points
&nbsp;     */
&nbsp;    public static int maxArmorFactor(Protomech proto) {
<b class="nc">&nbsp;        return maxArmorFactor(proto.getWeight(), proto.hasMainGun());</b>
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * Calculate the maximum armor factor based on weight and whether there is a main gun location
&nbsp;     * 
&nbsp;     * @param weight  The weight of the protomech in tons
&nbsp;     * @param mainGun Whether the protomech has a main gun location
&nbsp;     * @return        The maximum total number of armor points
&nbsp;     */
&nbsp;    public static int maxArmorFactor(double weight, boolean mainGun) {
<b class="fc">&nbsp;        final int weightIndex = Math.max(0, (int) weight - 2);</b>
<b class="fc">&nbsp;        int base = MAX_ARMOR_FACTOR[Math.min(weightIndex, MAX_ARMOR_FACTOR.length - 1)];</b>
<b class="fc">&nbsp;        if (mainGun) {</b>
<b class="fc">&nbsp;            return base + ((weight &gt; MAX_STD_TONNAGE)? 6 : 3);</b>
&nbsp;        }
<b class="fc">&nbsp;        return base;</b>
&nbsp;    }
&nbsp;    /**
&nbsp;     * Determine the maximum amount of armor in a location based on unit weight.
&nbsp;     * 
&nbsp;     * @param proto   The protomech
&nbsp;     * @param location The location index
&nbsp;     * @return        The maximum total number of armor points
&nbsp;     */
&nbsp;    public static int maxArmorFactor(Protomech proto, int location) {
<b class="fc">&nbsp;        if (location == Protomech.LOC_HEAD) {</b>
<b class="fc">&nbsp;            return 2 + (int) proto.getWeight() / 2;</b>
<b class="fc">&nbsp;        } else if (location == Protomech.LOC_MAINGUN) {</b>
<b class="fc">&nbsp;            if (proto.hasMainGun()) {</b>
<b class="nc">&nbsp;                return proto.getOInternal(location) * 3;</b>
&nbsp;            } else {
<b class="fc">&nbsp;                return 0;</b>
&nbsp;            }
<b class="fc">&nbsp;        } else if ((location == Protomech.LOC_LARM)</b>
&nbsp;                || (location == Protomech.LOC_RARM)) {
<b class="fc">&nbsp;            if (proto.isQuad()) {</b>
<b class="nc">&nbsp;                return 0;</b>
<b class="fc">&nbsp;            } else if (proto.getWeight() &lt; 3) {</b>
<b class="nc">&nbsp;                return 2;</b>
<b class="fc">&nbsp;            } else if (proto.getWeight() &lt; 10) {</b>
<b class="fc">&nbsp;                return 4;</b>
&nbsp;            } else {
<b class="nc">&nbsp;                return 6;</b>
&nbsp;            }
<b class="fc">&nbsp;        } else if (location == Protomech.LOC_BODY) {</b>
<b class="fc">&nbsp;            return 0;</b>
<b class="fc">&nbsp;        } else if (proto.isQuad()) {</b>
<b class="nc">&nbsp;            switch ((int) proto.getWeight()) {</b>
&nbsp;                case 3:
<b class="nc">&nbsp;                    return 12;</b>
&nbsp;                case 4:
&nbsp;                case 5:
<b class="nc">&nbsp;                    return 14;</b>
&nbsp;                // else drop through
&nbsp;            }
&nbsp;        }
<b class="fc">&nbsp;        return proto.getOInternal(location) * 2;</b>
&nbsp;    }
&nbsp;    
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2023-05-16 16:28</div>
</div>
</body>
</html>
