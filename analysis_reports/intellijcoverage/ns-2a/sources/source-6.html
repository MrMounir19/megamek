


<!DOCTYPE html>
<html id="htmlId">
<head>
  <title>Coverage Report > TestAdvancedAerospace</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">megamek.common.verifier</a>
</div>

<h1>Coverage Summary for Class: TestAdvancedAerospace (megamek.common.verifier)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">TestAdvancedAerospace</td>
<td class="coverageStat">
  <span class="percent">
    3.1%
  </span>
  <span class="absValue">
    (2/64)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    3.9%
  </span>
  <span class="absValue">
    (22/564)
  </span>
</td>
</tr>
  <tr>
    <td class="name">TestAdvancedAerospace$CapitalArmor</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/40)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    2.9%
  </span>
  <span class="absValue">
    (2/69)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    3.6%
  </span>
  <span class="absValue">
    (22/604)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;/*
&nbsp; * MegaMek -
&nbsp; * Copyright (C) 2018 - The MegaMek Team
&nbsp; *
&nbsp; *  This program is free software; you can redistribute it and/or modify it
&nbsp; *  under the terms of the GNU General Public License as published by the Free
&nbsp; *  Software Foundation; either version 2 of the License, or (at your option)
&nbsp; *  any later version.
&nbsp; *
&nbsp; *  This program is distributed in the hope that it will be useful, but
&nbsp; *  WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
&nbsp; *  or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License
&nbsp; *  for more details.
&nbsp; */
&nbsp;package megamek.common.verifier;
&nbsp;
&nbsp;import java.math.BigInteger;
&nbsp;import java.util.*;
&nbsp;
&nbsp;import megamek.common.*;
&nbsp;import megamek.common.util.StringUtil;
&nbsp;import megamek.common.weapons.bayweapons.BayWeapon;
&nbsp;import megamek.common.weapons.capitalweapons.ScreenLauncherWeapon;
&nbsp;
&nbsp;/**
&nbsp; * Validation and construction data for advanced aerospace units (jumpships, warships, space stations)
&nbsp; * 
&nbsp; * @author Neoancient
&nbsp; *
&nbsp; */
&nbsp;public class TestAdvancedAerospace extends TestAero {
&nbsp;    
&nbsp;    private final Jumpship vessel;
&nbsp;
<b class="nc">&nbsp;    public enum CapitalArmor{</b>
<b class="nc">&nbsp;        PRIMITIVE(EquipmentType.T_ARMOR_PRIMITIVE_AERO, false),   </b>
<b class="nc">&nbsp;        STANDARD(EquipmentType.T_ARMOR_AEROSPACE, false),   </b>
<b class="nc">&nbsp;        CLAN_STANDARD(EquipmentType.T_ARMOR_AEROSPACE, true),</b>
<b class="nc">&nbsp;        IS_IMP_FERRO_ALUM(EquipmentType.T_ARMOR_LC_FERRO_IMP, false),</b>
<b class="nc">&nbsp;        CLAN_IMP_FERRO_ALUM(EquipmentType.T_ARMOR_LC_FERRO_IMP, true),</b>
<b class="nc">&nbsp;        IS_FERRO_CARBIDE(EquipmentType.T_ARMOR_LC_FERRO_CARBIDE, false),</b>
<b class="nc">&nbsp;        CLAN_FERRO_CARBIDE(EquipmentType.T_ARMOR_LC_FERRO_CARBIDE, true),</b>
<b class="nc">&nbsp;        IS_LAMELLOR(EquipmentType.T_ARMOR_LC_LAMELLOR_FERRO_CARBIDE, false),</b>
<b class="nc">&nbsp;        CLAN_LAMELLOR(EquipmentType.T_ARMOR_LC_LAMELLOR_FERRO_CARBIDE, true);</b>
&nbsp;
&nbsp;        /**
&nbsp;         * The type, corresponding to types defined in 
&nbsp;         * &lt;code&gt;EquipmentType&lt;/code&gt;.
&nbsp;         */
&nbsp;        public int type;
&nbsp;                
&nbsp;        /**
&nbsp;         * Denotes whether this armor is Clan or not.
&nbsp;         */
&nbsp;        public boolean isClan;
&nbsp;        
<b class="nc">&nbsp;        CapitalArmor(int t, boolean c){</b>
<b class="nc">&nbsp;            type = t;</b>
<b class="nc">&nbsp;            isClan = c;</b>
&nbsp;        }
&nbsp;        
&nbsp;        /**
&nbsp;         * Given an armor type, return the &lt;code&gt;AerospaceArmor&lt;/code&gt; instance that
&nbsp;         * represents that type.
&nbsp;         * 
&nbsp;         * @param t  The armor type.
&nbsp;         * @param c  Whether this armor type is Clan or not.
&nbsp;         * @return   The &lt;code&gt;AeroArmor&lt;/code&gt; that corresponds to the given 
&nbsp;         *              type or null if no match was found.
&nbsp;         */
&nbsp;        public static CapitalArmor getArmor(int t, boolean c){
<b class="nc">&nbsp;            for (CapitalArmor a : values()){</b>
<b class="nc">&nbsp;                if (a.type == t &amp;&amp; a.isClan == c){</b>
<b class="nc">&nbsp;                    return a;</b>
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            return null;</b>
&nbsp;        }
&nbsp;        
&nbsp;        /**
&nbsp;         * Calculates and returns the points per ton of the armor type given the
&nbsp;         * weight of the ship. 
&nbsp;         * 
&nbsp;         * @param vessel The ship
&nbsp;         * @return       The number of points of capital armor per ton
&nbsp;         */
&nbsp;        public double pointsPerTon(Jumpship vessel) {
<b class="nc">&nbsp;            double ppt = 0.8;</b>
<b class="nc">&nbsp;            if (type == EquipmentType.T_ARMOR_LC_FERRO_IMP) {</b>
<b class="nc">&nbsp;                ppt += 0.2;</b>
<b class="nc">&nbsp;            } else if (type == EquipmentType.T_ARMOR_LC_FERRO_CARBIDE) {</b>
<b class="nc">&nbsp;                ppt += 0.4;</b>
<b class="nc">&nbsp;            } else if (type == EquipmentType.T_ARMOR_LC_LAMELLOR_FERRO_CARBIDE) {</b>
<b class="nc">&nbsp;                ppt += 0.6;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (vessel.getWeight() &gt;= 250000) {</b>
<b class="nc">&nbsp;                ppt -= 0.4;</b>
<b class="nc">&nbsp;                if (isClan) {</b>
<b class="nc">&nbsp;                    ppt += 0.1;</b>
&nbsp;                }
<b class="nc">&nbsp;            } else if (vessel.getWeight() &gt;= 150000) {</b>
<b class="nc">&nbsp;                ppt -= 0.2;</b>
<b class="nc">&nbsp;                if (isClan) {</b>
<b class="nc">&nbsp;                    ppt += 0.1;</b>
&nbsp;                }
<b class="nc">&nbsp;            } else if (isClan) {</b>
<b class="nc">&nbsp;                ppt += 0.2;</b>
&nbsp;            }
&nbsp;            // Deal with potential rounding errors
<b class="nc">&nbsp;            ppt = Math.round(ppt * 10.0) / 10.0;</b>
<b class="nc">&nbsp;            if (type == EquipmentType.T_ARMOR_PRIMITIVE_AERO) {</b>
<b class="nc">&nbsp;                ppt *= EquipmentType.armorPointMultipliers[EquipmentType.T_ARMOR_PRIMITIVE_AERO];</b>
&nbsp;            }
<b class="nc">&nbsp;            return ppt;</b>
&nbsp;        }
&nbsp;        
&nbsp;        /**
&nbsp;         * @return The &lt;code&gt;MiscType&lt;/code&gt; for this armor.
&nbsp;         */
&nbsp;        public EquipmentType getArmorEqType() {
<b class="nc">&nbsp;            String name = EquipmentType.getArmorTypeName(type, isClan);</b>
<b class="nc">&nbsp;            return EquipmentType.get(name);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Filters all capital armor according to given tech constraints
&nbsp;     * 
&nbsp;     * @param techManager Constraints used to filter the possible armor types
&nbsp;     * @return A list of all armors that meet the tech constraints
&nbsp;     */
&nbsp;    public static List&lt;EquipmentType&gt; legalArmorsFor(ITechManager techManager, boolean primitive) {
<b class="nc">&nbsp;        if (primitive) {</b>
<b class="nc">&nbsp;            return Collections.singletonList(CapitalArmor.PRIMITIVE.getArmorEqType());</b>
&nbsp;        }
<b class="nc">&nbsp;        List&lt;EquipmentType&gt; retVal = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        for (CapitalArmor armor : CapitalArmor.values()) {</b>
<b class="nc">&nbsp;            final EquipmentType eq = armor.getArmorEqType();</b>
<b class="nc">&nbsp;            if ((null != eq) &amp;&amp; techManager.isLegal(eq)) {</b>
<b class="nc">&nbsp;                retVal.add(eq);</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        return retVal;</b>
&nbsp;    }
&nbsp;    
&nbsp;    public static int maxArmorPoints(Jumpship vessel) {
<b class="nc">&nbsp;        CapitalArmor a = CapitalArmor.getArmor(vessel.getArmorType(0),</b>
<b class="nc">&nbsp;                TechConstants.isClan(vessel.getArmorTechLevel(0)));</b>
<b class="nc">&nbsp;        if (null == a) {</b>
<b class="nc">&nbsp;            return 0;</b>
&nbsp;        }
&nbsp;        // The ship gets a number of armor points equal to 10% of the SI, rounded normally, per facing.
<b class="nc">&nbsp;        double freeSI = Math.round(vessel.get0SI() / 10.0) * 6;</b>
&nbsp;        // Primitive jumpships multiply the armor by a factor of 0.66. Per errata, the armor is calculated
&nbsp;        // based on standard armor then rounded down, and the free SI armor is rounded down separately.
<b class="nc">&nbsp;        if (vessel.isPrimitive()) {</b>
<b class="nc">&nbsp;            return (int) (Math.floor(CapitalArmor.STANDARD.pointsPerTon(vessel)</b>
<b class="nc">&nbsp;                    * maxArmorWeight(vessel) * 0.66)</b>
<b class="nc">&nbsp;                + Math.floor(freeSI * 0.66));</b>
&nbsp;        }
<b class="nc">&nbsp;        return (int) Math.floor(a.pointsPerTon(vessel) * maxArmorWeight(vessel) + freeSI);</b>
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     *  Computes the maximum number armor level in tons
&nbsp;     *   
&nbsp;     */
&nbsp;    public static double maxArmorWeight(Jumpship vessel){
&nbsp;        // max armor tonnage is based on SI weight
<b class="nc">&nbsp;        if (vessel.hasETypeFlag(Entity.ETYPE_WARSHIP)) {</b>
&nbsp;            // SI weight (SI/1000) / 50
<b class="nc">&nbsp;            return floor(vessel.get0SI() * vessel.getWeight() / 50000.0, Ceil.HALFTON);</b>
<b class="nc">&nbsp;        } else if (vessel.hasETypeFlag(Entity.ETYPE_SPACE_STATION)) {</b>
&nbsp;            // SI weight (SI/100) / 3 + 60
<b class="nc">&nbsp;            return floor(vessel.get0SI() * vessel.getWeight() / 300.0 + 60, Ceil.HALFTON);</b>
&nbsp;        } else {
&nbsp;            // SI weight (SI/150) / 12
<b class="nc">&nbsp;            return floor(vessel.get0SI() * vessel.getWeight() / 1800.0, Ceil.HALFTON);</b>
&nbsp;        }
&nbsp;    }
&nbsp;    
&nbsp;    public static double armorPointsPerTon(Jumpship vessel, int at, boolean clan) {
<b class="nc">&nbsp;        CapitalArmor arm = CapitalArmor.getArmor(at, clan);</b>
<b class="nc">&nbsp;        if (null != arm) {</b>
<b class="nc">&nbsp;            return arm.pointsPerTon(vessel);</b>
&nbsp;        } else {
<b class="nc">&nbsp;            return 0;</b>
&nbsp;        }
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * Computes the amount of weight required for fire control systems and power distribution
&nbsp;     * systems for exceeding the base limit of weapons per firing arc.
&nbsp;     * 
&nbsp;     * @param vessel The advanced aerospace unit in question
&nbsp;     * @return   Returns a &lt;code&gt;double&lt;/code&gt; array, where each element corresponds to a 
&nbsp;     *           location and the value is the extra tonnage required by exceeding the base
&nbsp;     *           allotment
&nbsp;     */
&nbsp;    public static double[] extraSlotCost(Jumpship vessel) {
<b class="nc">&nbsp;        int slotsPerArc = 12;</b>
<b class="nc">&nbsp;        int arcs = vessel.locations();</b>
<b class="nc">&nbsp;        if (vessel.hasETypeFlag(Entity.ETYPE_WARSHIP)) {</b>
<b class="nc">&nbsp;            slotsPerArc = 20;</b>
<b class="nc">&nbsp;        } else if (vessel.hasETypeFlag(Entity.ETYPE_SPACE_STATION)) {</b>
<b class="nc">&nbsp;            slotsPerArc = 20;</b>
&nbsp;        }
<b class="nc">&nbsp;        int weaponsPerArc[] = new int[arcs];</b>
<b class="nc">&nbsp;        double weaponTonnage[] = new double[arcs];</b>
<b class="nc">&nbsp;        boolean hasNC3 = vessel.hasWorkingMisc(MiscType.F_NAVAL_C3);</b>
&nbsp;
<b class="nc">&nbsp;        for (Mounted m : vessel.getEquipment()) {</b>
<b class="nc">&nbsp;            if (usesWeaponSlot(vessel, m.getType())) {</b>
<b class="nc">&nbsp;                int arc = m.getLocation();</b>
<b class="nc">&nbsp;                if (arc &lt; 0) {</b>
<b class="nc">&nbsp;                    continue;</b>
&nbsp;                }
<b class="nc">&nbsp;                if ((m.getType() instanceof WeaponType)</b>
<b class="nc">&nbsp;                        &amp;&amp; m.getType().hasFlag(WeaponType.F_MASS_DRIVER)) {</b>
<b class="nc">&nbsp;                    weaponsPerArc[arc] += 10;</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    weaponsPerArc[arc]++;</b>
&nbsp;                }
<b class="nc">&nbsp;                weaponTonnage[arc] += m.getTonnage();</b>
&nbsp;            }
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;        double[] retVal = new double[arcs];</b>
<b class="nc">&nbsp;        for (int arc = 0; arc &lt; arcs; arc++) {</b>
<b class="nc">&nbsp;            int excess = (weaponsPerArc[arc] - 1) / slotsPerArc;</b>
<b class="nc">&nbsp;            if (excess &gt; 0) {</b>
<b class="nc">&nbsp;                retVal[arc] = ceil(excess * weaponTonnage[arc] / 10.0, Ceil.HALFTON);</b>
&nbsp;            }
<b class="nc">&nbsp;            if (hasNC3) {</b>
<b class="nc">&nbsp;                retVal[arc] *= 2;</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        return retVal;</b>
&nbsp;    }
&nbsp;    
&nbsp;    public static int getMinTonnage(Jumpship vessel) {
<b class="nc">&nbsp;        switch (vessel.getDriveCoreType()) {</b>
&nbsp;            case Jumpship.DRIVE_CORE_COMPACT:
<b class="nc">&nbsp;                return 100000;</b>
&nbsp;            case Jumpship.DRIVE_CORE_SUBCOMPACT:
<b class="nc">&nbsp;                return 5000;</b>
&nbsp;            case Jumpship.DRIVE_CORE_NONE:
<b class="nc">&nbsp;                return 2000;</b>
&nbsp;            case Jumpship.DRIVE_CORE_STANDARD:
&nbsp;            case Jumpship.DRIVE_CORE_PRIMITIVE:
&nbsp;            default:
<b class="nc">&nbsp;                return 50000;</b>
&nbsp;        }
&nbsp;    }
&nbsp;    
&nbsp;    public static int getWeightIncrement(Jumpship vessel) {
<b class="nc">&nbsp;        switch (vessel.getDriveCoreType()) {</b>
&nbsp;            case Jumpship.DRIVE_CORE_COMPACT:
<b class="nc">&nbsp;                return 10000;</b>
&nbsp;            case Jumpship.DRIVE_CORE_SUBCOMPACT:
<b class="nc">&nbsp;                return 100;</b>
&nbsp;            case Jumpship.DRIVE_CORE_NONE:
<b class="nc">&nbsp;                return 500;</b>
&nbsp;            case Jumpship.DRIVE_CORE_STANDARD:
&nbsp;            case Jumpship.DRIVE_CORE_PRIMITIVE:
&nbsp;            default:
<b class="nc">&nbsp;                return 1000;</b>
&nbsp;        }
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * Computes the weight of the engine.
&nbsp;     * 
&nbsp;     * @param vessel  The ship
&nbsp;     * @return        The weight of the engine in tons
&nbsp;     */
&nbsp;    public static double calculateEngineTonnage(Jumpship vessel) {
<b class="nc">&nbsp;        if (vessel.hasStationKeepingDrive()) {</b>
<b class="nc">&nbsp;            return round(vessel.getWeight() * 0.012, Ceil.HALFTON);</b>
<b class="nc">&nbsp;        } else if (vessel.isPrimitive()) {</b>
<b class="nc">&nbsp;            return round(vessel.getWeight() * vessel.getOriginalWalkMP()</b>
<b class="nc">&nbsp;                    * primitiveEngineMultiplier(vessel.getOriginalBuildYear()), Ceil.HALFTON);</b>
&nbsp;        } else {
<b class="nc">&nbsp;            return round(vessel.getWeight() * vessel.getOriginalWalkMP() * 0.06, Ceil.HALFTON);</b>
&nbsp;        }
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * @param year The original construction year of the jumpship chassis
&nbsp;     * @return     The engine weight multiplier for the primitive jumpship.
&nbsp;     */
&nbsp;    public static double primitiveEngineMultiplier(int year) {
<b class="nc">&nbsp;        if (year &gt;= 2300) {</b>
<b class="nc">&nbsp;            return 0.06;</b>
<b class="nc">&nbsp;        } else if (year &gt;= 2251) {</b>
<b class="nc">&nbsp;            return 0.066;</b>
<b class="nc">&nbsp;        } else if (year &gt;= 2201) {</b>
<b class="nc">&nbsp;            return 0.084;</b>
<b class="nc">&nbsp;        } else if (year &gt;= 2151) {</b>
<b class="nc">&nbsp;            return 0.102;</b>
&nbsp;        } else {
<b class="nc">&nbsp;            return 0.12;</b>
&nbsp;        }
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * @param vessel An advanced aerospace unit
&nbsp;     * @return       The number of heat sinks that are accounted for in the engine weight.
&nbsp;     */
&nbsp;    public static int weightFreeHeatSinks(Jumpship vessel) {
<b class="nc">&nbsp;        return (int) Math.floor(45 + Math.sqrt(calculateEngineTonnage(vessel)</b>
<b class="nc">&nbsp;                * (vessel.isPrimitive()?  1 : 2)));</b>
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * The maximum number of docking hardpoints (collars) depends on the tonnage of the vessel. Naval
&nbsp;     * Repair Facilities and Dropshuttle bays count against the total and reduce the maximum number
&nbsp;     * by two each.
&nbsp;     * 
&nbsp;     * @param vessel The ship
&nbsp;     * @return       The maximum number of docking hardpoints (collars) that can be mounted on the ship.
&nbsp;     */
&nbsp;    public static int getMaxDockingHardpoints(Jumpship vessel) {
&nbsp;        // minimum of 50ktons
<b class="nc">&nbsp;        if (vessel.getWeight() &lt; 50000) {</b>
<b class="nc">&nbsp;            return 0;</b>
&nbsp;        }
<b class="nc">&nbsp;        int max = (int) Math.ceil(vessel.getWeight() / 50000);</b>
<b class="nc">&nbsp;        for (Bay bay : vessel.getTransportBays()) {</b>
<b class="nc">&nbsp;            max -= bay.hardpointCost();</b>
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;        return Math.max(max, 0);</b>
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * @param vessel The ship
&nbsp;     * @return       The maximum number of gravity decks that can be mounted on the ship.
&nbsp;     */
&nbsp;    public static int getMaxGravDecks(Jumpship vessel) {
<b class="nc">&nbsp;        return 3 + (int) Math.ceil(vessel.getWeight() / 100000);</b>
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * @param vessel The ship
&nbsp;     * @return       The maximum diameter (in meters) for a grav deck mounted on the unit.
&nbsp;     */
&nbsp;    public static int getMaxGravDeckDiameter(Jumpship vessel) {
&nbsp;        // TacOps, p. 314 says that space stations can mount grav decks up to 1500 m, but the
&nbsp;        // weight breakdown gives the largest category as 250-1000 m. I went with the larger
&nbsp;        // size here.
<b class="nc">&nbsp;        if (vessel.hasETypeFlag(Entity.ETYPE_SPACE_STATION)) {</b>
<b class="nc">&nbsp;            return 1500;</b>
&nbsp;        }
<b class="nc">&nbsp;        return 250;</b>
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * @return Minimum crew requirements based on unit type and equipment crew requirements.
&nbsp;     */
&nbsp;    public static int minimumBaseCrew(Jumpship vessel) {
&nbsp;        int crew;
<b class="nc">&nbsp;        if (vessel.hasETypeFlag(Entity.ETYPE_WARSHIP)</b>
<b class="nc">&nbsp;                || vessel.hasETypeFlag(Entity.ETYPE_SPACE_STATION)) {</b>
<b class="nc">&nbsp;            crew = 45 + (int) Math.ceil(vessel.getWeight() / 5000);</b>
&nbsp;        } else {
<b class="nc">&nbsp;            crew = 6 + (int) Math.ceil(vessel.getWeight() / 20000);</b>
&nbsp;        }
<b class="nc">&nbsp;        for (Mounted m : vessel.getMisc()) {</b>
<b class="nc">&nbsp;            crew += equipmentCrewRequirements(m);</b>
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;        return crew;</b>
&nbsp;    }
&nbsp;        
&nbsp;    /**
&nbsp;     * One gunner is required for each capital weapon and each six standard scale weapons, rounding up
&nbsp;     * @return The vessel&#39;s minimum gunner requirements.
&nbsp;     */
&nbsp;    public static int requiredGunners(Jumpship vessel) {
<b class="nc">&nbsp;        int capitalWeapons = 0;</b>
<b class="nc">&nbsp;        int stdWeapons = 0;</b>
<b class="nc">&nbsp;        for (Mounted m : vessel.getTotalWeaponList()) {</b>
<b class="nc">&nbsp;            if ((m.getType() instanceof BayWeapon)</b>
<b class="nc">&nbsp;                    || (((WeaponType)m.getType()).getLongRange() &lt;= 1)) {</b>
<b class="nc">&nbsp;                continue;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (m.getType().hasFlag(WeaponType.F_MASS_DRIVER)) {</b>
<b class="nc">&nbsp;                capitalWeapons += 10;</b>
<b class="nc">&nbsp;            } else if (((WeaponType)m.getType()).isCapital()</b>
<b class="nc">&nbsp;                    || (m.getType() instanceof ScreenLauncherWeapon)) {</b>
<b class="nc">&nbsp;                capitalWeapons++;</b>
&nbsp;            } else {
<b class="nc">&nbsp;                stdWeapons++;</b>
&nbsp;            }
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;        return capitalWeapons + (int)Math.ceil(stdWeapons / 6.0);</b>
&nbsp;    }
&nbsp;    
&nbsp;    public TestAdvancedAerospace(Jumpship vessel, TestEntityOption option, String fs) {
<b class="fc">&nbsp;        super(vessel, option, fs);</b>
&nbsp;        
<b class="fc">&nbsp;        this.vessel = vessel;</b>
<b class="fc">&nbsp;    }</b>
&nbsp;
&nbsp;    @Override
&nbsp;    public Entity getEntity() {
<b class="nc">&nbsp;        return vessel;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean isTank() {
<b class="nc">&nbsp;        return false;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean isMech() {
<b class="nc">&nbsp;        return false;</b>
&nbsp;    }
&nbsp;    
&nbsp;    @Override
&nbsp;    public boolean isAero() {
<b class="nc">&nbsp;        return true;</b>
&nbsp;    }
&nbsp;    
&nbsp;    @Override
&nbsp;    public boolean isSmallCraft() {
<b class="nc">&nbsp;        return false;</b>
&nbsp;    }
&nbsp;    
&nbsp;    @Override
&nbsp;    public boolean isAdvancedAerospace() {
<b class="nc">&nbsp;        return true;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public double getWeightControls() {
<b class="nc">&nbsp;        if (vessel.isPrimitive()) {</b>
<b class="nc">&nbsp;            return ceil(vessel.getWeight()</b>
<b class="nc">&nbsp;                    * primitiveControlMultiplier(vessel.getOriginalBuildYear()), Ceil.TON);</b>
<b class="nc">&nbsp;        } else if (vessel.hasETypeFlag(Entity.ETYPE_SPACE_STATION)) {</b>
<b class="nc">&nbsp;            return ceil(vessel.getWeight() * 0.001, Ceil.TON);</b>
&nbsp;        } else {
<b class="nc">&nbsp;            return ceil(vessel.getWeight() * 0.0025, Ceil.TON);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * @param year The original construction year of the jumpship chassis
&nbsp;     * @return     The control weight multiplier for the primitive jumpship.
&nbsp;     */
&nbsp;    public static double primitiveControlMultiplier(int year) {
<b class="nc">&nbsp;        if (year &gt;= 2300) {</b>
<b class="nc">&nbsp;            return 0.0025;</b>
<b class="nc">&nbsp;        } else if (year &gt;= 2251) {</b>
<b class="nc">&nbsp;            return 0.00275;</b>
<b class="nc">&nbsp;        } else if (year &gt;= 2201) {</b>
<b class="nc">&nbsp;            return 0.0035;</b>
<b class="nc">&nbsp;        } else if (year &gt;= 2151) {</b>
<b class="nc">&nbsp;            return 0.005;</b>
&nbsp;        } else {
<b class="nc">&nbsp;            return 0.00625;</b>
&nbsp;        }
&nbsp;    }
&nbsp;    
&nbsp;    @Override
&nbsp;    public double getWeightEngine() {
<b class="nc">&nbsp;        return calculateEngineTonnage(vessel);</b>
&nbsp;    }
&nbsp;    
&nbsp;    @Override
&nbsp;    public String printWeightEngine() {
<b class="nc">&nbsp;        return StringUtil.makeLength(&quot;Engine: &quot;, getPrintSize() - 5)</b>
<b class="nc">&nbsp;                + TestEntity.makeWeightString(getWeightEngine()) + &quot;\n&quot;;</b>
&nbsp;    }
&nbsp;    
&nbsp;    public double getWeightKFDrive() {
<b class="nc">&nbsp;        return vessel.getJumpDriveWeight();</b>
&nbsp;    }
&nbsp;
&nbsp;    public String printWeightKFDrive() {
<b class="nc">&nbsp;        return StringUtil.makeLength(&quot;K/F Drive Core: &quot;, getPrintSize() - 5)</b>
<b class="nc">&nbsp;                + TestEntity.makeWeightString(getWeightKFDrive()) + &quot;\n&quot;;</b>
&nbsp;    }
&nbsp;    
&nbsp;    public double getWeightSail() {
<b class="nc">&nbsp;        if (!vessel.hasSail()) {</b>
<b class="nc">&nbsp;            return 0;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (vessel.isPrimitive()) {</b>
<b class="nc">&nbsp;            if (vessel.getOriginalBuildYear() &lt; 2230) {</b>
<b class="nc">&nbsp;                return Math.ceil(vessel.getWeight() / 2000) + 300;</b>
<b class="nc">&nbsp;            } else if (vessel.getOriginalBuildYear() &lt; 2260) {</b>
<b class="nc">&nbsp;                return Math.ceil(vessel.getWeight() / 4000) + 150;</b>
<b class="nc">&nbsp;            } else if (vessel.getOriginalBuildYear() &lt; 2300) {</b>
<b class="nc">&nbsp;                return Math.ceil(vessel.getWeight() / 8000) + 75;</b>
&nbsp;            } else {
<b class="nc">&nbsp;                return Math.ceil(vessel.getWeight() / 20000) + 30;</b>
&nbsp;            }
<b class="nc">&nbsp;        } else if (vessel.hasETypeFlag(Entity.ETYPE_WARSHIP)) {</b>
<b class="nc">&nbsp;            return Math.ceil(vessel.getWeight() / 20000) + 30;</b>
&nbsp;        } else {
&nbsp;            // Space stations with energy collection sail use jumpship formula.
<b class="nc">&nbsp;            return Math.ceil(vessel.getWeight() / 7500) + 30;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    public String printWeightSail() {
<b class="nc">&nbsp;        return StringUtil.makeLength(&quot;Jump Sail: &quot;, getPrintSize() - 5)</b>
<b class="nc">&nbsp;                + TestEntity.makeWeightString(getWeightSail()) + &quot;\n&quot;;</b>
&nbsp;    }
&nbsp;    
&nbsp;    @Override
&nbsp;    public double getWeightFuel() {
&nbsp;        // Fuel tanks and pumps add an additional 2%, rounded to the nearest ton
<b class="nc">&nbsp;        double pumpWeight = RoundWeight.nextTon(vessel.getFuelTonnage() * 0.02);</b>
<b class="nc">&nbsp;        return vessel.getFuelTonnage() + pumpWeight;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public int getCountHeatSinks() {
<b class="nc">&nbsp;        return vessel.getHeatSinks();</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public double getWeightHeatSinks() {
<b class="nc">&nbsp;        return Math.max(vessel.getHeatSinks() - weightFreeHeatSinks(vessel), 0);        </b>
&nbsp;    }
&nbsp;
&nbsp;    // Bays can store multiple tons of ammo in a single slot.
&nbsp;    @Override
&nbsp;    public double getWeightAmmo() {
<b class="nc">&nbsp;        double weight = 0.0;</b>
<b class="nc">&nbsp;        for (Mounted m : getEntity().getAmmo()) {</b>
&nbsp;
&nbsp;            // One Shot Ammo
<b class="nc">&nbsp;            if (m.getLocation() == Entity.LOC_NONE) {</b>
<b class="nc">&nbsp;                continue;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            AmmoType mt = (AmmoType) m.getType();</b>
<b class="nc">&nbsp;            int slots = (int) Math.ceil((double) m.getBaseShotsLeft() / mt.getShots());</b>
<b class="nc">&nbsp;            weight += ceil(m.getTonnage() * slots, Ceil.HALFTON);</b>
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;        return weight;</b>
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * @return The combined weight of grav decks mounted on the vessel
&nbsp;     */
&nbsp;    public double getWeightGravDecks() {
<b class="nc">&nbsp;        return vessel.getGravDeck() * 50</b>
<b class="nc">&nbsp;            + vessel.getGravDeckLarge() * 100</b>
<b class="nc">&nbsp;            + vessel.getGravDeckHuge() * 500;</b>
&nbsp;    }
&nbsp;    
&nbsp;    public String printWeightGravDecks() {
<b class="nc">&nbsp;        return StringUtil.makeLength(&quot;Gravity Decks: &quot;, getPrintSize() - 5)</b>
<b class="nc">&nbsp;                + TestEntity.makeWeightString(getWeightGravDecks()) + &quot;\n&quot;;</b>
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * @return The combined weight of all lifeboats and escape pods
&nbsp;     */
&nbsp;    public double getWeightLifeBoats() {
&nbsp;        // 7 tons each for life boats and escape pods, which includes the 5-ton vehicle and a
&nbsp;        // 2-ton launch mechanism
<b class="nc">&nbsp;        return (vessel.getLifeBoats() + vessel.getEscapePods()) * 7;</b>
&nbsp;    }
&nbsp;    
&nbsp;    public String printWeightLifeBoats() {
<b class="nc">&nbsp;        return StringUtil.makeLength(&quot;Life Boats/Escape Pods: &quot;, getPrintSize() - 5)</b>
<b class="nc">&nbsp;                + TestEntity.makeWeightString(getWeightLifeBoats()) + &quot;\n&quot;;</b>
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * 
&nbsp;     * @return Extra fire control system weight for exceeding base slot limit per firing arc
&nbsp;     */
&nbsp;    public double getWeightFireControl() {
<b class="nc">&nbsp;        double weight = 0.0;</b>
<b class="nc">&nbsp;        for (double extra : extraSlotCost(vessel)) {</b>
<b class="nc">&nbsp;            weight += extra;</b>
&nbsp;        }
<b class="nc">&nbsp;        return weight;</b>
&nbsp;    }
&nbsp;
&nbsp;    public String printWeightFireControl() {
<b class="nc">&nbsp;        return StringUtil.makeLength(&quot;Extra Fire Control: &quot;, getPrintSize() - 5)</b>
<b class="nc">&nbsp;                + TestEntity.makeWeightString(getWeightFireControl()) + &quot;\n&quot;;</b>
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * 
&nbsp;     * @return The weight of the lithium fusion battery (0 if not present).
&nbsp;     */
&nbsp;    public double getWeightLFBattery() {
<b class="nc">&nbsp;        if (vessel.hasLF()) {</b>
<b class="nc">&nbsp;            return vessel.getWeight() * 0.01;</b>
&nbsp;        }
<b class="nc">&nbsp;        return 0.0;</b>
&nbsp;    }
&nbsp;
&nbsp;    public String printWeightLFBattery() {
<b class="nc">&nbsp;        return StringUtil.makeLength(&quot;LF Battery: &quot;, getPrintSize() - 5)</b>
<b class="nc">&nbsp;                + TestEntity.makeWeightString(getWeightLFBattery()) + &quot;\n&quot;;</b>
&nbsp;    }
&nbsp;    
&nbsp;    public double getWeightHardpoints() {
<b class="nc">&nbsp;        return 1000 * vessel.getDockingCollars().size();</b>
&nbsp;    }
&nbsp;    
&nbsp;    public String printWeightHardpoints() {
<b class="nc">&nbsp;        return StringUtil.makeLength(&quot;Docking Hardpoints: &quot;, getPrintSize() - 5)</b>
<b class="nc">&nbsp;                + TestEntity.makeWeightString(getWeightHardpoints()) + &quot;\n&quot;;</b>
&nbsp;    }
&nbsp;    
&nbsp;    @Override
&nbsp;    public StringBuffer printWeapon() {
<b class="nc">&nbsp;        if (!getEntity().usesWeaponBays()) {</b>
<b class="nc">&nbsp;            return super.printWeapon();</b>
&nbsp;        }
<b class="nc">&nbsp;        StringBuffer buffer = new StringBuffer();</b>
<b class="nc">&nbsp;        for (Mounted m : getEntity().getWeaponBayList()) {</b>
<b class="nc">&nbsp;            buffer.append(m.getName()).append(&quot; &quot;)</b>
<b class="nc">&nbsp;                .append(getLocationAbbr(m.getLocation()));</b>
<b class="nc">&nbsp;            if (m.isRearMounted()) {</b>
<b class="nc">&nbsp;                buffer.append(&quot; (R)&quot;);</b>
&nbsp;            }
<b class="nc">&nbsp;            buffer.append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;            for (Integer wNum : m.getBayWeapons()) {</b>
<b class="nc">&nbsp;                final Mounted w = getEntity().getEquipment(wNum);</b>
<b class="nc">&nbsp;                buffer.append(&quot;   &quot;).append(StringUtil.makeLength(w.getName(),</b>
<b class="nc">&nbsp;                        getPrintSize() - 25)).append(w.getTonnage())</b>
<b class="nc">&nbsp;                    .append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;            for (Integer aNum : m.getBayAmmo()) {</b>
<b class="nc">&nbsp;                final Mounted a = getEntity().getEquipment(aNum);</b>
<b class="nc">&nbsp;                double weight = ceil(a.getTonnage()</b>
<b class="nc">&nbsp;                        * a.getBaseShotsLeft() / ((AmmoType)a.getType()).getShots(), Ceil.HALFTON);</b>
<b class="nc">&nbsp;                buffer.append(&quot;   &quot;).append(StringUtil.makeLength(a.getName(),</b>
<b class="nc">&nbsp;                        getPrintSize() - 25)).append(weight).append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;        return buffer;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public StringBuffer printAmmo() {
<b class="nc">&nbsp;        if (!vessel.usesWeaponBays()) {</b>
<b class="nc">&nbsp;            return super.printAmmo();</b>
&nbsp;        }
<b class="nc">&nbsp;        return new StringBuffer();</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean hasDoubleHeatSinks() {
<b class="nc">&nbsp;        return vessel.getHeatType() == Aero.HEAT_DOUBLE;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public String printWeightControls() {
<b class="nc">&nbsp;        StringBuffer retVal = new StringBuffer(StringUtil.makeLength(</b>
<b class="nc">&nbsp;                &quot;Control Systems:&quot;, getPrintSize() - 5));</b>
<b class="nc">&nbsp;        retVal.append(makeWeightString(getWeightControls()));</b>
<b class="nc">&nbsp;        retVal.append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;        return retVal.toString();</b>
&nbsp;    }
&nbsp;        
&nbsp;    @Override
&nbsp;    public String printWeightFuel() {
<b class="nc">&nbsp;        StringBuffer retVal = new StringBuffer(StringUtil.makeLength(</b>
<b class="nc">&nbsp;                &quot;Fuel: &quot;, getPrintSize() - 5));</b>
<b class="nc">&nbsp;        retVal.append(makeWeightString(getWeightFuel()));</b>
<b class="nc">&nbsp;        retVal.append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;        return retVal.toString();</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public Aero getAero() {
<b class="nc">&nbsp;        return vessel;</b>
&nbsp;    }
&nbsp;    
&nbsp;    public Jumpship getAdvancedAerospace() {
<b class="nc">&nbsp;        return vessel;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public String printArmorLocProp(int loc, int wert) {
<b class="nc">&nbsp;        return &quot; is greater than &quot; + Integer.toString(wert) + &quot;!&quot;;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Checks to see if this unit has valid armor assignment.
&nbsp;     * 
&nbsp;     * @param buff
&nbsp;     * @return
&nbsp;     */
&nbsp;    @Override
&nbsp;    public boolean correctArmor(StringBuffer buff) {
<b class="nc">&nbsp;        boolean correct = true;</b>
<b class="nc">&nbsp;        double maxArmor = maxArmorWeight(vessel);</b>
<b class="nc">&nbsp;        if (vessel.getLabArmorTonnage() &gt; maxArmor) {</b>
<b class="nc">&nbsp;            buff.append(&quot;Total armor, &quot;)</b>
<b class="nc">&nbsp;                    .append(vessel.getLabArmorTonnage())</b>
<b class="nc">&nbsp;                    .append(&quot; tons, is greater than the maximum: &quot;)</b>
<b class="nc">&nbsp;                    .append(maxArmor).append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;            correct = false;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return correct ;</b>
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * Checks that the heatsink type is a legal value.
&nbsp;     * 
&nbsp;     * @param buff
&nbsp;     * @return
&nbsp;     */
&nbsp;    @Override
&nbsp;    public boolean correctHeatSinks(StringBuffer buff) {
<b class="nc">&nbsp;        if ((vessel.getHeatType() != Aero.HEAT_SINGLE) </b>
<b class="nc">&nbsp;                &amp;&amp; (vessel.getHeatType() != Aero.HEAT_DOUBLE)) {</b>
<b class="nc">&nbsp;            buff.append(&quot;Invalid heatsink type!  Valid types are &quot;</b>
&nbsp;                    + Aero.HEAT_SINGLE + &quot; and &quot; + Aero.HEAT_DOUBLE
<b class="nc">&nbsp;                    + &quot;.  Found &quot; + vessel.getHeatType() + &quot;.&quot;);</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
<b class="nc">&nbsp;        return true;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean correctEntity(StringBuffer buff, int ammoTechLvl) {
<b class="nc">&nbsp;        boolean correct = true;</b>
&nbsp;        
<b class="nc">&nbsp;        if (skip()) {</b>
<b class="nc">&nbsp;            return true;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (!correctWeight(buff)) {</b>
<b class="nc">&nbsp;            buff.insert(0, printTechLevel() + printShortMovement());</b>
<b class="nc">&nbsp;            buff.append(printWeightCalculation());</b>
<b class="nc">&nbsp;            correct = false;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (getCountHeatSinks() &lt; weightFreeHeatSinks(vessel)) {</b>
<b class="nc">&nbsp;            buff.append(&quot;Heat Sinks:\n&quot;);</b>
<b class="nc">&nbsp;            buff.append(&quot; Total     &quot; + getCountHeatSinks() + &quot;\n&quot;);</b>
<b class="nc">&nbsp;            buff.append(&quot; Required  &quot; + weightFreeHeatSinks(vessel)</b>
&nbsp;                    + &quot;\n&quot;);
<b class="nc">&nbsp;            correct = false;</b>
&nbsp;        }                
&nbsp;        
<b class="nc">&nbsp;        if (showCorrectArmor() &amp;&amp; !correctArmor(buff)) {</b>
<b class="nc">&nbsp;            correct = false;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (showFailedEquip() &amp;&amp; hasFailedEquipment(buff)) {</b>
<b class="nc">&nbsp;            correct = false;</b>
&nbsp;        }
&nbsp;        
<b class="nc">&nbsp;        correct &amp;= !hasIllegalTechLevels(buff, ammoTechLvl);</b>
<b class="nc">&nbsp;        correct &amp;= !hasIllegalEquipmentCombinations(buff);</b>
<b class="nc">&nbsp;        correct &amp;= correctHeatSinks(buff);</b>
<b class="nc">&nbsp;        correct &amp;= correctCrew(buff);</b>
<b class="nc">&nbsp;        correct &amp;= correctGravDecks(buff);</b>
<b class="nc">&nbsp;        correct &amp;= correctBays(buff);</b>
<b class="nc">&nbsp;        correct &amp;= correctCriticals(buff);</b>
&nbsp;
<b class="nc">&nbsp;        return correct;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean hasIllegalEquipmentCombinations(StringBuffer buff) {
<b class="nc">&nbsp;        boolean illegal = false;</b>
&nbsp;        
&nbsp;        // Make sure all bays have at least one weapon and that there are at least
&nbsp;        // ten shots of ammo for each ammo-using weapon in the bay.
<b class="nc">&nbsp;        for (Mounted bay : vessel.getWeaponBayList()) {</b>
<b class="nc">&nbsp;            if (bay.getBayWeapons().size() == 0) {</b>
<b class="nc">&nbsp;                buff.append(&quot;Bay &quot;).append(bay.getName()).append(&quot; has no weapons\n&quot;);</b>
<b class="nc">&nbsp;                illegal = true;</b>
&nbsp;            }
<b class="nc">&nbsp;            Map&lt;Integer,Integer&gt; ammoWeaponCount = new HashMap&lt;&gt;();</b>
<b class="nc">&nbsp;            Map&lt;Integer,Integer&gt; ammoTypeCount = new HashMap&lt;&gt;();</b>
<b class="nc">&nbsp;            for (Integer wNum : bay.getBayWeapons()) {</b>
<b class="nc">&nbsp;                final Mounted w = vessel.getEquipment(wNum);</b>
<b class="nc">&nbsp;                if (w.isOneShotWeapon()) {</b>
<b class="nc">&nbsp;                    continue;</b>
&nbsp;                }
<b class="nc">&nbsp;                if (w.getType() instanceof WeaponType) {</b>
<b class="nc">&nbsp;                    ammoWeaponCount.merge(((WeaponType)w.getType()).getAmmoType(), 1, Integer::sum);</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    buff.append(w.getName()).append(&quot; in bay &quot;).append(bay.getName()).append(&quot; is not a weapon\n&quot;);</b>
<b class="nc">&nbsp;                    illegal = true;</b>
&nbsp;                }
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;            for (Integer aNum : bay.getBayAmmo()) {</b>
<b class="nc">&nbsp;                final Mounted a = vessel.getEquipment(aNum);</b>
<b class="nc">&nbsp;                if (a.getType() instanceof AmmoType) {</b>
<b class="nc">&nbsp;                    ammoTypeCount.merge(((AmmoType)a.getType()).getAmmoType(), a.getUsableShotsLeft(),</b>
&nbsp;                            Integer::sum);
&nbsp;                } else {
<b class="nc">&nbsp;                    buff.append(a.getName()).append(&quot; in bay &quot;).append(bay.getName()).append(&quot; is not ammo\n&quot;);</b>
<b class="nc">&nbsp;                    illegal = true;</b>
&nbsp;                }
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;            for (Integer at : ammoWeaponCount.keySet()) {</b>
<b class="nc">&nbsp;                if (at != AmmoType.T_NA) {</b>
<b class="nc">&nbsp;                    int needed = ammoWeaponCount.get(at) * 10;</b>
<b class="nc">&nbsp;                    if ((at == AmmoType.T_AC_ULTRA) || (at == AmmoType.T_AC_ULTRA_THB)) {</b>
<b class="nc">&nbsp;                        needed *= 2;</b>
<b class="nc">&nbsp;                    } else if ((at == AmmoType.T_AC_ROTARY)) {</b>
<b class="nc">&nbsp;                        needed *= 6;</b>
&nbsp;                    }
<b class="nc">&nbsp;                    if (!ammoTypeCount.containsKey(at)</b>
<b class="nc">&nbsp;                            || ammoTypeCount.get(at) &lt; needed) {</b>
<b class="nc">&nbsp;                        buff.append(&quot;Bay &quot;).append(bay.getName()).append(&quot; does not have the minimum 10 shots of ammo for each weapon\n&quot;);</b>
<b class="nc">&nbsp;                        illegal = true;</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    }
&nbsp;                }
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;            for (Integer at : ammoTypeCount.keySet()) {</b>
<b class="nc">&nbsp;                if (!ammoWeaponCount.containsKey(at)) {</b>
<b class="nc">&nbsp;                    buff.append(&quot;Bay &quot;).append(bay.getName()).append(&quot; has ammo for a weapon not in the bay\n&quot;);</b>
<b class="nc">&nbsp;                    illegal = true;</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                }
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;        }</b>
&nbsp;        
&nbsp;        // Count lateral weapons to make sure both sides match
<b class="nc">&nbsp;        Map&lt;EquipmentType,Integer&gt; leftFwd = new HashMap&lt;&gt;();</b>
<b class="nc">&nbsp;        Map&lt;EquipmentType,Integer&gt; leftAft = new HashMap&lt;&gt;();</b>
<b class="nc">&nbsp;        Map&lt;EquipmentType,Integer&gt; leftBroad = new HashMap&lt;&gt;();</b>
<b class="nc">&nbsp;        Map&lt;EquipmentType,Integer&gt; rightFwd = new HashMap&lt;&gt;();</b>
<b class="nc">&nbsp;        Map&lt;EquipmentType,Integer&gt; rightAft = new HashMap&lt;&gt;();</b>
<b class="nc">&nbsp;        Map&lt;EquipmentType,Integer&gt; rightBroad = new HashMap&lt;&gt;();</b>
<b class="nc">&nbsp;        Map&lt;Integer,Integer&gt; massDriversPerArc = new HashMap&lt;&gt;();</b>
&nbsp;        
<b class="nc">&nbsp;        BigInteger typeFlag = MiscType.F_JS_EQUIPMENT;</b>
<b class="nc">&nbsp;        if (vessel.hasETypeFlag(Entity.ETYPE_WARSHIP)) {</b>
<b class="nc">&nbsp;            typeFlag = MiscType.F_WS_EQUIPMENT;</b>
<b class="nc">&nbsp;        } else if (vessel.hasETypeFlag(Entity.ETYPE_SPACE_STATION)) {</b>
<b class="nc">&nbsp;            typeFlag = MiscType.F_SS_EQUIPMENT;</b>
&nbsp;        }
<b class="nc">&nbsp;        for (Mounted m : vessel.getEquipment()) {</b>
<b class="nc">&nbsp;            if (m.getType() instanceof MiscType) {</b>
<b class="nc">&nbsp;                if (!m.getType().hasFlag(typeFlag)) {</b>
<b class="nc">&nbsp;                    buff.append(&quot;Cannot mount &quot; + m.getType().getName() + &quot;\n&quot;);</b>
<b class="nc">&nbsp;                    illegal = true;</b>
&nbsp;                }
<b class="nc">&nbsp;            } else if (m.getType() instanceof WeaponType) {</b>
<b class="nc">&nbsp;                if (m.getType().hasFlag(WeaponType.F_MASS_DRIVER)</b>
<b class="nc">&nbsp;                        &amp;&amp; !vessel.hasETypeFlag(Entity.ETYPE_WARSHIP)</b>
<b class="nc">&nbsp;                        &amp;&amp; !vessel.hasETypeFlag(Entity.ETYPE_SPACE_STATION)) {</b>
<b class="nc">&nbsp;                    buff.append(&quot;A mass driver may not be mounted on a Jumpship.\n&quot;);</b>
<b class="nc">&nbsp;                    illegal = true;</b>
&nbsp;                }
<b class="nc">&nbsp;                switch (m.getLocation()) {</b>
&nbsp;                    case Jumpship.LOC_FLS:
<b class="nc">&nbsp;                        leftFwd.merge(m.getType(), 1, Integer::sum);</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    case Jumpship.LOC_FRS:
<b class="nc">&nbsp;                        rightFwd.merge(m.getType(), 1, Integer::sum);</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    case Jumpship.LOC_ALS:
<b class="nc">&nbsp;                        leftAft.merge(m.getType(), 1, Integer::sum);</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    case Jumpship.LOC_ARS:
<b class="nc">&nbsp;                        rightAft.merge(m.getType(), 1, Integer::sum);</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    case Warship.LOC_LBS:
<b class="nc">&nbsp;                        leftBroad.merge(m.getType(), 1, Integer::sum);</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    case Warship.LOC_RBS:
<b class="nc">&nbsp;                        rightBroad.merge(m.getType(), 1, Integer::sum);</b>
&nbsp;                        break;
&nbsp;                }
<b class="nc">&nbsp;                if (!isAeroWeapon(m.getType(), vessel)) {</b>
<b class="nc">&nbsp;                    buff.append(&quot;Cannot mount &quot; + m.getType().getName() + &quot;\n&quot;);</b>
<b class="nc">&nbsp;                    illegal = true;</b>
&nbsp;                }
<b class="nc">&nbsp;                if ((m.getType().hasFlag(WeaponType.F_MASS_DRIVER)</b>
<b class="nc">&nbsp;                        &amp;&amp; !(m.getType() instanceof BayWeapon))) {</b>
<b class="nc">&nbsp;                    massDriversPerArc.merge(m.getLocation(), 1, Integer::sum);</b>
<b class="nc">&nbsp;                    int at = ((WeaponType) m.getType()).getAmmoType();</b>
<b class="nc">&nbsp;                    if ((at == AmmoType.T_HMASS) &amp;&amp; vessel.getWeight() &lt; 2000000) {</b>
<b class="nc">&nbsp;                        buff.append(&quot;Minimum vessel tonnage for &quot;)</b>
<b class="nc">&nbsp;                            .append(m.getType().getName()).append(&quot; is 2,000,000 tons\n&quot;);</b>
<b class="nc">&nbsp;                        illegal = true;</b>
<b class="nc">&nbsp;                    } else if ((at == AmmoType.T_MMASS) &amp;&amp; vessel.getWeight() &lt; 1500000) {</b>
<b class="nc">&nbsp;                        buff.append(&quot;Minimum vessel tonnage for &quot;)</b>
<b class="nc">&nbsp;                            .append(m.getType().getName()).append(&quot; is 1,500,000 tons\n&quot;);</b>
<b class="nc">&nbsp;                        illegal = true;</b>
<b class="nc">&nbsp;                    } else if((at == AmmoType.T_LMASS) &amp;&amp; vessel.getWeight() &lt; 750000) {</b>
<b class="nc">&nbsp;                        buff.append(&quot;Minimum vessel tonnage for &quot;)</b>
<b class="nc">&nbsp;                            .append(m.getType().getName()).append(&quot; is 750,000 tons\n&quot;);</b>
<b class="nc">&nbsp;                        illegal = true;</b>
&nbsp;                    }
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;        boolean lateralMatch = true;</b>
&nbsp;        // Forward weapons
<b class="nc">&nbsp;        for (EquipmentType eq : leftFwd.keySet()) {</b>
<b class="nc">&nbsp;            if (!rightFwd.containsKey(eq) || !leftFwd.get(eq).equals(rightFwd.get(eq))) {</b>
<b class="nc">&nbsp;                lateralMatch = false;</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            }
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;        if (lateralMatch) {</b>
&nbsp;            //We&#39;ve already checked counts, so in the reverse direction we only need to see if there&#39;s
&nbsp;            //anything not found on the other side.
<b class="nc">&nbsp;            for (EquipmentType eq : rightFwd.keySet()) {</b>
<b class="nc">&nbsp;                if (!leftFwd.containsKey(eq)) {</b>
<b class="nc">&nbsp;                    lateralMatch = false;</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                }
<b class="nc">&nbsp;            }</b>
&nbsp;        }
&nbsp;        // Aft weapons
<b class="nc">&nbsp;        if (lateralMatch) {</b>
<b class="nc">&nbsp;            for (EquipmentType eq : leftAft.keySet()) {</b>
<b class="nc">&nbsp;                if (!rightAft.containsKey(eq) || !leftAft.get(eq).equals(rightAft.get(eq))) {</b>
<b class="nc">&nbsp;                    lateralMatch = false;</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                }
<b class="nc">&nbsp;            }</b>
&nbsp;        }
<b class="nc">&nbsp;        if (lateralMatch) {</b>
<b class="nc">&nbsp;            for (EquipmentType eq : rightAft.keySet()) {</b>
<b class="nc">&nbsp;                if (!leftAft.containsKey(eq)) {</b>
<b class="nc">&nbsp;                    lateralMatch = false;</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                }
<b class="nc">&nbsp;            }</b>
&nbsp;        }
&nbsp;        // Broadside (warships)
<b class="nc">&nbsp;        if (lateralMatch) {</b>
<b class="nc">&nbsp;            for (EquipmentType eq : leftBroad.keySet()) {</b>
<b class="nc">&nbsp;                if (!rightBroad.containsKey(eq) || !leftBroad.get(eq).equals(rightBroad.get(eq))) {</b>
<b class="nc">&nbsp;                    lateralMatch = false;</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                }
<b class="nc">&nbsp;            }</b>
&nbsp;        }
<b class="nc">&nbsp;        if (lateralMatch) {</b>
<b class="nc">&nbsp;            for (EquipmentType eq : rightBroad.keySet()) {</b>
<b class="nc">&nbsp;                if (!leftBroad.containsKey(eq)) {</b>
<b class="nc">&nbsp;                    lateralMatch = false;</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                }
<b class="nc">&nbsp;            }</b>
&nbsp;        }
<b class="nc">&nbsp;        if (!lateralMatch) {</b>
<b class="nc">&nbsp;            buff.append(&quot;Left and right side weapon loads do not match.\n&quot;);</b>
<b class="nc">&nbsp;            illegal = true;</b>
&nbsp;        }
&nbsp;        
<b class="nc">&nbsp;        for (Map.Entry&lt;Integer, Integer&gt; entry : massDriversPerArc.entrySet()) {</b>
<b class="nc">&nbsp;            if (vessel.hasETypeFlag(Entity.ETYPE_WARSHIP)</b>
<b class="nc">&nbsp;                    &amp;&amp; (entry.getKey() != Warship.LOC_NOSE)</b>
<b class="nc">&nbsp;                    &amp;&amp; (entry.getValue() &gt; 0)) {</b>
<b class="nc">&nbsp;                buff.append(&quot;A warship may only mount a mass driver in the nose firing arc.\n&quot;);</b>
<b class="nc">&nbsp;                illegal = true;</b>
<b class="nc">&nbsp;            } else if (entry.getValue() &gt; 1) {</b>
<b class="nc">&nbsp;                buff.append(&quot;A ship may not mount more than one mass driver in a firing arc.\n&quot;);</b>
<b class="nc">&nbsp;                illegal = true;</b>
&nbsp;            }
<b class="nc">&nbsp;        }</b>
&nbsp;
<b class="nc">&nbsp;        int bayDoors = 0;</b>
<b class="nc">&nbsp;        for (Bay bay : vessel.getTransportBays()) {</b>
<b class="nc">&nbsp;            bayDoors += bay.getDoors();</b>
<b class="nc">&nbsp;            if (bay.getDoors() == 0) {</b>
<b class="nc">&nbsp;                BayData data = BayData.getBayType(bay);</b>
<b class="nc">&nbsp;                if ((data != null) &amp;&amp; !data.isCargoBay() &amp;&amp; !data.isInfantryBay()) {</b>
<b class="nc">&nbsp;                    buff.append(&quot;Transport bays other than cargo and infantry require at least one door.\n&quot;);</b>
<b class="nc">&nbsp;                    illegal = true;</b>
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;        if (bayDoors &gt; maxBayDoors(vessel)) {</b>
<b class="nc">&nbsp;            buff.append(&quot;Exceeds maximum number of bay doors.\n&quot;);</b>
<b class="nc">&nbsp;            illegal = true;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return illegal;</b>
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * Checks that the unit meets minimum crew and quarters requirements.
&nbsp;     * @param buffer Where to write messages explaining failures.
&nbsp;     * @return  true if the crew data is valid.
&nbsp;     */
&nbsp;    public boolean correctCrew(StringBuffer buffer) {
<b class="nc">&nbsp;        boolean illegal = false;</b>
<b class="nc">&nbsp;        int crewSize = vessel.getNCrew() - vessel.getBayPersonnel();</b>
<b class="nc">&nbsp;        int reqCrew = minimumBaseCrew(vessel) + requiredGunners(vessel);</b>
<b class="nc">&nbsp;        if (crewSize &lt; reqCrew) {</b>
<b class="nc">&nbsp;            buffer.append(&quot;Requires &quot; + reqCrew + &quot; crew and only has &quot; + crewSize + &quot;\n&quot;);</b>
<b class="nc">&nbsp;            illegal = true;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (vessel.getNOfficers() &lt; Math.ceil(reqCrew / 6.0)) {</b>
<b class="nc">&nbsp;            buffer.append(&quot;Requires at least &quot; + (int)Math.ceil(reqCrew / 6.0) + &quot; officers\n&quot;);</b>
<b class="nc">&nbsp;            illegal = true;</b>
&nbsp;        }
<b class="nc">&nbsp;        crewSize += vessel.getNPassenger();</b>
<b class="nc">&nbsp;        crewSize += vessel.getNMarines();</b>
<b class="nc">&nbsp;        crewSize += vessel.getNBattleArmor();</b>
<b class="nc">&nbsp;        int quarters = 0;</b>
<b class="nc">&nbsp;        for (Bay bay : vessel.getTransportBays()) {</b>
<b class="nc">&nbsp;            Quarters q = Quarters.getQuartersForBay(bay);</b>
<b class="nc">&nbsp;            if (null != q) {</b>
<b class="nc">&nbsp;                quarters += bay.getCapacity();</b>
&nbsp;            }
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;        if (quarters &lt; crewSize) {</b>
<b class="nc">&nbsp;            buffer.append(&quot;Requires quarters for &quot; + crewSize + &quot; crew but only has &quot; + quarters + &quot;\n&quot;);</b>
<b class="nc">&nbsp;            illegal = true;</b>
&nbsp;        }
<b class="nc">&nbsp;        return !illegal;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Checks that the unit does not exceed the maximum number or size of gravity decks.
&nbsp;     * @param buffer Where to write messages explaining failures.
&nbsp;     * @return  true if the crew data is valid.
&nbsp;     */
&nbsp;    public boolean correctGravDecks(StringBuffer buffer) {
<b class="nc">&nbsp;        boolean illegal = false;</b>
<b class="nc">&nbsp;        if (vessel.getGravDecks().size() &gt; getMaxGravDecks(vessel)) {</b>
<b class="nc">&nbsp;            buffer.append(&quot;Exceeds maximum &quot; + getMaxGravDecks(vessel) + &quot; gravity decks.\n&quot;);</b>
<b class="nc">&nbsp;            illegal = true;</b>
&nbsp;        }
<b class="nc">&nbsp;        int maxSize = Jumpship.GRAV_DECK_LARGE_MAX;</b>
<b class="nc">&nbsp;        if (vessel.hasETypeFlag(Entity.ETYPE_SPACE_STATION)) {</b>
<b class="nc">&nbsp;            maxSize = Jumpship.GRAV_DECK_HUGE_MAX;</b>
&nbsp;        }
<b class="nc">&nbsp;        for (Integer dia : vessel.getGravDecks()) {</b>
<b class="nc">&nbsp;            if (dia &gt; maxSize) {</b>
<b class="nc">&nbsp;                buffer.append(&quot;Maximum grav deck diameter is &quot; + maxSize + &quot;\n&quot;);</b>
<b class="nc">&nbsp;                illegal = true;</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            }
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;        return !illegal;</b>
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * Checks that the unit does not have more than one naval repair facility or dropshuttle bay
&nbsp;     * per facing, all are assigned a facing, and non-stations have no more than one repair facility.
&nbsp;     * 
&nbsp;     * @param buffer Where to write messages explaining failures.
&nbsp;     * @return  true if the bay data is valid
&nbsp;     */
&nbsp;    public boolean correctBays(StringBuffer buffer) {
<b class="fc">&nbsp;        boolean legal = true;</b>
&nbsp;        
<b class="fc">&nbsp;        Set&lt;Integer&gt; facings = new HashSet&lt;&gt;();</b>
<b class="fc">&nbsp;        int repairCount = 0;</b>
<b class="fc">&nbsp;        for (Bay bay : vessel.getTransportBays()) {</b>
<b class="fc">&nbsp;            if (bay.hardpointCost() &gt; 0) {</b>
<b class="fc">&nbsp;                if ((bay.getFacing() &lt; 0) || (bay.getFacing() &gt;= Warship.LOC_LBS)) {</b>
<b class="fc">&nbsp;                    buffer.append(bay.getType() + &quot; is not assigned a legal armor facing.\n&quot;);</b>
<b class="fc">&nbsp;                    legal = false;</b>
<b class="fc">&nbsp;                } else if (facings.contains(bay.getFacing())) {</b>
<b class="fc">&nbsp;                    buffer.append(&quot;Exceeds maximum of one repair facility or dropshuttle bay per armor facing.\n&quot;);</b>
<b class="fc">&nbsp;                    legal = false;</b>
&nbsp;                }
<b class="fc">&nbsp;                facings.add(bay.getFacing());</b>
<b class="fc">&nbsp;                if (bay instanceof NavalRepairFacility) {</b>
<b class="fc">&nbsp;                    repairCount++;</b>
&nbsp;                }
&nbsp;            }
<b class="fc">&nbsp;        }</b>
<b class="fc">&nbsp;        if ((repairCount &gt; 1) &amp;&amp; !vessel.hasETypeFlag(Entity.ETYPE_SPACE_STATION)) {</b>
<b class="fc">&nbsp;            buffer.append(&quot;Only a space station may mount multiple naval repair facilities.\n&quot;);</b>
<b class="fc">&nbsp;            legal = false;</b>
&nbsp;        }
&nbsp;        
<b class="fc">&nbsp;        return legal;</b>
&nbsp;    }
&nbsp;    
&nbsp;    @Override
&nbsp;    public StringBuffer printEntity() {
<b class="nc">&nbsp;        StringBuffer buff = new StringBuffer();</b>
<b class="nc">&nbsp;        buff.append(&quot;Advanced Aerospace: &quot;).append(vessel.getDisplayName()).append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;        buff.append(&quot;Found in: &quot;).append(fileString).append(&quot;\n&quot;);        </b>
<b class="nc">&nbsp;        buff.append(printTechLevel());</b>
<b class="nc">&nbsp;        buff.append(&quot;Intro year: &quot;).append(getEntity().getYear()).append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;        buff.append(printSource());</b>
<b class="nc">&nbsp;        buff.append(printShortMovement());</b>
<b class="nc">&nbsp;        if (correctWeight(buff, true, true)) {</b>
<b class="nc">&nbsp;            buff.append(&quot;Weight: &quot;).append(getWeight()).append(&quot; (&quot;)</b>
<b class="nc">&nbsp;                    .append(calculateWeight()).append(&quot;)\n&quot;);</b>
&nbsp;        }
<b class="nc">&nbsp;        buff.append(printWeightCalculation()).append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;        buff.append(printArmorPlacement());</b>
<b class="nc">&nbsp;        correctArmor(buff);</b>
<b class="nc">&nbsp;        buff.append(printLocations());</b>
<b class="nc">&nbsp;        correctCriticals(buff);</b>
&nbsp;
&nbsp;        // printArmor(buff);
<b class="nc">&nbsp;        printFailedEquipment(buff);</b>
<b class="nc">&nbsp;        return buff;</b>
&nbsp;    }
&nbsp;    
&nbsp;    @Override
&nbsp;    public double calculateWeight() {
<b class="nc">&nbsp;        double weight = 0;</b>
<b class="nc">&nbsp;        weight += getWeightStructure();</b>
<b class="nc">&nbsp;        weight += getWeightEngine();</b>
<b class="nc">&nbsp;        weight += getWeightKFDrive();</b>
<b class="nc">&nbsp;        weight += getWeightLFBattery();</b>
<b class="nc">&nbsp;        weight += getWeightSail();</b>
<b class="nc">&nbsp;        weight += getWeightControls();</b>
<b class="nc">&nbsp;        weight += getWeightFuel();</b>
<b class="nc">&nbsp;        weight += getWeightHeatSinks();</b>
<b class="nc">&nbsp;        weight += getWeightArmor();</b>
<b class="nc">&nbsp;        weight += getWeightFireControl();</b>
&nbsp;
<b class="nc">&nbsp;        weight += getWeightMiscEquip();</b>
<b class="nc">&nbsp;        weight += getWeightWeapon();</b>
<b class="nc">&nbsp;        weight += getWeightAmmo();</b>
&nbsp;
<b class="nc">&nbsp;        weight += getWeightCarryingSpace();</b>
<b class="nc">&nbsp;        weight += getWeightHardpoints();</b>
<b class="nc">&nbsp;        weight += getWeightQuarters();</b>
<b class="nc">&nbsp;        weight += getWeightGravDecks();</b>
<b class="nc">&nbsp;        weight += getWeightLifeBoats();</b>
&nbsp;
<b class="nc">&nbsp;        return weight;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public String printWeightCalculation() {
<b class="nc">&nbsp;        return printWeightStructure() + printWeightEngine()</b>
<b class="nc">&nbsp;                + printWeightKFDrive() + printWeightLFBattery()</b>
<b class="nc">&nbsp;                + printWeightSail() + printWeightControls()</b>
<b class="nc">&nbsp;                + printWeightFuel() + printWeightHeatSinks()</b>
<b class="nc">&nbsp;                + printWeightArmor() + printWeightFireControl()</b>
<b class="nc">&nbsp;                + printWeightCarryingSpace() + printWeightHardpoints()</b>
<b class="nc">&nbsp;                + printWeightQuarters() + printWeightGravDecks()</b>
<b class="nc">&nbsp;                + printWeightLifeBoats()</b>
&nbsp;                + &quot;Equipment:\n&quot;
<b class="nc">&nbsp;                + printMiscEquip() + printWeapon() + printAmmo();</b>
&nbsp;    }
&nbsp;    
&nbsp;    @Override
&nbsp;    public String printLocations() {
<b class="nc">&nbsp;        StringBuilder buff = new StringBuilder();</b>
<b class="nc">&nbsp;        for (int i = 0; i &lt; getEntity().locations(); i++) {</b>
<b class="nc">&nbsp;            String locationName = getEntity().getLocationName(i);</b>
<b class="nc">&nbsp;            buff.append(locationName).append(&quot;:&quot;).append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;            for (int j = 0; j &lt; getEntity().getNumberOfCriticals(i); j++) {</b>
<b class="nc">&nbsp;                CriticalSlot slot = getEntity().getCritical(i, j);</b>
<b class="nc">&nbsp;                if (slot == null) {</b>
<b class="nc">&nbsp;                    j = getEntity().getNumberOfCriticals(i);                    </b>
<b class="nc">&nbsp;                } else if (slot.getType() == CriticalSlot.TYPE_SYSTEM) {</b>
<b class="nc">&nbsp;                        buff.append(j).append(&quot;. UNKNOWN SYSTEM NAME&quot;);</b>
<b class="nc">&nbsp;                        buff.append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;                } else if (slot.getType() == CriticalSlot.TYPE_EQUIPMENT) {</b>
<b class="nc">&nbsp;                    EquipmentType e = getEntity().getEquipmentType(slot);</b>
<b class="nc">&nbsp;                    buff.append(j).append(&quot;. &quot;).append(e.getInternalName());</b>
<b class="nc">&nbsp;                    buff.append(&quot;\n&quot;);</b>
&nbsp;                }
&nbsp;            }
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        double[] extra = extraSlotCost(vessel);</b>
<b class="nc">&nbsp;        for (int i = 0; i &lt; extra.length; i++) {</b>
<b class="nc">&nbsp;            if (extra[i] &gt; 0) {</b>
<b class="nc">&nbsp;                if (i &lt; getEntity().locations()) {</b>
<b class="nc">&nbsp;                    buff.append(getLocationAbbr(i));</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    buff.append(getLocationAbbr(i - 3)).append(&quot; (R)&quot;);</b>
&nbsp;                }
<b class="nc">&nbsp;                buff.append(&quot; requires &quot;).append(extra[i]).append(&quot; tons of additional fire control.\n&quot;);</b>
&nbsp;            }
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return buff.toString();</b>
&nbsp;    }
&nbsp;    
&nbsp;    @Override
&nbsp;    public String getName() {
<b class="nc">&nbsp;        if (vessel.hasETypeFlag(Entity.ETYPE_WARSHIP)) {</b>
<b class="nc">&nbsp;            return &quot;Warship: &quot; + vessel.getDisplayName();</b>
<b class="nc">&nbsp;        } else if (vessel.hasETypeFlag(Entity.ETYPE_SPACE_STATION)){</b>
<b class="nc">&nbsp;            return &quot;Space Station: &quot; + vessel.getDisplayName();</b>
&nbsp;        } else {
<b class="nc">&nbsp;            return &quot;Jumpship: &quot; + vessel.getDisplayName();</b>
&nbsp;        }
&nbsp;    }
&nbsp;    
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2023-05-16 16:28</div>
</div>
</body>
</html>
