


<!DOCTYPE html>
<html id="htmlId">
<head>
  <title>Coverage Report > TestTank</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">megamek.common.verifier</a>
</div>

<h1>Coverage Summary for Class: TestTank (megamek.common.verifier)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">TestTank</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/38)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/572)
  </span>
</td>
</tr>
  <tr>
    <td class="name">TestTank$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/39)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/573)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;/*
&nbsp; * MegaMek -
&nbsp; * Copyright (C) 2000,2001,2002,2003,2004,2005 Ben Mazur (bmazur@sev.org)
&nbsp; *
&nbsp; *  This program is free software; you can redistribute it and/or modify it
&nbsp; *  under the terms of the GNU General Public License as published by the Free
&nbsp; *  Software Foundation; either version 2 of the License, or (at your option)
&nbsp; *  any later version.
&nbsp; *
&nbsp; *  This program is distributed in the hope that it will be useful, but
&nbsp; *  WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
&nbsp; *  or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License
&nbsp; *  for more details.
&nbsp; */
&nbsp;
&nbsp;/*
&nbsp; * Author: Reinhard Vicinus
&nbsp; */
&nbsp;
&nbsp;package megamek.common.verifier;
&nbsp;
&nbsp;import java.util.ArrayList;
&nbsp;import java.util.Arrays;
&nbsp;import java.util.HashMap;
&nbsp;import java.util.List;
&nbsp;import java.util.Map;
&nbsp;
&nbsp;import megamek.common.*;
&nbsp;import megamek.common.annotations.Nullable;
&nbsp;import megamek.common.util.StringUtil;
&nbsp;import megamek.common.weapons.flamers.VehicleFlamerWeapon;
&nbsp;import megamek.common.weapons.lasers.CLChemicalLaserWeapon;
&nbsp;
&nbsp;public class TestTank extends TestEntity {
&nbsp;
&nbsp;    /**
&nbsp;     * Defines the maximum amount of armor a VTOL can mount on its rotor.
&nbsp;     */
<b class="nc">&nbsp;    public static int VTOL_MAX_ROTOR_ARMOR = 2;</b>
&nbsp;
&nbsp;    private final Tank tank;
&nbsp;
&nbsp;    public TestTank(Tank tank, TestEntityOption options, String fileString) {
<b class="nc">&nbsp;        super(options, tank.getEngine(), getArmor(tank), getStructure(tank));</b>
<b class="nc">&nbsp;        this.tank = tank;</b>
<b class="nc">&nbsp;        this.fileString = fileString;</b>
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    protected static Structure getStructure(Tank tank) {
<b class="nc">&nbsp;        if (tank.isSupportVehicle()) {</b>
<b class="nc">&nbsp;            return new SupportVeeStructure(tank);</b>
&nbsp;        }
<b class="nc">&nbsp;        int type = EquipmentType.T_STRUCTURE_STANDARD;</b>
<b class="nc">&nbsp;        if (tank.getStructureType() == 1) {</b>
<b class="nc">&nbsp;            type = EquipmentType.T_STRUCTURE_ENDO_STEEL;</b>
&nbsp;        }
<b class="nc">&nbsp;        return new Structure(type, tank.isSuperHeavy(), tank.getMovementMode());</b>
&nbsp;    }
&nbsp;
&nbsp;    private static Armor[] getArmor(Tank tank) {
&nbsp;        Armor[] armor;
<b class="nc">&nbsp;        if (!tank.hasPatchworkArmor()) {</b>
<b class="nc">&nbsp;            armor = new Armor[1];</b>
<b class="nc">&nbsp;            int type = tank.getArmorType(1);</b>
<b class="nc">&nbsp;            int flag = 0;</b>
<b class="nc">&nbsp;            if (tank.isClanArmor(1)) {</b>
<b class="nc">&nbsp;                flag |= Armor.CLAN_ARMOR;</b>
&nbsp;            }
<b class="nc">&nbsp;            armor[0] = new Armor(type, flag);</b>
<b class="nc">&nbsp;            return armor;</b>
&nbsp;        } else {
<b class="nc">&nbsp;            armor = new Armor[tank.locations()];</b>
<b class="nc">&nbsp;            for (int i = 0; i &lt; tank.locations(); i++) {</b>
<b class="nc">&nbsp;                int type = tank.getArmorType(1);</b>
<b class="nc">&nbsp;                int flag = 0;</b>
<b class="nc">&nbsp;                if (tank.isClanArmor(1)) {</b>
<b class="nc">&nbsp;                    flag |= Armor.CLAN_ARMOR;</b>
&nbsp;                }
<b class="nc">&nbsp;                armor[i] = new Armor(type, flag);</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        return armor;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Filters all vehicle armor according to given tech constraints
&nbsp;     *
&nbsp;     * @param movementMode The vehicle movement mode
&nbsp;     * @param techManager  The tech constraints
&nbsp;     * @return             The armors legal for the unit
&nbsp;     */
&nbsp;    public static List&lt;EquipmentType&gt; legalArmorsFor(EntityMovementMode movementMode, ITechManager techManager) {
<b class="nc">&nbsp;        List&lt;EquipmentType&gt; retVal = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        for (int at = 0; at &lt; EquipmentType.armorNames.length; at++) {</b>
<b class="nc">&nbsp;            if ((at == EquipmentType.T_ARMOR_PATCHWORK)</b>
&nbsp;                    || ((at == EquipmentType.T_ARMOR_HARDENED)
&nbsp;                            &amp;&amp; ((movementMode == EntityMovementMode.VTOL)
&nbsp;                            || (movementMode == EntityMovementMode.HOVER)
&nbsp;                            || (movementMode == EntityMovementMode.WIGE)))) {
<b class="nc">&nbsp;                continue;</b>
&nbsp;            }
<b class="nc">&nbsp;            String name = EquipmentType.getArmorTypeName(at, techManager.useClanTechBase());</b>
<b class="nc">&nbsp;            EquipmentType eq = EquipmentType.get(name);</b>
<b class="nc">&nbsp;            if ((null != eq)</b>
<b class="nc">&nbsp;                    &amp;&amp; eq.hasFlag(MiscType.F_TANK_EQUIPMENT)</b>
<b class="nc">&nbsp;                    &amp;&amp; techManager.isLegal(eq)) {</b>
<b class="nc">&nbsp;                retVal.add(eq);</b>
&nbsp;            }
<b class="nc">&nbsp;            if (techManager.useMixedTech()) {</b>
<b class="nc">&nbsp;                name = EquipmentType.getArmorTypeName(at, !techManager.useClanTechBase());</b>
<b class="nc">&nbsp;                EquipmentType eq2 = EquipmentType.get(name);</b>
<b class="nc">&nbsp;                if ((null != eq2) &amp;&amp; (eq != eq2)</b>
<b class="nc">&nbsp;                        &amp;&amp; eq2.hasFlag(MiscType.F_TANK_EQUIPMENT)</b>
<b class="nc">&nbsp;                        &amp;&amp; techManager.isLegal(eq2)) {</b>
<b class="nc">&nbsp;                    retVal.add(eq2);</b>
&nbsp;                }
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        return retVal;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Maximum construction weight by vehicle type
&nbsp;     *
&nbsp;     * @param mode        The vehicle&#39;s movement mode
&nbsp;     * @param superheavy  Whether the vehicle is superheavy
&nbsp;     * @return            The maximum construction tonnage
&nbsp;     */
&nbsp;    public static double maxTonnage(EntityMovementMode mode, boolean superheavy) {
<b class="nc">&nbsp;        switch(mode) {</b>
&nbsp;            case WHEELED:
&nbsp;            case WIGE:
<b class="nc">&nbsp;                return superheavy ? 160.0 : 80.0;</b>
&nbsp;            case HOVER:
<b class="nc">&nbsp;                return superheavy ? 100.0 : 50.0;</b>
&nbsp;            case VTOL:
<b class="nc">&nbsp;                return superheavy ? 60.0 : 30.0;</b>
&nbsp;            case NAVAL:
&nbsp;            case SUBMARINE:
<b class="nc">&nbsp;                return superheavy ? 555.0 : 300.0;</b>
&nbsp;            case HYDROFOIL:
<b class="nc">&nbsp;                return 100.0; // not eligible for superheavy</b>
&nbsp;            case TRACKED:
&nbsp;            default:
<b class="nc">&nbsp;                return superheavy ? 200.0 : 100.0;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public Entity getEntity() {
<b class="nc">&nbsp;        return tank;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean isTank() {
<b class="nc">&nbsp;        return !(tank instanceof GunEmplacement);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean isMech() {
<b class="nc">&nbsp;        return false;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean isAero() {
<b class="nc">&nbsp;        return false;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean isSmallCraft() {
<b class="nc">&nbsp;        return false;</b>
&nbsp;    }
&nbsp;    
&nbsp;    @Override
&nbsp;    public boolean isAdvancedAerospace() {
<b class="nc">&nbsp;        return false;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean isProtomech() {
<b class="nc">&nbsp;        return false;</b>
&nbsp;    }
&nbsp;
&nbsp;    public double getTankWeightTurret() {
<b class="nc">&nbsp;        double weight = 0;</b>
&nbsp;
&nbsp;        // For omni vees, the base chassis sets a turret weight
<b class="nc">&nbsp;        if (tank.isOmni() &amp;&amp; tank.getBaseChassisTurretWeight() &gt;= 0) {</b>
<b class="nc">&nbsp;            weight = tank.getBaseChassisTurretWeight();</b>
&nbsp;        } else {
&nbsp;            // For non-omnis, count up the weight of eq in the turret
<b class="nc">&nbsp;            for (Mounted m : tank.getEquipment()) {</b>
<b class="nc">&nbsp;                if ((m.getLocation() == tank.getLocTurret())</b>
<b class="nc">&nbsp;                        &amp;&amp; !(m.getType() instanceof AmmoType)</b>
&nbsp;                        // Skip any patchwork armor mounts
<b class="nc">&nbsp;                        &amp;&amp; (EquipmentType.getArmorType(m.getType()) == EquipmentType.T_ARMOR_UNKNOWN)) {</b>
<b class="nc">&nbsp;                    weight += m.getTonnage();</b>
&nbsp;                }
<b class="nc">&nbsp;            }</b>
&nbsp;            // Turrets weight 10% of the weight of weapons in them
<b class="nc">&nbsp;            weight = weight / 10.0f;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (tank.isSupportVehicle()) {</b>
<b class="nc">&nbsp;            if (getEntity().getWeight() &lt; 5) {</b>
<b class="nc">&nbsp;                return TestEntity.ceil(weight, Ceil.KILO);</b>
&nbsp;            } else {
<b class="nc">&nbsp;                return TestEntity.ceil(weight, Ceil.HALFTON);</b>
&nbsp;            }
&nbsp;        } else {
<b class="nc">&nbsp;            return TestEntity.ceilMaxHalf(weight, getWeightCeilingTurret());</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    public double getTankWeightDualTurret() {
<b class="nc">&nbsp;        double weight = 0;</b>
&nbsp;
&nbsp;        // For omni vees, the base chassis sets a turret weight
<b class="nc">&nbsp;        if (tank.isOmni() &amp;&amp; tank.getBaseChassisTurret2Weight() &gt;= 0) {</b>
<b class="nc">&nbsp;            weight = tank.getBaseChassisTurret2Weight();</b>
&nbsp;        } else {
&nbsp;            // For non-omnis, count up the weight of eq in the turret
<b class="nc">&nbsp;            for (Mounted m : tank.getEquipment()) {</b>
<b class="nc">&nbsp;                if ((m.getLocation() == tank.getLocTurret2())</b>
<b class="nc">&nbsp;                        &amp;&amp; !(m.getType() instanceof AmmoType)) {</b>
<b class="nc">&nbsp;                    weight += m.getTonnage();</b>
&nbsp;                }
<b class="nc">&nbsp;            }</b>
&nbsp;            // Turrets weight 10% of the weight of weapons in them
<b class="nc">&nbsp;            weight = weight / 10.0f;</b>
&nbsp;        }
<b class="nc">&nbsp;        return TestEntity.ceilMaxHalf(weight, getWeightCeilingTurret());</b>
&nbsp;    }
&nbsp;
&nbsp;    public double getTankWeightLifting() {
<b class="nc">&nbsp;        switch (tank.getMovementMode()) {</b>
&nbsp;            case HOVER:
&nbsp;            case VTOL:
&nbsp;            case HYDROFOIL:
&nbsp;            case SUBMARINE:
&nbsp;            case WIGE:
<b class="nc">&nbsp;                return TestEntity.ceilMaxHalf(tank.getWeight() / 10.0f,</b>
<b class="nc">&nbsp;                        getWeightCeilingLifting());</b>
&nbsp;            default:
<b class="nc">&nbsp;                return 0f;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public double getWeightMisc() {
<b class="nc">&nbsp;        return getTankWeightTurret() + getTankWeightDualTurret() + getTankWeightLifting();</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public double getWeightControls() {
<b class="nc">&nbsp;        if (tank.hasNoControlSystems()) {</b>
<b class="nc">&nbsp;            return 0;</b>
&nbsp;        } else {
<b class="nc">&nbsp;            return TestEntity.ceilMaxHalf(tank.getWeight() / 20.0f,</b>
<b class="nc">&nbsp;                    getWeightCeilingControls());</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean hasDoubleHeatSinks() {
&nbsp;        // tanks can&#39;t have DHS
<b class="nc">&nbsp;        return false;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public int getCountHeatSinks() {
<b class="nc">&nbsp;        return heatNeutralHSRequirement();</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public double getWeightHeatSinks() {
<b class="nc">&nbsp;        int heat = getCountHeatSinks();</b>
<b class="nc">&nbsp;        heat -= engine.getWeightFreeEngineHeatSinks();</b>
<b class="nc">&nbsp;        if (heat &lt; 0) {</b>
<b class="nc">&nbsp;            heat = 0;</b>
&nbsp;        }
<b class="nc">&nbsp;        return heat;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public String printWeightMisc() {
<b class="nc">&nbsp;        String turretString = !tank.hasNoTurret() ? StringUtil.makeLength(&quot;Turret:&quot;,</b>
<b class="nc">&nbsp;                getPrintSize() - 5)</b>
<b class="nc">&nbsp;                + TestEntity.makeWeightString(getTankWeightTurret()) + &quot;\n&quot; : &quot;&quot;;</b>
<b class="nc">&nbsp;        String dualTurretString = !tank.hasNoDualTurret() ? StringUtil.makeLength(&quot;Front Turret:&quot;,</b>
<b class="nc">&nbsp;                getPrintSize() - 5)</b>
<b class="nc">&nbsp;                + TestEntity.makeWeightString(getTankWeightDualTurret()) + &quot;\n&quot; : &quot;&quot;;</b>
<b class="nc">&nbsp;        return turretString + dualTurretString</b>
<b class="nc">&nbsp;                + (getTankWeightLifting() != 0 ? StringUtil.makeLength(</b>
<b class="nc">&nbsp;                        &quot;Lifting Equip:&quot;, getPrintSize() - 5)</b>
<b class="nc">&nbsp;                        + TestEntity.makeWeightString(getTankWeightLifting()) + &quot;\n&quot; : &quot;&quot;)</b>
<b class="nc">&nbsp;                + (getWeightPowerAmp() != 0 ? StringUtil.makeLength(</b>
<b class="nc">&nbsp;                        &quot;Power Amp:&quot;, getPrintSize() - 5)</b>
<b class="nc">&nbsp;                        + TestEntity.makeWeightString(getWeightPowerAmp()) + &quot;\n&quot; : &quot;&quot;);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public String printWeightControls() {
<b class="nc">&nbsp;        return StringUtil.makeLength(&quot;Controls:&quot;, getPrintSize() - 5)</b>
<b class="nc">&nbsp;                + TestEntity.makeWeightString(getWeightControls()) + &quot;\n&quot;;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public double getWeightCarryingSpace() {
<b class="nc">&nbsp;        return super.getWeightCarryingSpace() + tank.getExtraCrewSeats() * 0.5;</b>
&nbsp;    }
&nbsp;
&nbsp;    public String printWeightCarryingSpace() {
<b class="nc">&nbsp;        if (tank.getExtraCrewSeats() &gt; 0) {</b>
<b class="nc">&nbsp;            return super.printWeightCarryingSpace()</b>
<b class="nc">&nbsp;                    + StringUtil.makeLength(&quot;Combat Seats:&quot;, getPrintSize() - 5)</b>
<b class="nc">&nbsp;                    + TestEntity.makeWeightString(tank.getExtraCrewSeats() * 0.5) + &quot;\n&quot;;</b>
&nbsp;        } else {
<b class="nc">&nbsp;            return super.printWeightCarryingSpace();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    public Tank getTank() {
<b class="nc">&nbsp;        return tank;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean correctEntity(StringBuffer buff) {
<b class="nc">&nbsp;        return correctEntity(buff, getEntity().getTechLevel());</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean correctEntity(StringBuffer buff, int ammoTechLvl) {
<b class="nc">&nbsp;        boolean correct = true;</b>
<b class="nc">&nbsp;        if (skip()) {</b>
<b class="nc">&nbsp;            return true;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (!correctWeight(buff)) {</b>
<b class="nc">&nbsp;            buff.insert(0, printTechLevel() + printShortMovement());</b>
<b class="nc">&nbsp;            buff.append(printWeightCalculation()).append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;            correct = false;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (!engine.engineValid) {</b>
<b class="nc">&nbsp;            buff.append(engine.problem.toString()).append(&quot;\n\n&quot;);</b>
<b class="nc">&nbsp;            correct = false;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (tank.getFreeSlots() &lt; 0) {</b>
<b class="nc">&nbsp;            buff.append(&quot;Not enough item slots available! Using &quot;);</b>
<b class="nc">&nbsp;            buff.append(Math.abs(tank.getFreeSlots()));</b>
<b class="nc">&nbsp;            buff.append(&quot; slot(s) too many.\n&quot;);</b>
<b class="nc">&nbsp;            buff.append(printSlotCalculation()).append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;            correct = false;</b>
&nbsp;        }
<b class="nc">&nbsp;        int armorLimit = (int) (((tank.getWeight() * 7) / 2) + 40);</b>
<b class="nc">&nbsp;        if (tank.getTotalOArmor() &gt; armorLimit) {</b>
<b class="nc">&nbsp;            buff.append(&quot;Armor exceeds point limit for &quot;);</b>
<b class="nc">&nbsp;            buff.append(tank.getWeight());</b>
<b class="nc">&nbsp;            buff.append(&quot;-ton vehicle: &quot;);</b>
<b class="nc">&nbsp;            buff.append(tank.getTotalOArmor());</b>
<b class="nc">&nbsp;            buff.append(&quot; points &gt; &quot;);</b>
<b class="nc">&nbsp;            buff.append(armorLimit);</b>
<b class="nc">&nbsp;            buff.append(&quot;.\n\n&quot;);</b>
<b class="nc">&nbsp;            correct = false;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (tank instanceof VTOL) {</b>
<b class="nc">&nbsp;            if (!tank.hasWorkingMisc(MiscType.F_MAST_MOUNT)) {</b>
<b class="nc">&nbsp;                for (Mounted m : tank.getEquipment()) {</b>
&nbsp;                    // Units with patchwork armor place any armor slots in the same location
&nbsp;                    // as the armor. This is for accounting convenience.
<b class="nc">&nbsp;                    if ((m.getLocation() == VTOL.LOC_ROTOR)</b>
<b class="nc">&nbsp;                            &amp;&amp; EquipmentType.getArmorType(m.getType()) == EquipmentType.T_ARMOR_UNKNOWN) {</b>
<b class="nc">&nbsp;                        buff.append(&quot;rotor equipment must be placed in mast mount&quot;);</b>
<b class="nc">&nbsp;                        correct = false;</b>
&nbsp;                    }
<b class="nc">&nbsp;                }</b>
&nbsp;            }
<b class="nc">&nbsp;            if (tank.getOArmor(VTOL.LOC_ROTOR) &gt; VTOL_MAX_ROTOR_ARMOR) {</b>
<b class="nc">&nbsp;                buff.append(tank.getOArmor(VTOL.LOC_ROTOR));</b>
<b class="nc">&nbsp;                buff.append(&quot; points of VTOL rotor armor exceed &quot;)</b>
<b class="nc">&nbsp;                        .append(VTOL_MAX_ROTOR_ARMOR).append(&quot;-point limit.\n\n&quot;);</b>
<b class="nc">&nbsp;                correct = false;</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        for (Mounted m : tank.getEquipment()) {</b>
<b class="nc">&nbsp;            if (!legalForMotiveType(m.getType(), tank.getMovementMode(), false)) {</b>
<b class="nc">&nbsp;                buff.append(m.getType().getName()).append(&quot; is incompatible with &quot;)</b>
<b class="nc">&nbsp;                        .append(tank.getMovementModeAsString());</b>
<b class="nc">&nbsp;                correct = false;</b>
&nbsp;            }
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;        for (Mounted m : tank.getMisc()) {</b>
<b class="nc">&nbsp;            if (m.getType().hasFlag(MiscType.F_COMBAT_VEHICLE_ESCAPE_POD)) {</b>
<b class="nc">&nbsp;                if (m.getLocation() != (tank instanceof SuperHeavyTank?SuperHeavyTank.LOC_REAR:Tank.LOC_REAR)) {</b>
<b class="nc">&nbsp;                    buff.append(&quot;combat vehicle escape pod must be placed in rear&quot;);</b>
<b class="nc">&nbsp;                    correct = false;</b>
&nbsp;                }
<b class="nc">&nbsp;            } else if (m.getType().hasFlag(MiscType.F_MASC) &amp;&amp; m.getType().hasSubType(MiscType.S_SUPERCHARGER)</b>
&nbsp;                    &amp;&amp; (tank instanceof VTOL)) {
<b class="nc">&nbsp;                buff.append(&quot;VTOLS cannot mount superchargers.&quot;);</b>
<b class="nc">&nbsp;                correct = false;</b>
&nbsp;            }
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;        for (int loc = 0; loc &lt; tank.locations(); loc++) {</b>
<b class="nc">&nbsp;            int count = 0;</b>
<b class="nc">&nbsp;            for (Mounted misc : tank.getMisc()) {</b>
<b class="nc">&nbsp;                if ((misc.getLocation() == loc) &amp;&amp; misc.getType().hasFlag(MiscType.F_MANIPULATOR)) {</b>
<b class="nc">&nbsp;                    count++;</b>
&nbsp;                }
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;            if (count &gt; 2) {</b>
<b class="nc">&nbsp;                buff.append(&quot;max of 2 manipulators per location&quot;);</b>
<b class="nc">&nbsp;                correct = false;</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            }
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (showFailedEquip() &amp;&amp; hasFailedEquipment(buff)) {</b>
<b class="nc">&nbsp;            correct = false;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (hasIllegalTechLevels(buff, ammoTechLvl)) {</b>
<b class="nc">&nbsp;            correct = false;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (showIncorrectIntroYear() &amp;&amp; hasIncorrectIntroYear(buff)) {</b>
<b class="nc">&nbsp;            correct = false;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (hasIllegalEquipmentCombinations(buff)) {</b>
<b class="nc">&nbsp;            correct = false;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (!correctCriticals(buff)) {</b>
<b class="nc">&nbsp;            correct = false;</b>
&nbsp;        }
<b class="nc">&nbsp;        return correct;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Checks whether the equipment is compatible with the vehicle&#39;s motive type
&nbsp;     *
&nbsp;     * @param eq            The equipment to check
&nbsp;     * @param mode          The vehicle&#39;s motive type
&nbsp;     * @param supporVehicle Whether the vehicle is a support vehicle.
&nbsp;     * @return              Whether the equipment and motive type are compatible
&nbsp;     */
&nbsp;    public static boolean legalForMotiveType(EquipmentType eq, EntityMovementMode mode, boolean supporVehicle) {
&nbsp;        // A couple broad categories for convenience
<b class="nc">&nbsp;        final boolean isNaval = mode.equals(EntityMovementMode.NAVAL)</b>
<b class="nc">&nbsp;                || mode.equals(EntityMovementMode.HYDROFOIL)</b>
<b class="nc">&nbsp;                || mode.equals(EntityMovementMode.SUBMARINE);</b>
<b class="nc">&nbsp;        final boolean isAero = mode.equals(EntityMovementMode.AERODYNE)</b>
<b class="nc">&nbsp;                || mode.equals(EntityMovementMode.AIRSHIP)</b>
<b class="nc">&nbsp;                || mode.equals(EntityMovementMode.STATION_KEEPING);</b>
<b class="nc">&nbsp;        if (eq instanceof MiscType) {</b>
<b class="nc">&nbsp;            if (eq.hasFlag(MiscType.F_FLOTATION_HULL)) {</b>
&nbsp;                // Per errata, WiGE vehicles automatically include flotation hull
<b class="nc">&nbsp;                return mode.equals(EntityMovementMode.HOVER) || mode.equals(EntityMovementMode.VTOL);</b>
&nbsp;            }
<b class="nc">&nbsp;            if (eq.hasFlag(MiscType.F_FULLY_AMPHIBIOUS)</b>
<b class="nc">&nbsp;                    || eq.hasFlag(MiscType.F_LIMITED_AMPHIBIOUS)</b>
<b class="nc">&nbsp;                    || eq.hasFlag(MiscType.F_BULLDOZER)</b>
<b class="nc">&nbsp;                    || (eq.hasFlag(MiscType.F_CLUB) &amp;&amp; eq.hasSubType(MiscType.S_COMBINE))) {</b>
<b class="nc">&nbsp;                return mode.equals(EntityMovementMode.WHEELED) || mode.equals(EntityMovementMode.TRACKED);</b>
&nbsp;            }
<b class="nc">&nbsp;            if (eq.hasFlag(MiscType.F_DUNE_BUGGY)) {</b>
<b class="nc">&nbsp;                return mode.equals(EntityMovementMode.WHEELED);</b>
&nbsp;            }
&nbsp;            // Submarines have environmental sealing as part of their base construction
<b class="nc">&nbsp;            if (eq.hasFlag(MiscType.F_ENVIRONMENTAL_SEALING)) {</b>
<b class="nc">&nbsp;                return !mode.equals(EntityMovementMode.SUBMARINE);</b>
&nbsp;            }
<b class="nc">&nbsp;            if (eq.hasFlag(MiscType.F_JUMP_JET)</b>
<b class="nc">&nbsp;                    || eq.hasFlag(MiscType.F_VEEDC)</b>
<b class="nc">&nbsp;                    || (eq.hasFlag(MiscType.F_CLUB)</b>
<b class="nc">&nbsp;                    &amp;&amp; eq.hasSubType(MiscType.S_CHAINSAW | MiscType.S_DUAL_SAW | MiscType.S_MINING_DRILL))) {</b>
<b class="nc">&nbsp;                return mode.equals(EntityMovementMode.WHEELED) || mode.equals(EntityMovementMode.TRACKED)</b>
<b class="nc">&nbsp;                        || mode.equals(EntityMovementMode.HOVER) || mode.equals(EntityMovementMode.WIGE);</b>
&nbsp;            }
<b class="nc">&nbsp;            if (eq.hasFlag(MiscType.F_MINESWEEPER) || eq.hasFlag(MiscType.F_CLUB)</b>
<b class="nc">&nbsp;                    &amp;&amp; eq.hasSubType(MiscType.S_PILE_DRIVER)) {</b>
<b class="nc">&nbsp;                return mode.equals(EntityMovementMode.WHEELED) || mode.equals(EntityMovementMode.TRACKED)</b>
&nbsp;                        || isNaval;
&nbsp;            }
<b class="nc">&nbsp;            if (eq.hasFlag(MiscType.F_HITCH)) {</b>
<b class="nc">&nbsp;                return mode.equals(EntityMovementMode.WHEELED) || mode.equals(EntityMovementMode.TRACKED)</b>
<b class="nc">&nbsp;                        || mode.equals(EntityMovementMode.RAIL) || mode.equals(EntityMovementMode.MAGLEV);</b>
&nbsp;            }
<b class="nc">&nbsp;            if (eq.hasFlag(MiscType.F_LIFEBOAT)) {</b>
<b class="nc">&nbsp;                if (eq.hasSubType(MiscType.S_MARITIME_ESCAPE_POD | MiscType.S_MARITIME_LIFEBOAT)) {</b>
&nbsp;                    // Allowed for all naval units and support vehicles with an amphibious chassis mod
<b class="nc">&nbsp;                    return supporVehicle ? !mode.equals(EntityMovementMode.HOVER) : !isNaval;</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    return isAero;</b>
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            if (eq.hasFlag(MiscType.F_HEAVY_BRIDGE_LAYER)</b>
<b class="nc">&nbsp;                    || eq.hasFlag(MiscType.F_MEDIUM_BRIDGE_LAYER)</b>
<b class="nc">&nbsp;                    || eq.hasFlag(MiscType.F_LIGHT_BRIDGE_LAYER)</b>
<b class="nc">&nbsp;                    || (eq.hasFlag(MiscType.F_MASC) &amp;&amp; eq.hasSubType(MiscType.S_SUPERCHARGER))</b>
<b class="nc">&nbsp;                    || (eq.hasFlag(MiscType.F_CLUB)</b>
<b class="nc">&nbsp;                    &amp;&amp; eq.hasSubType(MiscType.S_BACKHOE | MiscType.S_ROCK_CUTTER</b>
&nbsp;                    | MiscType.S_SPOT_WELDER | MiscType.S_WRECKING_BALL))) {
<b class="nc">&nbsp;                return !mode.equals(EntityMovementMode.VTOL) &amp;&amp; !isAero;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (eq.hasFlag(MiscType.F_AP_POD)) {</b>
<b class="nc">&nbsp;                return !isNaval &amp;&amp; !isAero;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (eq.hasFlag(MiscType.F_ARMORED_MOTIVE_SYSTEM)) {</b>
<b class="nc">&nbsp;                return !isAero</b>
<b class="nc">&nbsp;                        &amp;&amp; !mode.equals(EntityMovementMode.VTOL)</b>
<b class="nc">&nbsp;                        &amp;&amp; !mode.equals(EntityMovementMode.RAIL)</b>
<b class="nc">&nbsp;                        &amp;&amp; !mode.equals(EntityMovementMode.MAGLEV);</b>
&nbsp;            }
<b class="nc">&nbsp;            if (eq.hasFlag(MiscType.F_MASH)) {</b>
<b class="nc">&nbsp;                return !mode.equals(EntityMovementMode.VTOL);</b>
&nbsp;            }
<b class="nc">&nbsp;            if (eq.hasFlag(MiscType.F_SPONSON_TURRET)</b>
<b class="nc">&nbsp;                    || eq.hasFlag(MiscType.F_LADDER)) {</b>
<b class="nc">&nbsp;                return !isAero;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (eq.hasFlag(MiscType.F_PINTLE_TURRET)) {</b>
<b class="nc">&nbsp;                return !isNaval &amp;&amp; !mode.equals(EntityMovementMode.AERODYNE)</b>
<b class="nc">&nbsp;                        &amp;&amp; !mode.equals(EntityMovementMode.STATION_KEEPING);</b>
&nbsp;            }
<b class="nc">&nbsp;            if (eq.hasFlag(MiscType.F_LOOKDOWN_RADAR)</b>
<b class="nc">&nbsp;                    || eq.hasFlag(MiscType.F_INFRARED_IMAGER)</b>
<b class="nc">&nbsp;                    || eq.hasFlag(MiscType.F_HIRES_IMAGER)) {</b>
<b class="nc">&nbsp;                return isAero || mode.equals(EntityMovementMode.VTOL);</b>
&nbsp;            }
<b class="nc">&nbsp;            if (eq.hasFlag(MiscType.F_REFUELING_DROGUE)) {</b>
<b class="nc">&nbsp;                return mode.equals(EntityMovementMode.VTOL)</b>
<b class="nc">&nbsp;                        || mode.equals(EntityMovementMode.AERODYNE)</b>
<b class="nc">&nbsp;                        || mode.equals(EntityMovementMode.AIRSHIP);</b>
&nbsp;            }
<b class="nc">&nbsp;            if (eq.hasFlag(MiscType.F_SASRCS)</b>
<b class="nc">&nbsp;                    || eq.hasFlag(MiscType.F_LIGHT_SAIL)</b>
<b class="nc">&nbsp;                    || eq.hasFlag(MiscType.F_SPACE_MINE_DISPENSER)</b>
<b class="nc">&nbsp;                    || eq.hasFlag(MiscType.F_SMALL_COMM_SCANNER_SUITE)) {</b>
<b class="nc">&nbsp;                return mode.equals(EntityMovementMode.STATION_KEEPING);</b>
&nbsp;            }
<b class="nc">&nbsp;            if (eq.hasFlag(MiscType.F_VEHICLE_MINE_DISPENSER)) {</b>
<b class="nc">&nbsp;                return !mode.equals(EntityMovementMode.STATION_KEEPING);</b>
&nbsp;            }
<b class="nc">&nbsp;            if (eq.hasFlag(MiscType.F_EXTERNAL_STORES_HARDPOINT)) {</b>
<b class="nc">&nbsp;                return mode.equals(EntityMovementMode.AERODYNE);</b>
&nbsp;            }
<b class="nc">&nbsp;        } else if (eq instanceof WeaponType) {</b>
<b class="nc">&nbsp;            if (((WeaponType) eq).getAmmoType() == AmmoType.T_BPOD) {</b>
<b class="nc">&nbsp;                return !isNaval;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (((WeaponType) eq).getAmmoType() == AmmoType.T_NAIL_RIVET_GUN) {</b>
<b class="nc">&nbsp;                return !mode.equals(EntityMovementMode.VTOL);</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        return true;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean correctWeight(StringBuffer buff, boolean showO, boolean showU) {
<b class="nc">&nbsp;        boolean correct = super.correctWeight(buff, showO, showU);</b>
<b class="nc">&nbsp;        double max = maxTonnage(getEntity().getMovementMode(), getEntity().isSuperHeavy());</b>
<b class="nc">&nbsp;        if (getEntity().getWeight() &gt; max) {</b>
<b class="nc">&nbsp;            correct = false;</b>
<b class="nc">&nbsp;            buff.append(&quot;Exceeds maximum tonnage of &quot;).append(max).append(&quot; for &quot;)</b>
<b class="nc">&nbsp;                    .append(getEntity().getMovementModeAsString())</b>
<b class="nc">&nbsp;                    .append(&quot; combat vehicle.\n&quot;);</b>
&nbsp;        }
<b class="nc">&nbsp;        return correct;</b>
&nbsp;    }
&nbsp;
&nbsp;    public boolean correctCriticals(StringBuffer buff) {
<b class="nc">&nbsp;        List&lt;Mounted&gt; unallocated = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        boolean correct = true;</b>
&nbsp;
<b class="nc">&nbsp;        for (Mounted mount : tank.getMisc()) {</b>
<b class="nc">&nbsp;            if (mount.getLocation() == Entity.LOC_NONE &amp;&amp; !(mount.getCriticals() == 0)) {</b>
<b class="nc">&nbsp;                unallocated.add(mount);</b>
&nbsp;            }
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;        for (Mounted mount : tank.getWeaponList()) {</b>
<b class="nc">&nbsp;            if (mount.getLocation() == Entity.LOC_NONE) {</b>
<b class="nc">&nbsp;                unallocated.add(mount);</b>
&nbsp;            }
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;        for (Mounted mount : tank.getAmmo()) {</b>
<b class="nc">&nbsp;            int ammoType = ((AmmoType)mount.getType()).getAmmoType();</b>
<b class="nc">&nbsp;            if ((mount.getLocation() == Entity.LOC_NONE) &amp;&amp;</b>
<b class="nc">&nbsp;                    (mount.getUsableShotsLeft() &gt; 1</b>
&nbsp;                            || ammoType == AmmoType.T_CRUISE_MISSILE )) {
<b class="nc">&nbsp;                unallocated.add(mount);</b>
&nbsp;            }
<b class="nc">&nbsp;        }</b>
&nbsp;
<b class="nc">&nbsp;        if (!unallocated.isEmpty()) {</b>
<b class="nc">&nbsp;            buff.append(&quot;Unallocated Equipment:\n&quot;);</b>
<b class="nc">&nbsp;            for (Mounted mount : unallocated) {</b>
<b class="nc">&nbsp;                buff.append(mount.getType().getInternalName()).append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;            correct = false;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return correct;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public StringBuffer printEntity() {
<b class="nc">&nbsp;        StringBuffer buff = new StringBuffer();</b>
<b class="nc">&nbsp;        buff.append(&quot;Tank: &quot;).append(tank.getDisplayName()).append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;        buff.append(&quot;Found in: &quot;).append(fileString).append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;        buff.append(printTechLevel());</b>
<b class="nc">&nbsp;        buff.append(&quot;Intro year: &quot;).append(tank.getYear()).append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;        buff.append(printSource());</b>
<b class="nc">&nbsp;        buff.append(printShortMovement());</b>
<b class="nc">&nbsp;        if (correctWeight(buff, true, true)) {</b>
<b class="nc">&nbsp;            buff.append(&quot;Weight: &quot;).append(getWeight()).append(&quot; (&quot;).append(</b>
<b class="nc">&nbsp;                    calculateWeight()).append(&quot;)\n&quot;);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        buff.append(printWeightCalculation()).append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;        printFailedEquipment(buff);</b>
<b class="nc">&nbsp;        return buff;</b>
&nbsp;    }
&nbsp;    
&nbsp;    public StringBuffer printSlotCalculation() {
<b class="nc">&nbsp;        StringBuffer buff = new StringBuffer();</b>
<b class="nc">&nbsp;        buff.append(&quot;Available slots: &quot;).append(tank.getTotalSlots()).append(&quot;\n&quot;);</b>
&nbsp;        // different engines take different amounts of slots
<b class="nc">&nbsp;        int engineSlots = 0;</b>
<b class="nc">&nbsp;        if (tank.hasEngine() &amp;&amp; tank.getEngine().isFusion()) {</b>
<b class="nc">&nbsp;            if (tank.getEngine().getEngineType() == Engine.LIGHT_ENGINE) {</b>
<b class="nc">&nbsp;                engineSlots = 1;</b>
<b class="nc">&nbsp;            } else if (tank.getEngine().getEngineType() == Engine.XL_ENGINE) {</b>
<b class="nc">&nbsp;                engineSlots = tank.getEngine().hasFlag(Engine.CLAN_ENGINE)? 1 : 2;</b>
<b class="nc">&nbsp;            } else if (tank.getEngine().getEngineType() == Engine.XXL_ENGINE) {</b>
<b class="nc">&nbsp;                engineSlots = tank.getEngine().hasFlag(Engine.CLAN_ENGINE)? 2 : 4;</b>
<b class="nc">&nbsp;            } else if (tank.getEngine().getEngineType() == Engine.COMPACT_ENGINE) {</b>
<b class="nc">&nbsp;                engineSlots--;</b>
&nbsp;            }
&nbsp;            
<b class="nc">&nbsp;            if (tank.getEngine().getEngineType() == Engine.LARGE_ENGINE) {</b>
<b class="nc">&nbsp;                engineSlots++;</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        if (engineSlots != 0) {</b>
<b class="nc">&nbsp;            buff.append(StringUtil.makeLength(tank.getEngine().getEngineName(), 30));</b>
<b class="nc">&nbsp;            buff.append(engineSlots).append(&quot;\n&quot;);</b>
&nbsp;        }
&nbsp;
&nbsp;        // JJs take just 1 slot
<b class="nc">&nbsp;        if (tank.getJumpMP(false) &gt; 0) {</b>
<b class="nc">&nbsp;            buff.append(StringUtil.makeLength(&quot;Jump Jets&quot;, 30)).append(&quot;1\n&quot;);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        boolean addedCargo = false;</b>
<b class="nc">&nbsp;        for (Mounted mount : tank.getEquipment()) {</b>
<b class="nc">&nbsp;            if ((mount.getType() instanceof MiscType)</b>
<b class="nc">&nbsp;                    &amp;&amp; mount.getType().hasFlag(MiscType.F_CARGO)) {</b>
<b class="nc">&nbsp;                if (!addedCargo) {</b>
<b class="nc">&nbsp;                    buff.append(StringUtil.makeLength(mount.getName(), 30));</b>
<b class="nc">&nbsp;                    buff.append(mount.getType().getTankSlots(tank)).append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;                    addedCargo = true;</b>
<b class="nc">&nbsp;                    continue;</b>
&nbsp;                } else {
&nbsp;                    continue;
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            if (!((mount.getType() instanceof AmmoType) || Arrays.asList(</b>
<b class="nc">&nbsp;                    EquipmentType.armorNames).contains(</b>
<b class="nc">&nbsp;                    mount.getType().getName()))) {</b>
<b class="nc">&nbsp;                buff.append(StringUtil.makeLength(mount.getName(), 30));</b>
<b class="nc">&nbsp;                buff.append(mount.getType().getTankSlots(tank)).append(&quot;\n&quot;);</b>
&nbsp;            }
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;        if (tank.getExtraCrewSeats() &gt; 0) {</b>
<b class="nc">&nbsp;            buff.append(StringUtil.makeLength(&quot;Combat Crew Seats:&quot;, 30));</b>
<b class="nc">&nbsp;            buff.append(tank.getExtraCrewSeats()).append(&quot;\n&quot;);</b>
&nbsp;        }
&nbsp;        // different armor types take different amount of slots
<b class="nc">&nbsp;        int armorSlots = 0;</b>
<b class="nc">&nbsp;        if (!tank.hasPatchworkArmor()) {</b>
<b class="nc">&nbsp;            int type = tank.getArmorType(1);</b>
<b class="nc">&nbsp;            switch (type) {</b>
&nbsp;                case EquipmentType.T_ARMOR_FERRO_FIBROUS:
<b class="nc">&nbsp;                    if (TechConstants.isClan(tank.getArmorTechLevel(1))) {</b>
<b class="nc">&nbsp;                        armorSlots++;</b>
&nbsp;                    } else {
<b class="nc">&nbsp;                        armorSlots += 2;</b>
&nbsp;                    }
<b class="nc">&nbsp;                    break;</b>
&nbsp;                case EquipmentType.T_ARMOR_HEAVY_FERRO:
<b class="nc">&nbsp;                    armorSlots += 3;</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                case EquipmentType.T_ARMOR_LIGHT_FERRO:
&nbsp;                case EquipmentType.T_ARMOR_FERRO_LAMELLOR:
&nbsp;                case EquipmentType.T_ARMOR_REFLECTIVE:
&nbsp;                case EquipmentType.T_ARMOR_HARDENED:
<b class="nc">&nbsp;                    armorSlots++;</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                case EquipmentType.T_ARMOR_STEALTH:
<b class="nc">&nbsp;                    armorSlots += 2;</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                case EquipmentType.T_ARMOR_REACTIVE:
<b class="nc">&nbsp;                    if (TechConstants.isClan(tank.getArmorTechLevel(1))) {</b>
<b class="nc">&nbsp;                        armorSlots++;</b>
&nbsp;                    } else {
<b class="nc">&nbsp;                        armorSlots += 2;</b>
&nbsp;                    }
<b class="nc">&nbsp;                    break;</b>
&nbsp;                default:
&nbsp;                    break;
&nbsp;            }
<b class="nc">&nbsp;            if (armorSlots != 0) {</b>
<b class="nc">&nbsp;                buff.append(StringUtil.makeLength(EquipmentType.getArmorTypeName(type,</b>
<b class="nc">&nbsp;                        TechConstants.isClan(tank.getArmorTechLevel(1))), 30));</b>
<b class="nc">&nbsp;                buff.append(armorSlots).append(&quot;\n&quot;);</b>
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;        // for ammo, each type of ammo takes one slots, regardless of
&nbsp;        // submunition type
<b class="nc">&nbsp;        Map&lt;String, Boolean&gt; foundAmmo = new HashMap&lt;&gt;();</b>
<b class="nc">&nbsp;        for (Mounted ammo : tank.getAmmo()) {</b>
&nbsp;            // don&#39;t count oneshot ammo
<b class="nc">&nbsp;            if ((ammo.getLocation() == Entity.LOC_NONE)</b>
<b class="nc">&nbsp;                    &amp;&amp; (ammo.getBaseShotsLeft() == 1)) {</b>
<b class="nc">&nbsp;                continue;</b>
&nbsp;            }
<b class="nc">&nbsp;            AmmoType at = (AmmoType) ammo.getType();</b>
<b class="nc">&nbsp;            if (foundAmmo.get(at.getAmmoType() + &quot;:&quot; + at.getRackSize()) == null) {</b>
<b class="nc">&nbsp;                buff.append(StringUtil.makeLength(at.getName(), 30));</b>
<b class="nc">&nbsp;                buff.append(&quot;1\n&quot;);</b>
<b class="nc">&nbsp;                foundAmmo.put(at.getAmmoType() + &quot;:&quot; + at.getRackSize(), true);</b>
&nbsp;            }
<b class="nc">&nbsp;        }</b>
&nbsp;        // if a tank has an infantry bay, add 1 slots (multiple bays take 1 slot
&nbsp;        // total)
<b class="nc">&nbsp;        boolean infantryBayCounted = false;</b>
<b class="nc">&nbsp;        for (Transporter transport : tank.getTransports()) {</b>
<b class="nc">&nbsp;            if (transport instanceof TroopSpace) {</b>
<b class="nc">&nbsp;                buff.append(StringUtil.makeLength(&quot;Troop Space&quot;, 30));</b>
<b class="nc">&nbsp;                buff.append(&quot;1\n&quot;);</b>
<b class="nc">&nbsp;                infantryBayCounted = true;</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            }
<b class="nc">&nbsp;        }</b>
&nbsp;        // unit transport bays take 1 slot each
<b class="nc">&nbsp;        for (Bay bay : tank.getTransportBays()) {</b>
<b class="nc">&nbsp;            if (((bay instanceof BattleArmorBay) || (bay instanceof InfantryBay))</b>
&nbsp;                    &amp;&amp; !infantryBayCounted) {
<b class="nc">&nbsp;                buff.append(StringUtil.makeLength(&quot;Infantry Bay&quot;, 30));</b>
<b class="nc">&nbsp;                buff.append(&quot;1&quot;).append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;                infantryBayCounted = true;</b>
&nbsp;            } else {
<b class="nc">&nbsp;                buff.append(StringUtil.makeLength(&quot;Transport Bay&quot;, 30));</b>
<b class="nc">&nbsp;                buff.append(&quot;1&quot;).append(&quot;\n&quot;);</b>
&nbsp;            }
<b class="nc">&nbsp;        }        </b>
<b class="nc">&nbsp;        return buff;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public String getName() {
<b class="nc">&nbsp;        return &quot;Tank: &quot; + tank.getDisplayName();</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public double getWeightPowerAmp() {
<b class="nc">&nbsp;        if (getEntity().isSupportVehicle() &amp;&amp; (getEntity().getWeight() &lt; 5)) {</b>
<b class="nc">&nbsp;            return 0;</b>
&nbsp;        }
&nbsp;    	
<b class="nc">&nbsp;        if (!engine.isFusion() &amp;&amp; (engine.getEngineType() != Engine.FISSION)) {</b>
<b class="nc">&nbsp;            double weight = 0;</b>
<b class="nc">&nbsp;            for (Mounted m : tank.getWeaponList()) {</b>
<b class="nc">&nbsp;                WeaponType wt = (WeaponType) m.getType();</b>
<b class="nc">&nbsp;                if (wt.hasFlag(WeaponType.F_ENERGY) &amp;&amp; !(wt instanceof CLChemicalLaserWeapon) &amp;&amp; !(wt instanceof VehicleFlamerWeapon)) {</b>
<b class="nc">&nbsp;                    weight += m.getTonnage();</b>
&nbsp;                }
<b class="nc">&nbsp;                if ((m.getLinkedBy() != null) &amp;&amp; (m.getLinkedBy().getType() instanceof</b>
<b class="nc">&nbsp;                        MiscType) &amp;&amp; m.getLinkedBy().getType().</b>
<b class="nc">&nbsp;                        hasFlag(MiscType.F_PPC_CAPACITOR)) {</b>
<b class="nc">&nbsp;                    weight += m.getLinkedBy().getTonnage();</b>
&nbsp;                }
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;            for (Mounted m : tank.getMisc()) {</b>
<b class="nc">&nbsp;                if (m.getType().hasFlag(MiscType.F_CLUB) &amp;&amp; m.getType().hasSubType(MiscType.S_SPOT_WELDER)) {</b>
<b class="nc">&nbsp;                    weight += m.getTonnage();</b>
&nbsp;                }
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;            return TestEntity.ceil(weight / 10, getWeightCeilingPowerAmp());</b>
&nbsp;        }
<b class="nc">&nbsp;        return 0;</b>
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * Check if the unit has combinations of equipment which are not allowed in
&nbsp;     * the construction rules.
&nbsp;     *
&nbsp;     * @param buff
&nbsp;     *            diagnostics are appended to this
&nbsp;     * @return true if the entity is illegal
&nbsp;     */
&nbsp;    @Override
&nbsp;    public boolean hasIllegalEquipmentCombinations(StringBuffer buff) {
<b class="nc">&nbsp;        boolean illegal = super.hasIllegalEquipmentCombinations(buff);</b>
&nbsp;        
<b class="nc">&nbsp;        boolean hasSponsonTurret = false;</b>
&nbsp;
<b class="nc">&nbsp;        for (Mounted m : getEntity().getMisc()) {</b>
<b class="nc">&nbsp;            if (m.getType().hasFlag(MiscType.F_SPONSON_TURRET)) {</b>
<b class="nc">&nbsp;                hasSponsonTurret = true;</b>
&nbsp;            }
<b class="nc">&nbsp;        }</b>
&nbsp;        
<b class="nc">&nbsp;        for (Mounted m : getEntity().getMisc()) {</b>
<b class="nc">&nbsp;            final MiscType misc = (MiscType)m.getType();</b>
&nbsp;            
<b class="nc">&nbsp;            if (misc.hasFlag(MiscType.F_JUMP_JET)) {</b>
<b class="nc">&nbsp;                if (hasSponsonTurret) {</b>
<b class="nc">&nbsp;                    buff.append(&quot;can&#39;t combine vehicular jump jets and sponson turret\n&quot;);</b>
<b class="nc">&nbsp;                    illegal = true;</b>
&nbsp;                }
<b class="nc">&nbsp;                if ((getEntity().getMovementMode() != EntityMovementMode.HOVER)</b>
<b class="nc">&nbsp;                        &amp;&amp; (getEntity().getMovementMode() != EntityMovementMode.WHEELED)</b>
<b class="nc">&nbsp;                        &amp;&amp; (getEntity().getMovementMode() != EntityMovementMode.TRACKED)</b>
<b class="nc">&nbsp;                        &amp;&amp; (getEntity().getMovementMode() != EntityMovementMode.WIGE)) {</b>
<b class="nc">&nbsp;                    buff.append(&quot;jump jets only possible on vehicles with hover, wheeled, tracked, or Wing-in-Ground Effect movement mode\n&quot;);</b>
<b class="nc">&nbsp;                    illegal = true;</b>
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;        }</b>
&nbsp;
<b class="nc">&nbsp;        if ((tank.getMovementMode() == EntityMovementMode.VTOL)</b>
<b class="nc">&nbsp;                || (tank.getMovementMode() == EntityMovementMode.WIGE)</b>
<b class="nc">&nbsp;                || (tank.getMovementMode() == EntityMovementMode.HOVER)) {</b>
<b class="nc">&nbsp;            for (int i = 0; i &lt; tank.locations(); i++) {</b>
<b class="nc">&nbsp;                if (tank.getArmorType(i) == EquipmentType.T_ARMOR_HARDENED) {</b>
<b class="nc">&nbsp;                    buff.append(&quot;Hardened armor can&#39;t be mounted on WiGE/Hover/Wheeled vehicles\n&quot;);</b>
<b class="nc">&nbsp;                    illegal = true;</b>
&nbsp;                }
&nbsp;            }
&nbsp;        }
&nbsp;        
&nbsp;        // Ensure that omni tank turrets aren&#39;t overloaded
<b class="nc">&nbsp;        if (tank.isOmni()) {</b>
&nbsp;            // Check to see if the base chassis turret weight is set
<b class="nc">&nbsp;            double turretWeight = 0;</b>
<b class="nc">&nbsp;            double turret2Weight = 0;</b>
<b class="nc">&nbsp;            for (Mounted m : tank.getEquipment()) {</b>
<b class="nc">&nbsp;                if ((m.getLocation() == tank.getLocTurret2())</b>
<b class="nc">&nbsp;                        &amp;&amp; !(m.getType() instanceof AmmoType)) {</b>
<b class="nc">&nbsp;                    turret2Weight += m.getTonnage();</b>
&nbsp;                }
<b class="nc">&nbsp;                if ((m.getLocation() == tank.getLocTurret())</b>
<b class="nc">&nbsp;                        &amp;&amp; !(m.getType() instanceof AmmoType)) {</b>
<b class="nc">&nbsp;                    turretWeight += m.getTonnage();</b>
&nbsp;                }
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;            turretWeight *= 0.1;</b>
<b class="nc">&nbsp;            turret2Weight *= 0.1;</b>
<b class="nc">&nbsp;            if (tank.isSupportVehicle()) {</b>
<b class="nc">&nbsp;                if (getEntity().getWeight() &lt; 5) {</b>
<b class="nc">&nbsp;                    turretWeight = TestEntity.ceil(turretWeight, Ceil.KILO);</b>
<b class="nc">&nbsp;                    turret2Weight = TestEntity.ceil(turret2Weight, Ceil.KILO);</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    turretWeight = TestEntity.ceil(turretWeight, Ceil.HALFTON);</b>
<b class="nc">&nbsp;                    turret2Weight = TestEntity.ceil(turret2Weight, Ceil.HALFTON);</b>
&nbsp;                }
&nbsp;            } else {
<b class="nc">&nbsp;                turretWeight = TestEntity.ceil(turretWeight,</b>
<b class="nc">&nbsp;                        getWeightCeilingTurret());</b>
<b class="nc">&nbsp;                turret2Weight = TestEntity.ceil(turret2Weight,</b>
<b class="nc">&nbsp;                        getWeightCeilingTurret());</b>
&nbsp;            }
<b class="nc">&nbsp;            if ((tank.getBaseChassisTurretWeight() &gt;= 0)</b>
<b class="nc">&nbsp;                    &amp;&amp; (turretWeight &gt; tank.getBaseChassisTurretWeight())) {</b>
<b class="nc">&nbsp;                buff.append(&quot;Unit has more weight in the turret than allowed &quot;)</b>
<b class="nc">&nbsp;                        .append(&quot;by base chassis!  Current weight: &quot;)</b>
<b class="nc">&nbsp;                        .append(turretWeight)</b>
<b class="nc">&nbsp;                        .append(&quot;, base chassis turret weight: &quot;)</b>
<b class="nc">&nbsp;                        .append(tank.getBaseChassisTurretWeight()).append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;                illegal = true;</b>
&nbsp;            }
<b class="nc">&nbsp;            if ((tank.getBaseChassisTurret2Weight() &gt;= 0)</b>
<b class="nc">&nbsp;                    &amp;&amp; (turret2Weight &gt; tank.getBaseChassisTurret2Weight())) {</b>
<b class="nc">&nbsp;                buff.append(&quot;Unit has more weight in the second turret than &quot;)</b>
<b class="nc">&nbsp;                        .append(&quot;allowed by base chassis!  Current weight: &quot;)</b>
<b class="nc">&nbsp;                        .append(turret2Weight).append(&quot;, base chassis turret weight: &quot;)</b>
<b class="nc">&nbsp;                        .append(tank.getBaseChassisTurret2Weight()).append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;                illegal = true;</b>
&nbsp;            }
&nbsp;        }
&nbsp;        
<b class="nc">&nbsp;        return illegal;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * @param tank      The Tank
&nbsp;     * @param eq        The equipment
&nbsp;     * @param location  A location index on the Entity
&nbsp;     * @param buffer    If non-null and the location is invalid, will be appended with an explanation
&nbsp;     * @return          Whether the equipment can be mounted in the location on the Tank
&nbsp;     */
&nbsp;    public static boolean isValidTankLocation(Tank tank, EquipmentType eq, int location,
&nbsp;                                              @Nullable StringBuffer buffer) {
<b class="nc">&nbsp;        if (isBodyEquipment(eq) &amp;&amp; (location != Tank.LOC_BODY)) {</b>
<b class="nc">&nbsp;            if (buffer != null) {</b>
<b class="nc">&nbsp;                buffer.append(eq.getName()).append(&quot; must be mounted in the body.\n&quot;);</b>
&nbsp;            }
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;        final boolean isRearLocation;
&nbsp;        final boolean isTurretLocation;
&nbsp;        // SuperHeavyTank and LargeSupportTank have the same location indices.
<b class="nc">&nbsp;        if ((tank instanceof SuperHeavyTank) || (tank instanceof LargeSupportTank)) {</b>
<b class="nc">&nbsp;            isRearLocation = location == SuperHeavyTank.LOC_REAR;</b>
<b class="nc">&nbsp;            isTurretLocation = (location == SuperHeavyTank.LOC_TURRET) || (location == SuperHeavyTank.LOC_TURRET_2);</b>
&nbsp;        } else {
<b class="nc">&nbsp;            isRearLocation = location == Tank.LOC_REAR;</b>
<b class="nc">&nbsp;            isTurretLocation = (location == Tank.LOC_TURRET) || (location == Tank.LOC_TURRET_2);</b>
&nbsp;        }
<b class="nc">&nbsp;        if (eq instanceof MiscType) {</b>
&nbsp;            // Equipment explicitly forbidden to a mast mount
<b class="nc">&nbsp;            if ((eq.hasFlag(MiscType.F_MODULAR_ARMOR) || eq.hasFlag(MiscType.F_HARJEL)</b>
<b class="nc">&nbsp;                    || eq.hasFlag(MiscType.F_LIGHT_FLUID_SUCTION_SYSTEM) || eq.hasFlag(MiscType.F_LIFTHOIST)</b>
<b class="nc">&nbsp;                    || eq.hasFlag(MiscType.F_MANIPULATOR) || eq.hasFlag(MiscType.F_FLUID_SUCTION_SYSTEM)</b>
<b class="nc">&nbsp;                    || eq.hasFlag(MiscType.F_LIGHT_FLUID_SUCTION_SYSTEM) || eq.hasFlag(MiscType.F_SPRAYER))</b>
&nbsp;                    &amp;&amp; (tank instanceof VTOL) &amp;&amp; (location == VTOL.LOC_ROTOR)) {
<b class="nc">&nbsp;                if (buffer != null) {</b>
<b class="nc">&nbsp;                    buffer.append(eq.getName()).append(&quot; cannot be mounted in the rotor.\n&quot;);</b>
&nbsp;                }
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
<b class="nc">&nbsp;            if ((eq.hasFlag(MiscType.F_HARJEL) || eq.hasFlag(MiscType.F_LIGHT_FLUID_SUCTION_SYSTEM)</b>
<b class="nc">&nbsp;                    || eq.hasFlag(MiscType.F_SPRAYER)</b>
<b class="nc">&nbsp;                    || (eq.hasFlag(MiscType.F_LIFTHOIST) &amp;&amp; !(tank instanceof VTOL)))</b>
&nbsp;                    &amp;&amp; (location == Tank.LOC_BODY)) {
<b class="nc">&nbsp;                if (buffer != null) {</b>
<b class="nc">&nbsp;                    buffer.append(eq.getName()).append(&quot; cannot be mounted in the body.\n&quot;);</b>
&nbsp;                }
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (eq.hasFlag(MiscType.F_BULLDOZER) &amp;&amp; ((location != Tank.LOC_FRONT) &amp;&amp; (location != Tank.LOC_REAR))) {</b>
<b class="nc">&nbsp;                if (buffer != null) {</b>
<b class="nc">&nbsp;                    buffer.append(eq.getName()).append(&quot; must be mounted on the front or rear.\n&quot;);</b>
&nbsp;                }
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (eq.hasFlag(MiscType.F_CLUB) &amp;&amp; eq.hasSubType(MiscType.S_PILE_DRIVER)</b>
&nbsp;                    &amp;&amp; (location != Tank.LOC_FRONT) &amp;&amp; !isRearLocation) {
<b class="nc">&nbsp;                if (buffer != null) {</b>
<b class="nc">&nbsp;                    buffer.append(eq.getName()).append(&quot; must be mounted on the front or rear.\n&quot;);</b>
&nbsp;                }
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (eq.hasFlag(MiscType.F_CLUB) &amp;&amp; eq.hasSubType(MiscType.S_WRECKING_BALL) &amp;&amp; !isTurretLocation) {</b>
<b class="nc">&nbsp;                if (buffer != null) {</b>
<b class="nc">&nbsp;                    buffer.append(eq.getName()).append(&quot; must be mounted on a turret.\n&quot;);</b>
&nbsp;                }
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (eq.hasFlag(MiscType.F_CLUB) &amp;&amp; !eq.hasSubType(MiscType.S_PILE_DRIVER | MiscType.S_SPOT_WELDER</b>
&nbsp;                    | MiscType.S_WRECKING_BALL)
&nbsp;                    &amp;&amp; (location != Tank.LOC_FRONT) &amp;&amp; !isRearLocation &amp;&amp; !isTurretLocation) {
<b class="nc">&nbsp;                if (buffer != null) {</b>
<b class="nc">&nbsp;                    buffer.append(eq.getName()).append(&quot; must be mounted on the front, rear, or turret.\n&quot;);</b>
&nbsp;                }
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (eq.hasFlag(MiscType.F_LADDER) &amp;&amp; ((location == Tank.LOC_FRONT) || isRearLocation</b>
&nbsp;                    || ((tank instanceof VTOL) &amp;&amp; (location == VTOL.LOC_ROTOR)))) {
<b class="nc">&nbsp;                if (buffer != null) {</b>
<b class="nc">&nbsp;                    buffer.append(eq.getName()).append(&quot; must be mounted on the side or turret.\n&quot;);</b>
&nbsp;                }
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (eq.hasFlag(MiscType.F_MAST_MOUNT) &amp;&amp; (location != VTOL.LOC_ROTOR)) {</b>
<b class="nc">&nbsp;                if (buffer != null) {</b>
<b class="nc">&nbsp;                    buffer.append(eq.getName()).append(&quot; must be mounted on the rotor.\n&quot;);</b>
&nbsp;                }
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
&nbsp;            // The minesweeper is also permitted in the front-side/rear-side location for &quot;particularly
&nbsp;            // large vehicles&quot; (TacOps, 326) but it is not clear how large this needs to be. Superheavy?
&nbsp;            // multi-hex large naval support?
<b class="nc">&nbsp;            if (eq.hasFlag(MiscType.F_MINESWEEPER) &amp;&amp; (location != Tank.LOC_FRONT) &amp;&amp; !isRearLocation) {</b>
<b class="nc">&nbsp;                if (buffer != null) {</b>
<b class="nc">&nbsp;                    buffer.append(eq.getName()).append(&quot; must be mounted on the front or rear.\n&quot;);</b>
&nbsp;                }
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
<b class="nc">&nbsp;        } else if (eq instanceof WeaponType) {</b>
<b class="nc">&nbsp;            if ((((WeaponType) eq).getAmmoType() == AmmoType.T_GAUSS_HEAVY)</b>
&nbsp;                    &amp;&amp; (location != Tank.LOC_FRONT) &amp;&amp; !isRearLocation) {
<b class="nc">&nbsp;                if (buffer != null) {</b>
<b class="nc">&nbsp;                    buffer.append(eq.getName()).append(&quot; cannot be mounted on the sides or turret.\n&quot;);</b>
&nbsp;                }
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
<b class="nc">&nbsp;            if ((((WeaponType) eq).getAmmoType() == AmmoType.T_IGAUSS_HEAVY)</b>
&nbsp;                    &amp;&amp; isTurretLocation) {
<b class="nc">&nbsp;                if (buffer != null) {</b>
<b class="nc">&nbsp;                    buffer.append(eq.getName()).append(&quot; cannot be mounted on a turret.\n&quot;);</b>
&nbsp;                }
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (!eq.hasFlag(WeaponType.F_C3M) &amp;&amp; !eq.hasFlag(WeaponType.F_C3MBS)</b>
<b class="nc">&nbsp;                    &amp;&amp; !eq.hasFlag(WeaponType.F_TAG) &amp;&amp; (location == Tank.LOC_BODY)) {</b>
<b class="nc">&nbsp;                if (buffer != null) {</b>
<b class="nc">&nbsp;                    buffer.append(eq.getName()).append(&quot; cannot be mounted in the body.\n&quot;);</b>
&nbsp;                }
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
<b class="nc">&nbsp;            if ((tank instanceof VTOL) &amp;&amp; (location == VTOL.LOC_ROTOR)</b>
<b class="nc">&nbsp;                    &amp;&amp; !eq.hasFlag(WeaponType.F_TAG)) {</b>
<b class="nc">&nbsp;                if (buffer != null) {</b>
<b class="nc">&nbsp;                    buffer.append(eq.getName()).append(&quot; cannot be mounted in the rotor.\n&quot;);</b>
&nbsp;                }
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        return true;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Determines whether a piece of equipment should be mounted in the body location.
&nbsp;     *
&nbsp;     * @param eq       The equipment
&nbsp;     * @return         Whether the equipment needs to be assigned to the body location.
&nbsp;     */
&nbsp;    public static boolean isBodyEquipment(EquipmentType eq) {
<b class="nc">&nbsp;        if (eq instanceof MiscType) {</b>
<b class="nc">&nbsp;            return eq.hasFlag(MiscType.F_CHASSIS_MODIFICATION)</b>
<b class="nc">&nbsp;                    || (eq.hasFlag(MiscType.F_CASE) &amp;&amp; !eq.isClan())</b>
<b class="nc">&nbsp;                    || eq.hasFlag(MiscType.F_CASEII)</b>
<b class="nc">&nbsp;                    || eq.hasFlag(MiscType.F_JUMP_JET)</b>
<b class="nc">&nbsp;                    || eq.hasFlag(MiscType.F_FUEL)</b>
<b class="nc">&nbsp;                    || eq.hasFlag(MiscType.F_BLUE_SHIELD);</b>
&nbsp;        } else {
<b class="nc">&nbsp;            return eq instanceof AmmoType;</b>
&nbsp;        }
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2023-05-16 16:28</div>
</div>
</body>
</html>
