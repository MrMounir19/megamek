


<!DOCTYPE html>
<html id="htmlId">
<head>
  <title>Coverage Report > TestMech</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">megamek.common.verifier</a>
</div>

<h1>Coverage Summary for Class: TestMech (megamek.common.verifier)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">TestMech</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/44)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/993)
  </span>
</td>
</tr>
  <tr>
    <td class="name">TestMech$MechJumpJets</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/6)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/19)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/50)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1012)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;/*
&nbsp; * MegaMek -
&nbsp; * Copyright (C) 2000,2001,2002,2003,2004,2005 Ben Mazur (bmazur@sev.org)
&nbsp; *
&nbsp; *  This program is free software; you can redistribute it and/or modify it
&nbsp; *  under the terms of the GNU General Public License as published by the Free
&nbsp; *  Software Foundation; either version 2 of the License, or (at your option)
&nbsp; *  any later version.
&nbsp; *
&nbsp; *  This program is distributed in the hope that it will be useful, but
&nbsp; *  WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
&nbsp; *  or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License
&nbsp; *  for more details.
&nbsp; */
&nbsp;
&nbsp;/*
&nbsp; * Author: Reinhard Vicinus
&nbsp; */
&nbsp;
&nbsp;package megamek.common.verifier;
&nbsp;
&nbsp;import java.io.Serializable;
&nbsp;import java.util.ArrayList;
&nbsp;import java.util.Enumeration;
&nbsp;import java.util.HashMap;
&nbsp;import java.util.HashSet;
&nbsp;import java.util.List;
&nbsp;import java.util.Map;
&nbsp;import java.util.Set;
&nbsp;import java.util.Vector;
&nbsp;import java.util.stream.Collectors;
&nbsp;
&nbsp;import megamek.common.*;
&nbsp;import megamek.common.annotations.Nullable;
&nbsp;import megamek.common.util.StringUtil;
&nbsp;import megamek.common.weapons.artillery.ArtilleryWeapon;
&nbsp;import megamek.common.weapons.autocannons.ACWeapon;
&nbsp;import megamek.common.weapons.autocannons.LBXACWeapon;
&nbsp;import megamek.common.weapons.autocannons.UACWeapon;
&nbsp;import megamek.common.weapons.gaussrifles.GaussWeapon;
&nbsp;import megamek.common.weapons.lasers.EnergyWeapon;
&nbsp;import megamek.common.weapons.ppc.PPCWeapon;
&nbsp;
&nbsp;public class TestMech extends TestEntity {
&nbsp;
<b class="nc">&nbsp;    public enum MechJumpJets {</b>
<b class="nc">&nbsp;        JJ_STANDARD (EquipmentTypeLookup.JUMP_JET, true, Mech.JUMP_STANDARD),</b>
<b class="nc">&nbsp;        JJ_IMPROVED (EquipmentTypeLookup.IMPROVED_JUMP_JET, false, Mech.JUMP_IMPROVED),</b>
<b class="nc">&nbsp;        JJ_PROTOTYPE (EquipmentTypeLookup.PROTOTYPE_JUMP_JET, true, Mech.JUMP_PROTOTYPE),</b>
<b class="nc">&nbsp;        JJ_PROTOTYPE_IMPROVED (EquipmentTypeLookup.PROTOTYPE_IMPROVED_JJ, false, Mech.JUMP_PROTOTYPE_IMPROVED),</b>
<b class="nc">&nbsp;        JJ_UMU (EquipmentTypeLookup.MECH_UMU, false, Mech.JUMP_NONE),</b>
<b class="nc">&nbsp;        JJ_BOOSTER (EquipmentTypeLookup.MECH_JUMP_BOOSTER, true, Mech.JUMP_BOOSTER);</b>
&nbsp;        
&nbsp;        private String internalName;
&nbsp;        private boolean industrial;
&nbsp;        private int jumpType;
&nbsp;        
<b class="nc">&nbsp;        MechJumpJets(String internalName, boolean industrial, int jumpType) {</b>
<b class="nc">&nbsp;            this.internalName = internalName;</b>
<b class="nc">&nbsp;            this.industrial = industrial;</b>
<b class="nc">&nbsp;            this.jumpType = jumpType;</b>
&nbsp;        }
&nbsp;        
&nbsp;        public String getName() {
<b class="nc">&nbsp;            return internalName;</b>
&nbsp;        }
&nbsp;        
&nbsp;        public boolean canIndustrialUse() {
<b class="nc">&nbsp;            return industrial;</b>
&nbsp;        }
&nbsp;        
&nbsp;        public int getJumpType() {
<b class="nc">&nbsp;            return jumpType;</b>
&nbsp;        }
&nbsp;        
&nbsp;        public static List&lt;EquipmentType&gt; allJJs(boolean industrialOnly) {
<b class="nc">&nbsp;            List&lt;EquipmentType&gt; retVal = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;            for (MechJumpJets jj : values()) {</b>
<b class="nc">&nbsp;                if (jj.industrial || !industrialOnly) {</b>
<b class="nc">&nbsp;                    retVal.add(EquipmentType.get(jj.internalName));</b>
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            return retVal;</b>
&nbsp;        }
&nbsp;
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * Filters all mech armor according to given tech constraints
&nbsp;     *
&nbsp;     * @param etype
&nbsp;     * @param industrial
&nbsp;     * @param techManager
&nbsp;     * @return
&nbsp;     */
&nbsp;    public static List&lt;EquipmentType&gt; legalArmorsFor(long etype, boolean industrial, ITechManager techManager) {
<b class="nc">&nbsp;        List&lt;EquipmentType&gt; retVal = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        boolean industrialOnly = industrial</b>
<b class="nc">&nbsp;                &amp;&amp; (techManager.getTechLevel().ordinal() &lt; SimpleTechLevel.EXPERIMENTAL.ordinal());</b>
<b class="nc">&nbsp;        boolean isLam = (etype &amp; Entity.ETYPE_LAND_AIR_MECH) != 0;</b>
<b class="nc">&nbsp;        for (int at = 0; at &lt; EquipmentType.armorNames.length; at++) {</b>
<b class="nc">&nbsp;            if ((at == EquipmentType.T_ARMOR_PATCHWORK)</b>
&nbsp;                    || (isLam &amp;&amp; (at == EquipmentType.T_ARMOR_HARDENED))) {
<b class="nc">&nbsp;                continue;</b>
&nbsp;            }
<b class="nc">&nbsp;            String name = EquipmentType.getArmorTypeName(at, techManager.useClanTechBase());</b>
<b class="nc">&nbsp;            EquipmentType eq = EquipmentType.get(name);</b>
<b class="nc">&nbsp;            if ((null != eq)</b>
<b class="nc">&nbsp;                    &amp;&amp; eq.hasFlag(MiscType.F_MECH_EQUIPMENT)</b>
<b class="nc">&nbsp;                    &amp;&amp; techManager.isLegal(eq)</b>
<b class="nc">&nbsp;                    &amp;&amp; (!isLam || (eq.getCriticals(null) == 0))</b>
<b class="nc">&nbsp;                    &amp;&amp; (!industrialOnly || ((MiscType)eq).isIndustrial())) {</b>
<b class="nc">&nbsp;                retVal.add(eq);</b>
&nbsp;            }
<b class="nc">&nbsp;            if (techManager.useMixedTech()) {</b>
<b class="nc">&nbsp;                name = EquipmentType.getArmorTypeName(at, !techManager.useClanTechBase());</b>
<b class="nc">&nbsp;                EquipmentType eq2 = EquipmentType.get(name);</b>
<b class="nc">&nbsp;                if ((null != eq2) &amp;&amp; (eq != eq2)</b>
<b class="nc">&nbsp;                        &amp;&amp; eq2.hasFlag(MiscType.F_MECH_EQUIPMENT)</b>
<b class="nc">&nbsp;                        &amp;&amp; techManager.isLegal(eq2)</b>
<b class="nc">&nbsp;                        &amp;&amp; (!isLam || (eq2.getCriticals(null) == 0))</b>
<b class="nc">&nbsp;                        &amp;&amp; (!industrialOnly || ((null != eq) &amp;&amp; ((MiscType)eq).isIndustrial()))) {</b>
<b class="nc">&nbsp;                    retVal.add(eq2);</b>
&nbsp;                }
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        return retVal;</b>
&nbsp;    }
&nbsp;    
<b class="nc">&nbsp;    private Mech mech = null;</b>
&nbsp;
&nbsp;    public TestMech(Mech mech, TestEntityOption option, String fileString) {
<b class="nc">&nbsp;        super(option, mech.getEngine(), getArmor(mech), getStructure(mech));</b>
<b class="nc">&nbsp;        this.mech = mech;</b>
<b class="nc">&nbsp;        this.fileString = fileString;</b>
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    private static Structure getStructure(Mech mech) {
<b class="nc">&nbsp;        int type = mech.getStructureType();</b>
<b class="nc">&nbsp;        return new Structure(type, mech.isSuperHeavy(), mech.getMovementMode());</b>
&nbsp;    }
&nbsp;
&nbsp;    private static Armor[] getArmor(Mech mech) {
&nbsp;        Armor[] armor;
<b class="nc">&nbsp;        if (!mech.hasPatchworkArmor()) {</b>
<b class="nc">&nbsp;            armor = new Armor[1];</b>
<b class="nc">&nbsp;            int type = mech.getArmorType(1);</b>
<b class="nc">&nbsp;            int flag = 0;</b>
<b class="nc">&nbsp;            if (mech.isClanArmor(1)) {</b>
<b class="nc">&nbsp;                flag |= Armor.CLAN_ARMOR;</b>
&nbsp;            }
<b class="nc">&nbsp;            armor[0] = new Armor(type, flag);</b>
<b class="nc">&nbsp;            return armor;</b>
&nbsp;        } else {
<b class="nc">&nbsp;            armor = new Armor[mech.locations()];</b>
<b class="nc">&nbsp;            for (int i = 0; i &lt; mech.locations(); i++) {</b>
<b class="nc">&nbsp;                int type = mech.getArmorType(i);</b>
<b class="nc">&nbsp;                int flag = 0;</b>
<b class="nc">&nbsp;                if (mech.isClanArmor(i)) {</b>
<b class="nc">&nbsp;                    flag |= Armor.CLAN_ARMOR;</b>
&nbsp;                }
<b class="nc">&nbsp;                armor[i] = new Armor(type, flag);</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        return armor;</b>
&nbsp;    }
&nbsp;    
&nbsp;    public static Integer maxJumpMP(Mech mech) {
<b class="nc">&nbsp;        if (mech.isSuperHeavy()) {</b>
<b class="nc">&nbsp;            return 0;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (mech.getJumpType() == Mech.JUMP_BOOSTER) {</b>
<b class="nc">&nbsp;            return null;</b>
<b class="nc">&nbsp;        } else if (!mech.hasEngine() || (!mech.getEngine().isFusion() &amp;&amp; (mech.getEngine().getEngineType() != Engine.FISSION))) {</b>
<b class="nc">&nbsp;            return 0;</b>
<b class="nc">&nbsp;        } else if ((mech.getJumpType() == Mech.JUMP_IMPROVED)</b>
<b class="nc">&nbsp;                || (mech.getJumpType() == Mech.JUMP_PROTOTYPE_IMPROVED)) {</b>
<b class="nc">&nbsp;            return (int)Math.ceil(mech.getOriginalWalkMP() * 1.5);</b>
&nbsp;        } else {
<b class="nc">&nbsp;            return mech.getOriginalWalkMP();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public Entity getEntity() {
<b class="nc">&nbsp;        return mech;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean isTank() {
<b class="nc">&nbsp;        return false;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean isMech() {
<b class="nc">&nbsp;        return true;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean isAero() {
<b class="nc">&nbsp;        return false;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean isSmallCraft() {
<b class="nc">&nbsp;        return false;</b>
&nbsp;    }
&nbsp;    
&nbsp;    @Override
&nbsp;    public boolean isAdvancedAerospace() {
<b class="nc">&nbsp;        return false;</b>
&nbsp;    }
&nbsp;    
&nbsp;    @Override
&nbsp;    public boolean isProtomech() {
<b class="nc">&nbsp;        return false;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public double getWeightMisc() {
&nbsp;        // LAM/QuadVee equipment is 10% of mass, rounded up to whole number (15% for bimodal LAM).
&nbsp;        // IO p. 113 (LAM), 134 (QV)
<b class="nc">&nbsp;        if (mech instanceof LandAirMech) {</b>
<b class="nc">&nbsp;            return Math.ceil(mech.getWeight()) *</b>
<b class="nc">&nbsp;                    (((LandAirMech) mech).getLAMType() == LandAirMech.LAM_BIMODAL ? 0.15 : 0.1);</b>
<b class="nc">&nbsp;        } else if (mech instanceof QuadVee) {</b>
<b class="nc">&nbsp;            return Math.ceil(mech.getWeight() * 0.1);</b>
&nbsp;        }
<b class="nc">&nbsp;        return 0.0;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public double getWeightPowerAmp() {
<b class="nc">&nbsp;        if (!mech.hasEngine()</b>
<b class="nc">&nbsp;                    || (mech.getEngine().getEngineType() == Engine.COMBUSTION_ENGINE)</b>
<b class="nc">&nbsp;                    || (mech.getEngine().getEngineType() == Engine.FUEL_CELL)) {</b>
<b class="nc">&nbsp;            double powerAmpWeight = 0;</b>
<b class="nc">&nbsp;            for (Mounted m : mech.getWeaponList()) {</b>
<b class="nc">&nbsp;                WeaponType wt = (WeaponType) m.getType();</b>
<b class="nc">&nbsp;                if (wt instanceof EnergyWeapon) {</b>
<b class="nc">&nbsp;                    powerAmpWeight += m.getTonnage();</b>
&nbsp;                }
<b class="nc">&nbsp;                if ((m.getLinkedBy() != null)</b>
<b class="nc">&nbsp;                        &amp;&amp; (m.getLinkedBy().getType() instanceof MiscType)</b>
<b class="nc">&nbsp;                        &amp;&amp; m.getLinkedBy().getType().hasFlag(MiscType.F_PPC_CAPACITOR)) {</b>
<b class="nc">&nbsp;                    powerAmpWeight += m.getLinkedBy().getTonnage();</b>
&nbsp;                }
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;            return TestEntity.ceil(powerAmpWeight / 10f, getWeightCeilingPowerAmp());</b>
&nbsp;        }
<b class="nc">&nbsp;        return 0;</b>
&nbsp;    }
&nbsp;    
&nbsp;    public double getWeightCockpit() {
<b class="nc">&nbsp;        double weight = 3.0;</b>
<b class="nc">&nbsp;        if (mech.getCockpitType() == Mech.COCKPIT_SMALL) {</b>
<b class="nc">&nbsp;            weight = 2.0;</b>
<b class="nc">&nbsp;        } else if (mech.getCockpitType() == Mech.COCKPIT_TORSO_MOUNTED) {</b>
<b class="nc">&nbsp;            weight = 4.0;</b>
<b class="nc">&nbsp;        } else if (mech.getCockpitType() == Mech.COCKPIT_COMMAND_CONSOLE) {</b>
&nbsp;            // Technically, it&#39;s two separate 3-ton pieces of equipment.
&nbsp;            // We&#39;re ignoring that and returning the total, because it&#39;s easier.
<b class="nc">&nbsp;            weight = 6.0;</b>
<b class="nc">&nbsp;        } else if (mech.getCockpitType() == Mech.COCKPIT_DUAL) {</b>
&nbsp;            // Solaris VII - The Game World (German) This is not actually
&nbsp;            // canonical as it
&nbsp;            // has never been repeated in any English language source including
&nbsp;            // Tech Manual
<b class="nc">&nbsp;            weight = 4.0;</b>
<b class="nc">&nbsp;        } else if (mech.getCockpitType() == Mech.COCKPIT_PRIMITIVE) {</b>
<b class="nc">&nbsp;            weight = 5.0;</b>
<b class="nc">&nbsp;        } else if (mech.getCockpitType() == Mech.COCKPIT_PRIMITIVE_INDUSTRIAL) {</b>
<b class="nc">&nbsp;            weight = 5.0;</b>
<b class="nc">&nbsp;        } else if ((mech.getCockpitType() == Mech.COCKPIT_SUPERHEAVY) || (mech.getCockpitType() == Mech.COCKPIT_TRIPOD)) {</b>
<b class="nc">&nbsp;            weight = 4.0;</b>
<b class="nc">&nbsp;        } else if (mech.getCockpitType() == Mech.COCKPIT_SUPERHEAVY_TRIPOD) {</b>
<b class="nc">&nbsp;            weight = 5.0;</b>
<b class="nc">&nbsp;        } else if (mech.getCockpitType() == Mech.COCKPIT_INTERFACE) {</b>
<b class="nc">&nbsp;            weight = 4.0;</b>
<b class="nc">&nbsp;        } else if (mech.getCockpitType() == Mech.COCKPIT_QUADVEE) {</b>
<b class="nc">&nbsp;            weight = 4.0;</b>
<b class="nc">&nbsp;        } else if (mech.getCockpitType() == Mech.COCKPIT_SUPERHEAVY_COMMAND_CONSOLE) {</b>
&nbsp;            // Like as normal command console, it is technically two seperate 4-ton and 3-ton pieces of equipment.
<b class="nc">&nbsp;            weight = 7.0;</b>
<b class="nc">&nbsp;        } else if (mech.getCockpitType() == Mech.COCKPIT_SMALL_COMMAND_CONSOLE) {</b>
&nbsp;            // Like as normal command console, it is technically two seperate 2-ton and 3-ton pieces of equipment. 
<b class="nc">&nbsp;            weight = 5.0;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return weight;</b>
&nbsp;    }
&nbsp;
&nbsp;    public double getWeightGyro() {
<b class="nc">&nbsp;        double retVal = Math.ceil(engine.getRating() / 100.0f);</b>
<b class="nc">&nbsp;        if (mech.getGyroType() == Mech.GYRO_XL) {</b>
<b class="nc">&nbsp;            retVal /= 2;</b>
<b class="nc">&nbsp;        } else if (mech.getGyroType() == Mech.GYRO_COMPACT) {</b>
<b class="nc">&nbsp;            retVal *= 1.5;</b>
<b class="nc">&nbsp;        } else if ((mech.getGyroType() == Mech.GYRO_HEAVY_DUTY)</b>
<b class="nc">&nbsp;                || (mech.getGyroType() == Mech.GYRO_SUPERHEAVY)) {</b>
<b class="nc">&nbsp;            retVal *= 2;</b>
<b class="nc">&nbsp;        } else if (mech.getGyroType() == Mech.GYRO_NONE) {</b>
<b class="nc">&nbsp;            retVal = 0;</b>
&nbsp;        }
<b class="nc">&nbsp;        retVal = ceil(retVal, getWeightCeilingGyro());</b>
<b class="nc">&nbsp;        return retVal;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public double getWeightControls() {
<b class="nc">&nbsp;        return getWeightCockpit() + getWeightGyro();</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public int getCountHeatSinks() {
<b class="nc">&nbsp;        return mech.heatSinks();</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public double getWeightHeatSinks() {
<b class="nc">&nbsp;        boolean hasCompact = false;</b>
<b class="nc">&nbsp;        double compactHsTons = 0;</b>
<b class="nc">&nbsp;        for (Mounted misc : mech.getMisc()) {</b>
<b class="nc">&nbsp;            if (misc.getType().hasFlag(MiscType.F_COMPACT_HEAT_SINK)) {</b>
<b class="nc">&nbsp;                hasCompact = true;</b>
<b class="nc">&nbsp;                compactHsTons += misc.getTonnage();</b>
&nbsp;            }
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;        if (hasCompact) {</b>
<b class="nc">&nbsp;            return compactHsTons</b>
<b class="nc">&nbsp;                    - (engine.getWeightFreeEngineHeatSinks() * 1.5f);</b>
&nbsp;        } else {
<b class="nc">&nbsp;            return mech.heatSinks() - engine.getWeightFreeEngineHeatSinks();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean hasDoubleHeatSinks() {
<b class="nc">&nbsp;        return mech.hasDoubleHeatSinks();</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public String printWeightMisc() {
<b class="nc">&nbsp;        return &quot;&quot;;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public String printWeightControls() {
<b class="nc">&nbsp;        StringBuffer retVal = new StringBuffer(StringUtil.makeLength(</b>
<b class="nc">&nbsp;                mech.getCockpitTypeString() + &quot;:&quot;, getPrintSize() - 5));</b>
<b class="nc">&nbsp;        retVal.append(makeWeightString(getWeightCockpit()));</b>
<b class="nc">&nbsp;        retVal.append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;        retVal.append(StringUtil.makeLength(mech.getGyroTypeString() + &quot;:&quot;,</b>
<b class="nc">&nbsp;                getPrintSize() - 5));</b>
<b class="nc">&nbsp;        retVal.append(makeWeightString(getWeightGyro()));</b>
<b class="nc">&nbsp;        retVal.append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;        return retVal.toString();</b>
&nbsp;    }
&nbsp;
&nbsp;    public Mech getMech() {
<b class="nc">&nbsp;        return mech;</b>
&nbsp;    }
&nbsp;
&nbsp;    public boolean isCockpitLocation(int location) {
<b class="nc">&nbsp;        if (mech.getCockpitType() == Mech.COCKPIT_TORSO_MOUNTED</b>
<b class="nc">&nbsp;                || mech.getCockpitType() == Mech.COCKPIT_VRRP) {</b>
<b class="nc">&nbsp;            return location == Mech.LOC_CT;</b>
&nbsp;        }
<b class="nc">&nbsp;        return location == Mech.LOC_HEAD;</b>
&nbsp;    }
&nbsp;    
&nbsp;    public boolean isEngineLocation(int location) {
<b class="nc">&nbsp;        return mech.hasSystem(Mech.SYSTEM_ENGINE, location);</b>
&nbsp;    }
&nbsp;
&nbsp;    public int countCriticalSlotsFromEquipInLocation(Entity entity, Mounted mount,
&nbsp;            int location) {
<b class="nc">&nbsp;        int count = 0;</b>
<b class="nc">&nbsp;        for (int slots = 0; slots &lt; entity.getNumberOfCriticals(location); slots++) {</b>
<b class="nc">&nbsp;            CriticalSlot slot = entity.getCritical(location, slots);</b>
<b class="nc">&nbsp;            if ((slot == null) || (slot.getType() == CriticalSlot.TYPE_SYSTEM)) {</b>
<b class="nc">&nbsp;                continue;</b>
<b class="nc">&nbsp;            } else if (slot.getType() == CriticalSlot.TYPE_EQUIPMENT) {</b>
<b class="nc">&nbsp;                if (slot.getMount().equals(mount)) {</b>
<b class="nc">&nbsp;                    count++;</b>
&nbsp;                }
&nbsp;            } else {
&nbsp;                // Ignore this?
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        return count;</b>
&nbsp;    }
&nbsp;
&nbsp;    public boolean checkMiscSpreadAllocation(Entity entity, Mounted mounted,
&nbsp;            StringBuffer buff) {
<b class="nc">&nbsp;        MiscType mt = (MiscType) mounted.getType();</b>
<b class="nc">&nbsp;        if (mt.hasFlag(MiscType.F_STEALTH) &amp;&amp; !entity.hasPatchworkArmor()) {</b>
&nbsp;            // stealth needs to have 2 crits in legs arm and side torso
<b class="nc">&nbsp;            if (countCriticalSlotsFromEquipInLocation(entity, mounted,</b>
&nbsp;                    Mech.LOC_LARM) != 2) {
<b class="nc">&nbsp;                buff.append(&quot;incorrect number of stealth crits in left arm\n&quot;);</b>
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (countCriticalSlotsFromEquipInLocation(entity, mounted,</b>
&nbsp;                    Mech.LOC_RARM) != 2) {
<b class="nc">&nbsp;                buff.append(&quot;incorrect number of stealth crits in right arm\n&quot;);</b>
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (countCriticalSlotsFromEquipInLocation(entity, mounted,</b>
&nbsp;                    Mech.LOC_LLEG) != 2) {
<b class="nc">&nbsp;                buff.append(&quot;incorrect number of stealth crits in left leg\n&quot;);</b>
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (countCriticalSlotsFromEquipInLocation(entity, mounted,</b>
&nbsp;                    Mech.LOC_RLEG) != 2) {
<b class="nc">&nbsp;                buff.append(&quot;incorrect number of stealth crits in right leg\n&quot;);</b>
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (countCriticalSlotsFromEquipInLocation(entity, mounted, Mech.LOC_LT) != 2) {</b>
<b class="nc">&nbsp;                buff.append(&quot;incorrect number of stealth crits in left torso\n&quot;);</b>
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (countCriticalSlotsFromEquipInLocation(entity, mounted, Mech.LOC_RT) != 2) {</b>
<b class="nc">&nbsp;                buff.append(&quot;incorrect number of stealth crits in right torso\n&quot;);</b>
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        if (mt.hasFlag(MiscType.F_DRONE_CONTROL_CONSOLE)) {</b>
<b class="nc">&nbsp;            if (mounted.getLocation() != Mech.LOC_HEAD) {</b>
<b class="nc">&nbsp;                buff.append(&quot;Drone Control Console must be mounted in head&quot;);</b>
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        if (mt.hasFlag(MiscType.F_MOBILE_HPG)) {</b>
<b class="nc">&nbsp;            if ((countCriticalSlotsFromEquipInLocation(entity, mounted,</b>
&nbsp;                    Mech.LOC_LARM) &gt; 0)
<b class="nc">&nbsp;                    || (countCriticalSlotsFromEquipInLocation(entity, mounted,</b>
&nbsp;                            Mech.LOC_RARM) &gt; 0)
<b class="nc">&nbsp;                    || (countCriticalSlotsFromEquipInLocation(entity, mounted,</b>
&nbsp;                            Mech.LOC_HEAD) &gt; 0)
<b class="nc">&nbsp;                    || (countCriticalSlotsFromEquipInLocation(entity, mounted,</b>
&nbsp;                            Mech.LOC_LLEG) &gt; 0)
<b class="nc">&nbsp;                    || (countCriticalSlotsFromEquipInLocation(entity, mounted,</b>
&nbsp;                            Mech.LOC_RLEG) &gt; 0)) {
<b class="nc">&nbsp;                buff.append(&quot;ground mobile HPG must be mounted in torso locations\n&quot;);</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        if (mt.hasFlag(MiscType.F_ENVIRONMENTAL_SEALING)) {</b>
&nbsp;            // environmental sealing needs to have 1 crit per location
<b class="nc">&nbsp;            for (int locations = 0; locations &lt; entity.locations(); locations++) {</b>
<b class="nc">&nbsp;                if (countCriticalSlotsFromEquipInLocation(entity, mounted,</b>
&nbsp;                        locations) != 1) {
<b class="nc">&nbsp;                    buff.append(&quot;not an environmental sealing crit in each location\n&quot;);</b>
<b class="nc">&nbsp;                    return false;</b>
&nbsp;                }
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        if (mt.hasFlag(MiscType.F_BLUE_SHIELD)) {</b>
&nbsp;            // blue shield needs to have 1 crit per location, except head
<b class="nc">&nbsp;            for (int locations = 0; locations &lt; entity.locations(); locations++) {</b>
<b class="nc">&nbsp;                if (locations != Mech.LOC_HEAD) {</b>
<b class="nc">&nbsp;                    if (countCriticalSlotsFromEquipInLocation(entity, mounted,</b>
&nbsp;                            locations) != 1) {
<b class="nc">&nbsp;                        buff.append(&quot;not a blue shield crit in each location except the head\n&quot;);</b>
<b class="nc">&nbsp;                        return false;</b>
&nbsp;                    }
&nbsp;                }
&nbsp;
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        if (mt.hasFlag(MiscType.F_PARTIAL_WING)) {</b>
&nbsp;            // partial wing needs 3/4 crits in the side torsos
<b class="nc">&nbsp;            if (countCriticalSlotsFromEquipInLocation(entity, mounted, Mech.LOC_LT) != ((TechConstants.isClan(mt</b>
<b class="nc">&nbsp;                    .getTechLevel(entity.getTechLevelYear()))) ? 3</b>
<b class="nc">&nbsp;                    : 4)) {</b>
<b class="nc">&nbsp;                buff.append(&quot;incorrect number of partial wing crits in left torso\n&quot;);</b>
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (countCriticalSlotsFromEquipInLocation(entity, mounted, Mech.LOC_RT) != ((TechConstants.isClan(mt</b>
<b class="nc">&nbsp;                    .getTechLevel(entity.getTechLevelYear()))) ? 3</b>
<b class="nc">&nbsp;                    : 4)) {</b>
<b class="nc">&nbsp;                buff.append(&quot;incorrect number of partial wing crits in right torso\n&quot;);</b>
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        return true;</b>
&nbsp;    }
&nbsp;
&nbsp;    public boolean criticalSlotsAllocated(Entity entity, Mounted mounted,
&nbsp;            Vector&lt;Serializable&gt; allocation, StringBuffer buff) {
<b class="nc">&nbsp;        int location = mounted.getLocation();</b>
<b class="nc">&nbsp;        EquipmentType et = mounted.getType();</b>
<b class="nc">&nbsp;        int criticals = 0;</b>
<b class="nc">&nbsp;        if (et instanceof MiscType) {</b>
<b class="nc">&nbsp;            criticals = calcMiscCrits((MiscType) et, mounted.getSize());</b>
&nbsp;        } else {
<b class="nc">&nbsp;            criticals = mounted.getCriticals();</b>
&nbsp;        }
<b class="nc">&nbsp;        int count = 0;</b>
&nbsp;
<b class="nc">&nbsp;        if (location == Entity.LOC_NONE) {</b>
<b class="nc">&nbsp;            return true;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (et.isSpreadable() &amp;&amp; !et.getName().equals(&quot;Targeting Computer&quot;)) {</b>
<b class="nc">&nbsp;            for (int locations = 0; locations &lt; entity.locations(); locations++) {</b>
<b class="nc">&nbsp;                count += countCriticalSlotsFromEquipInLocation(entity, mounted,</b>
&nbsp;                        locations);
&nbsp;            }
&nbsp;        } else {
<b class="nc">&nbsp;            count = countCriticalSlotsFromEquipInLocation(entity, mounted,</b>
&nbsp;                    location);
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if ((et instanceof WeaponType) &amp;&amp; mounted.isSplit()) {</b>
<b class="nc">&nbsp;            int secCound = 0;</b>
<b class="nc">&nbsp;            for (int locations = 0; locations &lt; entity.locations(); locations++) {</b>
<b class="nc">&nbsp;                if (locations == location) {</b>
<b class="nc">&nbsp;                    continue;</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                secCound = countCriticalSlotsFromEquipInLocation(entity, mounted,</b>
&nbsp;                        locations);
<b class="nc">&nbsp;                if ((secCound != 0)</b>
<b class="nc">&nbsp;                        &amp;&amp; (location == Mech.mostRestrictiveLoc(locations,</b>
&nbsp;                                location))) {
<b class="nc">&nbsp;                    count += secCound;</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                }
&nbsp;            }
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (count == criticals) {</b>
<b class="nc">&nbsp;            return true;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        allocation.addElement(mounted);</b>
<b class="nc">&nbsp;        allocation.addElement(Integer.valueOf(criticals));</b>
<b class="nc">&nbsp;        allocation.addElement(Integer.valueOf(count));</b>
<b class="nc">&nbsp;        return false;</b>
&nbsp;    }
&nbsp;
&nbsp;    public boolean checkCriticalSlotsForEquipment(Mech mech,
&nbsp;            Vector&lt;Mounted&gt; unallocated, Vector&lt;Serializable&gt; allocation,
&nbsp;            Vector&lt;Integer&gt; heatSinks, StringBuffer buff) {
<b class="nc">&nbsp;        boolean legal = true;</b>
<b class="nc">&nbsp;        int countInternalHeatSinks = 0;</b>
<b class="nc">&nbsp;        for (Mounted m : mech.getEquipment()) {</b>
<b class="nc">&nbsp;            int loc = m.getLocation();</b>
<b class="nc">&nbsp;            if (loc == Entity.LOC_NONE) {</b>
<b class="nc">&nbsp;                if ((m.getType() instanceof AmmoType)</b>
<b class="nc">&nbsp;                        &amp;&amp; (m.getUsableShotsLeft() &lt;= 1)) {</b>
<b class="nc">&nbsp;                    continue;</b>
&nbsp;                }
<b class="nc">&nbsp;                if (m.getCriticals() == 0) {</b>
<b class="nc">&nbsp;                    continue;</b>
&nbsp;                }
<b class="nc">&nbsp;                if (!(m.getType() instanceof MiscType)) {</b>
<b class="nc">&nbsp;                    unallocated.addElement(m);</b>
<b class="nc">&nbsp;                    continue;</b>
&nbsp;                }
<b class="nc">&nbsp;                MiscType mt = (MiscType) m.getType();</b>
<b class="nc">&nbsp;                if (mt.hasFlag(MiscType.F_HEAT_SINK)</b>
<b class="nc">&nbsp;                        || mt.hasFlag(MiscType.F_DOUBLE_HEAT_SINK)</b>
<b class="nc">&nbsp;                        || mt.hasFlag(MiscType.F_IS_DOUBLE_HEAT_SINK_PROTOTYPE)) {</b>
<b class="nc">&nbsp;                    countInternalHeatSinks++;</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    unallocated.addElement(m);</b>
<b class="nc">&nbsp;                    continue;</b>
&nbsp;                }
&nbsp;            }
&nbsp;            // Check for illegal allocations
<b class="nc">&nbsp;            if (mech.isOmni()</b>
&nbsp;                    &amp;&amp; (mech instanceof BipedMech)
&nbsp;                    &amp;&amp; ((loc == Mech.LOC_LARM) || (loc == Mech.LOC_RARM))
<b class="nc">&nbsp;                    &amp;&amp; ((m.getType() instanceof GaussWeapon)</b>
<b class="nc">&nbsp;                            || (m.getType() instanceof ACWeapon)</b>
<b class="nc">&nbsp;                            || (m.getType() instanceof UACWeapon)</b>
<b class="nc">&nbsp;                            || (m.getType() instanceof LBXACWeapon) </b>
<b class="nc">&nbsp;                            || (m.getType() instanceof PPCWeapon))) {</b>
<b class="nc">&nbsp;                String weapon = &quot;&quot;;</b>
<b class="nc">&nbsp;                if (m.getType() instanceof GaussWeapon) {</b>
<b class="nc">&nbsp;                    weapon = &quot;gauss rifles&quot;; </b>
<b class="nc">&nbsp;                } else if ((m.getType() instanceof ACWeapon) </b>
<b class="nc">&nbsp;                        || (m.getType() instanceof UACWeapon)</b>
<b class="nc">&nbsp;                        || (m.getType() instanceof LBXACWeapon)) {</b>
<b class="nc">&nbsp;                    weapon = &quot;autocannons&quot;;</b>
<b class="nc">&nbsp;                } else if (m.getType() instanceof PPCWeapon) {</b>
<b class="nc">&nbsp;                    weapon = &quot;PPCs&quot;;</b>
&nbsp;                }
<b class="nc">&nbsp;                if (mech.hasSystem(Mech.ACTUATOR_LOWER_ARM, loc)</b>
<b class="nc">&nbsp;                        || mech.hasSystem(Mech.ACTUATOR_HAND, loc)) {</b>
<b class="nc">&nbsp;                    buff.append(&quot;Omni mechs with arm mounted &quot;).append(weapon)</b>
<b class="nc">&nbsp;                            .append(&quot; cannot have lower armor or hand actuators!\n&quot;);</b>
<b class="nc">&nbsp;                    legal = false;</b>
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;        if ((countInternalHeatSinks &gt; engine.integralHeatSinkCapacity(this.mech.hasCompactHeatSinks()))</b>
<b class="nc">&nbsp;                || ((countInternalHeatSinks &lt; engine.integralHeatSinkCapacity(this.mech.hasCompactHeatSinks()))</b>
<b class="nc">&nbsp;                        &amp;&amp; (countInternalHeatSinks != mech.heatSinks(false))</b>
<b class="nc">&nbsp;                &amp;&amp; !mech.isOmni())) {</b>
<b class="nc">&nbsp;            heatSinks.addElement(countInternalHeatSinks);</b>
&nbsp;        }
<b class="nc">&nbsp;        return legal;</b>
&nbsp;    }
&nbsp;
&nbsp;    public boolean correctCriticals(StringBuffer buff) {
<b class="nc">&nbsp;        Vector&lt;Mounted&gt; unallocated = new Vector&lt;Mounted&gt;();</b>
<b class="nc">&nbsp;        Vector&lt;Serializable&gt; allocation = new Vector&lt;Serializable&gt;();</b>
<b class="nc">&nbsp;        Vector&lt;Integer&gt; heatSinks = new Vector&lt;Integer&gt;();</b>
<b class="nc">&nbsp;        boolean correct = checkCriticalSlotsForEquipment(mech, unallocated, allocation,</b>
&nbsp;                heatSinks, buff);
&nbsp;        /*
&nbsp;         * StringBuffer critAlloc = new StringBuffer(); need to redo this, in
&nbsp;         * MML, spread equipment gets one mounted per block that needs to be
&nbsp;         * allocated for (Mounted m : mech.getEquipment()) { if
&nbsp;         * ((m.getLocation() != Entity.LOC_NONE) &amp;&amp; (m.getType() instanceof
&nbsp;         * MiscType)) { if (!checkMiscSpreadAllocation(mech, m, critAlloc)) {
&nbsp;         * correct = false; buff.append(critAlloc.toString()); } } }
&nbsp;         */
&nbsp;
<b class="nc">&nbsp;        if (!unallocated.isEmpty()) {</b>
<b class="nc">&nbsp;            buff.append(&quot;Unallocated Equipment:\n&quot;);</b>
<b class="nc">&nbsp;            for (Mounted mount : unallocated) {</b>
<b class="nc">&nbsp;                buff.append(mount.getType().getInternalName()).append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;            correct = false;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (!allocation.isEmpty()) {</b>
<b class="nc">&nbsp;            buff.append(&quot;Allocated Equipment:\n&quot;);</b>
<b class="nc">&nbsp;            for (Enumeration&lt;Serializable&gt; serializableEnum = allocation</b>
<b class="nc">&nbsp;                    .elements(); serializableEnum.hasMoreElements();) {</b>
<b class="nc">&nbsp;                Mounted mount = (Mounted) serializableEnum.nextElement();</b>
<b class="nc">&nbsp;                int needCrits = ((Integer) serializableEnum.nextElement())</b>
<b class="nc">&nbsp;                        .intValue();</b>
<b class="nc">&nbsp;                int aktCrits = ((Integer) serializableEnum.nextElement())</b>
<b class="nc">&nbsp;                        .intValue();</b>
<b class="nc">&nbsp;                buff.append(mount.getType().getInternalName()).append(&quot; has &quot;)</b>
<b class="nc">&nbsp;                        .append(needCrits).append(&quot; Slots, but &quot;)</b>
<b class="nc">&nbsp;                        .append(aktCrits).append(&quot; Slots are allocated!&quot;)</b>
<b class="nc">&nbsp;                        .append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;            correct = false;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (!heatSinks.isEmpty()) {</b>
<b class="nc">&nbsp;            int sinks = heatSinks.elements().nextElement();</b>
<b class="nc">&nbsp;            buff.append(sinks - engine.integralHeatSinkCapacity(mech</b>
<b class="nc">&nbsp;                    .hasCompactHeatSinks())).append(&quot; unallocated heat sinks\n&quot;);</b>
<b class="nc">&nbsp;            correct = false;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (!checkSystemCriticals(buff)) {</b>
<b class="nc">&nbsp;            correct = false;</b>
&nbsp;        }
<b class="nc">&nbsp;        return correct;</b>
&nbsp;    }
&nbsp;
&nbsp;    private boolean checkSystemCriticals(StringBuffer buff) {
&nbsp;        // Engine criticals
<b class="nc">&nbsp;        boolean engineCorrect = true;</b>
<b class="nc">&nbsp;        int requiredSideCrits = engine.getSideTorsoCriticalSlots().length;</b>
<b class="nc">&nbsp;        if ((requiredSideCrits != mech.getNumberOfCriticals(</b>
&nbsp;                CriticalSlot.TYPE_SYSTEM, Mech.SYSTEM_ENGINE, Mech.LOC_LT))
<b class="nc">&nbsp;                || (requiredSideCrits != mech.getNumberOfCriticals(</b>
&nbsp;                        CriticalSlot.TYPE_SYSTEM, Mech.SYSTEM_ENGINE,
&nbsp;                        Mech.LOC_RT))) {
<b class="nc">&nbsp;            engineCorrect = false;</b>
&nbsp;        }
<b class="nc">&nbsp;        int requiredCTCrits = engine.getCenterTorsoCriticalSlots(mech.getGyroType()).length;</b>
<b class="nc">&nbsp;        if (requiredCTCrits != mech</b>
<b class="nc">&nbsp;                .getNumberOfCriticals(CriticalSlot.TYPE_SYSTEM,</b>
&nbsp;                        Mech.SYSTEM_ENGINE, Mech.LOC_CT)) {
<b class="nc">&nbsp;            engineCorrect = false;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (!engineCorrect) {</b>
<b class="nc">&nbsp;            buff.append(&quot;Engine: Incorrect number of criticals allocated.\n&quot;);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (!engineCorrect) {</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (getMech().getGyroType() == Mech.GYRO_NONE</b>
<b class="nc">&nbsp;                &amp;&amp; getMech().getCockpitType() != Mech.COCKPIT_INTERFACE) {</b>
<b class="nc">&nbsp;            buff.append(&quot;Missing Gyro!.\n&quot;);</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return true;</b>
&nbsp;    }
&nbsp;
&nbsp;    public String printArmorLocProp(int loc, int wert) {
<b class="nc">&nbsp;        return &quot; is greater than &quot; + Integer.toString(wert) + &quot;!&quot;;</b>
&nbsp;    }
&nbsp;
&nbsp;    public boolean correctArmor(StringBuffer buff) {
<b class="nc">&nbsp;        boolean correct = true;</b>
<b class="nc">&nbsp;        for (int loc = 0; loc &lt; mech.locations(); loc++) {</b>
<b class="nc">&nbsp;            if (loc == Mech.LOC_HEAD) {</b>
<b class="nc">&nbsp;                if (((mech.getOArmor(Mech.LOC_HEAD) &gt; 9) &amp;&amp; !mech.isSuperHeavy()) || ((mech.getOArmor(Mech.LOC_HEAD) &gt; 12) &amp;&amp; mech.isSuperHeavy())) {</b>
<b class="nc">&nbsp;                    buff.append(printArmorLocation(Mech.LOC_HEAD))</b>
<b class="nc">&nbsp;                            .append(printArmorLocProp(Mech.LOC_HEAD, 9))</b>
<b class="nc">&nbsp;                            .append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;                    correct = false;</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;            } else if ((mech.getOArmor(loc) + (mech.hasRearArmor(loc) ? mech</b>
<b class="nc">&nbsp;                    .getOArmor(loc, true) : 0)) &gt; (2 * mech.getOInternal(loc))) {</b>
<b class="nc">&nbsp;                buff.append(printArmorLocation(loc))</b>
<b class="nc">&nbsp;                        .append(printArmorLocProp(loc,</b>
<b class="nc">&nbsp;                                2 * mech.getOInternal(loc))).append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;                correct = false;</b>
&nbsp;            }
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (!getEntity().hasPatchworkArmor()</b>
<b class="nc">&nbsp;                &amp;&amp; (getEntity().getLabTotalArmorPoints() &lt; getEntity().getTotalOArmor())) {</b>
<b class="nc">&nbsp;            correct = false;</b>
<b class="nc">&nbsp;            buff.append(&quot;Too many armor points allocated&quot;);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return correct;</b>
&nbsp;    }
&nbsp;
&nbsp;    public boolean correctMovement(StringBuffer buff) {
&nbsp;        // Mechanical Jump Boosts can be greater then Running as long as
&nbsp;        // the unit can handle the weight.
<b class="nc">&nbsp;        if ((mech.getJumpMP(false) &gt; mech.getOriginalRunMP())</b>
<b class="nc">&nbsp;                &amp;&amp; !mech.hasJumpBoosters()</b>
<b class="nc">&nbsp;                &amp;&amp; !mech.hasWorkingMisc(MiscType.F_PARTIAL_WING)) {</b>
<b class="nc">&nbsp;            buff.append(&quot;Jump MP exceeds run MP\n&quot;);</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
<b class="nc">&nbsp;        if ((mech.getJumpMP(false) &gt; mech.getOriginalWalkMP())</b>
<b class="nc">&nbsp;                &amp;&amp; (((mech.getJumpType() != Mech.JUMP_IMPROVED) &amp;&amp; (mech.getJumpType() != Mech.JUMP_PROTOTYPE_IMPROVED))</b>
<b class="nc">&nbsp;                        &amp;&amp; !mech.hasWorkingMisc(MiscType.F_PARTIAL_WING) &amp;&amp; !mech</b>
<b class="nc">&nbsp;                            .hasJumpBoosters())) {</b>
<b class="nc">&nbsp;            buff.append(&quot;Jump MP exceeds walk MP without IJJs\n&quot;);</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
<b class="nc">&nbsp;        if ((mech instanceof LandAirMech) &amp;&amp; mech.getJumpMP(false) &lt; 3) {</b>
<b class="nc">&nbsp;            buff.append(&quot;LAMs must have at least 3 jumping MP.\n&quot;);</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
<b class="nc">&nbsp;        return true;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean correctEntity(StringBuffer buff) {
<b class="nc">&nbsp;        return correctEntity(buff, getEntity().getTechLevel());</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean correctEntity(StringBuffer buff, int ammoTechLvl) {
<b class="nc">&nbsp;        boolean correct = true;</b>
<b class="nc">&nbsp;        if (skip()) {</b>
<b class="nc">&nbsp;            return true;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (!correctWeight(buff)) {</b>
<b class="nc">&nbsp;            buff.insert(0, printTechLevel() + printShortMovement());</b>
<b class="nc">&nbsp;            buff.append(printWeightCalculation());</b>
<b class="nc">&nbsp;            correct = false;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (!engine.engineValid) {</b>
<b class="nc">&nbsp;            buff.append(engine.problem.toString()).append(&quot;\n\n&quot;);</b>
<b class="nc">&nbsp;            correct = false;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (getCountHeatSinks() &lt; engine.getWeightFreeEngineHeatSinks()) {</b>
<b class="nc">&nbsp;            buff.append(&quot;Heat Sinks:\n&quot;);</b>
<b class="nc">&nbsp;            buff.append(&quot; Engine    &quot;</b>
<b class="nc">&nbsp;                    + engine.integralHeatSinkCapacity(mech</b>
<b class="nc">&nbsp;                            .hasCompactHeatSinks()) + &quot;\n&quot;);</b>
<b class="nc">&nbsp;            buff.append(&quot; Total     &quot; + getCountHeatSinks() + &quot;\n&quot;);</b>
<b class="nc">&nbsp;            buff.append(&quot; Required  &quot; + engine.getWeightFreeEngineHeatSinks()</b>
&nbsp;                    + &quot;\n&quot;);
<b class="nc">&nbsp;            correct = false;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (showCorrectArmor() &amp;&amp; !correctArmor(buff)) {</b>
<b class="nc">&nbsp;            correct = false;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (showCorrectCritical() &amp;&amp; !correctCriticals(buff)) {</b>
<b class="nc">&nbsp;            correct = false;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (showFailedEquip() &amp;&amp; hasFailedEquipment(buff)) {</b>
<b class="nc">&nbsp;            correct = false;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (hasIllegalTechLevels(buff, ammoTechLvl)) {</b>
<b class="nc">&nbsp;            correct = false;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (showIncorrectIntroYear() &amp;&amp; hasIncorrectIntroYear(buff)) {</b>
<b class="nc">&nbsp;            correct = false;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (hasIllegalEquipmentCombinations(buff)) {</b>
<b class="nc">&nbsp;            correct = false;</b>
&nbsp;        }
<b class="nc">&nbsp;        for (Mounted misc : mech.getMisc()) {</b>
<b class="nc">&nbsp;            correct = correct &amp;&amp; checkMiscSpreadAllocation(mech, misc, buff);</b>
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;        correct = correct &amp;&amp; correctMovement(buff);</b>
<b class="nc">&nbsp;        return correct;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public StringBuffer printEntity() {
<b class="nc">&nbsp;        StringBuffer buff = new StringBuffer();</b>
<b class="nc">&nbsp;        buff.append(&quot;Mech: &quot;).append(mech.getDisplayName()).append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;        buff.append(&quot;Found in: &quot;).append(fileString).append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;        buff.append(printTechLevel());</b>
<b class="nc">&nbsp;        buff.append(&quot;Intro year: &quot;).append(mech.getYear()).append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;        buff.append(printSource());</b>
<b class="nc">&nbsp;        buff.append(printShortMovement());</b>
<b class="nc">&nbsp;        if (correctWeight(buff, true, true)) {</b>
<b class="nc">&nbsp;            buff.append(&quot;Weight: &quot;).append(getWeight()).append(&quot; (&quot;)</b>
<b class="nc">&nbsp;                    .append(calculateWeight()).append(&quot;)\n&quot;);</b>
&nbsp;        }
<b class="nc">&nbsp;        buff.append(printWeightCalculation()).append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;        buff.append(printArmorPlacement());</b>
<b class="nc">&nbsp;        correctArmor(buff);</b>
<b class="nc">&nbsp;        buff.append(printLocations());</b>
<b class="nc">&nbsp;        correctCriticals(buff);</b>
&nbsp;
&nbsp;        // printArmor(buff);
<b class="nc">&nbsp;        printFailedEquipment(buff);</b>
<b class="nc">&nbsp;        return buff;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public String getName() {
<b class="nc">&nbsp;        return &quot;Mech: &quot; + mech.getDisplayName();</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * calculates the total weight of all armored components.
&nbsp;     */
&nbsp;    @Override
&nbsp;    public double getArmoredComponentWeight() {
<b class="nc">&nbsp;        double weight = 0.0;</b>
<b class="nc">&nbsp;        double cockpitWeight = 0.0;</b>
<b class="nc">&nbsp;        for (int location = Mech.LOC_HEAD; location &lt; mech.locations(); location++) {</b>
<b class="nc">&nbsp;            for (int slot = 0; slot &lt; mech.getNumberOfCriticals(location); slot++) {</b>
<b class="nc">&nbsp;                CriticalSlot cs = mech.getCritical(location, slot);</b>
<b class="nc">&nbsp;                if ((cs != null) &amp;&amp; cs.isArmored()) {</b>
&nbsp;                    // Armored cockpit (including command console) adds 1 ton, regardless of number of slots
<b class="nc">&nbsp;                    if ((cs.getType() == CriticalSlot.TYPE_SYSTEM)</b>
<b class="nc">&nbsp;                            &amp;&amp; (cs.getIndex() == Mech.SYSTEM_COCKPIT)) {</b>
<b class="nc">&nbsp;                        cockpitWeight = 1.0;</b>
&nbsp;                    } else {
<b class="nc">&nbsp;                        weight += 0.5;</b>
&nbsp;                    }
&nbsp;                }
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        return weight + cockpitWeight;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Check if the unit has combinations of equipment which are not allowed in
&nbsp;     * the construction rules.
&nbsp;     *
&nbsp;     * @param buff
&nbsp;     *            diagnostics are appended to this
&nbsp;     * @return true if the entity is illegal
&nbsp;     */
&nbsp;    @Override
&nbsp;    public boolean hasIllegalEquipmentCombinations(StringBuffer buff) {
<b class="nc">&nbsp;        boolean illegal = super.hasIllegalEquipmentCombinations(buff);</b>
&nbsp;        
<b class="nc">&nbsp;        boolean hasStealth = mech.hasStealth();</b>
<b class="nc">&nbsp;        boolean hasC3 = mech.hasC3();</b>
<b class="nc">&nbsp;        boolean hasHarjelII = false;</b>
<b class="nc">&nbsp;        boolean hasHarjelIII = false;</b>
<b class="nc">&nbsp;        boolean hasNullSig = false;</b>
<b class="nc">&nbsp;        boolean hasVoidSig = false;</b>
<b class="nc">&nbsp;        boolean hasTC = false;</b>
<b class="nc">&nbsp;        boolean hasMASC = false;</b>
<b class="nc">&nbsp;        boolean hasAES = false;</b>
<b class="nc">&nbsp;        EquipmentType advancedMyomer = null;</b>
&nbsp;
&nbsp;        //First we find all the equipment that is required or incompatible with other equipment,
&nbsp;        //so we don&#39;t have to execute another loop each time one of those situations comes up.
<b class="nc">&nbsp;        for (Mounted m : mech.getMisc()) {</b>
<b class="nc">&nbsp;            hasHarjelII |= m.getType().hasFlag(MiscType.F_HARJEL_II);</b>
<b class="nc">&nbsp;            hasHarjelIII |= m.getType().hasFlag(MiscType.F_HARJEL_III);</b>
<b class="nc">&nbsp;            hasNullSig |= m.getType().hasFlag(MiscType.F_NULLSIG);</b>
<b class="nc">&nbsp;            hasVoidSig |= m.getType().hasFlag(MiscType.F_VOIDSIG);</b>
<b class="nc">&nbsp;            hasTC |= m.getType().hasFlag(MiscType.F_TARGCOMP);</b>
<b class="nc">&nbsp;            hasMASC |= m.getType().hasFlag(MiscType.F_MASC)</b>
<b class="nc">&nbsp;                    &amp;&amp; !m.getType().hasSubType(MiscType.S_SUPERCHARGER);</b>
<b class="nc">&nbsp;            hasAES |= m.getType().hasFlag(MiscType.F_ACTUATOR_ENHANCEMENT_SYSTEM);</b>
<b class="nc">&nbsp;            if (m.getType().hasFlag(MiscType.F_TSM)</b>
<b class="nc">&nbsp;                    || m.getType().hasFlag(MiscType.F_INDUSTRIAL_TSM)</b>
<b class="nc">&nbsp;                    || m.getType().hasFlag(MiscType.F_SCM)) {</b>
<b class="nc">&nbsp;                advancedMyomer = m.getType();</b>
&nbsp;            }
<b class="nc">&nbsp;        }</b>
&nbsp;
<b class="nc">&nbsp;        for (Mounted m : getEntity().getMisc()) {</b>
<b class="nc">&nbsp;            final MiscType misc = (MiscType)m.getType();</b>
&nbsp;
<b class="nc">&nbsp;            if (misc.hasFlag(MiscType.F_UMU) &amp;&amp; (mech.getJumpType() != Mech.JUMP_NONE)</b>
<b class="nc">&nbsp;                    &amp;&amp; (mech.getJumpType() != Mech.JUMP_BOOSTER)) {</b>
<b class="nc">&nbsp;                illegal = true;</b>
<b class="nc">&nbsp;                buff.append(&quot;UMUs cannot be mounted with jump jets &quot;</b>
&nbsp;                        + &quot;(jump boosters are legal)\n&quot;);
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (misc.hasFlag(MiscType.F_MASC)</b>
<b class="nc">&nbsp;                    &amp;&amp; misc.hasSubType(MiscType.S_SUPERCHARGER)) {</b>
<b class="nc">&nbsp;                if (mech instanceof LandAirMech) {</b>
<b class="nc">&nbsp;                    buff.append(&quot;LAMs may not mount a supercharger\n&quot;);</b>
<b class="nc">&nbsp;                    illegal = true;</b>
&nbsp;                }
&nbsp;            }
&nbsp;            
<b class="nc">&nbsp;            if ((misc.hasFlag(MiscType.F_TSM)</b>
<b class="nc">&nbsp;                    || misc.hasFlag(MiscType.F_INDUSTRIAL_TSM)</b>
<b class="nc">&nbsp;                    || misc.hasFlag(MiscType.F_SCM))</b>
&nbsp;                    &amp;&amp; (misc != advancedMyomer)) {
<b class="nc">&nbsp;                buff.append(&quot;Cannot mount more than one type of myomer.\n&quot;);</b>
<b class="nc">&nbsp;                illegal = true;</b>
&nbsp;            }
&nbsp;            
<b class="nc">&nbsp;            if (misc.hasFlag(MiscType.F_REMOTE_DRONE_COMMAND_CONSOLE)) {</b>
<b class="nc">&nbsp;                if (mech.getCockpitType() == Mech.COCKPIT_COMMAND_CONSOLE) {</b>
<b class="nc">&nbsp;                    buff.append(&quot;cockpit command console can&#39;t be combined with remote drone command console\n&quot;);</b>
<b class="nc">&nbsp;                    illegal = true;</b>
&nbsp;                }
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (misc.hasFlag(MiscType.F_CHAMELEON_SHIELD)) {</b>
<b class="nc">&nbsp;                if (hasStealth) {</b>
<b class="nc">&nbsp;                    buff.append(&quot;Unit mounts both chameleon-light-polarization-system and stealth armor\n&quot;);</b>
<b class="nc">&nbsp;                    illegal = true;</b>
&nbsp;                }
<b class="nc">&nbsp;                if (hasVoidSig) {</b>
<b class="nc">&nbsp;                    buff.append(&quot;Unit mounts both void-signature-system and a chameleon light polarisation shield\n&quot;);</b>
<b class="nc">&nbsp;                    illegal = true;</b>
&nbsp;                }
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (misc.hasFlag(MiscType.F_LIGHT_FLUID_SUCTION_SYSTEM)</b>
<b class="nc">&nbsp;                    &amp;&amp; !mech.isIndustrial()) {</b>
<b class="nc">&nbsp;                illegal = true;</b>
<b class="nc">&nbsp;                buff.append(&quot;BattleMech can&#39;t mount light fluid suction system\n&quot;);</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (!mech.entityIsQuad()) {</b>
<b class="nc">&nbsp;                if (replacesHandActuator(misc)</b>
<b class="nc">&nbsp;                        &amp;&amp; mech.hasSystem(Mech.ACTUATOR_HAND, m.getLocation())) {</b>
<b class="nc">&nbsp;                    illegal = true;</b>
<b class="nc">&nbsp;                    buff.append(&quot;Mech can only mount &quot;).append(misc.getName())</b>
<b class="nc">&nbsp;                            .append(&quot; in arm with no hand actuator.\n&quot;);</b>
<b class="nc">&nbsp;                } else if (requiresHandActuator(misc) &amp;&amp; !mech.hasSystem(Mech.ACTUATOR_HAND, m.getLocation())) {</b>
<b class="nc">&nbsp;                    illegal = true;</b>
<b class="nc">&nbsp;                    buff.append(&quot;Mech requires a hand actuator in the arm that mounts &quot;).append(misc.getName()).append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;                } else if (requiresLowerArm(misc) &amp;&amp; !mech.hasSystem(Mech.ACTUATOR_LOWER_ARM, m.getLocation())) {</b>
<b class="nc">&nbsp;                    illegal = true;</b>
<b class="nc">&nbsp;                    buff.append(&quot;Mech requires a lower arm actuator in the arm that mounts &quot;).append(misc.getName()).append(&quot;\n&quot;);</b>
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            if (misc.hasFlag(MiscType.F_HEAD_TURRET)</b>
<b class="nc">&nbsp;                    &amp;&amp; isCockpitLocation(Mech.LOC_HEAD)) {</b>
<b class="nc">&nbsp;                illegal = true;</b>
<b class="nc">&nbsp;                buff.append(&quot;head turret requires torso mounted cockpit\n&quot;);</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (misc.hasFlag(MiscType.F_SHOULDER_TURRET) &amp;&amp; mech instanceof QuadMech) {</b>
<b class="nc">&nbsp;                illegal = true;</b>
<b class="nc">&nbsp;                buff.append(&quot;quad mechs can&#39;t mount shoulder turrets\n&quot;);</b>
&nbsp;            }
&nbsp;            
<b class="nc">&nbsp;            if (misc.hasFlag(MiscType.F_SHOULDER_TURRET)) {</b>
<b class="nc">&nbsp;                if (m.getLocation() != Mech.LOC_RT</b>
<b class="nc">&nbsp;                        &amp;&amp; m.getLocation() != Mech.LOC_LT) {</b>
<b class="nc">&nbsp;                    if (mech.countWorkingMisc(MiscType.F_SHOULDER_TURRET, m.getLocation()) &gt; 1) {</b>
<b class="nc">&nbsp;                        illegal = true;</b>
<b class="nc">&nbsp;                        buff.append(&quot;max of 1 shoulder turret per side torso\n&quot;);</b>
&nbsp;                    }
&nbsp;                }
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (misc.hasFlag(MiscType.F_TRACKS)) {</b>
<b class="nc">&nbsp;                if (mech instanceof QuadVee) {</b>
<b class="nc">&nbsp;                    if (misc.hasSubType(MiscType.S_QUADVEE_WHEELS)</b>
<b class="nc">&nbsp;                            != (((QuadVee)mech).getMotiveType() == QuadVee.MOTIVE_WHEEL)) {</b>
<b class="nc">&nbsp;                        illegal = true;</b>
<b class="nc">&nbsp;                        buff.append(&quot;Motive equipment does not match QuadVee motive type.\n&quot;);</b>
&nbsp;                    }
<b class="nc">&nbsp;                } else if (misc.hasSubType(MiscType.S_QUADVEE_WHEELS)) {</b>
<b class="nc">&nbsp;                    illegal = true;</b>
<b class="nc">&nbsp;                    buff.append(&quot;Wheels can only be used on QuadVees.\n&quot;);</b>
&nbsp;                }
<b class="nc">&nbsp;                for (int loc = 0; loc &lt; mech.locations(); loc++) {</b>
<b class="nc">&nbsp;                    if (mech.locationIsLeg(loc)</b>
<b class="nc">&nbsp;                            &amp;&amp; countCriticalSlotsFromEquipInLocation(mech, m, loc) != 1) {</b>
<b class="nc">&nbsp;                        illegal = true;</b>
<b class="nc">&nbsp;                        buff.append(misc.getName()).append(&quot; require one critical slot in each leg.\n&quot;);</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    }
&nbsp;                }
&nbsp;            }
&nbsp;            
<b class="nc">&nbsp;            if (m.getType().hasFlag(MiscType.F_TALON)) {</b>
<b class="nc">&nbsp;                int slots = getMech().isSuperHeavy() ? 1 : 2;</b>
<b class="nc">&nbsp;                for (int loc = 0; loc &lt; mech.locations(); loc++) {</b>
<b class="nc">&nbsp;                    if (mech.locationIsLeg(loc) &amp;&amp; countCriticalSlotsFromEquipInLocation(mech, m, loc) != slots) {</b>
<b class="nc">&nbsp;                        illegal = true;</b>
<b class="nc">&nbsp;                        buff.append(&quot;Talons require &quot;).append(slots).append(&quot; critical slots in each leg.\n&quot;);</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    }
&nbsp;                }
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (misc.hasFlag(MiscType.F_RAM_PLATE)) {</b>
<b class="nc">&nbsp;                if (!(mech instanceof QuadMech)) {</b>
<b class="nc">&nbsp;                    buff.append(misc.getName()).append(&quot; can only be mounted on a quad mech.\n&quot;);</b>
<b class="nc">&nbsp;                    illegal = true;</b>
&nbsp;                }
<b class="nc">&nbsp;                if (!mech.hasReinforcedStructure()) {</b>
<b class="nc">&nbsp;                    buff.append(misc.getName()).append(&quot; requires reinforced structure.\n&quot;);</b>
<b class="nc">&nbsp;                    illegal = true;</b>
&nbsp;                }
<b class="nc">&nbsp;                for (int loc = 0; loc &lt; mech.locations(); loc++) {</b>
<b class="nc">&nbsp;                    if (mech.locationIsTorso(loc)</b>
<b class="nc">&nbsp;                            &amp;&amp; countCriticalSlotsFromEquipInLocation(mech, m, loc) != 1) {</b>
<b class="nc">&nbsp;                        illegal = true;</b>
<b class="nc">&nbsp;                        buff.append(misc.getName()).append(&quot; requires one critical slot in each torso location.\n&quot;);</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    }
&nbsp;                }
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (mech.isSuperHeavy()</b>
<b class="nc">&nbsp;                    &amp;&amp; (misc.hasFlag(MiscType.F_TSM)</b>
<b class="nc">&nbsp;                            || misc.hasFlag(MiscType.F_INDUSTRIAL_TSM)</b>
<b class="nc">&nbsp;                            || misc.hasFlag(MiscType.F_SCM)</b>
<b class="nc">&nbsp;                            || misc.hasFlag(MiscType.F_MASC)</b>
<b class="nc">&nbsp;                            || misc.hasFlag(MiscType.F_JUMP_JET)</b>
<b class="nc">&nbsp;                            || misc.hasFlag(MiscType.F_MECHANICAL_JUMP_BOOSTER)</b>
<b class="nc">&nbsp;                            || misc.hasFlag(MiscType.F_UMU)</b>
<b class="nc">&nbsp;                            || misc.hasFlag(MiscType.F_ACTUATOR_ENHANCEMENT_SYSTEM)</b>
<b class="nc">&nbsp;                            || misc.hasFlag(MiscType.F_MODULAR_ARMOR)</b>
<b class="nc">&nbsp;                            || misc.hasFlag(MiscType.F_PARTIAL_WING))) {</b>
<b class="nc">&nbsp;                buff.append(&quot;Superheavy may not mount &quot;).append(m.getType().getName()).append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;                illegal = true;</b>
&nbsp;            }
&nbsp;            
<b class="nc">&nbsp;            if (mech.isIndustrial()) {</b>
<b class="nc">&nbsp;                if (misc.hasFlag(MiscType.F_TSM)</b>
<b class="nc">&nbsp;                        || misc.hasFlag(MiscType.F_SCM)</b>
<b class="nc">&nbsp;                        || (misc.hasFlag(MiscType.F_MASC) &amp;&amp; !misc.hasSubType(MiscType.S_SUPERCHARGER))) {</b>
<b class="nc">&nbsp;                    buff.append(&quot;industrial mech can&#39;t mount &quot;).append(misc.getName()).append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;                    illegal = true;                    </b>
&nbsp;                }
<b class="nc">&nbsp;                if ((mech.getCockpitType() == Mech.COCKPIT_INDUSTRIAL</b>
<b class="nc">&nbsp;                        || mech.getCockpitType() == Mech.COCKPIT_PRIMITIVE_INDUSTRIAL)</b>
<b class="nc">&nbsp;                    &amp;&amp; (misc.hasFlag(MiscType.F_TARGCOMP)</b>
<b class="nc">&nbsp;                        || misc.hasFlag(MiscType.F_ARTEMIS)</b>
<b class="nc">&nbsp;                        || misc.hasFlag(MiscType.F_ARTEMIS_PROTO)</b>
<b class="nc">&nbsp;                        || misc.hasFlag(MiscType.F_ARTEMIS_V)</b>
<b class="nc">&nbsp;                        || misc.hasFlag(MiscType.F_BAP))) {</b>
<b class="nc">&nbsp;                    buff.append(&quot;Industrial mech without advanced fire control can&#39;t mount &quot;)</b>
<b class="nc">&nbsp;                            .append(misc.getName()).append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;                    illegal = true;                    </b>
&nbsp;                }
&nbsp;            } else {
<b class="nc">&nbsp;                if (misc.hasFlag(MiscType.F_INDUSTRIAL_TSM)</b>
<b class="nc">&nbsp;                        || misc.hasFlag(MiscType.F_ENVIRONMENTAL_SEALING)</b>
<b class="nc">&nbsp;                        || misc.hasFlag(MiscType.F_FUEL)) {</b>
<b class="nc">&nbsp;                    buff.append(&quot;Non-industrial mech can&#39;t mount &quot;).append(misc.getName()).append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;                    illegal = true;</b>
&nbsp;                }
&nbsp;            }
&nbsp;            
<b class="nc">&nbsp;            if ((mech instanceof LandAirMech)</b>
<b class="nc">&nbsp;                    &amp;&amp; (misc.hasFlag(MiscType.F_MODULAR_ARMOR)</b>
<b class="nc">&nbsp;                            || misc.hasFlag(MiscType.F_JUMP_BOOSTER)</b>
<b class="nc">&nbsp;                            || misc.hasFlag(MiscType.F_PARTIAL_WING)</b>
<b class="nc">&nbsp;                            || misc.hasFlag(MiscType.F_DUMPER)</b>
<b class="nc">&nbsp;                            || misc.hasFlag(MiscType.F_HEAVY_BRIDGE_LAYER)</b>
<b class="nc">&nbsp;                            || misc.hasFlag(MiscType.F_MEDIUM_BRIDGE_LAYER)</b>
<b class="nc">&nbsp;                            || misc.hasFlag(MiscType.F_LIGHT_BRIDGE_LAYER)</b>
<b class="nc">&nbsp;                            || (misc.hasFlag(MiscType.F_CLUB)</b>
<b class="nc">&nbsp;                                    &amp;&amp; (misc.getSubType() == MiscType.S_BACKHOE)</b>
<b class="nc">&nbsp;                                    || (misc.getSubType() == MiscType.S_COMBINE)))) {</b>
<b class="nc">&nbsp;                buff.append(&quot;LAMs may not mount &quot;).append(misc.getName()).append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;                illegal = true;</b>
&nbsp;            }
<b class="nc">&nbsp;        }</b>
&nbsp;        
<b class="nc">&nbsp;        if (mech.isSuperHeavy()) {</b>
<b class="nc">&nbsp;            switch (mech.hasEngine()? mech.getEngine().getEngineType() : Engine.NONE) {</b>
&nbsp;                case Engine.NORMAL_ENGINE:
&nbsp;                case Engine.LARGE_ENGINE:
<b class="nc">&nbsp;                    break;</b>
&nbsp;                case Engine.XL_ENGINE:
&nbsp;                case Engine.XXL_ENGINE:
&nbsp;                case Engine.COMPACT_ENGINE:
&nbsp;                case Engine.LIGHT_ENGINE:
<b class="nc">&nbsp;                    if (mech.isIndustrial()) {</b>
<b class="nc">&nbsp;                        buff.append(&quot;Superheavy industrialMechs can only use standard or large fusion engine\n&quot;);</b>
<b class="nc">&nbsp;                        illegal = true;</b>
&nbsp;                    }
&nbsp;                    break;
&nbsp;                default:
<b class="nc">&nbsp;                    buff.append(&quot;Superheavy Mechs must use some type of fusion engine\n&quot;);</b>
<b class="nc">&nbsp;                    illegal = true;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (mech.getGyroType() != Mech.GYRO_SUPERHEAVY) {</b>
<b class="nc">&nbsp;                buff.append(&quot;Superheavy Mechs must use a superheavy gyro.\n&quot;);</b>
<b class="nc">&nbsp;                illegal = true;</b>
&nbsp;            }
&nbsp;            
<b class="nc">&nbsp;            if (mech.getArmoredComponentBV() &gt; 0) {</b>
<b class="nc">&nbsp;                buff.append(&quot;Superheavy Mechs cannot have armored components\n&quot;);</b>
<b class="nc">&nbsp;                illegal = true;</b>
&nbsp;            }
&nbsp;            
<b class="nc">&nbsp;            if (mech instanceof QuadVee) {</b>
<b class="nc">&nbsp;                buff.append(&quot;QuadVees cannot be constructed as superheavies.\n&quot;);</b>
&nbsp;            }
<b class="nc">&nbsp;        } else if (mech.getGyroType() == Mech.GYRO_SUPERHEAVY) {</b>
<b class="nc">&nbsp;            buff.append(&quot;Only superheavy Mechs can use a superheavy gyro.\n&quot;);</b>
<b class="nc">&nbsp;            illegal = true;</b>
&nbsp;        }
&nbsp;        
<b class="nc">&nbsp;        if (mech.isIndustrial()) {</b>
<b class="nc">&nbsp;            if ((mech.getCockpitType() == Mech.COCKPIT_INDUSTRIAL</b>
<b class="nc">&nbsp;                    || mech.getCockpitType() == Mech.COCKPIT_PRIMITIVE_INDUSTRIAL) &amp;&amp; hasC3) {</b>
<b class="nc">&nbsp;                buff.append(&quot;industrial mech without advanced fire control can&#39;t use c3 computer\n&quot;);</b>
<b class="nc">&nbsp;                illegal = true;</b>
&nbsp;            }
<b class="nc">&nbsp;            if ((mech.getJumpType() != Mech.JUMP_STANDARD)</b>
<b class="nc">&nbsp;                    &amp;&amp; (mech.getJumpType() != Mech.JUMP_NONE)</b>
<b class="nc">&nbsp;                    &amp;&amp; (mech.getJumpType() != Mech.JUMP_PROTOTYPE)</b>
<b class="nc">&nbsp;                    &amp;&amp; (mech.getJumpType() != Mech.JUMP_BOOSTER)) {</b>
<b class="nc">&nbsp;                buff.append(&quot;industrial mechs can only mount standard jump jets or mechanical jump boosters\n&quot;);</b>
<b class="nc">&nbsp;                illegal = true;</b>
&nbsp;            }
<b class="nc">&nbsp;            if ((mech.getGyroType() != Mech.GYRO_STANDARD) &amp;&amp; (mech.getGyroType() != Mech.GYRO_SUPERHEAVY)) {</b>
<b class="nc">&nbsp;                buff.append(&quot;industrial mechs can only mount standard gyros\n&quot;);</b>
<b class="nc">&nbsp;                illegal = true;</b>
&nbsp;            }
&nbsp;        }
&nbsp;        
<b class="nc">&nbsp;        if (mech.isPrimitive()) {</b>
<b class="nc">&nbsp;            if (mech.isOmni()) {</b>
<b class="nc">&nbsp;                buff.append(&quot;primitive mechs can&#39;t be omnis\n&quot;);</b>
<b class="nc">&nbsp;                illegal = true;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (!((mech.getStructureType() == EquipmentType.T_STRUCTURE_STANDARD) || (mech</b>
<b class="nc">&nbsp;                    .getStructureType() == EquipmentType.T_STRUCTURE_INDUSTRIAL))) {</b>
<b class="nc">&nbsp;                buff.append(&quot;primitive mechs can&#39;t mount advanced inner structure\n&quot;);</b>
<b class="nc">&nbsp;                illegal = true;</b>
&nbsp;            }
<b class="nc">&nbsp;            if(mech.hasEngine() &amp;&amp; ((mech.getEngine().getEngineType() == Engine.XL_ENGINE)</b>
<b class="nc">&nbsp;                    || (mech.getEngine().getEngineType() == Engine.LIGHT_ENGINE)</b>
<b class="nc">&nbsp;                    || (mech.getEngine().getEngineType() == Engine.COMPACT_ENGINE)</b>
<b class="nc">&nbsp;                    || mech.getEngine().hasFlag(Engine.LARGE_ENGINE)</b>
<b class="nc">&nbsp;                    || (mech.getEngine().getEngineType() == Engine.XXL_ENGINE))) {</b>
<b class="nc">&nbsp;                buff.append(&quot;primitive mechs can&#39;t mount XL, Light, Compact, XXL or Large Engines\n&quot;);</b>
<b class="nc">&nbsp;                illegal = true;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (advancedMyomer != null) {</b>
<b class="nc">&nbsp;                buff.append(&quot;primitive mechs can&#39;t mount advanced myomers\n&quot;);</b>
<b class="nc">&nbsp;                illegal = true;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (mech.isIndustrial()) {</b>
<b class="nc">&nbsp;                if (mech.getArmorType(0) != EquipmentType.T_ARMOR_COMMERCIAL) {</b>
<b class="nc">&nbsp;                    buff.append(&quot;primitive industrialmechs must mount commercial armor\n&quot;);</b>
<b class="nc">&nbsp;                    illegal = true;</b>
&nbsp;                }
&nbsp;            } else {
<b class="nc">&nbsp;                if ((mech.getArmorType(0) != EquipmentType.T_ARMOR_PRIMITIVE)</b>
<b class="nc">&nbsp;                        &amp;&amp; (mech.getArmorType(0) != EquipmentType.T_ARMOR_INDUSTRIAL)) {</b>
<b class="nc">&nbsp;                    buff.append(&quot;primitive battlemechs must mount primitive battlemech armor\n&quot;);</b>
<b class="nc">&nbsp;                    illegal = true;</b>
&nbsp;                }
&nbsp;            }
&nbsp;        }
&nbsp;        
<b class="nc">&nbsp;        if (mech instanceof LandAirMech) {</b>
<b class="nc">&nbsp;            if (mech.isOmni()) {</b>
<b class="nc">&nbsp;                buff.append(&quot;LAMs may not be constructed as omnis\n&quot;);</b>
<b class="nc">&nbsp;                illegal = true;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (mech.getWeight() &gt; 55) {</b>
<b class="nc">&nbsp;                buff.append(&quot;LAMs cannot be larger than 55 tons.\n&quot;);</b>
<b class="nc">&nbsp;                illegal = true;</b>
&nbsp;            }
<b class="nc">&nbsp;            EquipmentType structure = EquipmentType.get(EquipmentType.getStructureTypeName(mech.getStructureType(),</b>
<b class="nc">&nbsp;                    mech.isClan()));</b>
<b class="nc">&nbsp;            if (structure.getCriticals(mech) &gt; 0) {</b>
<b class="nc">&nbsp;                buff.append(&quot;LAMs may not use &quot;).append(structure.getName()).append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;                illegal = true;</b>
&nbsp;            }
&nbsp;            
<b class="nc">&nbsp;            Set&lt;Integer&gt; ats = new HashSet&lt;&gt;();</b>
<b class="nc">&nbsp;            for (int i = 0; i &lt; mech.locations(); i++) {</b>
<b class="nc">&nbsp;                ats.add(mech.getArmorType(i));</b>
&nbsp;            }
<b class="nc">&nbsp;            for (int at : ats) {</b>
<b class="nc">&nbsp;                if (at == EquipmentType.T_ARMOR_HARDENED) {</b>
<b class="nc">&nbsp;                    buff.append(&quot;LAMs cannot use hardened armor.\n&quot;);</b>
<b class="nc">&nbsp;                    illegal = true;</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    final EquipmentType eq = EquipmentType.get(EquipmentType.getArmorTypeName(at, mech.isClan()));</b>
<b class="nc">&nbsp;                    if (eq != null &amp;&amp; eq.getCriticals(mech) &gt; 0) {</b>
<b class="nc">&nbsp;                        buff.append(&quot;LAMs cannot use &quot;).append(eq.getName()).append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;                        illegal = true;</b>
&nbsp;                    }
&nbsp;                }
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;            if (mech.countWorkingMisc(MiscType.F_BOMB_BAY) &gt; 20) {</b>
<b class="nc">&nbsp;                buff.append(&quot;A LAM has a maximum of 20 bomb bays.\n&quot;);</b>
<b class="nc">&nbsp;                illegal = true;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (isCockpitLocation(Mech.LOC_CT)) {</b>
<b class="nc">&nbsp;                buff.append(&quot;LAMs may not use torso-mounted cockpits.\n&quot;);</b>
<b class="nc">&nbsp;                illegal = true;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (mech.getNumberOfCriticals(CriticalSlot.TYPE_SYSTEM, Mech.SYSTEM_COCKPIT, Mech.LOC_HEAD) &gt; 1) {</b>
<b class="nc">&nbsp;                buff.append(&quot;LAMs may not cockpits that require multiple critical slots.\n&quot;);</b>
<b class="nc">&nbsp;                illegal = true;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (mech.getCockpitType() == Mech.COCKPIT_PRIMITIVE</b>
<b class="nc">&nbsp;                    || mech.getCockpitType() == Mech.COCKPIT_PRIMITIVE_INDUSTRIAL) {</b>
<b class="nc">&nbsp;                illegal = true;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (mech.getGyroType() != Mech.GYRO_STANDARD</b>
<b class="nc">&nbsp;                    &amp;&amp; mech.getGyroType() != Mech.GYRO_COMPACT</b>
<b class="nc">&nbsp;                    &amp;&amp; mech.getGyroType() != Mech.GYRO_HEAVY_DUTY) {</b>
<b class="nc">&nbsp;                buff.append(&quot;LAMs may not use &quot;).append(Mech.getGyroDisplayString(mech.getGyroType()))</b>
<b class="nc">&nbsp;                .append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;                illegal = true;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (mech.getEngine().getEngineType() != Engine.NORMAL_ENGINE</b>
<b class="nc">&nbsp;                    &amp;&amp; mech.getEngine().getEngineType() != Engine.COMPACT_ENGINE) {</b>
<b class="nc">&nbsp;                buff.append(&quot;LAMs may only use standard or compact fusion engines.\n&quot;);</b>
<b class="nc">&nbsp;                illegal = true;</b>
&nbsp;            }
&nbsp;            
<b class="nc">&nbsp;            Map&lt;EquipmentType,Set&lt;Integer&gt;&gt; spread = new HashMap&lt;&gt;();</b>
<b class="nc">&nbsp;            for (Mounted m : mech.getEquipment()) {</b>
<b class="nc">&nbsp;                if (m.isSplit()) {</b>
<b class="nc">&nbsp;                    buff.append(&quot;Cannot split &quot;).append(m.getType().getName())</b>
<b class="nc">&nbsp;                        .append(&quot; between locations&quot;);</b>
<b class="nc">&nbsp;                    illegal = true;</b>
<b class="nc">&nbsp;                } else if (m.getType() instanceof ArtilleryWeapon) {</b>
<b class="nc">&nbsp;                    buff.append(&quot;LAMs cannot mount artillery weapons.\n&quot;);</b>
<b class="nc">&nbsp;                    illegal = true;</b>
<b class="nc">&nbsp;                } else if (m.getType() instanceof WeaponType</b>
<b class="nc">&nbsp;                        &amp;&amp; ((((WeaponType)m.getType()).getAmmoType() == AmmoType.T_GAUSS_HEAVY)</b>
<b class="nc">&nbsp;                                || (((WeaponType)m.getType()).getAmmoType() == AmmoType.T_IGAUSS_HEAVY))) {</b>
<b class="nc">&nbsp;                    buff.append(&quot;LAMs cannot mount heavy gauss rifles.\n&quot;);</b>
<b class="nc">&nbsp;                    illegal = true;</b>
<b class="nc">&nbsp;                } else if ((m.getType() instanceof MiscType)</b>
<b class="nc">&nbsp;                        &amp;&amp; m.getType().hasFlag(MiscType.F_CLUB)) {</b>
<b class="nc">&nbsp;                    buff.append(&quot;LAMs cannot be constructed with physical weapons.\n&quot;);</b>
<b class="nc">&nbsp;                    illegal = true;</b>
<b class="nc">&nbsp;                } else if (m.getType().isSpreadable()) {</b>
<b class="nc">&nbsp;                    if (spread.containsKey(m.getType())) {</b>
<b class="nc">&nbsp;                        spread.get(m.getType()).add(m.getLocation());</b>
&nbsp;                    } else {
<b class="nc">&nbsp;                        spread.put(m.getType(), new HashSet&lt;&gt;());</b>
<b class="nc">&nbsp;                        spread.get(m.getType()).add(m.getLocation());</b>
&nbsp;                    }
&nbsp;                }
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;            for (EquipmentType et : spread.keySet()) {</b>
<b class="nc">&nbsp;                if (spread.get(et).size() &gt; 1) {</b>
<b class="nc">&nbsp;                    buff.append(et.getName()).append(&quot; must be allocated to a single location.\n&quot;);</b>
<b class="nc">&nbsp;                    illegal = true;</b>
&nbsp;                }
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;            if (!mech.hasSystem(Mech.ACTUATOR_LOWER_ARM, Mech.LOC_RARM)</b>
<b class="nc">&nbsp;                    || !mech.hasSystem(Mech.ACTUATOR_LOWER_ARM, Mech.LOC_LARM)</b>
<b class="nc">&nbsp;                    || !mech.hasSystem(Mech.ACTUATOR_UPPER_ARM, Mech.LOC_RARM)</b>
<b class="nc">&nbsp;                    || !mech.hasSystem(Mech.ACTUATOR_UPPER_ARM, Mech.LOC_LARM)) {</b>
<b class="nc">&nbsp;                buff.append(&quot;LAMs require upper and lower arm actuators in both arms.\n&quot;);</b>
<b class="nc">&nbsp;                illegal = true;</b>
&nbsp;            }
&nbsp;        }
&nbsp;        
&nbsp;        //Make sure all base chassis heat sinks are allocated
<b class="nc">&nbsp;        if (mech.isOmni()) {</b>
<b class="nc">&nbsp;            int total = 0;</b>
<b class="nc">&nbsp;            int allocated = 0;</b>
<b class="nc">&nbsp;            boolean compact = false;</b>
<b class="nc">&nbsp;            for (Mounted m : mech.getMisc()) {</b>
<b class="nc">&nbsp;                if (m.getType().hasFlag(MiscType.F_HEAT_SINK)</b>
<b class="nc">&nbsp;                            || m.getType().hasFlag(MiscType.F_DOUBLE_HEAT_SINK)</b>
<b class="nc">&nbsp;                            || m.getType().hasFlag(MiscType.F_IS_DOUBLE_HEAT_SINK_PROTOTYPE)) {</b>
<b class="nc">&nbsp;                    total++;</b>
<b class="nc">&nbsp;                    compact |= m.getType().hasFlag(MiscType.F_COMPACT_HEAT_SINK);</b>
<b class="nc">&nbsp;                    if (m.getLocation() != Entity.LOC_NONE) {</b>
<b class="nc">&nbsp;                        allocated++;</b>
&nbsp;                    }
&nbsp;                }
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;            int required = total - (mech.isOmni()?</b>
<b class="nc">&nbsp;                    mech.getEngine().getBaseChassisHeatSinks(compact) :</b>
<b class="nc">&nbsp;                        mech.getEngine().integralHeatSinkCapacity(compact));</b>
<b class="nc">&nbsp;            if (allocated &lt; required) {</b>
<b class="nc">&nbsp;                illegal = true;</b>
<b class="nc">&nbsp;                buff.append(&quot;Only &quot; + allocated + &quot; of the required &quot; + required + &quot; heat sinks are allocated to critical slots.&quot;);</b>
&nbsp;            }
&nbsp;        }
&nbsp;        
<b class="nc">&nbsp;        if (hasMASC &amp;&amp; advancedMyomer != null) {</b>
<b class="nc">&nbsp;            buff.append(&quot;MASC is incompatible with &quot; + advancedMyomer.getName() + &quot;\n&quot;);</b>
<b class="nc">&nbsp;            illegal = true;</b>
&nbsp;        }
&nbsp;        
<b class="nc">&nbsp;        if (hasAES) {</b>
<b class="nc">&nbsp;            if (hasMASC) {</b>
<b class="nc">&nbsp;                buff.append(&quot;AES is incompatible with MASC.\n&quot;);</b>
<b class="nc">&nbsp;                illegal = true;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (hasTC) {</b>
<b class="nc">&nbsp;                buff.append(&quot;AES is incompatible with Targeting computers.\n&quot;);</b>
<b class="nc">&nbsp;                illegal = true;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (advancedMyomer != null) {</b>
<b class="nc">&nbsp;                buff.append(&quot;AES is incompatible with advanced myomers.\n&quot;);</b>
&nbsp;            }
&nbsp;            //Find all locations with an AES and map the number in that location to the location index.
<b class="nc">&nbsp;            Map&lt;Integer,Long&gt; byLocation = mech.getMisc().stream()</b>
<b class="nc">&nbsp;                    .filter(m -&gt; m.getType().hasFlag(MiscType.F_ACTUATOR_ENHANCEMENT_SYSTEM))</b>
<b class="nc">&nbsp;                    .collect(Collectors.groupingBy(Mounted::getLocation, Collectors.counting()));</b>
<b class="nc">&nbsp;            boolean multiple = false;</b>
<b class="nc">&nbsp;            boolean wrongLocation = false;</b>
<b class="nc">&nbsp;            int legCount = 0;</b>
<b class="nc">&nbsp;            for (Integer loc : byLocation.keySet()) {</b>
<b class="nc">&nbsp;                if (mech.locationIsLeg(loc)) {</b>
<b class="nc">&nbsp;                    legCount++;</b>
<b class="nc">&nbsp;                } else if (loc == Mech.LOC_HEAD</b>
<b class="nc">&nbsp;                        || loc == Mech.LOC_CT</b>
<b class="nc">&nbsp;                        || loc == Mech.LOC_LT</b>
<b class="nc">&nbsp;                        || loc == Mech.LOC_RT) {</b>
<b class="nc">&nbsp;                    wrongLocation = true;</b>
&nbsp;                }
<b class="nc">&nbsp;                multiple |= byLocation.get(loc) &gt; 1;</b>
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;            if (multiple) {</b>
<b class="nc">&nbsp;                buff.append(&quot;Only one AES can be mounted in a single location.\n&quot;);</b>
<b class="nc">&nbsp;                illegal = true;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (wrongLocation) {</b>
<b class="nc">&nbsp;                buff.append(&quot;AES can only be mounted in an arm or leg location.\n&quot;);</b>
<b class="nc">&nbsp;                illegal = true;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (legCount &gt; 0) {</b>
<b class="nc">&nbsp;                for (int loc = 0; loc &lt; mech.locations(); loc++) {</b>
<b class="nc">&nbsp;                    if (mech.locationIsLeg(loc)) {</b>
<b class="nc">&nbsp;                        legCount--;</b>
&nbsp;                    }
&nbsp;                }
<b class="nc">&nbsp;                if (legCount &lt; 0) {</b>
<b class="nc">&nbsp;                    buff.append(&quot;If an AES is mounted in a leg, all legs must mount one.\n&quot;);</b>
<b class="nc">&nbsp;                    illegal = true;</b>
&nbsp;                }
&nbsp;            }
&nbsp;        }
&nbsp;        
<b class="nc">&nbsp;        if (hasNullSig) {</b>
<b class="nc">&nbsp;            if (hasStealth) {</b>
<b class="nc">&nbsp;                buff.append(&quot;Unit mounts both null-signature-system and stealth armor\n&quot;);</b>
<b class="nc">&nbsp;                illegal = true;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (hasTC) {</b>
<b class="nc">&nbsp;                buff.append(&quot;Unit mounts both null-signature-system and targeting computer\n&quot;);</b>
<b class="nc">&nbsp;                illegal = true;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (hasVoidSig) {</b>
<b class="nc">&nbsp;                buff.append(&quot;Unit mounts both null-signature-system and void-signature-system\n&quot;);</b>
<b class="nc">&nbsp;                illegal = true;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (hasC3) {</b>
<b class="nc">&nbsp;                buff.append(&quot;Unit mounts both null-signature-system and a c3 system\n&quot;);</b>
<b class="nc">&nbsp;                illegal = true;</b>
&nbsp;            }
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (hasVoidSig) {</b>
<b class="nc">&nbsp;            if (hasStealth) {</b>
<b class="nc">&nbsp;                buff.append(&quot;Unit mounts both void-signature-system and stealth armor\n&quot;);</b>
<b class="nc">&nbsp;                illegal = true;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (hasTC) {</b>
<b class="nc">&nbsp;                buff.append(&quot;Unit mounts both void-signature-system and targeting computer\n&quot;);</b>
<b class="nc">&nbsp;                illegal = true;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (hasC3) {</b>
<b class="nc">&nbsp;                buff.append(&quot;Unit mounts both void-signature-system and a c3 system\n&quot;);</b>
<b class="nc">&nbsp;                illegal = true;</b>
&nbsp;            }
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (hasHarjelII &amp;&amp; hasHarjelIII) {</b>
<b class="nc">&nbsp;            illegal = true;</b>
<b class="nc">&nbsp;            buff.append(&quot;Can&#39;t mix HarJel II and HarJel III\n&quot;);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (hasHarjelII || hasHarjelIII) {</b>
<b class="nc">&nbsp;            if (mech.isIndustrial()) {</b>
<b class="nc">&nbsp;                buff.append(&quot;Cannot mount HarJel repair system on IndustrialMech\n&quot;);</b>
<b class="nc">&nbsp;                illegal = true;</b>
&nbsp;            }
<b class="nc">&nbsp;            for (int loc = 0; loc &lt; mech.locations(); ++loc) {</b>
<b class="nc">&nbsp;                int count = 0;</b>
<b class="nc">&nbsp;                for (Mounted m : mech.getMisc()) {</b>
<b class="nc">&nbsp;                    if ((m.getLocation() == loc)</b>
<b class="nc">&nbsp;                        &amp;&amp; (m.getType().hasFlag(MiscType.F_HARJEL_II)</b>
<b class="nc">&nbsp;                         || m.getType().hasFlag(MiscType.F_HARJEL_III))) {</b>
<b class="nc">&nbsp;                        ++count;</b>
&nbsp;                    }
<b class="nc">&nbsp;                }</b>
<b class="nc">&nbsp;                if (count &gt; 1) {</b>
<b class="nc">&nbsp;                    buff.append(&quot;Cannot mount multiple HarJel repair systems in a location\n&quot;);</b>
<b class="nc">&nbsp;                    illegal = true;</b>
&nbsp;                }
<b class="nc">&nbsp;                if (count == 1) {</b>
<b class="nc">&nbsp;                    int armor = mech.getArmorType(loc);</b>
<b class="nc">&nbsp;                    switch (armor) {</b>
&nbsp;                        case EquipmentType.T_ARMOR_STANDARD:
&nbsp;                        case EquipmentType.T_ARMOR_FERRO_FIBROUS:
&nbsp;                        case EquipmentType.T_ARMOR_LIGHT_FERRO:
&nbsp;                        case EquipmentType.T_ARMOR_HEAVY_FERRO:
&nbsp;                        case EquipmentType.T_ARMOR_HEAVY_INDUSTRIAL:
&nbsp;                            // these armors are legal with HarJel
<b class="nc">&nbsp;                            break;</b>
&nbsp;                        default:
<b class="nc">&nbsp;                            buff.append(&quot;Cannot mount HarJel repair system in location with this armor type\n&quot;);</b>
<b class="nc">&nbsp;                            illegal = true;</b>
&nbsp;                    }
&nbsp;                }
&nbsp;            }
&nbsp;        }
&nbsp;        
<b class="nc">&nbsp;        for (Mounted m : mech.getWeaponList()) {</b>
<b class="nc">&nbsp;            if ((((WeaponType) m.getType()).getAmmoType() == AmmoType.T_GAUSS_HEAVY)</b>
<b class="nc">&nbsp;                    || (((WeaponType) m.getType()).getAmmoType() == AmmoType.T_IGAUSS_HEAVY)) {</b>
<b class="nc">&nbsp;                boolean torso = mech.locationIsTorso(m.getLocation());</b>
<b class="nc">&nbsp;                if (m.getSecondLocation() != Entity.LOC_NONE) {</b>
<b class="nc">&nbsp;                    torso = torso &amp;&amp; mech.locationIsTorso(m.getSecondLocation());</b>
&nbsp;                }
<b class="nc">&nbsp;                if (!mech.isSuperHeavy() &amp;&amp; !torso) {</b>
<b class="nc">&nbsp;                    buff.append(&quot;Heavy Gauss can only be mounted in a torso location.\n&quot;);</b>
<b class="nc">&nbsp;                    illegal = true;</b>
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            if ((m.getType().hasFlag(WeaponType.F_TASER)</b>
<b class="nc">&nbsp;                    || m.getType().hasFlag(WeaponType.F_HYPER))</b>
<b class="nc">&nbsp;                    &amp;&amp; !(mech.hasEngine() &amp;&amp; mech.getEngine().isFusion())) {</b>
<b class="nc">&nbsp;                buff.append(m.getType().getName()).append(&quot; needs fusion engine\n&quot;);</b>
<b class="nc">&nbsp;                illegal = true;</b>
&nbsp;            }
<b class="nc">&nbsp;        }</b>
&nbsp;
<b class="nc">&nbsp;        if (mech.hasWorkingWeapon(WeaponType.F_HYPER) &amp;&amp; !(mech.hasEngine() &amp;&amp; mech.getEngine().isFusion())) {</b>
<b class="nc">&nbsp;            buff.append(&quot;RISC Hyper Laser needs fusion engine\n&quot;);</b>
<b class="nc">&nbsp;            illegal = true;</b>
&nbsp;        }
&nbsp;        
<b class="nc">&nbsp;        if (mech.hasFullHeadEject()) {</b>
<b class="nc">&nbsp;            if ((mech.getCockpitType() == Mech.COCKPIT_TORSO_MOUNTED)</b>
<b class="nc">&nbsp;                    || (mech.getCockpitType() == Mech.COCKPIT_COMMAND_CONSOLE)) {</b>
<b class="nc">&nbsp;                buff.append(&quot;full head ejection system incompatible with cockpit type\n&quot;);</b>
<b class="nc">&nbsp;                illegal = true;</b>
&nbsp;            }
&nbsp;        }
&nbsp;        
&nbsp;        // only one sword/vibroblade per arm
<b class="nc">&nbsp;        for (int loc = Mech.LOC_RARM; loc &lt;= Mech.LOC_LARM; loc++) {</b>
<b class="nc">&nbsp;            int count = 0;</b>
<b class="nc">&nbsp;            for (Mounted m : mech.getMisc()) {</b>
<b class="nc">&nbsp;                if (m.getLocation() == loc) {</b>
<b class="nc">&nbsp;                    if (m.getType().hasFlag(MiscType.F_CLUB)</b>
<b class="nc">&nbsp;                            &amp;&amp; (m.getType().hasSubType(MiscType.S_SWORD)</b>
<b class="nc">&nbsp;                                    || m.getType().hasSubType(</b>
&nbsp;                                            MiscType.S_VIBRO_LARGE)
<b class="nc">&nbsp;                                    || m.getType().hasSubType(</b>
&nbsp;                                            MiscType.S_VIBRO_MEDIUM) || m
<b class="nc">&nbsp;                                    .getType().hasSubType(</b>
&nbsp;                                            MiscType.S_VIBRO_SMALL))) {
<b class="nc">&nbsp;                        count++;</b>
&nbsp;                    }
&nbsp;                }
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;            if (count &gt; 1) {</b>
<b class="nc">&nbsp;                buff.append(&quot;only one sword/vibroblade per arm\n&quot;);</b>
<b class="nc">&nbsp;                illegal = true;</b>
&nbsp;            }
&nbsp;        }
&nbsp;        
<b class="nc">&nbsp;        return illegal;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * @param misc A type of equipment
&nbsp;     * @return     Whether the equipment replaces the hand actuator when mounted in an arm
&nbsp;     */
&nbsp;    public static boolean replacesHandActuator(MiscType misc) {
<b class="nc">&nbsp;        return misc.hasFlag(MiscType.F_SALVAGE_ARM)</b>
<b class="nc">&nbsp;                || misc.hasFlag(MiscType.F_HAND_WEAPON)</b>
<b class="nc">&nbsp;                || (misc.hasFlag(MiscType.F_CLUB)</b>
<b class="nc">&nbsp;                    &amp;&amp; (misc.hasSubType(MiscType.S_CHAINSAW)</b>
<b class="nc">&nbsp;                    || misc.hasSubType(MiscType.S_BACKHOE)</b>
<b class="nc">&nbsp;                    || misc.hasSubType(MiscType.S_DUAL_SAW)</b>
<b class="nc">&nbsp;                    || misc.hasSubType(MiscType.S_PILE_DRIVER)</b>
<b class="nc">&nbsp;                    || misc.hasSubType(MiscType.S_MINING_DRILL)</b>
<b class="nc">&nbsp;                    || misc.hasSubType(MiscType.S_ROCK_CUTTER)</b>
<b class="nc">&nbsp;                    || misc.hasSubType(MiscType.S_SPOT_WELDER)</b>
<b class="nc">&nbsp;                    || misc.hasSubType(MiscType.S_WRECKING_BALL)</b>
<b class="nc">&nbsp;                    || misc.hasSubType(MiscType.S_FLAIL)));</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * @param misc A type of equipment that can be mounted in a mech arm
&nbsp;     * @return     Whether the equipment requires the hand acutator
&nbsp;     */
&nbsp;    public static boolean requiresHandActuator(MiscType misc) {
<b class="nc">&nbsp;        return misc.hasFlag(MiscType.F_CLUB)</b>
<b class="nc">&nbsp;                &amp;&amp; misc.hasSubType(MiscType.S_CHAIN_WHIP</b>
&nbsp;                | MiscType.S_HATCHET
&nbsp;                | MiscType.S_MACE
&nbsp;                | MiscType.S_SWORD
&nbsp;                | MiscType.S_VIBRO_SMALL
&nbsp;                | MiscType.S_VIBRO_MEDIUM
&nbsp;                | MiscType.S_VIBRO_LARGE);
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * @param misc A type of equipment that can be mounted in a mech arm
&nbsp;     * @return     Whether the equipment requires the lower arm acutator
&nbsp;     */
&nbsp;    public static boolean requiresLowerArm(MiscType misc) {
<b class="nc">&nbsp;        return replacesHandActuator(misc) ||</b>
<b class="nc">&nbsp;                (misc.hasFlag(MiscType.F_CLUB)</b>
<b class="nc">&nbsp;                &amp;&amp; misc.hasSubType(MiscType.S_LANCE | MiscType.S_RETRACTABLE_BLADE));</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * @param mech      The Mech
&nbsp;     * @param eq        The equipment
&nbsp;     * @param location  A location index on the Entity
&nbsp;     * @param buffer    If non-null and the location is invalid, will be appended with an explanation
&nbsp;     * @return          Whether the equipment can be mounted in the location on the Mech
&nbsp;     */
&nbsp;    public static boolean isValidMechLocation(Mech mech, EquipmentType eq, int location, @Nullable StringBuffer buffer) {
<b class="nc">&nbsp;        if (eq instanceof MiscType) {</b>
<b class="nc">&nbsp;            if (eq.hasFlag(MiscType.F_CLUB) &amp;&amp; ((eq.getSubType() &amp;</b>
&nbsp;                            (MiscType.S_DUAL_SAW | MiscType.S_PILE_DRIVER
&nbsp;                                    | MiscType.S_WRECKING_BALL | MiscType.S_BACKHOE
&nbsp;                                    | MiscType.S_COMBINE | MiscType.S_CHAINSAW
&nbsp;                                    | MiscType.S_ROCK_CUTTER | MiscType.S_BUZZSAW
&nbsp;                                    | MiscType.S_SPOT_WELDER | MiscType.S_PILE_DRIVER)) != 0)) {
<b class="nc">&nbsp;                if (mech.entityIsQuad() &amp;&amp; (location != Mech.LOC_LT) &amp;&amp; (location != Mech.LOC_RT)) {</b>
<b class="nc">&nbsp;                    if (buffer != null) {</b>
<b class="nc">&nbsp;                        buffer.append(eq.getName()).append(&quot; must be mounted in a side torso.\n&quot;);</b>
&nbsp;                    }
<b class="nc">&nbsp;                    return false;</b>
<b class="nc">&nbsp;                } else if (!mech.entityIsQuad() &amp;&amp; (location != Mech.LOC_LARM) &amp;&amp; (location != Mech.LOC_RARM)) {</b>
<b class="nc">&nbsp;                    if (buffer != null) {</b>
<b class="nc">&nbsp;                        buffer.append(eq.getName()).append(&quot; must be mounted in an arm.\n&quot;);</b>
&nbsp;                    }
<b class="nc">&nbsp;                    return false;</b>
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            if (eq.hasFlag(MiscType.F_SALVAGE_ARM) &amp;&amp; (mech.entityIsQuad()</b>
&nbsp;                    || ((location != Mech.LOC_LARM) &amp;&amp; (location != Mech.LOC_RARM)))) {
<b class="nc">&nbsp;                if (buffer != null) {</b>
<b class="nc">&nbsp;                    buffer.append(eq.getName()).append(&quot; must be mounted in an arm.\n&quot;);</b>
&nbsp;                }
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (eq.hasFlag(MiscType.F_ACTUATOR_ENHANCEMENT_SYSTEM)</b>
<b class="nc">&nbsp;                    &amp;&amp; ((location == Mech.LOC_HEAD) || mech.locationIsTorso(location))) {</b>
<b class="nc">&nbsp;                if (buffer != null) {</b>
<b class="nc">&nbsp;                    buffer.append(eq.getName()).append(&quot; must be mounted in an arm or leg location.\n&quot;);</b>
&nbsp;                }
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (eq.hasFlag(MiscType.F_HEAD_TURRET) &amp;&amp; (location != Mech.LOC_CT)) {</b>
<b class="nc">&nbsp;                if (buffer != null) {</b>
<b class="nc">&nbsp;                    buffer.append(eq.getName()).append(&quot; must be placed in the center torso.\n&quot;);</b>
&nbsp;                }
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
<b class="nc">&nbsp;            if ((eq.hasFlag(MiscType.F_QUAD_TURRET) || eq.hasFlag(MiscType.F_SHOULDER_TURRET))</b>
&nbsp;                    &amp;&amp; (location != Mech.LOC_RT) &amp;&amp; (location != Mech.LOC_LT)) {
<b class="nc">&nbsp;                if (buffer != null) {</b>
<b class="nc">&nbsp;                    buffer.append(eq.getName()).append(&quot; must be placed in a side torso.\n&quot;);</b>
&nbsp;                }
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (eq.hasFlag(MiscType.F_HARJEL) &amp;&amp; mech.hasSystem(Mech.SYSTEM_COCKPIT, location)) {</b>
<b class="nc">&nbsp;                if (buffer != null) {</b>
<b class="nc">&nbsp;                    buffer.append(eq.getName()).append(&quot; cannot be placed in the same location as the cockpit.\n&quot;);</b>
&nbsp;                }
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
<b class="nc">&nbsp;            if ((eq.hasFlag(MiscType.F_MASS) || eq.hasFlag(MiscType.F_REMOTE_DRONE_COMMAND_CONSOLE))</b>
<b class="nc">&nbsp;                    &amp;&amp; !mech.hasSystem(Mech.SYSTEM_COCKPIT, location)) {</b>
<b class="nc">&nbsp;                if (buffer != null) {</b>
<b class="nc">&nbsp;                    buffer.append(eq.getName()).append(&quot; must be placed in the same location as the cockpit.\n&quot;);</b>
&nbsp;                }
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (((eq.hasFlag(MiscType.F_MASC) &amp;&amp; eq.hasSubType(MiscType.S_SUPERCHARGER))</b>
<b class="nc">&nbsp;                    || eq.hasFlag(MiscType.F_EMERGENCY_COOLANT_SYSTEM))</b>
<b class="nc">&nbsp;                    &amp;&amp; !mech.hasSystem(Mech.SYSTEM_ENGINE, location)) {</b>
<b class="nc">&nbsp;                if (buffer != null) {</b>
<b class="nc">&nbsp;                    buffer.append(eq.getName()).append(&quot; must be placed in the a location with an engine critical.\n&quot;);</b>
&nbsp;                }
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
<b class="nc">&nbsp;            if ((eq.hasFlag(MiscType.F_FUEL) || (eq.hasFlag(MiscType.F_CASE) &amp;&amp; !eq.isClan())</b>
<b class="nc">&nbsp;                    || eq.hasFlag(MiscType.F_LIGHT_BRIDGE_LAYER) || eq.hasFlag(MiscType.F_MEDIUM_BRIDGE_LAYER)</b>
<b class="nc">&nbsp;                    || eq.hasFlag(MiscType.F_HEAVY_BRIDGE_LAYER) || eq.hasFlag(MiscType.F_LADDER))</b>
<b class="nc">&nbsp;                    &amp;&amp; !mech.locationIsTorso(location)) {</b>
<b class="nc">&nbsp;                if (buffer != null) {</b>
<b class="nc">&nbsp;                    buffer.append(eq.getName()).append(&quot; must be placed in a torso location.\n&quot;);</b>
&nbsp;                }
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (eq.hasFlag(MiscType.F_LIFTHOIST) &amp;&amp; ((location == Mech.LOC_HEAD) || mech.locationIsLeg(location))) {</b>
<b class="nc">&nbsp;                if (buffer != null) {</b>
<b class="nc">&nbsp;                    buffer.append(eq.getName()).append(&quot; must be placed in a torso or arm location.\n&quot;);</b>
&nbsp;                }
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (eq.hasFlag(MiscType.F_JUMP_JET)</b>
<b class="nc">&nbsp;                    &amp;&amp; !mech.locationIsLeg(location) &amp;&amp; !mech.locationIsTorso(location)) {</b>
<b class="nc">&nbsp;                if (buffer != null) {</b>
<b class="nc">&nbsp;                    buffer.append(eq.getName()).append(&quot; must be placed in a torso or leg location.\n&quot;);</b>
&nbsp;                }
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
<b class="nc">&nbsp;            if ((eq.hasFlag(MiscType.F_AP_POD) || eq.hasFlag(MiscType.F_TRACKS) || eq.hasFlag(MiscType.F_TALON))</b>
<b class="nc">&nbsp;                    &amp;&amp; !mech.locationIsLeg(location)) {</b>
<b class="nc">&nbsp;                if (buffer != null) {</b>
<b class="nc">&nbsp;                    buffer.append(eq.getName()).append(&quot; must be placed in a leg location.\n&quot;);</b>
&nbsp;                }
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (eq.hasFlag(MiscType.F_MODULAR_ARMOR) &amp;&amp; (location == Mech.LOC_HEAD)) {</b>
<b class="nc">&nbsp;                if (buffer != null) {</b>
<b class="nc">&nbsp;                    buffer.append(eq.getName()).append(&quot; cannot be placed in the head.\n&quot;);</b>
&nbsp;                }
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (eq.hasFlag(MiscType.F_EJECTION_SEAT) &amp;&amp; (location != Mech.LOC_HEAD)) {</b>
<b class="nc">&nbsp;                if (buffer != null) {</b>
<b class="nc">&nbsp;                    buffer.append(eq.getName()).append(&quot; must be placed in the head.\n&quot;);</b>
&nbsp;                }
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
<b class="nc">&nbsp;        } else if (eq instanceof WeaponType) {</b>
<b class="nc">&nbsp;            if (eq.hasFlag(WeaponType.F_VGL) &amp;&amp; !mech.locationIsTorso(location)) {</b>
<b class="nc">&nbsp;                if (buffer != null) {</b>
<b class="nc">&nbsp;                    buffer.append(eq.getName()).append(&quot; must be placed in a torso location.\n&quot;);</b>
&nbsp;                }
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (((((WeaponType) eq).getAmmoType() == AmmoType.T_GAUSS_HEAVY)</b>
<b class="nc">&nbsp;                    || ((WeaponType) eq).getAmmoType() == AmmoType.T_IGAUSS_HEAVY)</b>
<b class="nc">&nbsp;                    &amp;&amp; !mech.isSuperHeavy() &amp;&amp; !mech.locationIsTorso(location)) {</b>
<b class="nc">&nbsp;                if (buffer != null) {</b>
<b class="nc">&nbsp;                    buffer.append(eq.getName()).append(&quot; must be placed in a torso location.\n&quot;);</b>
&nbsp;                }
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        return true;</b>
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2023-05-16 16:28</div>
</div>
</body>
</html>
