


<!DOCTYPE html>
<html id="htmlId">
<head>
  <title>Coverage Report > TestAero</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">megamek.common.verifier</a>
</div>

<h1>Coverage Summary for Class: TestAero (megamek.common.verifier)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">TestAero</td>
<td class="coverageStat">
  <span class="percent">
    6.6%
  </span>
  <span class="absValue">
    (4/61)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    2%
  </span>
  <span class="absValue">
    (14/686)
  </span>
</td>
</tr>
  <tr>
    <td class="name">TestAero$AeroArmor</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/27)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">TestAero$Quarters</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/10)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/24)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    5.3%
  </span>
  <span class="absValue">
    (4/75)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    1.9%
  </span>
  <span class="absValue">
    (14/737)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;/*
&nbsp; * MegaMek -
&nbsp; * Copyright (C) 2000,2001,2002,2003,2004,2005 Ben Mazur (bmazur@sev.org)
&nbsp; *
&nbsp; *  This program is free software; you can redistribute it and/or modify it
&nbsp; *  under the terms of the GNU General Public License as published by the Free
&nbsp; *  Software Foundation; either version 2 of the License, or (at your option)
&nbsp; *  any later version.
&nbsp; *
&nbsp; *  This program is distributed in the hope that it will be useful, but
&nbsp; *  WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
&nbsp; *  or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License
&nbsp; *  for more details.
&nbsp; */
&nbsp;
&nbsp;/*
&nbsp; * Author: Reinhard Vicinus
&nbsp; */
&nbsp;
&nbsp;package megamek.common.verifier;
&nbsp;
&nbsp;import java.util.*;
&nbsp;import java.util.function.Function;
&nbsp;
&nbsp;import megamek.common.*;
&nbsp;import megamek.common.annotations.Nullable;
&nbsp;import megamek.common.util.StringUtil;
&nbsp;import megamek.common.weapons.bayweapons.BayWeapon;
&nbsp;import megamek.common.weapons.capitalweapons.ScreenLauncherWeapon;
&nbsp;import megamek.common.weapons.flamers.VehicleFlamerWeapon;
&nbsp;import megamek.common.weapons.infantry.InfantryWeapon;
&nbsp;import megamek.common.weapons.lasers.CLChemicalLaserWeapon;
&nbsp;import megamek.common.weapons.lrms.LRMWeapon;
&nbsp;import megamek.common.weapons.lrms.LRTWeapon;
&nbsp;import megamek.common.weapons.missiles.MRMWeapon;
&nbsp;import megamek.common.weapons.missiles.RLWeapon;
&nbsp;import megamek.common.weapons.srms.SRMWeapon;
&nbsp;import megamek.common.weapons.srms.SRTWeapon;
&nbsp;
&nbsp;/**
&nbsp; * Class for testing and validating instantiations for Conventional Fighters and
&nbsp; * Aerospace Fighters.
&nbsp; * 
&nbsp; * @author arlith
&nbsp; *
&nbsp; */
&nbsp;public class TestAero extends TestEntity {
<b class="fc">&nbsp;    private Aero aero = null;</b>
&nbsp;    
&nbsp;    /**
&nbsp;     * An enumeration that keeps track of the legal armors for Aerospace and 
&nbsp;     * Conventional fighters.  Each entry consists of the type, which 
&nbsp;     * corresponds to the types defined in &lt;code&gt;EquipmentType&lt;/code&gt; as well
&nbsp;     * as the number of slots the armor takes up.
&nbsp;     * 
&nbsp;     * @author arlith
&nbsp;     *
&nbsp;     */
<b class="nc">&nbsp;    public static enum AeroArmor{</b>
<b class="nc">&nbsp;        STANDARD(EquipmentType.T_ARMOR_STANDARD, 0, 0, false),   </b>
<b class="nc">&nbsp;        CLAN_FERRO_ALUM(EquipmentType.T_ARMOR_ALUM, 1, 1, true),</b>
<b class="nc">&nbsp;        FERRO_LAMELLOR(EquipmentType.T_ARMOR_FERRO_LAMELLOR, 2, 1, true),</b>
<b class="nc">&nbsp;        CLAN_REACTIVE(EquipmentType.T_ARMOR_REACTIVE, 1, 1, true),</b>
<b class="nc">&nbsp;        CLAN_REFLECTIVE(EquipmentType.T_ARMOR_REFLECTIVE, 1, 1, true),</b>
<b class="nc">&nbsp;        ANTI_PENETRATIVE_ABLATION(</b>
&nbsp;                EquipmentType.T_ARMOR_ANTI_PENETRATIVE_ABLATION, 1, 1, false),
<b class="nc">&nbsp;        BALLISTIC_REINFORCED(</b>
&nbsp;                EquipmentType.T_ARMOR_BALLISTIC_REINFORCED, 2, 1, false),
<b class="nc">&nbsp;        FERRO_ALUM(EquipmentType.T_ARMOR_ALUM, 2, 1, false),</b>
<b class="nc">&nbsp;        FERRO_PROTO(EquipmentType.T_ARMOR_FERRO_ALUM_PROTO, 3, 1, false),        </b>
<b class="nc">&nbsp;        HEAVY_FERRO_ALUM(EquipmentType.T_ARMOR_HEAVY_ALUM, 4, 2, false),</b>
<b class="nc">&nbsp;        LIGHT_FERRO_ALUM(EquipmentType.T_ARMOR_LIGHT_ALUM, 1, 1, false),</b>
<b class="nc">&nbsp;        PRIMITIVE(EquipmentType.T_ARMOR_PRIMITIVE_FIGHTER, 0, 0, false),        </b>
<b class="nc">&nbsp;        REACTIVE(EquipmentType.T_ARMOR_REACTIVE, 3, 1, false),        </b>
<b class="nc">&nbsp;        REFLECTIVE(EquipmentType.T_ARMOR_REFLECTIVE, 2, 1, false),</b>
<b class="nc">&nbsp;        STEALTH_VEHICLE(EquipmentType.T_ARMOR_STEALTH_VEHICLE, 2, 1, false);</b>
&nbsp;
&nbsp;        /**
&nbsp;         * The type, corresponding to types defined in 
&nbsp;         * &lt;code&gt;EquipmentType&lt;/code&gt;.
&nbsp;         */
&nbsp;        public final int type;
&nbsp;        
&nbsp;        /**
&nbsp;         * The number of spaces occupied by the armor type.  Armors that take 
&nbsp;         * up 1 space take up space in the aft, those with 2 take up space in
&nbsp;         * each wing, 3 takes up space in both wings and the aft, 4 takes up
&nbsp;         * space in each possible arc (nose, aft, left wing, right wing).
&nbsp;         */
&nbsp;        public final int space;
&nbsp;        
&nbsp;        /**
&nbsp;         * The number of weapon spaces occupied by patchwork armor. Unlike standard armor, patchwork
&nbsp;         * armor takes up slots in the location where it&#39;s used.
&nbsp;         */
&nbsp;        public final int patchworkSpace;
&nbsp;        
&nbsp;        /**
&nbsp;         * Denotes whether this armor is Clan or not.
&nbsp;         */
&nbsp;        public boolean isClan;
&nbsp;        
<b class="nc">&nbsp;        private AeroArmor(int t, int s, int p, boolean c){</b>
<b class="nc">&nbsp;            type = t;</b>
<b class="nc">&nbsp;            space = s;</b>
<b class="nc">&nbsp;            patchworkSpace = p;</b>
<b class="nc">&nbsp;            isClan = c;</b>
&nbsp;        }
&nbsp;        
&nbsp;        /**
&nbsp;         * Given an armor type, return the &lt;code&gt;AeroArmor&lt;/code&gt; instance that
&nbsp;         * represents that type.
&nbsp;         * 
&nbsp;         * @param t  The armor type.
&nbsp;         * @param c  Whether this armor type is Clan or not.
&nbsp;         * @return   The &lt;code&gt;AeroArmor&lt;/code&gt; that correspondes to the given 
&nbsp;         *              type or null if no match was found.
&nbsp;         */
&nbsp;        public static AeroArmor getArmor(int t, boolean c){
<b class="nc">&nbsp;            for (AeroArmor a : values()){</b>
<b class="nc">&nbsp;                if ((a.type == t) &amp;&amp; ((a.isClan == c)</b>
&nbsp;                        || (t == EquipmentType.T_ARMOR_STANDARD))) {
<b class="nc">&nbsp;                    return a;</b>
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            return null;</b>
&nbsp;        }
&nbsp;        
&nbsp;        /**
&nbsp;         * @return The &lt;code&gt;MiscType&lt;/code&gt; for this armor.
&nbsp;         */
&nbsp;        public EquipmentType getArmor() {
<b class="nc">&nbsp;            String name = EquipmentType.getArmorTypeName(type, isClan);</b>
<b class="nc">&nbsp;            return EquipmentType.get(name);</b>
&nbsp;        }
&nbsp;        
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * Filters all fighter armor according to given tech constraints
&nbsp;     * 
&nbsp;     * @param techManager
&nbsp;     * @return A list of all armors that meet the tech constraints
&nbsp;     */
&nbsp;    public static List&lt;EquipmentType&gt; legalArmorsFor(ITechManager techManager) {
<b class="nc">&nbsp;        List&lt;EquipmentType&gt; retVal = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        for (AeroArmor armor : AeroArmor.values()) {</b>
<b class="nc">&nbsp;            final EquipmentType eq = armor.getArmor();</b>
<b class="nc">&nbsp;            if ((null != eq) &amp;&amp; techManager.isLegal(eq)) {</b>
<b class="nc">&nbsp;                retVal.add(eq);</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        return retVal;</b>
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * Defines how many spaces each arc has for weapons. Large units can add more by increasing weight
&nbsp;     * of master fire control systems.
&nbsp;     */
&nbsp;    public static int slotsPerArc(Aero aero) {
<b class="nc">&nbsp;        if (aero.hasETypeFlag(Entity.ETYPE_WARSHIP)</b>
<b class="nc">&nbsp;                || aero.hasETypeFlag(Entity.ETYPE_SPACE_STATION)) {</b>
<b class="nc">&nbsp;            return 20;</b>
<b class="nc">&nbsp;        } else if (aero.hasETypeFlag(Entity.ETYPE_JUMPSHIP)</b>
<b class="nc">&nbsp;                || aero.hasETypeFlag(Entity.ETYPE_SMALL_CRAFT)) {</b>
<b class="nc">&nbsp;            return 12;</b>
&nbsp;        } else {
<b class="nc">&nbsp;            return 5;</b>
&nbsp;        }
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * @param aero A large craft
&nbsp;     * @return     The maximum number of bay doors. Aerospace units that are not large craft have
&nbsp;     *             a maximum of zero.
&nbsp;     */
&nbsp;    public static int maxBayDoors(Aero aero) {
<b class="nc">&nbsp;        if (aero.hasETypeFlag(Entity.ETYPE_WARSHIP)) {</b>
<b class="nc">&nbsp;            return 8 + (int)Math.ceil(aero.getWeight() / 100000);</b>
<b class="nc">&nbsp;        } else if (aero.hasETypeFlag(Entity.ETYPE_JUMPSHIP)) {</b>
<b class="nc">&nbsp;            return 8 + (int)Math.ceil(aero.getWeight() / 75000);</b>
<b class="nc">&nbsp;        } else if (aero.hasETypeFlag(Entity.ETYPE_JUMPSHIP)</b>
<b class="nc">&nbsp;                || (aero.hasETypeFlag(Entity.ETYPE_DROPSHIP))) {</b>
<b class="nc">&nbsp;            return 7 + (int)Math.ceil(aero.getWeight() / 50000);</b>
<b class="nc">&nbsp;        } else if (aero.hasETypeFlag(Entity.ETYPE_SMALL_CRAFT)) {</b>
<b class="nc">&nbsp;            return aero.isSpheroid()? 4 : 2;</b>
&nbsp;        } else {
<b class="nc">&nbsp;            return 0;</b>
&nbsp;        }
&nbsp;    }
&nbsp;    
<b class="nc">&nbsp;    public enum Quarters {</b>
<b class="nc">&nbsp;        FIRST_CLASS (10, FirstClassQuartersCargoBay.class, size -&gt; new FirstClassQuartersCargoBay(size, 0)),</b>
<b class="nc">&nbsp;        STANDARD (7, CrewQuartersCargoBay.class, size -&gt; new CrewQuartersCargoBay(size, 0)),</b>
<b class="nc">&nbsp;        SECOND_CLASS (7, SecondClassQuartersCargoBay.class, size -&gt; new SecondClassQuartersCargoBay(size, 0)),</b>
<b class="nc">&nbsp;        STEERAGE (5, SteerageQuartersCargoBay.class, size -&gt; new SteerageQuartersCargoBay(size, 0));</b>
&nbsp;        
&nbsp;        private int tonnage;
&nbsp;        private Class&lt;? extends Bay&gt; bayClass;
&nbsp;        private Function&lt;Integer, Bay&gt; init;
&nbsp;        
<b class="nc">&nbsp;        Quarters(int tonnage, Class&lt;? extends Bay&gt; bayClass, Function&lt;Integer, Bay&gt; init) {</b>
<b class="nc">&nbsp;            this.tonnage = tonnage;</b>
<b class="nc">&nbsp;            this.bayClass = bayClass;</b>
<b class="nc">&nbsp;            this.init = init;</b>
&nbsp;        }
&nbsp;        
&nbsp;        public int getTonnage() {
<b class="nc">&nbsp;            return tonnage;</b>
&nbsp;        }
&nbsp;        
&nbsp;        public static @Nullable Quarters getQuartersForBay(Bay bay) {
<b class="nc">&nbsp;            for (Quarters q : values()) {</b>
<b class="nc">&nbsp;                if (bay.getClass() == q.bayClass) {</b>
<b class="nc">&nbsp;                    return q;</b>
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            return null;</b>
&nbsp;        }
&nbsp;        
&nbsp;        public Bay newQuarters(int size) {
<b class="nc">&nbsp;            return init.apply(size * tonnage);</b>
&nbsp;        }
&nbsp;        
&nbsp;        public static Map&lt;Quarters, Integer&gt; getQuartersByType(Aero aero) {
<b class="nc">&nbsp;            EnumMap&lt;TestAero.Quarters, Integer&gt; sizes = new EnumMap&lt;&gt;(TestAero.Quarters.class);</b>
<b class="nc">&nbsp;            for (Quarters q : values()) {</b>
<b class="nc">&nbsp;                sizes.put(q, 0);</b>
&nbsp;            }
<b class="nc">&nbsp;            for (Bay bay : aero.getTransportBays()) {</b>
<b class="nc">&nbsp;                Quarters q = getQuartersForBay(bay);</b>
<b class="nc">&nbsp;                if (null != q) {</b>
<b class="nc">&nbsp;                    sizes.merge(q, (int) bay.getCapacity(), Integer::sum);</b>
&nbsp;                }
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;            return sizes;</b>
&nbsp;        }
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * Defines the maximum engine rating that an Aero can have.
&nbsp;     */
<b class="fc">&nbsp;    public static int MAX_ENGINE_RATING = 400;</b>
&nbsp;    
&nbsp;    /**
&nbsp;     *  Computes the maximum number of armor points for a given Aero
&nbsp;     *  at the given tonnage.
&nbsp;     *   
&nbsp;     * @param aero
&nbsp;     * @param tonnage
&nbsp;     * @return
&nbsp;     */
&nbsp;    public static int maxArmorPoints(Entity aero, double tonnage){
<b class="nc">&nbsp;        long eType = aero.getEntityType();</b>
<b class="nc">&nbsp;        if (aero.hasETypeFlag(Entity.ETYPE_SMALL_CRAFT)) {</b>
<b class="nc">&nbsp;            return TestSmallCraft.maxArmorPoints((SmallCraft)aero);</b>
<b class="nc">&nbsp;        } else if (aero.hasETypeFlag(Entity.ETYPE_CONV_FIGHTER)) {</b>
<b class="nc">&nbsp;                return (int)(tonnage * 1);</b>
<b class="nc">&nbsp;        } else if (eType == Entity.ETYPE_AERO){</b>
<b class="nc">&nbsp;            return (int)(tonnage * 8);</b>
&nbsp;        } else {
<b class="nc">&nbsp;            return 0;</b>
&nbsp;        }
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * Computes the available space for each location in the supplied Aero.
&nbsp;     * Aeros can only have so many weapons in each location, and this available
&nbsp;     * space is reduced by the armor type.
&nbsp;     * 
&nbsp;     * @param a  The aero in question
&nbsp;     * @return   Returns an int array, where each element corresponds to a 
&nbsp;     *           location and the value is the number of weapons the Aero can
&nbsp;     *           have in that location. Returns null if the space cannot be determined
&nbsp;     *           due to illegal armor type value.
&nbsp;     */
&nbsp;    public static @Nullable int[] availableSpace(Aero a){
&nbsp;        // Keep track of the max space we have in each arc
<b class="nc">&nbsp;        int slots = slotsPerArc(a);</b>
<b class="nc">&nbsp;        int availSpace[] = </b>
&nbsp;            { slots, slots, slots, slots };
&nbsp;        
<b class="nc">&nbsp;        if (!a.hasPatchworkArmor()) {</b>
&nbsp;            // Get the armor type, to determine how much space it uses
<b class="nc">&nbsp;            AeroArmor armor = </b>
<b class="nc">&nbsp;                    AeroArmor.getArmor(a.getArmorType(Aero.LOC_NOSE),</b>
<b class="nc">&nbsp;                                       a.isClanArmor(Aero.LOC_NOSE));</b>
&nbsp;            
<b class="nc">&nbsp;            if (armor == null){            </b>
<b class="nc">&nbsp;                return null;</b>
&nbsp;            }
&nbsp;            // Remove space for each location until we&#39;ve allocated the armor
<b class="nc">&nbsp;            int spaceUsedByArmor = armor.space;</b>
<b class="nc">&nbsp;            int loc = (spaceUsedByArmor != 2) ? Aero.LOC_AFT : Aero.LOC_RWING;</b>
<b class="nc">&nbsp;            while (spaceUsedByArmor &gt; 0){</b>
<b class="nc">&nbsp;                availSpace[loc]--;</b>
<b class="nc">&nbsp;                spaceUsedByArmor--;</b>
<b class="nc">&nbsp;                loc--;</b>
<b class="nc">&nbsp;                if (loc &lt; 0){</b>
<b class="nc">&nbsp;                    loc = Aero.LOC_AFT;</b>
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;        } else {</b>
<b class="nc">&nbsp;            for (int loc = 0; loc &lt; Aero.LOC_WINGS; loc++) {</b>
<b class="nc">&nbsp;                AeroArmor armor = AeroArmor.getArmor(a.getArmorType(loc),</b>
<b class="nc">&nbsp;                        a.isClanArmor(loc));</b>
<b class="nc">&nbsp;                if (null == armor) {</b>
<b class="nc">&nbsp;                    return null;</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    availSpace[loc] -= armor.patchworkSpace;</b>
&nbsp;                }
&nbsp;            }
&nbsp;        }
&nbsp;        // Blue shield particle field dampener takes one slot in each arc.
<b class="nc">&nbsp;        if (a.hasMisc(MiscType.F_BLUE_SHIELD)) {</b>
<b class="nc">&nbsp;            for (int i = 0; i &lt; availSpace.length; i++) {</b>
<b class="nc">&nbsp;                availSpace[i]--;</b>
&nbsp;            }
&nbsp;        }
&nbsp;        
&nbsp;        // XXL engines take up extra space in the aft in conventional fighters
<b class="nc">&nbsp;        if (((a.getEntityType() &amp; Entity.ETYPE_CONV_FIGHTER) != 0)</b>
<b class="nc">&nbsp;                &amp;&amp; a.hasEngine() &amp;&amp; (a.getEngine().getEngineType() == Engine.XXL_ENGINE)) {</b>
<b class="nc">&nbsp;            if (a.getEngine().hasFlag(Engine.CLAN_ENGINE)) {</b>
<b class="nc">&nbsp;                availSpace[Aero.LOC_AFT] -= 2;</b>
&nbsp;            } else {
<b class="nc">&nbsp;                availSpace[Aero.LOC_AFT] -= 4;</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        return availSpace;</b>
&nbsp;    }
&nbsp;    
&nbsp;    public static boolean usesWeaponSlot(Entity en, EquipmentType eq) {
<b class="nc">&nbsp;        if (eq instanceof WeaponType) {</b>
<b class="nc">&nbsp;            return !(eq instanceof BayWeapon);</b>
&nbsp;        }
<b class="nc">&nbsp;        if (eq instanceof MiscType) {</b>
&nbsp;            // Equipment that takes up a slot on fighters and small craft, but not large craft.
<b class="nc">&nbsp;            if (!en.hasETypeFlag(Entity.ETYPE_DROPSHIP) &amp;&amp; !en.hasETypeFlag(Entity.ETYPE_JUMPSHIP)</b>
<b class="nc">&nbsp;                    &amp;&amp; (eq.hasFlag(MiscType.F_BAP)</b>
<b class="nc">&nbsp;                            || eq.hasFlag(MiscType.F_WATCHDOG)</b>
<b class="nc">&nbsp;                            || eq.hasFlag(MiscType.F_ECM)</b>
<b class="nc">&nbsp;                            || eq.hasFlag(MiscType.F_ANGEL_ECM)</b>
<b class="nc">&nbsp;                            || eq.hasFlag(MiscType.F_EW_EQUIPMENT)</b>
<b class="nc">&nbsp;                            || eq.hasFlag(MiscType.F_BOOBY_TRAP)</b>
<b class="nc">&nbsp;                            || eq.hasFlag(MiscType.F_SENSOR_DISPENSER))) {</b>
<b class="nc">&nbsp;                return true;</b>
&nbsp;                
&nbsp;            }
&nbsp;            // Equipment that takes a slot on all aerospace units
<b class="nc">&nbsp;            return  eq.hasFlag(MiscType.F_CHAFF_POD)</b>
<b class="nc">&nbsp;                    || eq.hasFlag(MiscType.F_SPACE_MINE_DISPENSER)</b>
<b class="nc">&nbsp;                    || eq.hasFlag(MiscType.F_MOBILE_HPG)</b>
<b class="nc">&nbsp;                    || eq.hasFlag(MiscType.F_RECON_CAMERA)</b>
<b class="nc">&nbsp;                    || eq.hasFlag(MiscType.F_HIRES_IMAGER)</b>
<b class="nc">&nbsp;                    || eq.hasFlag(MiscType.F_HYPERSPECTRAL_IMAGER)</b>
<b class="nc">&nbsp;                    || eq.hasFlag(MiscType.F_INFRARED_IMAGER)</b>
<b class="nc">&nbsp;                    || eq.hasFlag(MiscType.F_LOOKDOWN_RADAR);</b>
&nbsp;        }
<b class="nc">&nbsp;        return false;</b>
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * Computes the engine rating for the given entity type.
&nbsp;     * 
&nbsp;     * @param unit
&nbsp;     * @param tonnage
&nbsp;     * @param desiredSafeThrust
&nbsp;     * @return
&nbsp;     */
&nbsp;    public static int calculateEngineRating(Aero unit, int tonnage, int desiredSafeThrust){
&nbsp;        int rating;
<b class="nc">&nbsp;        long eType = unit.getEntityType();</b>
<b class="nc">&nbsp;        if (unit.hasETypeFlag(Entity.ETYPE_CONV_FIGHTER)) {</b>
<b class="nc">&nbsp;            rating = (tonnage * desiredSafeThrust);</b>
<b class="nc">&nbsp;        } else if (eType == Entity.ETYPE_AERO){</b>
<b class="nc">&nbsp;            rating = (tonnage * (desiredSafeThrust - 2));</b>
&nbsp;        } else {
<b class="nc">&nbsp;            rating = 0;</b>
&nbsp;        }
&nbsp;        
<b class="nc">&nbsp;        if (unit.isPrimitive()){</b>
<b class="nc">&nbsp;            double dRating = rating;</b>
<b class="nc">&nbsp;            dRating *= 1.2;</b>
<b class="nc">&nbsp;            if ((dRating % 5) != 0) {</b>
<b class="nc">&nbsp;                dRating = (dRating - (dRating % 5)) + 5;</b>
&nbsp;            }
<b class="nc">&nbsp;            rating = (int) dRating;</b>
&nbsp;        }
<b class="nc">&nbsp;        return rating;</b>
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * Computes and returns the maximum number of turns the given unit could
&nbsp;     * fly at safe thrust given its fuel payload.  Aerospace fighters consume
&nbsp;     * 1 fuel point per thrust point spent up the the maximum safe thrust, 
&nbsp;     * whereas conventional fighters with turbine engines consume 0.5 fuel
&nbsp;     * points per thrust point spent up to the maximum safe thrust.
&nbsp;     * See Strategic Operations pg 34. 
&nbsp;     * 
&nbsp;     * @param aero
&nbsp;     * @return
&nbsp;     */
&nbsp;    public static float calculateMaxTurnsAtSafe(Aero aero){
<b class="nc">&nbsp;        int fuelPoints = aero.getFuel();</b>
&nbsp;        float fuelPerTurn;
<b class="nc">&nbsp;        if (aero.hasETypeFlag(Entity.ETYPE_CONV_FIGHTER)</b>
<b class="nc">&nbsp;                &amp;&amp; aero.hasEngine()</b>
<b class="nc">&nbsp;                &amp;&amp; (aero.getEngine().getEngineType() == Engine.COMBUSTION_ENGINE)) {</b>
<b class="nc">&nbsp;            fuelPerTurn = aero.getWalkMP() * 0.5f;</b>
<b class="nc">&nbsp;        } else if (aero.getWalkMP() == 0) {</b>
<b class="nc">&nbsp;            fuelPerTurn = 0.2f;</b>
&nbsp;        } else {
<b class="nc">&nbsp;            fuelPerTurn = aero.getWalkMP();</b>
&nbsp;        }
<b class="nc">&nbsp;        return fuelPoints/fuelPerTurn;        </b>
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * Computes and returns the maximum number of turns the given unit could
&nbsp;     * fly at max thrust given its fuel payload.  Aerospace fighters consume
&nbsp;     * 1 fuel point per thrust point spent up the the maximum safe thrust and
&nbsp;     * 2 fuel points per thrust point afterwards, whereas conventional fighters 
&nbsp;     * with ICE engines consume 0.5 fuel points per thrust point spent up to 
&nbsp;     * the maximum safe thrust and 1 fuel point per thrust up to the maximum 
&nbsp;     * thrust.  Conventional fighters with Fusion engines spend 0.5 fuel points
&nbsp;     * per thrust up to the safe thrust and then 2 fuel points per thrust 
&nbsp;     * afterwards.  See Strategic Operations pg 34.
&nbsp;     * 
&nbsp;     * @param aero
&nbsp;     * @return
&nbsp;     */
&nbsp;    public static float calculateMaxTurnsAtMax(Aero aero){
<b class="nc">&nbsp;        int fuelPoints = aero.getFuel();</b>
&nbsp;        float fuelPerTurn;
<b class="nc">&nbsp;        if (aero.hasETypeFlag(Entity.ETYPE_CONV_FIGHTER)) {</b>
<b class="nc">&nbsp;            fuelPerTurn = aero.getWalkMP() * 0.5f;</b>
<b class="nc">&nbsp;            if(aero.hasEngine()) {</b>
<b class="nc">&nbsp;                if(aero.getEngine().isFusion()) {</b>
<b class="nc">&nbsp;                    fuelPerTurn += (aero.getRunMP()-aero.getWalkMP()) * 2;</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    fuelPerTurn += (aero.getRunMP()-aero.getWalkMP());</b>
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;        } else if (aero.getWalkMP() == 0) {</b>
<b class="nc">&nbsp;            fuelPerTurn = 0.2f;</b>
&nbsp;        } else {
<b class="nc">&nbsp;            fuelPerTurn = aero.getWalkMP() + </b>
<b class="nc">&nbsp;                    (aero.getRunMP()-aero.getWalkMP()) * 2;</b>
&nbsp;        }
<b class="nc">&nbsp;        return fuelPoints/fuelPerTurn;       </b>
&nbsp;    }    
&nbsp;
&nbsp;    public static int weightFreeHeatSinks(Aero aero) {
<b class="nc">&nbsp;        if (aero.hasETypeFlag(Entity.ETYPE_SMALL_CRAFT)) {</b>
<b class="nc">&nbsp;            return TestSmallCraft.weightFreeHeatSinks((SmallCraft) aero);</b>
<b class="nc">&nbsp;        } else if (aero.hasETypeFlag(Entity.ETYPE_JUMPSHIP)) {</b>
<b class="nc">&nbsp;            return TestAdvancedAerospace.weightFreeHeatSinks((Jumpship) aero);</b>
<b class="nc">&nbsp;        } else if (aero.hasEngine()) {</b>
<b class="nc">&nbsp;            return aero.getEngine().getWeightFreeEngineHeatSinks();</b>
&nbsp;        } else {
<b class="nc">&nbsp;            return 0;</b>
&nbsp;        }
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * Computes and returns the number of days the unit can spend accelerating at 1G 
&nbsp;     * 
&nbsp;     * @param aero
&nbsp;     * @return
&nbsp;     */
&nbsp;    public static double calculateDaysAt1G(Aero aero) {
<b class="nc">&nbsp;        double stratUse = aero.getStrategicFuelUse();</b>
<b class="nc">&nbsp;        if (stratUse &gt; 0) {</b>
<b class="nc">&nbsp;            return aero.getFuelTonnage() / aero.getStrategicFuelUse();</b>
&nbsp;        } else {
<b class="nc">&nbsp;            return 0.0;</b>
&nbsp;        }
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * Computes and returns the number of days the unit can spend accelerating at maximum thrust. 
&nbsp;     * 
&nbsp;     * @param aero
&nbsp;     * @return
&nbsp;     */
&nbsp;    public static double calculateDaysAtMax(Aero aero) {
<b class="nc">&nbsp;        double stratUse = aero.getStrategicFuelUse();</b>
<b class="nc">&nbsp;        if (stratUse &gt; 0) {</b>
<b class="nc">&nbsp;            double maxMP = aero.getRunMP();</b>
&nbsp;            // check for station-keeping drive
<b class="nc">&nbsp;            if (maxMP == 0) {</b>
<b class="nc">&nbsp;                maxMP = 0.2;</b>
&nbsp;            }
<b class="nc">&nbsp;            return aero.getFuelTonnage() / (aero.getStrategicFuelUse() * maxMP / 2.0);</b>
&nbsp;        } else {
<b class="nc">&nbsp;            return 0.0;</b>
&nbsp;        }
&nbsp;    }
&nbsp;    
&nbsp;    public TestAero(Aero a, TestEntityOption option, String fs) {
<b class="fc">&nbsp;        super(option, a.getEngine(), getArmor(a), getStructure(a));</b>
<b class="fc">&nbsp;        aero = a;</b>
<b class="fc">&nbsp;        fileString = fs;</b>
<b class="fc">&nbsp;    }</b>
&nbsp;
&nbsp;    private static Structure getStructure(Aero aero) {
<b class="fc">&nbsp;        int type = aero.getStructureType();</b>
<b class="fc">&nbsp;        return new Structure(type, false, aero.getMovementMode());</b>
&nbsp;    }
&nbsp;
&nbsp;    private static Armor[] getArmor(Aero aero) {
&nbsp;        Armor[] armor;
<b class="fc">&nbsp;        armor = new Armor[1];</b>
<b class="fc">&nbsp;        int type = aero.getArmorType(1);</b>
<b class="fc">&nbsp;        int flag = 0;</b>
<b class="fc">&nbsp;        if (aero.isClanArmor(1)) {</b>
<b class="nc">&nbsp;            flag |= Armor.CLAN_ARMOR;</b>
&nbsp;        }
<b class="fc">&nbsp;        armor[0] = new Armor(type, flag);</b>
<b class="fc">&nbsp;        return armor;</b>
&nbsp;
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public Entity getEntity() {
<b class="nc">&nbsp;        return aero;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean isTank() {
<b class="nc">&nbsp;        return false;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean isMech() {
<b class="nc">&nbsp;        return false;</b>
&nbsp;    }
&nbsp;    
&nbsp;    @Override
&nbsp;    public boolean isAero() {
<b class="nc">&nbsp;        return true;</b>
&nbsp;    }
&nbsp;    
&nbsp;    @Override
&nbsp;    public boolean isSmallCraft() {
<b class="nc">&nbsp;        return false;</b>
&nbsp;    }
&nbsp;    
&nbsp;    @Override
&nbsp;    public boolean isAdvancedAerospace() {
<b class="nc">&nbsp;        return false;</b>
&nbsp;    }
&nbsp;    
&nbsp;    @Override
&nbsp;    public boolean isProtomech() {
<b class="nc">&nbsp;        return false;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public double getWeightMisc() {
&nbsp;        // VSTOL equipment weighs extra for conventional fighters
<b class="nc">&nbsp;        if ((aero.hasETypeFlag(Entity.ETYPE_CONV_FIGHTER)) &amp;&amp; aero.isVSTOL()) {</b>
&nbsp;            // Weight = tonnage * 0.05 rounded up to nearest half ton
<b class="nc">&nbsp;            return Math.ceil(0.05 * aero.getWeight() * 2) / 2.0;</b>
&nbsp;        }
<b class="nc">&nbsp;        return 0.0f;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public double getWeightPowerAmp() {
&nbsp;        // Conventional Fighters with ICE engines may need a power amp
<b class="nc">&nbsp;        if ((aero.hasETypeFlag(Entity.ETYPE_CONV_FIGHTER)) &amp;&amp; aero.hasEngine()</b>
<b class="nc">&nbsp;                &amp;&amp; (aero.getEngine().getEngineType() == Engine.COMBUSTION_ENGINE)) {</b>
<b class="nc">&nbsp;            double weight = 0;</b>
<b class="nc">&nbsp;            for (Mounted m : aero.getWeaponList()) {</b>
<b class="nc">&nbsp;                WeaponType wt = (WeaponType) m.getType();</b>
<b class="nc">&nbsp;                if (wt.hasFlag(WeaponType.F_ENERGY) &amp;&amp; </b>
&nbsp;                        !(wt instanceof CLChemicalLaserWeapon) &amp;&amp; 
&nbsp;                        !(wt instanceof VehicleFlamerWeapon)) {
<b class="nc">&nbsp;                    weight += m.getTonnage();</b>
&nbsp;                }
<b class="nc">&nbsp;                Mounted linkedBy = m.getLinkedBy();</b>
<b class="nc">&nbsp;                if ((linkedBy != null) &amp;&amp; </b>
<b class="nc">&nbsp;                        (linkedBy.getType() instanceof MiscType) &amp;&amp; </b>
<b class="nc">&nbsp;                        linkedBy.getType().hasFlag(MiscType.F_PPC_CAPACITOR)){</b>
<b class="nc">&nbsp;                    weight += linkedBy.getTonnage();</b>
&nbsp;                }
<b class="nc">&nbsp;            }</b>
&nbsp;            // Power amp weighs:
&nbsp;            //   energy weapon tonnage * 0.1 rounded to nearest half ton
<b class="nc">&nbsp;            return Math.ceil(0.1 * weight * 2) / 2.0;</b>
&nbsp;        }
<b class="nc">&nbsp;        return 0;</b>
&nbsp;    }
&nbsp;    
&nbsp;    @Override
&nbsp;    public double getWeightEngine() {
<b class="nc">&nbsp;        double wt = super.getWeightEngine();</b>
&nbsp;        // Conventional fighters with fusion engines require extra shielding.
&nbsp;        // Per TacOps fission engines require extra shielding as well.
<b class="nc">&nbsp;        if (getEntity().hasETypeFlag(Entity.ETYPE_CONV_FIGHTER)</b>
<b class="nc">&nbsp;                &amp;&amp; (null != getEntity().getEngine())</b>
<b class="nc">&nbsp;                &amp;&amp; (getEntity().getEngine().isFusion() || getEntity().getEngine().hasFlag(Engine.FISSION))) {</b>
<b class="nc">&nbsp;            wt = ceil(wt * 1.5, Ceil.HALFTON);</b>
&nbsp;        }
<b class="nc">&nbsp;        return wt;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public double getWeightControls() {
&nbsp;        // Controls for Aerospace Fighters and Conventional Fighters consists
&nbsp;        //  of the cockpit and the fuel
&nbsp;        double weight;
<b class="nc">&nbsp;        if (aero.hasETypeFlag(Entity.ETYPE_CONV_FIGHTER)) {</b>
&nbsp;            // Weight = tonnage * 0.1 rounded to nearest half ton
<b class="nc">&nbsp;            weight = Math.round(0.1 * aero.getWeight()*2) / 2.0;</b>
&nbsp;        } else {
<b class="nc">&nbsp;            weight = 3.0;</b>
<b class="nc">&nbsp;            if (aero.getCockpitType() == Aero.COCKPIT_SMALL) {</b>
<b class="nc">&nbsp;                weight = 2.0;</b>
<b class="nc">&nbsp;        } else if (aero.getCockpitType() == Aero.COCKPIT_COMMAND_CONSOLE){                       </b>
<b class="nc">&nbsp;                weight = 6.0;</b>
<b class="nc">&nbsp;            } else if (aero.getCockpitType() == Aero.COCKPIT_PRIMITIVE) {</b>
<b class="nc">&nbsp;                weight = 5.0;</b>
&nbsp;            } 
&nbsp;        }   
<b class="nc">&nbsp;        return weight;</b>
&nbsp;    }
&nbsp;    
&nbsp;    public double getWeightFuel() {
<b class="nc">&nbsp;        return aero.getFuelTonnage();</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public int getCountHeatSinks() {
<b class="nc">&nbsp;        if (aero.hasETypeFlag(Entity.ETYPE_CONV_FIGHTER)) {</b>
<b class="nc">&nbsp;            return heatNeutralHSRequirement();</b>
&nbsp;        }
<b class="nc">&nbsp;        return aero.getHeatSinks();</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public double getWeightHeatSinks() {
<b class="nc">&nbsp;        if (aero.hasETypeFlag(Entity.ETYPE_CONV_FIGHTER)) {</b>
<b class="nc">&nbsp;            int required = heatNeutralHSRequirement();</b>
<b class="nc">&nbsp;            return Math.max(0, required - engine.getWeightFreeEngineHeatSinks());</b>
&nbsp;        } else {
<b class="nc">&nbsp;            return Math.max(getCountHeatSinks() - engine.getWeightFreeEngineHeatSinks(), 0);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean hasDoubleHeatSinks() {
<b class="nc">&nbsp;        return aero.getHeatType() == Aero.HEAT_DOUBLE;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public String printWeightMisc() {
<b class="nc">&nbsp;        double weight = getWeightMisc();</b>
<b class="nc">&nbsp;        if (weight &gt; 0){</b>
<b class="nc">&nbsp;            StringBuffer retVal = new StringBuffer(StringUtil.makeLength(</b>
<b class="nc">&nbsp;                    &quot;VSTOL equipment:&quot;, getPrintSize() - 5));</b>
<b class="nc">&nbsp;            retVal.append(makeWeightString(weight));</b>
<b class="nc">&nbsp;            retVal.append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;            return retVal.toString();</b>
&nbsp;        }
<b class="nc">&nbsp;        return &quot;&quot;;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public String printWeightControls() {
<b class="nc">&nbsp;        StringBuffer retVal = new StringBuffer(StringUtil.makeLength(</b>
<b class="nc">&nbsp;                aero.getCockpitTypeString() + &quot;:&quot;, getPrintSize() - 5));</b>
<b class="nc">&nbsp;        retVal.append(makeWeightString(getWeightControls()));</b>
<b class="nc">&nbsp;        retVal.append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;        return retVal.toString();</b>
&nbsp;    }
&nbsp;        
&nbsp;    public String printWeightFuel() {
<b class="nc">&nbsp;        StringBuffer retVal = new StringBuffer(StringUtil.makeLength(</b>
<b class="nc">&nbsp;                &quot;Fuel: &quot;, getPrintSize() - 5));</b>
<b class="nc">&nbsp;        retVal.append(makeWeightString(getWeightFuel()));</b>
<b class="nc">&nbsp;        retVal.append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;        return retVal.toString();</b>
&nbsp;    }
&nbsp;
&nbsp;    public Aero getAero() {
<b class="nc">&nbsp;        return aero;</b>
&nbsp;    }
&nbsp;
&nbsp;    public String printArmorLocProp(int loc, int wert) {
<b class="nc">&nbsp;        return &quot; is greater than &quot; + Integer.toString(wert) + &quot;!&quot;;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Checks to see if this unit has valid armor assignment.
&nbsp;     * 
&nbsp;     * @param buff
&nbsp;     * @return
&nbsp;     */
&nbsp;    public boolean correctArmor(StringBuffer buff) {
<b class="nc">&nbsp;        boolean correct = true;</b>
<b class="nc">&nbsp;        int maxArmorPoints = maxArmorPoints(aero,aero.getWeight());</b>
<b class="nc">&nbsp;        int armorTotal = 0;</b>
<b class="nc">&nbsp;        for (int loc = 0; loc &lt; aero.locations(); loc++) {</b>
<b class="nc">&nbsp;            if (aero.getOArmor(loc) &gt; maxArmorPoints) {</b>
<b class="nc">&nbsp;                buff.append(printArmorLocation(loc))</b>
<b class="nc">&nbsp;                        .append(printArmorLocProp(loc,</b>
<b class="nc">&nbsp;                                maxArmorPoints)).append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;                correct = false;</b>
&nbsp;            }
<b class="nc">&nbsp;            armorTotal += aero.getOArmor(loc);</b>
&nbsp;        }
<b class="nc">&nbsp;        if (armorTotal &gt; maxArmorPoints){</b>
<b class="nc">&nbsp;            buff.append(&quot;Total armor,&quot; + armorTotal + </b>
&nbsp;                    &quot;, is greater than the maximum: &quot; + maxArmorPoints + &quot;\n&quot;);
<b class="nc">&nbsp;            correct = false;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return correct ;</b>
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * Checks that Conventional fighters only have a standard cockpit and that
&nbsp;     * Aerospace fighters have a valid cockpit (standard, small, primitive, 
&nbsp;     * command console).
&nbsp;     * 
&nbsp;     * @param buff
&nbsp;     * @return
&nbsp;     */
&nbsp;    public boolean correctControlSystems(StringBuffer buff){
<b class="nc">&nbsp;        if ((aero.hasETypeFlag(Entity.ETYPE_CONV_FIGHTER)) &amp;&amp;</b>
<b class="nc">&nbsp;                aero.getCockpitType() != Aero.COCKPIT_STANDARD){</b>
<b class="nc">&nbsp;            buff.append(</b>
&nbsp;                    &quot;Conventional fighters may only have standard cockpits!&quot;);
<b class="nc">&nbsp;            return false;</b>
<b class="nc">&nbsp;        } else if (aero.getCockpitType() &lt; Aero.COCKPIT_STANDARD || </b>
<b class="nc">&nbsp;                aero.getCockpitType() &gt; Aero.COCKPIT_PRIMITIVE){</b>
<b class="nc">&nbsp;            buff.append(</b>
&nbsp;                    &quot;Invalid cockpit type!&quot;);
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
<b class="nc">&nbsp;        return true;</b>
&nbsp;    }
&nbsp;    
&nbsp;    public List&lt;Mounted&gt; checkCriticalSlotsForEquipment(Entity entity) {
<b class="nc">&nbsp;        List&lt;Mounted&gt; unallocated = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        for (Mounted m : entity.getEquipment()) {</b>
<b class="nc">&nbsp;            if ((m.getLocation() == Entity.LOC_NONE) &amp;&amp; !m.isOneShotAmmo() &amp;&amp; (m.getCriticals() &gt; 0)) {</b>
<b class="nc">&nbsp;                unallocated.add(m);</b>
&nbsp;            }
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;        return unallocated;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * For Aerospace and Conventional fighters the only thing we need to ensure
&nbsp;     * is that they do not mount more weapons in each arc then allowed.  They
&nbsp;     * have boundless space for equipment.  Certain armor types reduce the 
&nbsp;     * number of spaces available in each arc.
&nbsp;     * 
&nbsp;     * @param buff  A buffer for error messages
&nbsp;     * @return  True if the mounted weapons are valid, else false
&nbsp;     */
&nbsp;    public boolean correctCriticals(StringBuffer buff) {
<b class="nc">&nbsp;        boolean correct = true;</b>
&nbsp;
<b class="nc">&nbsp;        List&lt;Mounted&gt; unallocated = checkCriticalSlotsForEquipment(aero);</b>
<b class="nc">&nbsp;        if (!unallocated.isEmpty()) {</b>
<b class="nc">&nbsp;            buff.append(&quot;Unallocated Equipment:\n&quot;);</b>
<b class="nc">&nbsp;            for (Mounted mount : unallocated) {</b>
<b class="nc">&nbsp;                buff.append(mount.getType().getInternalName()).append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;            correct = false;</b>
&nbsp;        }
<b class="nc">&nbsp;        int[] numWeapons = new int[aero.locations()];</b>
<b class="nc">&nbsp;        int numBombs = 0;</b>
&nbsp;        
<b class="nc">&nbsp;        for (Mounted m : aero.getWeaponList()){</b>
<b class="nc">&nbsp;            if (m.getLocation() == Entity.LOC_NONE)</b>
<b class="nc">&nbsp;                continue;</b>
&nbsp;            
&nbsp;            // Aeros can&#39;t use special munitions except for artemis, exceptions
&nbsp;            //  LBX&#39;s must use clusters
<b class="nc">&nbsp;            WeaponType wt = (WeaponType)m.getType();</b>
<b class="nc">&nbsp;            boolean canHaveSpecialMunitions = </b>
<b class="nc">&nbsp;                    ((wt.getAmmoType() == AmmoType.T_MML)</b>
<b class="nc">&nbsp;                    || (wt.getAmmoType() == AmmoType.T_ATM)</b>
<b class="nc">&nbsp;                    || (wt.getAmmoType() == AmmoType.T_NARC));</b>
<b class="nc">&nbsp;            if (wt.getAmmoType() != AmmoType.T_NA</b>
<b class="nc">&nbsp;                    &amp;&amp; m.getLinked() != null </b>
&nbsp;                    &amp;&amp; !canHaveSpecialMunitions) {
<b class="nc">&nbsp;                EquipmentType linkedType = m.getLinked().getType();</b>
<b class="nc">&nbsp;                boolean hasArtemisFCS = m.getLinkedBy() != null</b>
<b class="nc">&nbsp;                        &amp;&amp; (m.getLinkedBy().getType().hasFlag(MiscType.F_ARTEMIS)</b>
<b class="nc">&nbsp;                        || m.getLinkedBy().getType().hasFlag(MiscType.F_ARTEMIS_PROTO)</b>
<b class="nc">&nbsp;                        || m.getLinkedBy().getType().hasFlag(MiscType.F_ARTEMIS_V));</b>
<b class="nc">&nbsp;                if (linkedType instanceof AmmoType) {</b>
<b class="nc">&nbsp;                    AmmoType linkedAT = (AmmoType)linkedType;</b>
&nbsp;                    // Check LBX&#39;s
<b class="nc">&nbsp;                    if (wt.getAmmoType() == AmmoType.T_AC_LBX &amp;&amp; </b>
<b class="nc">&nbsp;                            linkedAT.getMunitionType() != AmmoType.M_CLUSTER) {</b>
<b class="nc">&nbsp;                        correct = false;</b>
<b class="nc">&nbsp;                        buff.append(&quot;Aeros must use cluster munitions!&quot;).append(m.getType().getInternalName())</b>
<b class="nc">&nbsp;                                .append(&quot; is using &quot;).append(linkedAT.getInternalName()).append(&quot;\n&quot;);</b>
&nbsp;                    }
&nbsp;                    // Allow Artemis munitions for artemis-linked launchers
<b class="nc">&nbsp;                    if (hasArtemisFCS</b>
<b class="nc">&nbsp;                            &amp;&amp; linkedAT.getMunitionType() != AmmoType.M_STANDARD</b>
<b class="nc">&nbsp;                            &amp;&amp; linkedAT.getMunitionType() != AmmoType.M_ARTEMIS_CAPABLE</b>
<b class="nc">&nbsp;                            &amp;&amp; linkedAT.getMunitionType() != AmmoType.M_ARTEMIS_V_CAPABLE) {</b>
<b class="nc">&nbsp;                        correct = false;</b>
<b class="nc">&nbsp;                        buff.append(&quot;Aero using illegal special missile type!&quot;).append(m.getType().getInternalName())</b>
<b class="nc">&nbsp;                                .append(&quot; is using &quot;).append(linkedAT.getInternalName()).append(&quot;\n&quot;);</b>
&nbsp;                    }
<b class="nc">&nbsp;                    if (linkedAT.getMunitionType() != AmmoType.M_STANDARD </b>
&nbsp;                            &amp;&amp; !hasArtemisFCS 
<b class="nc">&nbsp;                            &amp;&amp; wt.getAmmoType() != AmmoType.T_AC_LBX</b>
<b class="nc">&nbsp;                    		&amp;&amp; wt.getAmmoType() != AmmoType.T_SBGAUSS){</b>
<b class="nc">&nbsp;                        correct = false;</b>
<b class="nc">&nbsp;                        buff.append(&quot;Aeros may not use special munitions! &quot;).append(m.getType().getInternalName())</b>
<b class="nc">&nbsp;                                .append(&quot; is using &quot;).append(linkedAT.getInternalName()).append(&quot;\n&quot;);</b>
&nbsp;                    }
&nbsp;                    
&nbsp;                }
&nbsp;            }
&nbsp;            
<b class="nc">&nbsp;            if (m.getType().hasFlag(AmmoType.F_SPACE_BOMB) </b>
<b class="nc">&nbsp;                    || m.getType().hasFlag(AmmoType.F_GROUND_BOMB)</b>
<b class="nc">&nbsp;                    || m.getType().hasFlag(WeaponType.F_DIVE_BOMB)</b>
<b class="nc">&nbsp;                    || m.getType().hasFlag(WeaponType.F_ALT_BOMB)</b>
<b class="nc">&nbsp;                    || m.getType().hasFlag(WeaponType.F_SPACE_BOMB)){</b>
<b class="nc">&nbsp;                numBombs++;</b>
&nbsp;            } else {
<b class="nc">&nbsp;                numWeapons[m.getLocation()]++;</b>
&nbsp;            }
<b class="nc">&nbsp;        }</b>
&nbsp;
<b class="nc">&nbsp;        if (aero.isFighter()) {</b>
<b class="nc">&nbsp;            int[] availSpace = availableSpace(aero);</b>
<b class="nc">&nbsp;            if (availSpace == null) {</b>
<b class="nc">&nbsp;                buff.append(&quot;Invalid armor type! Armor: &quot;)</b>
<b class="nc">&nbsp;                        .append(EquipmentType.armorNames[aero.getArmorType(Aero.LOC_NOSE)]);</b>
<b class="nc">&nbsp;                buff.append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (numBombs &gt; aero.getMaxBombPoints()) {</b>
<b class="nc">&nbsp;                buff.append(&quot;Invalid number of bombs! Unit can mount &quot;).append(aero.getMaxBombPoints())</b>
<b class="nc">&nbsp;                        .append(&quot; but &quot;).append(numBombs).append(&quot;are present!&quot;);</b>
<b class="nc">&nbsp;                buff.append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            String[] locNames = aero.getLocationNames();</b>
<b class="nc">&nbsp;            int loc = Aero.LOC_AFT;</b>
<b class="nc">&nbsp;            while (loc &gt;= 0) {</b>
<b class="nc">&nbsp;                correct &amp;= !(numWeapons[loc] &gt; availSpace[loc]);</b>
<b class="nc">&nbsp;                if (numWeapons[loc] &gt; availSpace[loc]) {</b>
<b class="nc">&nbsp;                    buff.append(locNames[loc]).append(&quot; has &quot;).append(numWeapons[loc])</b>
<b class="nc">&nbsp;                            .append(&quot; weapons but it can only fit &quot;).append(availSpace[loc]).append(&quot; weapons!&quot;);</b>
<b class="nc">&nbsp;                    buff.append(&quot;\n&quot;);</b>
&nbsp;                }
<b class="nc">&nbsp;                loc--;</b>
&nbsp;            }
&nbsp;        }
&nbsp;        
<b class="nc">&nbsp;        return correct;</b>
&nbsp;    }
&nbsp;    
&nbsp;    
&nbsp;    /**
&nbsp;     * Checks that the heatsink assignment is legal.  Conventional fighters must
&nbsp;     * have enough heatsinks to dissipate heat from all of their energy weapons
&nbsp;     * and they may only mount standard heatsinks.
&nbsp;     * Aerospace fighters must have at least 10 heatsinks.
&nbsp;     * 
&nbsp;     * @param buff
&nbsp;     * @return
&nbsp;     */
&nbsp;    public boolean correctHeatSinks(StringBuffer buff) {
<b class="nc">&nbsp;        if ((aero.getHeatType() != Aero.HEAT_SINGLE) </b>
<b class="nc">&nbsp;                &amp;&amp; (aero.getHeatType() != Aero.HEAT_DOUBLE)) {</b>
<b class="nc">&nbsp;            buff.append(&quot;Invalid heatsink type!  Valid types are &quot;</b>
&nbsp;                    + Aero.HEAT_SINGLE + &quot; and &quot; + Aero.HEAT_DOUBLE
<b class="nc">&nbsp;                    + &quot;.  Found &quot; + aero.getHeatType() + &quot;.&quot;);</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
<b class="nc">&nbsp;        return true;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean correctEntity(StringBuffer buff) {
<b class="nc">&nbsp;        return correctEntity(buff, aero.getTechLevel());</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean correctEntity(StringBuffer buff, int ammoTechLvl) {
<b class="nc">&nbsp;        boolean correct = true;</b>
&nbsp;        
&nbsp;        // We only support Conventional Fighters and ASF
<b class="nc">&nbsp;        if (aero.getEntityType() == Entity.ETYPE_DROPSHIP || </b>
<b class="nc">&nbsp;                aero.getEntityType() == Entity.ETYPE_SMALL_CRAFT ||</b>
<b class="nc">&nbsp;                aero.getEntityType() == Entity.ETYPE_FIGHTER_SQUADRON ||</b>
<b class="nc">&nbsp;                aero.getEntityType() == Entity.ETYPE_JUMPSHIP ||</b>
<b class="nc">&nbsp;                aero.getEntityType() == Entity.ETYPE_SPACE_STATION){</b>
<b class="nc">&nbsp;            System.out.println(&quot;TestAero only supports Aerospace Fighters &quot; +</b>
&nbsp;                    &quot;and Conventional fighters.  Supplied unit was a &quot; + 
<b class="nc">&nbsp;                    Entity.getEntityTypeName(aero.getEntityType()));</b>
<b class="nc">&nbsp;            return true;            </b>
&nbsp;        }
&nbsp;        
<b class="nc">&nbsp;        if (skip()) {</b>
<b class="nc">&nbsp;            return true;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (!correctWeight(buff)) {</b>
<b class="nc">&nbsp;            buff.insert(0, printTechLevel() + printShortMovement());</b>
<b class="nc">&nbsp;            buff.append(printWeightCalculation());</b>
<b class="nc">&nbsp;            correct = false;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (!engine.engineValid) {</b>
<b class="nc">&nbsp;            buff.append(engine.problem.toString()).append(&quot;\n\n&quot;);</b>
<b class="nc">&nbsp;            correct = false;</b>
&nbsp;        }
<b class="nc">&nbsp;        if ((getCountHeatSinks() &lt; engine.getWeightFreeEngineHeatSinks())</b>
<b class="nc">&nbsp;                &amp;&amp; !aero.hasETypeFlag(Entity.ETYPE_CONV_FIGHTER)) {</b>
<b class="nc">&nbsp;            buff.append(&quot;Heat Sinks:\n&quot;);</b>
<b class="nc">&nbsp;            buff.append(&quot; Engine    &quot;</b>
<b class="nc">&nbsp;                    + engine.integralHeatSinkCapacity(false) + &quot;\n&quot;);</b>
<b class="nc">&nbsp;            buff.append(&quot; Total     &quot; + getCountHeatSinks() + &quot;\n&quot;);</b>
<b class="nc">&nbsp;            buff.append(&quot; Required  &quot; + engine.getWeightFreeEngineHeatSinks()</b>
&nbsp;                    + &quot;\n&quot;);
<b class="nc">&nbsp;            correct = false;</b>
&nbsp;        }                
&nbsp;        
<b class="nc">&nbsp;        if (showCorrectArmor() &amp;&amp; !correctArmor(buff)) {</b>
<b class="nc">&nbsp;            correct = false;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (showCorrectCritical() &amp;&amp; !correctCriticals(buff)) {</b>
<b class="nc">&nbsp;            correct = false;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (showFailedEquip() &amp;&amp; hasFailedEquipment(buff)) {</b>
<b class="nc">&nbsp;            correct = false;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (showIncorrectIntroYear() &amp;&amp; hasIncorrectIntroYear(buff)) {</b>
<b class="nc">&nbsp;            correct = false;</b>
&nbsp;        }
&nbsp;        
<b class="nc">&nbsp;        correct &amp;= correctControlSystems(buff);</b>
<b class="nc">&nbsp;        correct &amp;= !hasIllegalTechLevels(buff, ammoTechLvl);</b>
<b class="nc">&nbsp;        correct &amp;= !hasIllegalEquipmentCombinations(buff);</b>
<b class="nc">&nbsp;        correct &amp;= !hasMismatchedLateralWeapons(buff);</b>
<b class="nc">&nbsp;        correct &amp;= correctHeatSinks(buff);</b>
&nbsp;        
<b class="nc">&nbsp;        return correct;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Checks that the weapon loads in the wings match each other.
&nbsp;     * @param buff The buffer that contains the collected error messages.
&nbsp;     * @return     Whether the lateral weapons are mismatched.
&nbsp;     */
&nbsp;    public boolean hasMismatchedLateralWeapons(StringBuffer buff) {
<b class="nc">&nbsp;        boolean illegal = false;</b>
<b class="nc">&nbsp;        Map&lt;EquipmentType,Integer&gt; leftWing = new HashMap&lt;&gt;();</b>
<b class="nc">&nbsp;        Map&lt;EquipmentType,Integer&gt; rightWing = new HashMap&lt;&gt;();</b>
<b class="nc">&nbsp;        Map&lt;EquipmentType,Integer&gt; leftWingRear = new HashMap&lt;&gt;();</b>
<b class="nc">&nbsp;        Map&lt;EquipmentType,Integer&gt; rightWingRear = new HashMap&lt;&gt;();</b>
<b class="nc">&nbsp;        for (Mounted m : aero.getEquipment()) {</b>
<b class="nc">&nbsp;            if (m.getType() instanceof WeaponType) {</b>
<b class="nc">&nbsp;                if (m.getLocation() == Aero.LOC_LWING) {</b>
<b class="nc">&nbsp;                    if (m.isRearMounted()) {</b>
<b class="nc">&nbsp;                        leftWingRear.merge(m.getType(), 1, Integer::sum);</b>
&nbsp;                    } else {
<b class="nc">&nbsp;                        leftWing.merge(m.getType(), 1, Integer::sum);</b>
&nbsp;                    }
<b class="nc">&nbsp;                } else if (m.getLocation() == SmallCraft.LOC_RWING) {</b>
<b class="nc">&nbsp;                    if (m.isRearMounted()) {</b>
<b class="nc">&nbsp;                        rightWingRear.merge(m.getType(), 1, Integer::sum);</b>
&nbsp;                    } else {
<b class="nc">&nbsp;                        rightWing.merge(m.getType(), 1, Integer::sum);</b>
&nbsp;                    }
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;        boolean lateralMatch = true;</b>
<b class="nc">&nbsp;        for (EquipmentType eq : leftWing.keySet()) {</b>
<b class="nc">&nbsp;            if (!rightWing.containsKey(eq) || !leftWing.get(eq).equals(rightWing.get(eq))) {</b>
<b class="nc">&nbsp;                lateralMatch = false;</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            }
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;        if (lateralMatch) {</b>
&nbsp;            //We&#39;ve already checked counts, so in the reverse direction we only need to see if there&#39;s
&nbsp;            //anything not found on the other side.
<b class="nc">&nbsp;            for (EquipmentType eq : rightWing.keySet()) {</b>
<b class="nc">&nbsp;                if (!leftWing.containsKey(eq)) {</b>
<b class="nc">&nbsp;                    lateralMatch = false;</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                }
<b class="nc">&nbsp;            }</b>
&nbsp;        }
<b class="nc">&nbsp;        if (lateralMatch) {</b>
<b class="nc">&nbsp;            for (EquipmentType eq : leftWingRear.keySet()) {</b>
<b class="nc">&nbsp;                if (!rightWingRear.containsKey(eq) || !leftWingRear.get(eq).equals(rightWingRear.get(eq))) {</b>
<b class="nc">&nbsp;                    lateralMatch = false;</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                }
<b class="nc">&nbsp;            }</b>
&nbsp;        }
<b class="nc">&nbsp;        if (lateralMatch) {</b>
<b class="nc">&nbsp;            for (EquipmentType eq : rightWingRear.keySet()) {</b>
<b class="nc">&nbsp;                if (!leftWingRear.containsKey(eq)) {</b>
<b class="nc">&nbsp;                    lateralMatch = false;</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                }
<b class="nc">&nbsp;            }</b>
&nbsp;        }
<b class="nc">&nbsp;        if (!lateralMatch) {</b>
<b class="nc">&nbsp;            buff.append(&quot;Left and right side weapon loads do not match.\n&quot;);</b>
<b class="nc">&nbsp;            illegal = true;</b>
&nbsp;        }
<b class="nc">&nbsp;        return illegal;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * @param eq        The equipment
&nbsp;     * @param location  A location index on the Entity
&nbsp;     * @param buffer    If non-null and the location is invalid, will be appended with an explanation
&nbsp;     * @return          Whether the equipment can be mounted in the location on the aerospace fighter,
&nbsp;     *                  conventional fighter, or fixed wing support vehicle
&nbsp;     */
&nbsp;    public static boolean isValidAeroLocation(EquipmentType eq, int location, @Nullable StringBuffer buffer) {
<b class="nc">&nbsp;        if (eq instanceof AmmoType) {</b>
<b class="nc">&nbsp;            if (location != Aero.LOC_FUSELAGE) {</b>
<b class="nc">&nbsp;                if (buffer != null) {</b>
<b class="nc">&nbsp;                    buffer.append(eq.getName()).append(&quot; must be mounted in the fuselage.\n&quot;);</b>
&nbsp;                }
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
<b class="nc">&nbsp;        } else if (eq instanceof MiscType) {</b>
&nbsp;            // Weapon enhancements go in the same location as the weapon
<b class="nc">&nbsp;            if ((eq.hasFlag(MiscType.F_ARTEMIS)</b>
<b class="nc">&nbsp;                    || eq.hasFlag(MiscType.F_ARTEMIS_V)</b>
<b class="nc">&nbsp;                    || eq.hasFlag(MiscType.F_ARTEMIS_PROTO)</b>
<b class="nc">&nbsp;                    || eq.hasFlag(MiscType.F_APOLLO)</b>
<b class="nc">&nbsp;                    || eq.hasFlag(MiscType.F_PPC_CAPACITOR)</b>
<b class="nc">&nbsp;                    || eq.hasFlag(MiscType.F_RISC_LASER_PULSE_MODULE)) &amp;&amp; (location &gt;= Aero.LOC_WINGS)) {</b>
<b class="nc">&nbsp;                if (location != Aero.LOC_FUSELAGE) {</b>
<b class="nc">&nbsp;                    if (buffer != null) {</b>
<b class="nc">&nbsp;                        buffer.append(eq.getName()).append(&quot; must be mounted in a location with a firing arc.\n&quot;);</b>
&nbsp;                    }
<b class="nc">&nbsp;                    return false;</b>
&nbsp;                }
<b class="nc">&nbsp;            } else if ((eq.hasFlag(MiscType.F_BLUE_SHIELD) || eq.hasFlag(MiscType.F_LIFTHOIST)</b>
<b class="nc">&nbsp;                    || (eq.hasFlag(MiscType.F_CASE) &amp;&amp; !eq.isClan())) &amp;&amp; (location != Aero.LOC_FUSELAGE)) {</b>
<b class="nc">&nbsp;                if (buffer != null) {</b>
<b class="nc">&nbsp;                    buffer.append(eq.getName()).append(&quot; must be mounted in the fuselage.\n&quot;);</b>
&nbsp;                }
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
<b class="nc">&nbsp;        } else if (eq instanceof WeaponType) {</b>
<b class="nc">&nbsp;            if ((((WeaponType) eq).getAmmoType() == AmmoType.T_GAUSS_HEAVY)</b>
&nbsp;                    &amp;&amp; (location != Aero.LOC_NOSE) &amp;&amp; (location != Aero.LOC_AFT)) {
<b class="nc">&nbsp;                if (buffer != null) {</b>
<b class="nc">&nbsp;                    buffer.append(eq.getName()).append(&quot; must be mounted in the nose or aft.\n&quot;);</b>
&nbsp;                }
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (!eq.hasFlag(WeaponType.F_C3M) &amp;&amp; !eq.hasFlag(WeaponType.F_C3MBS)</b>
<b class="nc">&nbsp;                    &amp;&amp; !eq.hasFlag(WeaponType.F_TAG) &amp;&amp; (location == Aero.LOC_FUSELAGE)) {</b>
<b class="nc">&nbsp;                if (buffer != null) {</b>
<b class="nc">&nbsp;                    buffer.append(eq.getName()).append(&quot; must be mounted in a location with a firing arc.\n&quot;);</b>
&nbsp;                }
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        return true;</b>
&nbsp;    }
&nbsp;
&nbsp;    public boolean isAeroWeapon(EquipmentType eq, Entity en) {
<b class="nc">&nbsp;        if (eq instanceof InfantryWeapon) {</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        WeaponType weapon = (WeaponType) eq;</b>
&nbsp;        
&nbsp;        // small craft only; lacks aero weapon flag
<b class="nc">&nbsp;        if (weapon.getAmmoType() == AmmoType.T_C3_REMOTE_SENSOR) {</b>
<b class="nc">&nbsp;            return en.hasETypeFlag(Entity.ETYPE_SMALL_CRAFT)</b>
<b class="nc">&nbsp;                    &amp;&amp; !en.hasETypeFlag(Entity.ETYPE_DROPSHIP);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (weapon.hasFlag(WeaponType.F_ARTILLERY) &amp;&amp; !weapon.hasFlag(WeaponType.F_BA_WEAPON)) {</b>
<b class="nc">&nbsp;            return (weapon.getAmmoType() == AmmoType.T_ARROW_IV)</b>
<b class="nc">&nbsp;                    || en.hasETypeFlag(Entity.ETYPE_SMALL_CRAFT)</b>
<b class="nc">&nbsp;                    || en.hasETypeFlag(Entity.ETYPE_JUMPSHIP);</b>
&nbsp;        }
&nbsp;        
<b class="nc">&nbsp;        if (weapon.isSubCapital() || (weapon.isCapital() &amp;&amp; (weapon.hasFlag(WeaponType.F_MISSILE)))</b>
<b class="nc">&nbsp;                || (weapon.getAtClass() == WeaponType.CLASS_SCREEN)) {</b>
<b class="nc">&nbsp;            return en.hasETypeFlag(Entity.ETYPE_DROPSHIP)</b>
<b class="nc">&nbsp;                    || en.hasETypeFlag(Entity.ETYPE_JUMPSHIP);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (weapon.hasFlag(WeaponType.F_VGL)) {</b>
<b class="nc">&nbsp;            return !en.hasETypeFlag(Entity.ETYPE_JUMPSHIP);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (weapon.isCapital()) {</b>
<b class="nc">&nbsp;            return en.hasETypeFlag(Entity.ETYPE_JUMPSHIP);</b>
&nbsp;        }
&nbsp;        
<b class="nc">&nbsp;        if (weapon instanceof BayWeapon) {</b>
<b class="nc">&nbsp;            return en.usesWeaponBays();</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (!weapon.hasFlag(WeaponType.F_AERO_WEAPON)) {</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (((weapon instanceof LRMWeapon) || (weapon instanceof LRTWeapon))</b>
<b class="nc">&nbsp;                &amp;&amp; (weapon.getRackSize() != 5)</b>
<b class="nc">&nbsp;                &amp;&amp; (weapon.getRackSize() != 10)</b>
<b class="nc">&nbsp;                &amp;&amp; (weapon.getRackSize() != 15)</b>
<b class="nc">&nbsp;                &amp;&amp; (weapon.getRackSize() != 20)) {</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (((weapon instanceof SRMWeapon) || (weapon instanceof SRTWeapon))</b>
<b class="nc">&nbsp;                &amp;&amp; (weapon.getRackSize() != 2)</b>
<b class="nc">&nbsp;                &amp;&amp; (weapon.getRackSize() != 4)</b>
<b class="nc">&nbsp;                &amp;&amp; (weapon.getRackSize() != 6)) {</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
<b class="nc">&nbsp;        if ((weapon instanceof MRMWeapon) &amp;&amp; (weapon.getRackSize() &lt; 10)) {</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if ((weapon instanceof RLWeapon) &amp;&amp; (weapon.getRackSize() &lt; 10)) {</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;        
<b class="nc">&nbsp;        if (weapon.hasFlag(WeaponType.F_ENERGY)</b>
<b class="nc">&nbsp;                || (weapon.hasFlag(WeaponType.F_PLASMA) &amp;&amp; (weapon</b>
<b class="nc">&nbsp;                        .getAmmoType() == AmmoType.T_PLASMA))) {</b>
&nbsp;
<b class="nc">&nbsp;            if (weapon.hasFlag(WeaponType.F_ENERGY)</b>
<b class="nc">&nbsp;                    &amp;&amp; weapon.hasFlag(WeaponType.F_PLASMA)</b>
<b class="nc">&nbsp;                    &amp;&amp; (weapon.getAmmoType() == AmmoType.T_NA)) {</b>
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        return true;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public StringBuffer printEntity() {
<b class="nc">&nbsp;        StringBuffer buff = new StringBuffer();</b>
<b class="nc">&nbsp;        buff.append(&quot;Aero: &quot;).append(aero.getDisplayName()).append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;        buff.append(&quot;Found in: &quot;).append(fileString).append(&quot;\n&quot;);        </b>
<b class="nc">&nbsp;        buff.append(printTechLevel());</b>
<b class="nc">&nbsp;        buff.append(&quot;Intro year: &quot;).append(aero.getYear()).append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;        buff.append(printSource());</b>
<b class="nc">&nbsp;        buff.append(printShortMovement());</b>
<b class="nc">&nbsp;        if (correctWeight(buff, true, true)) {</b>
<b class="nc">&nbsp;            buff.append(&quot;Weight: &quot;).append(getWeight()).append(&quot; (&quot;)</b>
<b class="nc">&nbsp;                    .append(calculateWeight()).append(&quot;)\n&quot;);</b>
&nbsp;        }
<b class="nc">&nbsp;        buff.append(printWeightCalculation()).append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;        buff.append(printArmorPlacement());</b>
<b class="nc">&nbsp;        correctArmor(buff);</b>
<b class="nc">&nbsp;        buff.append(printLocations());</b>
<b class="nc">&nbsp;        correctCriticals(buff);</b>
&nbsp;
&nbsp;        // printArmor(buff);
<b class="nc">&nbsp;        printFailedEquipment(buff);</b>
<b class="nc">&nbsp;        return buff;</b>
&nbsp;    }
&nbsp;    
&nbsp;    @Override
&nbsp;    public double calculateWeight() {
<b class="nc">&nbsp;        double weight = 0;</b>
<b class="nc">&nbsp;        weight += getWeightEngine();</b>
<b class="nc">&nbsp;        weight += getWeightControls();</b>
<b class="nc">&nbsp;        weight += getWeightFuel();</b>
<b class="nc">&nbsp;        weight += getWeightHeatSinks();</b>
<b class="nc">&nbsp;        weight += getWeightArmor();</b>
<b class="nc">&nbsp;        weight += getWeightMisc();</b>
&nbsp;
<b class="nc">&nbsp;        weight += getWeightMiscEquip();</b>
<b class="nc">&nbsp;        weight += getWeightWeapon();</b>
<b class="nc">&nbsp;        weight += getWeightAmmo();</b>
<b class="nc">&nbsp;        weight += getWeightPowerAmp();</b>
&nbsp;
<b class="nc">&nbsp;        weight += getWeightCarryingSpace();</b>
&nbsp;
<b class="nc">&nbsp;        weight += getArmoredComponentWeight();</b>
<b class="nc">&nbsp;        return weight;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public String printWeightCalculation() {
<b class="nc">&nbsp;        return printWeightEngine()</b>
<b class="nc">&nbsp;                + printWeightControls() + printWeightFuel() </b>
<b class="nc">&nbsp;                + printWeightHeatSinks()</b>
<b class="nc">&nbsp;                + printWeightArmor() + printWeightMisc()</b>
<b class="nc">&nbsp;                + printWeightCarryingSpace() + &quot;Equipment:\n&quot;</b>
<b class="nc">&nbsp;                + printMiscEquip() + printWeapon() + printAmmo();</b>
&nbsp;    }
&nbsp;    
&nbsp;    @Override
&nbsp;    public String printLocations() {
<b class="nc">&nbsp;        StringBuffer buff = new StringBuffer();</b>
<b class="nc">&nbsp;        for (int i = 0; i &lt; getEntity().locations(); i++) {</b>
<b class="nc">&nbsp;            String locationName = getEntity().getLocationName(i);</b>
<b class="nc">&nbsp;            buff.append(locationName + &quot;:&quot;);</b>
<b class="nc">&nbsp;            buff.append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;            for (int j = 0; j &lt; getEntity().getNumberOfCriticals(i); j++) {</b>
<b class="nc">&nbsp;                CriticalSlot slot = getEntity().getCritical(i, j);</b>
<b class="nc">&nbsp;                if (slot == null) {</b>
<b class="nc">&nbsp;                    j = getEntity().getNumberOfCriticals(i);                    </b>
<b class="nc">&nbsp;                } else if (slot.getType() == CriticalSlot.TYPE_SYSTEM) {</b>
<b class="nc">&nbsp;                        buff.append(Integer.toString(j)</b>
&nbsp;                                + &quot;. UNKNOWN SYSTEM NAME&quot;);
<b class="nc">&nbsp;                        buff.append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;                } else if (slot.getType() == CriticalSlot.TYPE_EQUIPMENT) {</b>
<b class="nc">&nbsp;                    EquipmentType e = getEntity().getEquipmentType(slot);</b>
<b class="nc">&nbsp;                    buff.append(Integer.toString(j) + &quot;. &quot;</b>
<b class="nc">&nbsp;                            + e.getInternalName());</b>
<b class="nc">&nbsp;                    buff.append(&quot;\n&quot;);</b>
&nbsp;                }
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        return buff.toString();</b>
&nbsp;    }
&nbsp;    
&nbsp;    public double getWeightQuarters() {
<b class="nc">&nbsp;        double quartersWeight = 0;</b>
<b class="nc">&nbsp;        for (Bay bay : getEntity().getTransportBays()) {</b>
<b class="nc">&nbsp;            if (bay.isQuarters()) {</b>
<b class="nc">&nbsp;                quartersWeight += bay.getWeight();</b>
&nbsp;            }
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;        return quartersWeight;</b>
&nbsp;    }
&nbsp;
&nbsp;    public String printWeightQuarters() {
<b class="nc">&nbsp;        double weight = 0.0;</b>
<b class="nc">&nbsp;        for (Bay bay : aero.getTransportBays()) {</b>
<b class="nc">&nbsp;            if (bay.isQuarters()) {</b>
<b class="nc">&nbsp;                weight += bay.getWeight();</b>
&nbsp;            }
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;        if (weight &gt; 0) {</b>
<b class="nc">&nbsp;            return StringUtil.makeLength(&quot;Crew quarters: &quot;, getPrintSize() - 5) + weight + &quot;\n&quot;;</b>
&nbsp;        }
<b class="nc">&nbsp;        return &quot;&quot;;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public String getName() {
<b class="nc">&nbsp;        if (aero.hasETypeFlag(Entity.ETYPE_CONV_FIGHTER)) {</b>
<b class="nc">&nbsp;            return &quot;Conventional Fighter: &quot; + aero.getDisplayName();</b>
&nbsp;        } else {
<b class="nc">&nbsp;            return &quot;Aerospace Fighter: &quot; + aero.getDisplayName();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Calculate the structural integrity weight
&nbsp;     */
&nbsp;    public double getWeightStructure() {
<b class="nc">&nbsp;        double tonnage = 0;</b>
<b class="nc">&nbsp;        if (aero.hasETypeFlag(Entity.ETYPE_SMALL_CRAFT)) {</b>
<b class="nc">&nbsp;            tonnage = aero.getSI() * aero.getWeight();</b>
<b class="nc">&nbsp;            if (aero.isSpheroid()) {</b>
<b class="nc">&nbsp;                tonnage /= 500;</b>
&nbsp;            } else {
<b class="nc">&nbsp;                tonnage /= 200;</b>
&nbsp;            }
<b class="nc">&nbsp;        } else if (aero.hasETypeFlag(Entity.ETYPE_SPACE_STATION)) {</b>
<b class="nc">&nbsp;            tonnage = aero.getWeight() / 100;</b>
<b class="nc">&nbsp;        } else if (aero.hasETypeFlag(Entity.ETYPE_WARSHIP)) {</b>
&nbsp;            // SI * weight / 1000, rounded up to half ton
<b class="nc">&nbsp;            tonnage = aero.getSI() * aero.getWeight() / 1000;</b>
<b class="nc">&nbsp;        } else if (aero.hasETypeFlag(Entity.ETYPE_JUMPSHIP)) {</b>
<b class="nc">&nbsp;            tonnage = aero.getWeight() / 150;</b>
&nbsp;        } else {
&nbsp;            // Fighters do not allocate weight to structure
<b class="nc">&nbsp;            return 0;</b>
&nbsp;        }
<b class="nc">&nbsp;        return Math.ceil(tonnage * 2) / 2.0;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Get the maximum tonnage for the type of unit. Primitive jumpships will use the maximum
&nbsp;     * allowable value for the construction year (Terran Alliance/Hegemony)
&nbsp;     * 
&nbsp;     * @param aero      The unit
&nbsp;     * @return          The maximum tonnage for the type of unit.
&nbsp;     */
&nbsp;    public static int getMaxTonnage(Aero aero) {
<b class="nc">&nbsp;        return getMaxTonnage(aero, ITechnology.F_NONE);</b>
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * Get the maximum tonnage for the type of unit
&nbsp;     * 
&nbsp;     * @param aero      The unit
&nbsp;     * @param faction   An ITechnology faction constant used for primitive jumpships. A value
&nbsp;     *                  of F_NONE will use the least restrictive values (TA/TH).
&nbsp;     * @return          The maximum tonnage for the type of unit.
&nbsp;     */
&nbsp;    public static int getMaxTonnage(Aero aero, int faction) {
<b class="nc">&nbsp;        if (aero.hasETypeFlag(Entity.ETYPE_SPACE_STATION)) {</b>
<b class="nc">&nbsp;            return 2500000;</b>
<b class="nc">&nbsp;        } else if (aero.hasETypeFlag(Entity.ETYPE_WARSHIP)) {</b>
<b class="nc">&nbsp;            if (((Jumpship) aero).getDriveCoreType() == Jumpship.DRIVE_CORE_SUBCOMPACT) {</b>
<b class="nc">&nbsp;                return 25000;</b>
&nbsp;            }
<b class="nc">&nbsp;            return 2500000;</b>
<b class="nc">&nbsp;        } else if (aero.hasETypeFlag(Entity.ETYPE_JUMPSHIP)) {</b>
<b class="nc">&nbsp;            if (aero.isPrimitive()) {</b>
<b class="nc">&nbsp;                return getPrimitiveJumpshipMaxTonnage(aero, faction);</b>
&nbsp;            }
<b class="nc">&nbsp;            return 500000;</b>
<b class="nc">&nbsp;        } else if (aero.hasETypeFlag(Entity.ETYPE_DROPSHIP)) {</b>
<b class="nc">&nbsp;            if (aero.isPrimitive()) {</b>
<b class="nc">&nbsp;                return getPrimitiveDropshipMaxTonnage(aero);</b>
&nbsp;            }
<b class="nc">&nbsp;            return aero.isSpheroid()? 100000 : 35000;</b>
<b class="nc">&nbsp;        } else if (aero.hasETypeFlag(Entity.ETYPE_SMALL_CRAFT)</b>
<b class="nc">&nbsp;                || aero.hasETypeFlag(Entity.ETYPE_FIXED_WING_SUPPORT)) {</b>
<b class="nc">&nbsp;            return 200;</b>
<b class="nc">&nbsp;        } else if (aero.hasETypeFlag(Entity.ETYPE_CONV_FIGHTER)) {</b>
<b class="nc">&nbsp;            return 50;</b>
&nbsp;        } else {
<b class="nc">&nbsp;            return 100;</b>
&nbsp;        }
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * @param jumpship
&nbsp;     * @return Max tonnage allowed by construction rules.
&nbsp;     */
&nbsp;    public static int getPrimitiveJumpshipMaxTonnage(Aero jumpship, int faction) {
<b class="nc">&nbsp;        switch (faction) {</b>
&nbsp;            case ITechnology.F_TA:
&nbsp;            case ITechnology.F_TH:
&nbsp;            case ITechnology.F_NONE:
<b class="nc">&nbsp;                if (jumpship.getYear() &lt; 2130) {</b>
<b class="nc">&nbsp;                    return 100000;</b>
<b class="nc">&nbsp;                } else if (jumpship.getYear() &lt; 2150) {</b>
<b class="nc">&nbsp;                    return 150000;</b>
<b class="nc">&nbsp;                } else if (jumpship.getYear() &lt; 2165) {</b>
<b class="nc">&nbsp;                    return 200000;</b>
<b class="nc">&nbsp;                } else if (jumpship.getYear() &lt; 2175) {</b>
<b class="nc">&nbsp;                    return 250000;</b>
<b class="nc">&nbsp;                } else if (jumpship.getYear() &lt; 2200) {</b>
<b class="nc">&nbsp;                    return 350000;</b>
<b class="nc">&nbsp;                } else if (jumpship.getYear() &lt; 2300){</b>
<b class="nc">&nbsp;                    return 500000;</b>
<b class="nc">&nbsp;                } else if (jumpship.getYear() &lt; 2350) {</b>
<b class="nc">&nbsp;                    return 1000000;</b>
<b class="nc">&nbsp;                } else if (jumpship.getYear() &lt; 2400) {</b>
<b class="nc">&nbsp;                    return 1600000;</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    return 1800000;</b>
&nbsp;                }
&nbsp;            case ITechnology.F_CC:
&nbsp;            case ITechnology.F_DC:
&nbsp;            case ITechnology.F_FS:
&nbsp;            case ITechnology.F_FW:
&nbsp;            case ITechnology.F_LC:
<b class="nc">&nbsp;                if (jumpship.getYear() &lt; 2300){</b>
<b class="nc">&nbsp;                    return 350000;</b>
<b class="nc">&nbsp;                } else if (jumpship.getYear() &lt; 2350) {</b>
<b class="nc">&nbsp;                    return 600000;</b>
<b class="nc">&nbsp;                } else if (jumpship.getYear() &lt; 2400) {</b>
<b class="nc">&nbsp;                    return 800000;</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    return 1000000;</b>
&nbsp;                }
&nbsp;            default:
<b class="nc">&nbsp;                if (jumpship.getYear() &lt; 2300){</b>
<b class="nc">&nbsp;                    return 300000;</b>
<b class="nc">&nbsp;                } else if (jumpship.getYear() &lt; 2350) {</b>
<b class="nc">&nbsp;                    return 450000;</b>
<b class="nc">&nbsp;                } else if (jumpship.getYear() &lt; 2400) {</b>
<b class="nc">&nbsp;                    return 600000;</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    return 1000000;</b>
&nbsp;                }
&nbsp;        }
&nbsp;    }
&nbsp;    
&nbsp;    public static int getPrimitiveDropshipMaxTonnage(Aero dropship) {
<b class="nc">&nbsp;        if (dropship.getYear() &lt; 2130) {</b>
<b class="nc">&nbsp;            return dropship.isSpheroid()? 3000 : 1000; </b>
<b class="nc">&nbsp;        } else if (dropship.getYear() &lt; 2150) {</b>
<b class="nc">&nbsp;            return dropship.isSpheroid()? 4000 : 1500; </b>
<b class="nc">&nbsp;        } else if (dropship.getYear() &lt; 2165) {</b>
<b class="nc">&nbsp;            return dropship.isSpheroid()? 7000 : 2500; </b>
<b class="nc">&nbsp;        } else if (dropship.getYear() &lt; 2175) {</b>
<b class="nc">&nbsp;            return dropship.isSpheroid()? 10000 : 3000; </b>
<b class="nc">&nbsp;        } else if (dropship.getYear() &lt; 2200) {</b>
<b class="nc">&nbsp;            return dropship.isSpheroid()? 14000 : 5000; </b>
<b class="nc">&nbsp;        } else if (dropship.getYear() &lt; 2250) {</b>
<b class="nc">&nbsp;            return dropship.isSpheroid()? 15000 : 6000; </b>
<b class="nc">&nbsp;        } else if (dropship.getYear() &lt; 2300) {</b>
<b class="nc">&nbsp;            return dropship.isSpheroid()? 19000 : 7000; </b>
<b class="nc">&nbsp;        } else if (dropship.getYear() &lt; 2350) {</b>
<b class="nc">&nbsp;            return dropship.isSpheroid()? 23000 : 8000; </b>
<b class="nc">&nbsp;        } else if (dropship.getYear() &lt; 2425) {</b>
<b class="nc">&nbsp;            return dropship.isSpheroid()? 30000 : 10000; </b>
&nbsp;        } else {
<b class="nc">&nbsp;            return dropship.isSpheroid()? 50000 : 20000; </b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * @return Minimum crew requirements based on unit type and equipment crew requirements.
&nbsp;     */
&nbsp;    public static int minimumBaseCrew(Aero aero) {
<b class="nc">&nbsp;        if (aero.hasETypeFlag(Entity.ETYPE_SMALL_CRAFT)) {</b>
<b class="nc">&nbsp;            return TestSmallCraft.minimumBaseCrew((SmallCraft) aero);</b>
<b class="nc">&nbsp;        } else if (aero.hasETypeFlag(Entity.ETYPE_JUMPSHIP)) {</b>
<b class="nc">&nbsp;            return TestAdvancedAerospace.minimumBaseCrew((Jumpship) aero);</b>
&nbsp;        } else {
<b class="nc">&nbsp;            return 1;</b>
&nbsp;        }
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * One gunner is required for each capital weapon and each six standard scale weapons, rounding up
&nbsp;     * @return The vessel&#39;s minimum gunner requirements.
&nbsp;     */
&nbsp;    public static int requiredGunners(Aero aero) {
<b class="nc">&nbsp;        if (!aero.isLargeCraft() &amp;&amp; !aero.hasETypeFlag(Entity.ETYPE_SMALL_CRAFT)) {</b>
<b class="nc">&nbsp;            return 0;</b>
&nbsp;        }
<b class="nc">&nbsp;        int capitalWeapons = 0;</b>
<b class="nc">&nbsp;        int stdWeapons = 0;</b>
<b class="nc">&nbsp;        for (Mounted m : aero.getTotalWeaponList()) {</b>
<b class="nc">&nbsp;            if (m.getType() instanceof BayWeapon) {</b>
<b class="nc">&nbsp;                continue;</b>
&nbsp;            }
<b class="nc">&nbsp;            if ((((WeaponType)m.getType()).getLongRange() &lt;= 1)</b>
&nbsp;                    // MML range depends on ammo, and getLongRange() returns 0
<b class="nc">&nbsp;                    &amp;&amp; (((WeaponType) m.getType()).getAmmoType() != AmmoType.T_MML)) {</b>
<b class="nc">&nbsp;                continue;</b>
&nbsp;            }
<b class="nc">&nbsp;            if (((WeaponType)m.getType()).isCapital()</b>
<b class="nc">&nbsp;                    || (m.getType() instanceof ScreenLauncherWeapon)) {</b>
<b class="nc">&nbsp;                capitalWeapons++;</b>
&nbsp;            } else {
<b class="nc">&nbsp;                stdWeapons++;</b>
&nbsp;            }
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;        return capitalWeapons + (int)Math.ceil(stdWeapons / 6.0);</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Determines whether a piece of equipment should be mounted in a specific location, as opposed
&nbsp;     * to the fuselage.
&nbsp;     * 
&nbsp;     * @param eq       The equipment
&nbsp;     * @param fighter  If the aero is a fighter (including fixed wing support), the ammo is mounted in the
&nbsp;     *                 fuselage. Otherwise it&#39;s in the location with the weapon.
&nbsp;     * @return         Whether the equipment needs to be assigned to a location with a firing arc.
&nbsp;     */
&nbsp;    public static boolean eqRequiresLocation(EquipmentType eq, boolean fighter) {
<b class="nc">&nbsp;        if (!fighter) {</b>
<b class="nc">&nbsp;            return (eq instanceof WeaponType)</b>
&nbsp;                    || (eq instanceof AmmoType)
&nbsp;                    || ((eq instanceof MiscType)
<b class="nc">&nbsp;                            &amp;&amp; (eq.hasFlag(MiscType.F_ARTEMIS)</b>
<b class="nc">&nbsp;                                    || eq.hasFlag(MiscType.F_ARTEMIS_PROTO)</b>
<b class="nc">&nbsp;                                    || eq.hasFlag(MiscType.F_ARTEMIS_V)</b>
<b class="nc">&nbsp;                                    || eq.hasFlag(MiscType.F_APOLLO)</b>
<b class="nc">&nbsp;                                    || eq.hasFlag(MiscType.F_PPC_CAPACITOR)</b>
<b class="nc">&nbsp;                                    || eq.hasFlag(MiscType.F_RISC_LASER_PULSE_MODULE)</b>
<b class="nc">&nbsp;                                    || eq.hasFlag(MiscType.F_LASER_INSULATOR)));</b>
<b class="nc">&nbsp;        } else if (eq instanceof MiscType) {</b>
<b class="nc">&nbsp;            if (eq.hasFlag(MiscType.F_CASE)) {</b>
<b class="nc">&nbsp;                return eq.isClan();</b>
<b class="nc">&nbsp;            } else return !eq.hasFlag(MiscType.F_BLUE_SHIELD) &amp;&amp; !eq.hasFlag(MiscType.F_LIFTHOIST);</b>
&nbsp;        } else {
<b class="nc">&nbsp;            return !(eq instanceof AmmoType);</b>
&nbsp;        }
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2023-05-16 16:28</div>
</div>
</body>
</html>
