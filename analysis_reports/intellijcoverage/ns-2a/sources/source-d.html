


<!DOCTYPE html>
<html id="htmlId">
<head>
  <title>Coverage Report > TestSmallCraft</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">megamek.common.verifier</a>
</div>

<h1>Coverage Summary for Class: TestSmallCraft (megamek.common.verifier)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">TestSmallCraft</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/44)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/429)
  </span>
</td>
</tr>
  <tr>
    <td class="name">TestSmallCraft$AerospaceArmor</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/19)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/49)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/448)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;/*
&nbsp; * MegaMek -
&nbsp; * Copyright (C) 2017 - The MegaMek Team
&nbsp; *
&nbsp; *  This program is free software; you can redistribute it and/or modify it
&nbsp; *  under the terms of the GNU General Public License as published by the Free
&nbsp; *  Software Foundation; either version 2 of the License, or (at your option)
&nbsp; *  any later version.
&nbsp; *
&nbsp; *  This program is distributed in the hope that it will be useful, but
&nbsp; *  WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
&nbsp; *  or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License
&nbsp; *  for more details.
&nbsp; */
&nbsp;package megamek.common.verifier;
&nbsp;
&nbsp;import java.math.BigInteger;
&nbsp;import java.util.ArrayList;
&nbsp;import java.util.HashMap;
&nbsp;import java.util.List;
&nbsp;import java.util.Map;
&nbsp;
&nbsp;import megamek.common.Aero;
&nbsp;import megamek.common.AmmoType;
&nbsp;import megamek.common.Bay;
&nbsp;import megamek.common.CriticalSlot;
&nbsp;import megamek.common.Entity;
&nbsp;import megamek.common.EquipmentType;
&nbsp;import megamek.common.ITechManager;
&nbsp;import megamek.common.MiscType;
&nbsp;import megamek.common.Mounted;
&nbsp;import megamek.common.SmallCraft;
&nbsp;import megamek.common.TechConstants;
&nbsp;import megamek.common.WeaponType;
&nbsp;import megamek.common.util.StringUtil;
&nbsp;
&nbsp;/**
&nbsp; * Class for testing and validating instantiations for Small Craft and Dropships.
&nbsp; *
&nbsp; * @author Neoancient
&nbsp; *
&nbsp; */
&nbsp;public class TestSmallCraft extends TestAero {
&nbsp;    
&nbsp;    // Indices used to specify firing arcs with aliases for aerodyne and spheroid
&nbsp;    public static final int ARC_NOSE = SmallCraft.LOC_NOSE;
&nbsp;    public static final int ARC_LWING = SmallCraft.LOC_LWING;
&nbsp;    public static final int ARC_RWING = SmallCraft.LOC_RWING;
&nbsp;    public static final int ARC_AFT = SmallCraft.LOC_AFT;
&nbsp;    public static final int REAR_ARC_OFFSET = SmallCraft.LOC_HULL;
&nbsp;    public static final int ARC_FWD_LEFT = SmallCraft.LOC_LWING;
&nbsp;    public static final int ARC_FWD_RIGHT = SmallCraft.LOC_RWING;
&nbsp;    public static final int ARC_AFT_LEFT = SmallCraft.LOC_LWING + REAR_ARC_OFFSET;
&nbsp;    public static final int ARC_AFT_RIGHT = SmallCraft.LOC_RWING + REAR_ARC_OFFSET;
&nbsp;    
&nbsp;    private final SmallCraft smallCraft;
&nbsp;
<b class="nc">&nbsp;    public enum AerospaceArmor{</b>
<b class="nc">&nbsp;        STANDARD(EquipmentType.T_ARMOR_AEROSPACE, false),   </b>
<b class="nc">&nbsp;        CLAN_STANDARD(EquipmentType.T_ARMOR_AEROSPACE, true),</b>
<b class="nc">&nbsp;        IS_FERRO_ALUM(EquipmentType.T_ARMOR_ALUM, false),</b>
<b class="nc">&nbsp;        CLAN_FERRO_ALUM(EquipmentType.T_ARMOR_ALUM, true),</b>
<b class="nc">&nbsp;        FERRO_PROTO(EquipmentType.T_ARMOR_FERRO_ALUM_PROTO, false),        </b>
<b class="nc">&nbsp;        HEAVY_FERRO_ALUM(EquipmentType.T_ARMOR_HEAVY_ALUM, false),</b>
<b class="nc">&nbsp;        LIGHT_FERRO_ALUM(EquipmentType.T_ARMOR_LIGHT_ALUM, false),</b>
<b class="nc">&nbsp;        PRIMITIVE(EquipmentType.T_ARMOR_PRIMITIVE_AERO, false);        </b>
&nbsp;
&nbsp;        /**
&nbsp;         * The type, corresponding to types defined in 
&nbsp;         * &lt;code&gt;EquipmentType&lt;/code&gt;.
&nbsp;         */
&nbsp;        public int type;
&nbsp;                
&nbsp;        /**
&nbsp;         * Denotes whether this armor is Clan or not.
&nbsp;         */
&nbsp;        public boolean isClan;
&nbsp;        
<b class="nc">&nbsp;        AerospaceArmor(int t, boolean c){</b>
<b class="nc">&nbsp;            type = t;</b>
<b class="nc">&nbsp;            isClan = c;</b>
&nbsp;        }
&nbsp;        
&nbsp;        /**
&nbsp;         * Given an armor type, return the &lt;code&gt;AerospaceArmor&lt;/code&gt; instance that
&nbsp;         * represents that type.
&nbsp;         * 
&nbsp;         * @param t  The armor type.
&nbsp;         * @param c  Whether this armor type is Clan or not.
&nbsp;         * @return   The &lt;code&gt;AeroArmor&lt;/code&gt; that corresponds to the given 
&nbsp;         *              type or null if no match was found.
&nbsp;         */
&nbsp;        public static AerospaceArmor getArmor(int t, boolean c){
<b class="nc">&nbsp;            for (AerospaceArmor a : values()){</b>
<b class="nc">&nbsp;                if (a.type == t &amp;&amp; a.isClan == c){</b>
<b class="nc">&nbsp;                    return a;</b>
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            return null;</b>
&nbsp;        }
&nbsp;        
&nbsp;        /**
&nbsp;         * Calculates and returns the points per ton of the armor type given the
&nbsp;         * weight and shape of a small craft/dropship
&nbsp;         * 
&nbsp;         * @param sc The small craft/dropship
&nbsp;         * @return   The number of points of armor per ton
&nbsp;         */
&nbsp;        public double pointsPerTon(SmallCraft sc) {
<b class="nc">&nbsp;            return SmallCraft.armorPointsPerTon(sc.getWeight(), sc.isSpheroid(), type, isClan);</b>
&nbsp;        }
&nbsp;        
&nbsp;        /**
&nbsp;         * @return The &lt;code&gt;MiscType&lt;/code&gt; for this armor.
&nbsp;         */
&nbsp;        public EquipmentType getArmorEqType() {
<b class="nc">&nbsp;            String name = EquipmentType.getArmorTypeName(type, isClan);</b>
<b class="nc">&nbsp;            return EquipmentType.get(name);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Filters all small craft/dropship armor according to given tech constraints
&nbsp;     * 
&nbsp;     * @param techManager Used to check the tech constraints
&nbsp;     * @return A list of all armors that meet the tech constraints
&nbsp;     */
&nbsp;    public static List&lt;EquipmentType&gt; legalArmorsFor(ITechManager techManager) {
<b class="nc">&nbsp;        List&lt;EquipmentType&gt; retVal = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        for (AerospaceArmor armor : AerospaceArmor.values()) {</b>
<b class="nc">&nbsp;            final EquipmentType eq = armor.getArmorEqType();</b>
<b class="nc">&nbsp;            if ((null != eq) &amp;&amp; techManager.isLegal(eq)) {</b>
<b class="nc">&nbsp;                retVal.add(eq);</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        return retVal;</b>
&nbsp;    }
&nbsp;    
&nbsp;    public static int maxArmorPoints(SmallCraft sc) {
<b class="nc">&nbsp;        AerospaceArmor a = AerospaceArmor.getArmor(sc.getArmorType(0),</b>
<b class="nc">&nbsp;                TechConstants.isClan(sc.getArmorTechLevel(0)));</b>
<b class="nc">&nbsp;        if (null != a) {</b>
<b class="nc">&nbsp;            return (int) Math.floor(a.pointsPerTon(sc) * maxArmorWeight(sc)</b>
<b class="nc">&nbsp;                    + sc.get0SI() * (sc.isPrimitive() ? 2.64 : 4));</b>
&nbsp;        } else {
<b class="nc">&nbsp;            return 0;</b>
&nbsp;        }
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     *  Computes the maximum number armor level in tons
&nbsp;     *   
&nbsp;     */
&nbsp;    public static double maxArmorWeight(SmallCraft smallCraft){
<b class="nc">&nbsp;        if (smallCraft.isSpheroid()) {</b>
<b class="nc">&nbsp;            return floor(smallCraft.get0SI() * 3.6, Ceil.HALFTON);</b>
&nbsp;        } else {
<b class="nc">&nbsp;            return floor(smallCraft.get0SI() * 4.5, Ceil.HALFTON);</b>
&nbsp;        }
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * Computes the amount of weight required for fire control systems and power distribution
&nbsp;     * systems for exceeding the base limit of weapons per firing arc.
&nbsp;     * 
&nbsp;     * Spheroid aft side arcs are implemented as rear-mounted; the return value uses the index
&nbsp;     * of forward side + 3 for the aft side arcs.
&nbsp;     * 
&nbsp;     * @param sc The small craft/dropship in question
&nbsp;     * @return   Returns a &lt;code&gt;double&lt;/code&gt; array, where each element corresponds to a 
&nbsp;     *           location and the value is the extra tonnage required by exceeding the base
&nbsp;     *           allotment
&nbsp;     */
&nbsp;    public static double[] extraSlotCost(SmallCraft sc) {
&nbsp;        // Arcs/locations include the hull. Spheroids have two arcs in each side location;
&nbsp;        // the indices for the side aft arcs are after the virtual wings location.
<b class="nc">&nbsp;        final int arcs = sc.isSpheroid() ? 8 : 5;</b>
<b class="nc">&nbsp;        int[] weaponsPerArc = new int[arcs];</b>
<b class="nc">&nbsp;        double[] weaponTonnage = new double[arcs];</b>
<b class="nc">&nbsp;        boolean hasNC3 = sc.hasWorkingMisc(MiscType.F_NAVAL_C3);</b>
&nbsp;
<b class="nc">&nbsp;        for (Mounted m : sc.getEquipment()) {</b>
<b class="nc">&nbsp;            if (usesWeaponSlot(sc, m.getType())) {</b>
<b class="nc">&nbsp;                int arc = m.getLocation();</b>
<b class="nc">&nbsp;                if (arc &lt; 0) {</b>
<b class="nc">&nbsp;                    continue;</b>
&nbsp;                }
<b class="nc">&nbsp;                if (sc.isSpheroid() &amp;&amp; m.isRearMounted()) {</b>
<b class="nc">&nbsp;                    arc += REAR_ARC_OFFSET;</b>
&nbsp;                }
<b class="nc">&nbsp;                weaponsPerArc[arc]++;</b>
<b class="nc">&nbsp;                weaponTonnage[arc] += m.getTonnage();</b>
&nbsp;            }
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;        double[] retVal = new double[arcs];</b>
<b class="nc">&nbsp;        for (int arc = 0; arc &lt; arcs; arc++) {</b>
<b class="nc">&nbsp;            int excess = (weaponsPerArc[arc] - 1) / slotsPerArc(sc);</b>
<b class="nc">&nbsp;            if (excess &gt; 0) {</b>
<b class="nc">&nbsp;                retVal[arc] = ceil(excess * weaponTonnage[arc] / 10.0, Ceil.HALFTON);</b>
&nbsp;            }
<b class="nc">&nbsp;            if (hasNC3) {</b>
<b class="nc">&nbsp;                retVal[arc] *= 2;</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        return retVal;</b>
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * Computes the weight of the engine.
&nbsp;     * 
&nbsp;     * @param clan          Whether the unit is a Clan design
&nbsp;     * @param tonnage       The weight of the unit
&nbsp;     * @param desiredSafeThrust  The safe thrust value
&nbsp;     * @param dropship      Whether the unit is a dropship (only relevant for primitives)
&nbsp;     * @param year          The original construction year (only relevant for primitives)
&nbsp;     * @return              The weight of the engine in tons
&nbsp;     */
&nbsp;    public static double calculateEngineTonnage(boolean clan, double tonnage, 
&nbsp;            int desiredSafeThrust, boolean dropship, int year) {
&nbsp;        double multiplier;
<b class="nc">&nbsp;        if (clan) {</b>
<b class="nc">&nbsp;            multiplier = 0.061;</b>
<b class="nc">&nbsp;        } else if (dropship) {</b>
<b class="nc">&nbsp;            multiplier = dropshipEngineMultiplier(year);</b>
&nbsp;        } else {
<b class="nc">&nbsp;            multiplier = smallCraftEngineMultiplier(year);</b>
&nbsp;        }
<b class="nc">&nbsp;        return ceil(tonnage * desiredSafeThrust * multiplier, Ceil.HALFTON);</b>
&nbsp;    }
&nbsp;    
&nbsp;    public static int weightFreeHeatSinks(SmallCraft sc) {
<b class="nc">&nbsp;        double engineTonnage = calculateEngineTonnage(sc.isClan(), sc.getWeight(), sc.getWalkMP(),</b>
<b class="nc">&nbsp;                sc.hasETypeFlag(Entity.ETYPE_DROPSHIP), sc.getOriginalBuildYear());</b>
<b class="nc">&nbsp;        if (sc.isSpheroid()) {</b>
<b class="nc">&nbsp;            if (sc.isPrimitive()) {</b>
<b class="nc">&nbsp;                return (int)Math.floor(Math.sqrt(engineTonnage * 1.3));</b>
<b class="nc">&nbsp;            } else if ((sc.getDesignType() == SmallCraft.MILITARY)</b>
<b class="nc">&nbsp;                    &amp;&amp; sc.hasETypeFlag(Entity.ETYPE_DROPSHIP)) {</b>
<b class="nc">&nbsp;                return (int)Math.floor(Math.sqrt(engineTonnage * 6.8));</b>
&nbsp;            } else {
<b class="nc">&nbsp;                return (int)Math.floor(Math.sqrt(engineTonnage * 1.6));</b>
&nbsp;            }
&nbsp;        } else {
<b class="nc">&nbsp;            if (sc.isPrimitive()) {</b>
<b class="nc">&nbsp;                return (int)Math.floor(engineTonnage / 75.0);</b>
<b class="nc">&nbsp;            } else if ((sc.getDesignType() == SmallCraft.MILITARY)</b>
<b class="nc">&nbsp;                    &amp;&amp; sc.hasETypeFlag(Entity.ETYPE_DROPSHIP)) {</b>
<b class="nc">&nbsp;                return (int)Math.floor(engineTonnage / 20.0);</b>
&nbsp;            } else {
<b class="nc">&nbsp;                return (int)Math.floor(engineTonnage / 60.0);</b>
&nbsp;            }
&nbsp;        }
&nbsp;    }
&nbsp;    
&nbsp;    public static double smallCraftEngineMultiplier(int year) {
<b class="nc">&nbsp;        if (year &gt;= 2500) {</b>
<b class="nc">&nbsp;            return 0.065;</b>
<b class="nc">&nbsp;        } else if (year &gt;= 2400) {</b>
<b class="nc">&nbsp;            return 0.078;</b>
<b class="nc">&nbsp;        } else if (year &gt;= 2300) {</b>
<b class="nc">&nbsp;            return 0.091;</b>
<b class="nc">&nbsp;        } else if (year &gt;= 2251) {</b>
<b class="nc">&nbsp;            return 0.0975;</b>
<b class="nc">&nbsp;        } else if (year &gt;= 2201) {</b>
<b class="nc">&nbsp;            return 0.1105;</b>
<b class="nc">&nbsp;        } else if (year &gt;= 2151) {</b>
<b class="nc">&nbsp;            return 0.1235;</b>
&nbsp;        } else {
<b class="nc">&nbsp;            return 0.143;</b>
&nbsp;        }
&nbsp;    }
&nbsp;    
&nbsp;    public static double smallCraftControlMultiplier(int year) {
<b class="nc">&nbsp;        if (year &gt;= 2500) {</b>
<b class="nc">&nbsp;            return 0.0075;</b>
<b class="nc">&nbsp;        } else if (year &gt;= 2400) {</b>
<b class="nc">&nbsp;            return 0.00825;</b>
<b class="nc">&nbsp;        } else if (year &gt;= 2300) {</b>
<b class="nc">&nbsp;            return 0.00975;</b>
<b class="nc">&nbsp;        } else if (year &gt;= 2251) {</b>
<b class="nc">&nbsp;            return 0.01125;</b>
<b class="nc">&nbsp;        } else if (year &gt;= 2201) {</b>
<b class="nc">&nbsp;            return 0.01275;</b>
<b class="nc">&nbsp;        } else if (year &gt;= 2151) {</b>
<b class="nc">&nbsp;            return 0.01245;</b>
&nbsp;        } else {
<b class="nc">&nbsp;            return 0.01575;</b>
&nbsp;        }
&nbsp;    }
&nbsp;    
&nbsp;    public static double dropshipEngineMultiplier(int year) {
<b class="nc">&nbsp;        if (year &gt;= 2500) {</b>
<b class="nc">&nbsp;            return 0.065;</b>
<b class="nc">&nbsp;        } else if (year &gt;= 2351) {</b>
<b class="nc">&nbsp;            return 0.0715;</b>
<b class="nc">&nbsp;        } else if (year &gt;= 2300) {</b>
<b class="nc">&nbsp;            return 0.0845;</b>
<b class="nc">&nbsp;        } else if (year &gt;= 2251) {</b>
<b class="nc">&nbsp;            return 0.091;</b>
<b class="nc">&nbsp;        } else if (year &gt;= 2201) {</b>
<b class="nc">&nbsp;            return 0.1104;</b>
<b class="nc">&nbsp;        } else if (year &gt;= 2151) {</b>
<b class="nc">&nbsp;            return 0.117;</b>
&nbsp;        } else {
<b class="nc">&nbsp;            return 0.13;</b>
&nbsp;        }
&nbsp;    }
&nbsp;    
&nbsp;    public static double dropshipControlMultiplier(int year) {
<b class="nc">&nbsp;        if (year &gt;= 2500) {</b>
<b class="nc">&nbsp;            return 0.0075;</b>
<b class="nc">&nbsp;        } else if (year &gt;= 2351) {</b>
<b class="nc">&nbsp;            return 0.009;</b>
<b class="nc">&nbsp;        } else if (year &gt;= 2300) {</b>
<b class="nc">&nbsp;            return 0.00975;</b>
<b class="nc">&nbsp;        } else if (year &gt;= 2251) {</b>
<b class="nc">&nbsp;            return 0.0105;</b>
<b class="nc">&nbsp;        } else if (year &gt;= 2201) {</b>
<b class="nc">&nbsp;            return 0.0120;</b>
<b class="nc">&nbsp;        } else if (year &gt;= 2151) {</b>
<b class="nc">&nbsp;            return 0.0135;</b>
&nbsp;        } else {
<b class="nc">&nbsp;            return 0.015;</b>
&nbsp;        }
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * @return Minimum crew requirements based on unit type and equipment crew requirements.
&nbsp;     */
&nbsp;    public static int minimumBaseCrew(SmallCraft sc) {
<b class="nc">&nbsp;        int crew = 3;</b>
<b class="nc">&nbsp;        if (sc.hasETypeFlag(Entity.ETYPE_DROPSHIP)) {</b>
<b class="nc">&nbsp;            crew += (int)Math.ceil(sc.getWeight() / 5000);</b>
<b class="nc">&nbsp;            if (sc.getDesignType() == SmallCraft.MILITARY) {</b>
<b class="nc">&nbsp;                crew++;</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        for (Mounted m : sc.getMisc()) {</b>
<b class="nc">&nbsp;            crew += equipmentCrewRequirements(m);</b>
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;        return crew;</b>
&nbsp;    }
&nbsp;        
&nbsp;    public TestSmallCraft(SmallCraft sc, TestEntityOption option, String fs) {
<b class="nc">&nbsp;        super(sc, option, fs);</b>
&nbsp;        
<b class="nc">&nbsp;        smallCraft = sc;</b>
<b class="nc">&nbsp;    }</b>
&nbsp;
&nbsp;    @Override
&nbsp;    public Entity getEntity() {
<b class="nc">&nbsp;        return smallCraft;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean isTank() {
<b class="nc">&nbsp;        return false;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean isMech() {
<b class="nc">&nbsp;        return false;</b>
&nbsp;    }
&nbsp;    
&nbsp;    @Override
&nbsp;    public boolean isAero() {
<b class="nc">&nbsp;        return true;</b>
&nbsp;    }
&nbsp;    
&nbsp;    @Override
&nbsp;    public boolean isSmallCraft() {
<b class="nc">&nbsp;        return true;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public double getWeightControls() {
&nbsp;        // Non primitives use the multiplier for 2500+ even if they were built before that date
<b class="nc">&nbsp;        int year = smallCraft.isPrimitive()? smallCraft.getOriginalBuildYear() : 2500;</b>
&nbsp;        // Small craft round up to the half ton and dropships to the full ton
<b class="nc">&nbsp;        if (smallCraft.hasETypeFlag(Entity.ETYPE_DROPSHIP)) {</b>
<b class="nc">&nbsp;            return ceil(smallCraft.getWeight()</b>
<b class="nc">&nbsp;                    * dropshipControlMultiplier(year), Ceil.TON);</b>
&nbsp;        } else {
<b class="nc">&nbsp;            return ceil(smallCraft.getWeight()</b>
<b class="nc">&nbsp;                    * smallCraftControlMultiplier(year), Ceil.HALFTON);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public double getWeightEngine() {
<b class="nc">&nbsp;        return calculateEngineTonnage(smallCraft.isClan(), smallCraft.getWeight(),</b>
<b class="nc">&nbsp;                smallCraft.getOriginalWalkMP(), smallCraft.hasETypeFlag(Entity.ETYPE_DROPSHIP),</b>
<b class="nc">&nbsp;                smallCraft.getOriginalBuildYear());</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public String printWeightEngine() {
<b class="nc">&nbsp;        return StringUtil.makeLength(&quot;Engine: &quot;, getPrintSize() - 5)</b>
<b class="nc">&nbsp;                + TestEntity.makeWeightString(getWeightEngine()) + &quot;\n&quot;;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public double getWeightFuel() {
&nbsp;        // Add 2% for pumps and round up to the half ton
<b class="nc">&nbsp;        return ceil(smallCraft.getFuelTonnage() * 1.02, Ceil.HALFTON);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public int getCountHeatSinks() {
<b class="nc">&nbsp;        return smallCraft.getHeatSinks();</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public double getWeightHeatSinks() {
<b class="nc">&nbsp;        return Math.max(smallCraft.getHeatSinks() - weightFreeHeatSinks(smallCraft), 0);        </b>
&nbsp;    }
&nbsp;
&nbsp;    // Bays can store multiple tons of ammo in a single slot.
&nbsp;    @Override
&nbsp;    public double getWeightAmmo() {
<b class="nc">&nbsp;        double weight = 0.0;</b>
<b class="nc">&nbsp;        for (Mounted m : getEntity().getAmmo()) {</b>
&nbsp;
&nbsp;            // One Shot Ammo
<b class="nc">&nbsp;            if (m.getLocation() == Entity.LOC_NONE) {</b>
<b class="nc">&nbsp;                continue;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            AmmoType mt = (AmmoType) m.getType();</b>
<b class="nc">&nbsp;            int slots = (int) Math.ceil((double) m.getBaseShotsLeft() / mt.getShots());</b>
<b class="nc">&nbsp;            weight += m.getTonnage() * slots;</b>
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;        return weight;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public double getWeightMisc() {
<b class="nc">&nbsp;        double weight = 0.0;</b>
&nbsp;        // Add in extra fire control system weight for exceeding base slot limit
<b class="nc">&nbsp;        for (double extra : extraSlotCost(smallCraft)) {</b>
<b class="nc">&nbsp;            weight += extra;</b>
&nbsp;        }
&nbsp;        // 7 tons each for life boats and escape pods, which includes the 5-ton vehicle and a
&nbsp;        // 2-ton launch mechanism
<b class="nc">&nbsp;        weight += (smallCraft.getLifeBoats() + smallCraft.getEscapePods()) * 7;</b>
<b class="nc">&nbsp;        return weight;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public String printWeightMisc() {
<b class="nc">&nbsp;        double weight = getWeightMisc();</b>
<b class="nc">&nbsp;        if (weight &gt; 0){</b>
<b class="nc">&nbsp;            return StringUtil.makeLength(</b>
<b class="nc">&nbsp;                    &quot;Escape pods/Life boats: &quot;, getPrintSize() - 5) + weight + &quot;\n&quot;;</b>
&nbsp;        }
<b class="nc">&nbsp;        return &quot;&quot;;</b>
&nbsp;    }
&nbsp;    
&nbsp;    @Override
&nbsp;    public StringBuffer printWeapon() {
<b class="nc">&nbsp;        if (!getEntity().usesWeaponBays()) {</b>
<b class="nc">&nbsp;            return super.printWeapon();</b>
&nbsp;        }
<b class="nc">&nbsp;        StringBuffer buffer = new StringBuffer();</b>
<b class="nc">&nbsp;        for (Mounted m : getEntity().getWeaponBayList()) {</b>
<b class="nc">&nbsp;            buffer.append(m.getName()).append(&quot; &quot;)</b>
<b class="nc">&nbsp;                .append(getLocationAbbr(m.getLocation()));</b>
<b class="nc">&nbsp;            if (m.isRearMounted()) {</b>
<b class="nc">&nbsp;                buffer.append(&quot; (R)&quot;);</b>
&nbsp;            }
<b class="nc">&nbsp;            buffer.append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;            for (Integer wNum : m.getBayWeapons()) {</b>
<b class="nc">&nbsp;                final Mounted w = getEntity().getEquipment(wNum);</b>
<b class="nc">&nbsp;                buffer.append(&quot;   &quot;).append(StringUtil.makeLength(w.getName(),</b>
<b class="nc">&nbsp;                        getPrintSize() - 25)).append(w.getTonnage())</b>
<b class="nc">&nbsp;                    .append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;            for (Integer aNum : m.getBayAmmo()) {</b>
<b class="nc">&nbsp;                final Mounted a = getEntity().getEquipment(aNum);</b>
<b class="nc">&nbsp;                double weight = a.getTonnage() * a.getBaseShotsLeft() / ((AmmoType) a.getType()).getShots();</b>
<b class="nc">&nbsp;                buffer.append(&quot;   &quot;).append(StringUtil.makeLength(a.getName(),</b>
<b class="nc">&nbsp;                        getPrintSize() - 25)).append(weight).append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;        return buffer;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public StringBuffer printAmmo() {
<b class="nc">&nbsp;        if (!smallCraft.usesWeaponBays()) {</b>
<b class="nc">&nbsp;            return super.printAmmo();</b>
&nbsp;        }
<b class="nc">&nbsp;        return new StringBuffer();</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean hasDoubleHeatSinks() {
<b class="nc">&nbsp;        return smallCraft.getHeatType() == Aero.HEAT_DOUBLE;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public String printWeightControls() {
<b class="nc">&nbsp;        return StringUtil.makeLength(</b>
<b class="nc">&nbsp;                &quot;Control Systems:&quot;, getPrintSize() - 5) + makeWeightString(getWeightControls()) +</b>
&nbsp;                &quot;\n&quot;;
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public String printWeightFuel() {
<b class="nc">&nbsp;        return StringUtil.makeLength(</b>
<b class="nc">&nbsp;                &quot;Fuel: &quot;, getPrintSize() - 5) + makeWeightString(getWeightFuel()) +</b>
&nbsp;                &quot;\n&quot;;
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public Aero getAero() {
<b class="nc">&nbsp;        return smallCraft;</b>
&nbsp;    }
&nbsp;    
&nbsp;    public SmallCraft getSmallCraft() {
<b class="nc">&nbsp;        return smallCraft;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public String printArmorLocProp(int loc, int wert) {
<b class="nc">&nbsp;        return &quot; is greater than &quot; + wert + &quot;!&quot;;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Checks to see if this unit has valid armor assignment.
&nbsp;     * 
&nbsp;     * @param buff A buffer that collects messages about validation failures
&nbsp;     * @return     Whether the unit&#39;s armor is valid
&nbsp;     */
&nbsp;    @Override
&nbsp;    public boolean correctArmor(StringBuffer buff) {
<b class="nc">&nbsp;        boolean correct = true;</b>
<b class="nc">&nbsp;        double maxArmor = maxArmorWeight(smallCraft);</b>
<b class="nc">&nbsp;        if (smallCraft.getLabArmorTonnage() &gt; maxArmor) {</b>
<b class="nc">&nbsp;            buff.append(&quot;Total armor,&quot;).append(smallCraft.getLabArmorTonnage())</b>
<b class="nc">&nbsp;                    .append(&quot; tons, is greater than the maximum: &quot;).append(maxArmor).append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;            correct = false;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return correct ;</b>
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * Checks that the heatsink type is a legal value.
&nbsp;     *
&nbsp;     * @param buff A buffer that collects messages about validation failures
&nbsp;     * @return     Whether the unit&#39;s heat sinks are valid.
&nbsp;     */
&nbsp;    @Override
&nbsp;    public boolean correctHeatSinks(StringBuffer buff) {
<b class="nc">&nbsp;        if ((smallCraft.getHeatType() != Aero.HEAT_SINGLE) </b>
<b class="nc">&nbsp;                &amp;&amp; (smallCraft.getHeatType() != Aero.HEAT_DOUBLE)) {</b>
<b class="nc">&nbsp;            buff.append(&quot;Invalid heatsink type!  Valid types are &quot;).append(Aero.HEAT_SINGLE)</b>
<b class="nc">&nbsp;                    .append(&quot; and &quot;).append(Aero.HEAT_DOUBLE).append(&quot;.  Found &quot;)</b>
<b class="nc">&nbsp;                    .append(smallCraft.getHeatType()).append(&quot;.&quot;);</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
<b class="nc">&nbsp;        return true;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean correctEntity(StringBuffer buff, int ammoTechLvl) {
<b class="nc">&nbsp;        boolean correct = true;</b>
&nbsp;        
<b class="nc">&nbsp;        if (skip()) {</b>
<b class="nc">&nbsp;            return true;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (!correctWeight(buff)) {</b>
<b class="nc">&nbsp;            buff.insert(0, printTechLevel() + printShortMovement());</b>
<b class="nc">&nbsp;            buff.append(printWeightCalculation());</b>
<b class="nc">&nbsp;            correct = false;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (getCountHeatSinks() &lt; weightFreeHeatSinks(smallCraft)) {</b>
<b class="nc">&nbsp;            buff.append(&quot;Heat Sinks:\n&quot;);</b>
<b class="nc">&nbsp;            buff.append(&quot; Total     &quot;).append(getCountHeatSinks()).append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;            buff.append(&quot; Required  &quot;).append(weightFreeHeatSinks(smallCraft)).append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;            correct = false;</b>
&nbsp;        }                
&nbsp;        
<b class="nc">&nbsp;        if (showCorrectArmor() &amp;&amp; !correctArmor(buff)) {</b>
<b class="nc">&nbsp;            correct = false;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (showFailedEquip() &amp;&amp; hasFailedEquipment(buff)) {</b>
<b class="nc">&nbsp;            correct = false;</b>
&nbsp;        }
&nbsp;        
<b class="nc">&nbsp;        correct &amp;= !hasIllegalTechLevels(buff, ammoTechLvl);</b>
<b class="nc">&nbsp;        correct &amp;= !hasIllegalEquipmentCombinations(buff);</b>
<b class="nc">&nbsp;        correct &amp;= correctHeatSinks(buff);</b>
<b class="nc">&nbsp;        correct &amp;= correctCrew(buff);</b>
<b class="nc">&nbsp;        correct &amp;= correctCriticals(buff);</b>
&nbsp;        
<b class="nc">&nbsp;        return correct;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean hasIllegalEquipmentCombinations(StringBuffer buff) {
<b class="nc">&nbsp;        boolean illegal = false;</b>
&nbsp;        
&nbsp;        // For dropships, make sure all bays have at least one weapon and that there are at least
&nbsp;        // ten shots of ammo for each ammo-using weapon in the bay.
<b class="nc">&nbsp;        for (Mounted bay : smallCraft.getWeaponBayList()) {</b>
<b class="nc">&nbsp;            if (bay.getBayWeapons().size() == 0) {</b>
<b class="nc">&nbsp;                buff.append(&quot;Bay &quot;).append(bay.getName()).append(&quot; has no weapons\n&quot;);</b>
<b class="nc">&nbsp;                illegal = true;</b>
&nbsp;            }
<b class="nc">&nbsp;            Map&lt;Integer,Integer&gt; ammoWeaponCount = new HashMap&lt;&gt;();</b>
<b class="nc">&nbsp;            Map&lt;Integer,Integer&gt; ammoTypeCount = new HashMap&lt;&gt;();</b>
<b class="nc">&nbsp;            for (Integer wNum : bay.getBayWeapons()) {</b>
<b class="nc">&nbsp;                final Mounted w = smallCraft.getEquipment(wNum);</b>
<b class="nc">&nbsp;                if (w.isOneShotWeapon()) {</b>
<b class="nc">&nbsp;                    continue;</b>
&nbsp;                }
<b class="nc">&nbsp;                if (w.getType() instanceof WeaponType) {</b>
<b class="nc">&nbsp;                    ammoWeaponCount.merge(((WeaponType)w.getType()).getAmmoType(), 1, Integer::sum);</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    buff.append(w.getName()).append(&quot; in bay &quot;).append(bay.getName()).append(&quot; is not a weapon\n&quot;);</b>
<b class="nc">&nbsp;                    illegal = true;</b>
&nbsp;                }
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;            for (Integer aNum : bay.getBayAmmo()) {</b>
<b class="nc">&nbsp;                final Mounted a = smallCraft.getEquipment(aNum);</b>
<b class="nc">&nbsp;                if (a.getType() instanceof AmmoType) {</b>
<b class="nc">&nbsp;                    ammoTypeCount.merge(((AmmoType)a.getType()).getAmmoType(), a.getUsableShotsLeft(),</b>
&nbsp;                            Integer::sum);
&nbsp;                } else {
<b class="nc">&nbsp;                    buff.append(a.getName()).append(&quot; in bay &quot;).append(bay.getName()).append(&quot; is not ammo\n&quot;);</b>
<b class="nc">&nbsp;                    illegal = true;</b>
&nbsp;                }
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;            for (Integer at : ammoWeaponCount.keySet()) {</b>
<b class="nc">&nbsp;                if (at != AmmoType.T_NA) {</b>
<b class="nc">&nbsp;                    int needed = ammoWeaponCount.get(at) * 10;</b>
<b class="nc">&nbsp;                    if ((at == AmmoType.T_AC_ULTRA) || (at == AmmoType.T_AC_ULTRA_THB)) {</b>
<b class="nc">&nbsp;                        needed *= 2;</b>
<b class="nc">&nbsp;                    } else if ((at == AmmoType.T_AC_ROTARY)) {</b>
<b class="nc">&nbsp;                        needed *= 6;</b>
&nbsp;                    }
<b class="nc">&nbsp;                    if (!ammoTypeCount.containsKey(at)</b>
<b class="nc">&nbsp;                            || ammoTypeCount.get(at) &lt; needed) {</b>
<b class="nc">&nbsp;                        buff.append(&quot;Bay &quot;).append(bay.getName()).append(&quot; does not have the minimum 10 shots of ammo for each weapon\n&quot;);</b>
<b class="nc">&nbsp;                        illegal = true;</b>
<b class="nc">&nbsp;                        break;</b>
&nbsp;                    }
&nbsp;                }
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;            for (Integer at : ammoTypeCount.keySet()) {</b>
<b class="nc">&nbsp;                if (!ammoWeaponCount.containsKey(at)) {</b>
<b class="nc">&nbsp;                    buff.append(&quot;Bay &quot;).append(bay.getName()).append(&quot; has ammo for a weapon not in the bay\n&quot;);</b>
<b class="nc">&nbsp;                    illegal = true;</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                }
<b class="nc">&nbsp;            }</b>
<b class="nc">&nbsp;        }</b>
&nbsp;        
&nbsp;        // Count lateral weapons to make sure both sides match
<b class="nc">&nbsp;        Map&lt;EquipmentType,Integer&gt; leftFwd = new HashMap&lt;&gt;();</b>
<b class="nc">&nbsp;        Map&lt;EquipmentType,Integer&gt; leftAft = new HashMap&lt;&gt;();</b>
<b class="nc">&nbsp;        Map&lt;EquipmentType,Integer&gt; rightFwd = new HashMap&lt;&gt;();</b>
<b class="nc">&nbsp;        Map&lt;EquipmentType,Integer&gt; rightAft = new HashMap&lt;&gt;();</b>
<b class="nc">&nbsp;        BigInteger typeFlag = smallCraft.hasETypeFlag(Entity.ETYPE_DROPSHIP)?</b>
<b class="nc">&nbsp;                MiscType.F_DS_EQUIPMENT : MiscType.F_SC_EQUIPMENT;</b>
<b class="nc">&nbsp;        for (Mounted m : smallCraft.getEquipment()) {</b>
<b class="nc">&nbsp;            if (m.getType() instanceof MiscType) {</b>
<b class="nc">&nbsp;                if (!m.getType().hasFlag(typeFlag)) {</b>
<b class="nc">&nbsp;                    buff.append(&quot;Cannot mount &quot;).append(m.getType().getName()).append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;                    illegal = true;</b>
&nbsp;                }
<b class="nc">&nbsp;            } else if ((m.getType() instanceof AmmoType)</b>
<b class="nc">&nbsp;                    &amp;&amp; (smallCraft.hasETypeFlag(Entity.ETYPE_DROPSHIP))</b>
<b class="nc">&nbsp;                    &amp;&amp; (((AmmoType)m.getType()).getAmmoType() == AmmoType.T_COOLANT_POD)) {</b>
<b class="nc">&nbsp;                buff.append(&quot;Cannot mount &quot;).append(m.getType().getName()).append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;                illegal = true;</b>
<b class="nc">&nbsp;            } else if (m.getType() instanceof WeaponType) {</b>
<b class="nc">&nbsp;                if (m.getLocation() == SmallCraft.LOC_LWING) {</b>
<b class="nc">&nbsp;                    if (m.isRearMounted()) {</b>
<b class="nc">&nbsp;                        leftAft.merge(m.getType(), 1, Integer::sum);</b>
&nbsp;                    } else {
<b class="nc">&nbsp;                        leftFwd.merge(m.getType(), 1, Integer::sum);</b>
&nbsp;                    }
<b class="nc">&nbsp;                } else if (m.getLocation() == SmallCraft.LOC_RWING) {</b>
<b class="nc">&nbsp;                    if (m.isRearMounted()) {</b>
<b class="nc">&nbsp;                        rightAft.merge(m.getType(), 1, Integer::sum);</b>
&nbsp;                    } else {
<b class="nc">&nbsp;                        rightFwd.merge(m.getType(), 1, Integer::sum);</b>
&nbsp;                    }
&nbsp;                }
<b class="nc">&nbsp;                if (!isAeroWeapon(m.getType(), smallCraft)) {</b>
<b class="nc">&nbsp;                    buff.append(&quot;Cannot mount &quot;).append(m.getType().getName()).append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;                    illegal = true;</b>
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;        boolean lateralMatch = true;</b>
<b class="nc">&nbsp;        for (EquipmentType eq : leftFwd.keySet()) {</b>
<b class="nc">&nbsp;            if (!rightFwd.containsKey(eq) || !leftFwd.get(eq).equals(rightFwd.get(eq))) {</b>
<b class="nc">&nbsp;                lateralMatch = false;</b>
<b class="nc">&nbsp;                break;</b>
&nbsp;            }
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;        if (lateralMatch) {</b>
&nbsp;            //We&#39;ve already checked counts, so in the reverse direction we only need to see if there&#39;s
&nbsp;            //anything not found on the other side.
<b class="nc">&nbsp;            for (EquipmentType eq : rightFwd.keySet()) {</b>
<b class="nc">&nbsp;                if (!leftFwd.containsKey(eq)) {</b>
<b class="nc">&nbsp;                    lateralMatch = false;</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                }
<b class="nc">&nbsp;            }</b>
&nbsp;        }
<b class="nc">&nbsp;        if (lateralMatch) {</b>
<b class="nc">&nbsp;            for (EquipmentType eq : leftAft.keySet()) {</b>
<b class="nc">&nbsp;                if (!rightAft.containsKey(eq) || !leftAft.get(eq).equals(rightAft.get(eq))) {</b>
<b class="nc">&nbsp;                    lateralMatch = false;</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                }
<b class="nc">&nbsp;            }</b>
&nbsp;        }
<b class="nc">&nbsp;        if (lateralMatch) {</b>
<b class="nc">&nbsp;            for (EquipmentType eq : rightAft.keySet()) {</b>
<b class="nc">&nbsp;                if (!leftAft.containsKey(eq)) {</b>
<b class="nc">&nbsp;                    lateralMatch = false;</b>
<b class="nc">&nbsp;                    break;</b>
&nbsp;                }
<b class="nc">&nbsp;            }</b>
&nbsp;        }
<b class="nc">&nbsp;        if (!lateralMatch) {</b>
<b class="nc">&nbsp;            buff.append(&quot;Left and right side weapon loads do not match.\n&quot;);</b>
<b class="nc">&nbsp;            illegal = true;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        int bayDoors = 0;</b>
<b class="nc">&nbsp;        for (Bay bay : smallCraft.getTransportBays()) {</b>
<b class="nc">&nbsp;            bayDoors += bay.getDoors();</b>
<b class="nc">&nbsp;            if (bay.getDoors() == 0) {</b>
<b class="nc">&nbsp;                BayData data = BayData.getBayType(bay);</b>
<b class="nc">&nbsp;                if ((data != null) &amp;&amp; !data.isCargoBay() &amp;&amp; !data.isInfantryBay()) {</b>
<b class="nc">&nbsp;                    buff.append(&quot;Transport bays other than cargo and infantry require at least one door.\n&quot;);</b>
<b class="nc">&nbsp;                    illegal = true;</b>
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;        if (bayDoors &gt; maxBayDoors(smallCraft)) {</b>
<b class="nc">&nbsp;            buff.append(&quot;Exceeds maximum number of bay doors.\n&quot;);</b>
<b class="nc">&nbsp;            illegal = true;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return illegal;</b>
&nbsp;    }
&nbsp;    
&nbsp;    /**
&nbsp;     * Checks that the unit meets minimum crew and quarters requirements.
&nbsp;     * @param buffer Where to write messages explaining failures.
&nbsp;     * @return  true if the crew data is valid.
&nbsp;     */
&nbsp;    public boolean correctCrew(StringBuffer buffer) {
<b class="nc">&nbsp;        boolean illegal = false;</b>
<b class="nc">&nbsp;        int crewSize = getSmallCraft().getNCrew() - getSmallCraft().getBayPersonnel();</b>
<b class="nc">&nbsp;        int reqCrew = minimumBaseCrew(getSmallCraft()) + requiredGunners(getSmallCraft());</b>
<b class="nc">&nbsp;        if (crewSize &lt; reqCrew) {</b>
<b class="nc">&nbsp;            buffer.append(&quot;Requires &quot;).append(reqCrew).append(&quot; crew and only has &quot;).append(crewSize).append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;            illegal = true;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (getSmallCraft().getNOfficers() * 5 &lt; reqCrew) {</b>
<b class="nc">&nbsp;            buffer.append(&quot;Requires at least &quot;).append((int) Math.ceil(reqCrew / 5.0)).append(&quot; officers\n&quot;);</b>
<b class="nc">&nbsp;            illegal = true;</b>
&nbsp;        }
<b class="nc">&nbsp;        crewSize += getSmallCraft().getNPassenger();</b>
<b class="nc">&nbsp;        crewSize += getSmallCraft().getNMarines();</b>
<b class="nc">&nbsp;        crewSize += getSmallCraft().getNBattleArmor();</b>
<b class="nc">&nbsp;        int quarters = 0;</b>
<b class="nc">&nbsp;        for (Bay bay : getSmallCraft().getTransportBays()) {</b>
<b class="nc">&nbsp;            Quarters q = Quarters.getQuartersForBay(bay);</b>
<b class="nc">&nbsp;            if (null != q) {</b>
<b class="nc">&nbsp;                quarters += bay.getCapacity();</b>
&nbsp;            }
<b class="nc">&nbsp;        }</b>
<b class="nc">&nbsp;        if (quarters &lt; crewSize) {</b>
<b class="nc">&nbsp;            buffer.append(&quot;Requires quarters for &quot;).append(crewSize).append(&quot; crew but only has &quot;).append(quarters).append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;            illegal = true;</b>
&nbsp;        }
<b class="nc">&nbsp;        return !illegal;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public StringBuffer printEntity() {
<b class="nc">&nbsp;        StringBuffer buff = new StringBuffer();</b>
<b class="nc">&nbsp;        buff.append(&quot;Small Craft/Dropship: &quot;).append(smallCraft.getDisplayName()).append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;        buff.append(&quot;Found in: &quot;).append(fileString).append(&quot;\n&quot;);        </b>
<b class="nc">&nbsp;        buff.append(printTechLevel());</b>
<b class="nc">&nbsp;        buff.append(&quot;Intro year: &quot;).append(getEntity().getYear()).append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;        buff.append(printSource());</b>
<b class="nc">&nbsp;        buff.append(printShortMovement());</b>
<b class="nc">&nbsp;        if (correctWeight(buff, true, true)) {</b>
<b class="nc">&nbsp;            buff.append(&quot;Weight: &quot;).append(getWeight()).append(&quot; (&quot;)</b>
<b class="nc">&nbsp;                    .append(calculateWeight()).append(&quot;)\n&quot;);</b>
&nbsp;        }
<b class="nc">&nbsp;        buff.append(printWeightCalculation()).append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;        buff.append(printArmorPlacement());</b>
<b class="nc">&nbsp;        correctArmor(buff);</b>
<b class="nc">&nbsp;        buff.append(printLocations());</b>
<b class="nc">&nbsp;        correctCriticals(buff);</b>
&nbsp;
&nbsp;        // printArmor(buff);
<b class="nc">&nbsp;        printFailedEquipment(buff);</b>
<b class="nc">&nbsp;        return buff;</b>
&nbsp;    }
&nbsp;    
&nbsp;    @Override
&nbsp;    public double calculateWeight() {
<b class="nc">&nbsp;        double weight = 0;</b>
<b class="nc">&nbsp;        weight += getWeightStructure();</b>
<b class="nc">&nbsp;        weight += getWeightEngine();</b>
<b class="nc">&nbsp;        weight += getWeightControls();</b>
<b class="nc">&nbsp;        weight += getWeightFuel();</b>
<b class="nc">&nbsp;        weight += getWeightHeatSinks();</b>
<b class="nc">&nbsp;        weight += getWeightArmor();</b>
<b class="nc">&nbsp;        weight += getWeightMisc();</b>
&nbsp;
<b class="nc">&nbsp;        weight += getWeightMiscEquip();</b>
<b class="nc">&nbsp;        weight += getWeightWeapon();</b>
<b class="nc">&nbsp;        weight += getWeightAmmo();</b>
&nbsp;
<b class="nc">&nbsp;        weight += getWeightCarryingSpace();</b>
<b class="nc">&nbsp;        weight += getWeightQuarters();</b>
&nbsp;
<b class="nc">&nbsp;        return weight;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public String printWeightCalculation() {
<b class="nc">&nbsp;        return printWeightEngine()</b>
<b class="nc">&nbsp;                + printWeightControls() + printWeightFuel() </b>
<b class="nc">&nbsp;                + printWeightHeatSinks()</b>
<b class="nc">&nbsp;                + printWeightArmor() + printWeightMisc()</b>
<b class="nc">&nbsp;                + printWeightCarryingSpace()</b>
<b class="nc">&nbsp;                + printWeightQuarters()</b>
&nbsp;                + &quot;Equipment:\n&quot;
<b class="nc">&nbsp;                + printMiscEquip() + printWeapon() + printAmmo();</b>
&nbsp;    }
&nbsp;    
&nbsp;    @Override
&nbsp;    public String printLocations() {
<b class="nc">&nbsp;        StringBuilder buff = new StringBuilder();</b>
<b class="nc">&nbsp;        for (int i = 0; i &lt; getEntity().locations(); i++) {</b>
<b class="nc">&nbsp;            String locationName = getEntity().getLocationName(i);</b>
<b class="nc">&nbsp;            buff.append(locationName).append(&quot;:&quot;);</b>
<b class="nc">&nbsp;            buff.append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;            for (int j = 0; j &lt; getEntity().getNumberOfCriticals(i); j++) {</b>
<b class="nc">&nbsp;                CriticalSlot slot = getEntity().getCritical(i, j);</b>
<b class="nc">&nbsp;                if (slot == null) {</b>
<b class="nc">&nbsp;                    j = getEntity().getNumberOfCriticals(i);                    </b>
<b class="nc">&nbsp;                } else if (slot.getType() == CriticalSlot.TYPE_SYSTEM) {</b>
<b class="nc">&nbsp;                        buff.append(j).append(&quot;. UNKNOWN SYSTEM NAME&quot;);</b>
<b class="nc">&nbsp;                        buff.append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;                } else if (slot.getType() == CriticalSlot.TYPE_EQUIPMENT) {</b>
<b class="nc">&nbsp;                    EquipmentType e = getEntity().getEquipmentType(slot);</b>
<b class="nc">&nbsp;                    buff.append(j).append(&quot;. &quot;).append(e.getInternalName());</b>
<b class="nc">&nbsp;                    buff.append(&quot;\n&quot;);</b>
&nbsp;                }
&nbsp;            }
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        double[] extra = extraSlotCost(getSmallCraft());</b>
<b class="nc">&nbsp;        for (int i = 0; i &lt; extra.length; i++) {</b>
<b class="nc">&nbsp;            if (extra[i] &gt; 0) {</b>
<b class="nc">&nbsp;                if (i &lt; getEntity().locations()) {</b>
<b class="nc">&nbsp;                    buff.append(getLocationAbbr(i));</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    buff.append(getLocationAbbr(i - 3)).append(&quot; (R)&quot;);</b>
&nbsp;                }
<b class="nc">&nbsp;                buff.append(&quot; requires &quot;).append(extra[i]).append(&quot; tons of additional fire control.\n&quot;);</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        return buff.toString();</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public String getName() {
<b class="nc">&nbsp;        if (smallCraft.hasETypeFlag(Entity.ETYPE_DROPSHIP)) {</b>
<b class="nc">&nbsp;            return &quot;Dropship: &quot; + smallCraft.getDisplayName();</b>
&nbsp;        } else {
<b class="nc">&nbsp;            return &quot;Small Craft: &quot; + smallCraft.getDisplayName();</b>
&nbsp;        }
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2023-05-16 16:28</div>
</div>
</body>
</html>
